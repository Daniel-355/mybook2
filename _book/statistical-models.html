<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Statistical models | Biostatistics Handbook</title>
  <meta name="description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.46 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Statistical models | Biostatistics Handbook" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Statistical models | Biostatistics Handbook" />
  
  <meta name="twitter:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="Daniel He" />


<meta name="date" content="2026-02-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="basic-statistics.html"/>
<link rel="next" href="probability.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/table1-1.0/table1_defaults.css" rel="stylesheet" />


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Biostatistics Handbook</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="data-wrangling.html"><a href="data-wrangling.html"><i class="fa fa-check"></i><b>1</b> Data Wrangling</a>
<ul>
<li class="chapter" data-level="1.1" data-path="data-wrangling.html"><a href="data-wrangling.html#how-to-do-data-wrangling"><i class="fa fa-check"></i><b>1.1</b> How to do data wrangling</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="data-wrangling.html"><a href="data-wrangling.html#load-data-and-package"><i class="fa fa-check"></i><b>1.1.1</b> Load data and package</a></li>
<li class="chapter" data-level="1.1.2" data-path="data-wrangling.html"><a href="data-wrangling.html#select-certain-rows"><i class="fa fa-check"></i><b>1.1.2</b> Select certain rows</a></li>
<li class="chapter" data-level="1.1.3" data-path="data-wrangling.html"><a href="data-wrangling.html#select-certain-columns"><i class="fa fa-check"></i><b>1.1.3</b> Select certain columns</a></li>
<li class="chapter" data-level="1.1.4" data-path="data-wrangling.html"><a href="data-wrangling.html#rename-variables"><i class="fa fa-check"></i><b>1.1.4</b> Rename variables</a></li>
<li class="chapter" data-level="1.1.5" data-path="data-wrangling.html"><a href="data-wrangling.html#sorting-in-ascending-or-descending-order"><i class="fa fa-check"></i><b>1.1.5</b> Sorting in ascending or descending order</a></li>
<li class="chapter" data-level="1.1.6" data-path="data-wrangling.html"><a href="data-wrangling.html#transform-variables"><i class="fa fa-check"></i><b>1.1.6</b> Transform variables</a></li>
<li class="chapter" data-level="1.1.7" data-path="data-wrangling.html"><a href="data-wrangling.html#working-with-pipes"><i class="fa fa-check"></i><b>1.1.7</b> Working with pipes %&gt;%</a></li>
<li class="chapter" data-level="1.1.8" data-path="data-wrangling.html"><a href="data-wrangling.html#pivot-wider-long-to-wide"><i class="fa fa-check"></i><b>1.1.8</b> Pivot wider (long to wide)</a></li>
<li class="chapter" data-level="1.1.9" data-path="data-wrangling.html"><a href="data-wrangling.html#pivot-longer-wide-to-long"><i class="fa fa-check"></i><b>1.1.9</b> Pivot longer (wide to long)</a></li>
<li class="chapter" data-level="1.1.10" data-path="data-wrangling.html"><a href="data-wrangling.html#separate-columns"><i class="fa fa-check"></i><b>1.1.10</b> Separate columns</a></li>
<li class="chapter" data-level="1.1.11" data-path="data-wrangling.html"><a href="data-wrangling.html#recoderelabel-data"><i class="fa fa-check"></i><b>1.1.11</b> Recode/relabel data</a></li>
<li class="chapter" data-level="1.1.12" data-path="data-wrangling.html"><a href="data-wrangling.html#deduplication"><i class="fa fa-check"></i><b>1.1.12</b> deduplication</a></li>
<li class="chapter" data-level="1.1.13" data-path="data-wrangling.html"><a href="data-wrangling.html#combine-data-sets"><i class="fa fa-check"></i><b>1.1.13</b> Combine data sets</a></li>
<li class="chapter" data-level="1.1.14" data-path="data-wrangling.html"><a href="data-wrangling.html#working-with-character-strings"><i class="fa fa-check"></i><b>1.1.14</b> Working with character strings</a></li>
<li class="chapter" data-level="1.1.15" data-path="data-wrangling.html"><a href="data-wrangling.html#conditional-operations"><i class="fa fa-check"></i><b>1.1.15</b> Conditional operations</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="data-wrangling.html"><a href="data-wrangling.html#how-to-do-aggregation-summarization"><i class="fa fa-check"></i><b>1.2</b> How to do aggregation/ summarization</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="data-wrangling.html"><a href="data-wrangling.html#summarization-after-grouping"><i class="fa fa-check"></i><b>1.2.1</b> Summarization after grouping</a></li>
<li class="chapter" data-level="1.2.2" data-path="data-wrangling.html"><a href="data-wrangling.html#summarization-with-upgroup"><i class="fa fa-check"></i><b>1.2.2</b> Summarization with upgroup</a></li>
<li class="chapter" data-level="1.2.3" data-path="data-wrangling.html"><a href="data-wrangling.html#mutate-new-variables-after-grouping"><i class="fa fa-check"></i><b>1.2.3</b> Mutate new variables after grouping</a></li>
<li class="chapter" data-level="1.2.4" data-path="data-wrangling.html"><a href="data-wrangling.html#recode-and-generate-new-variables-then-value-label"><i class="fa fa-check"></i><b>1.2.4</b> Recode and generate new variables, then value label</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="data-wrangling.html"><a href="data-wrangling.html#how-to-creat-table-1-with-test"><i class="fa fa-check"></i><b>1.3</b> How to creat table 1 with test</a></li>
<li class="chapter" data-level="1.4" data-path="data-wrangling.html"><a href="data-wrangling.html#imputing-missing-data-with-mice"><i class="fa fa-check"></i><b>1.4</b> Imputing Missing Data with MICE</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="machine-learning.html"><a href="machine-learning.html"><i class="fa fa-check"></i><b>2</b> Machine learning</a></li>
<li class="chapter" data-level="3" data-path="deep-learning.html"><a href="deep-learning.html"><i class="fa fa-check"></i><b>3</b> Deep learning</a></li>
<li class="chapter" data-level="4" data-path="data-visualization.html"><a href="data-visualization.html"><i class="fa fa-check"></i><b>4</b> Data visualization</a>
<ul>
<li class="chapter" data-level="4.1" data-path="data-visualization.html"><a href="data-visualization.html#data-visualization-introduction"><i class="fa fa-check"></i><b>4.1</b> Data visualization introduction</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="data-visualization.html"><a href="data-visualization.html#summarization"><i class="fa fa-check"></i><b>4.1.1</b> Summarization</a></li>
<li class="chapter" data-level="4.1.2" data-path="data-visualization.html"><a href="data-visualization.html#explore-missing-values"><i class="fa fa-check"></i><b>4.1.2</b> Explore missing values</a></li>
<li class="chapter" data-level="4.1.3" data-path="data-visualization.html"><a href="data-visualization.html#add-statistical-test"><i class="fa fa-check"></i><b>4.1.3</b> Add statistical test</a></li>
<li class="chapter" data-level="4.1.4" data-path="data-visualization.html"><a href="data-visualization.html#add-texts-to-dots"><i class="fa fa-check"></i><b>4.1.4</b> Add texts to dots</a></li>
<li class="chapter" data-level="4.1.5" data-path="data-visualization.html"><a href="data-visualization.html#set-the-legend"><i class="fa fa-check"></i><b>4.1.5</b> Set the legend</a></li>
<li class="chapter" data-level="4.1.6" data-path="data-visualization.html"><a href="data-visualization.html#create-a-panel-of-plots"><i class="fa fa-check"></i><b>4.1.6</b> Create a panel of plots</a></li>
<li class="chapter" data-level="4.1.7" data-path="data-visualization.html"><a href="data-visualization.html#plots-in-regression"><i class="fa fa-check"></i><b>4.1.7</b> Plots in regression</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="data-visualization.html"><a href="data-visualization.html#scatter-plot"><i class="fa fa-check"></i><b>4.2</b> Scatter plot</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="data-visualization.html"><a href="data-visualization.html#create-a-empty-canvas"><i class="fa fa-check"></i><b>4.2.1</b> Create a empty canvas</a></li>
<li class="chapter" data-level="4.2.2" data-path="data-visualization.html"><a href="data-visualization.html#add-a-layergeom-of-points-to-the-canvas"><i class="fa fa-check"></i><b>4.2.2</b> Add a layer/geom of <code>points</code> to the canvas</a></li>
<li class="chapter" data-level="4.2.3" data-path="data-visualization.html"><a href="data-visualization.html#add-another-aesthetic"><i class="fa fa-check"></i><b>4.2.3</b> Add another aesthetic</a></li>
<li class="chapter" data-level="4.2.4" data-path="data-visualization.html"><a href="data-visualization.html#add-other-aesthetic"><i class="fa fa-check"></i><b>4.2.4</b> Add other aesthetic</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="data-visualization.html"><a href="data-visualization.html#bar-chart"><i class="fa fa-check"></i><b>4.3</b> Bar chart</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="data-visualization.html"><a href="data-visualization.html#add-some-options-for-the-whole-ggplot-rather-than-layers"><i class="fa fa-check"></i><b>4.3.1</b> Add some options for the whole ggplot rather than layers</a></li>
<li class="chapter" data-level="4.3.2" data-path="data-visualization.html"><a href="data-visualization.html#grouped-bar-chart"><i class="fa fa-check"></i><b>4.3.2</b> Grouped bar chart</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="data-visualization.html"><a href="data-visualization.html#line-charts"><i class="fa fa-check"></i><b>4.4</b> Line charts</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="data-visualization.html"><a href="data-visualization.html#grouped-by-colour-variable"><i class="fa fa-check"></i><b>4.4.1</b> Grouped by <code>colour variable</code></a></li>
<li class="chapter" data-level="4.4.2" data-path="data-visualization.html"><a href="data-visualization.html#multiple-aesthetics"><i class="fa fa-check"></i><b>4.4.2</b> Multiple aesthetics</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="data-visualization.html"><a href="data-visualization.html#ggplot2-parameters"><i class="fa fa-check"></i><b>4.5</b> ggplot2 parameters</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="data-visualization.html"><a href="data-visualization.html#components-of-plot"><i class="fa fa-check"></i><b>4.5.1</b> Components of plot</a></li>
<li class="chapter" data-level="4.5.2" data-path="data-visualization.html"><a href="data-visualization.html#create-main-title-axis-labels-caption"><i class="fa fa-check"></i><b>4.5.2</b> Create main title, axis labels, caption</a></li>
<li class="chapter" data-level="4.5.3" data-path="data-visualization.html"><a href="data-visualization.html#create-legend-title-position"><i class="fa fa-check"></i><b>4.5.3</b> Create legend title, position</a></li>
<li class="chapter" data-level="4.5.4" data-path="data-visualization.html"><a href="data-visualization.html#change-plot-colors"><i class="fa fa-check"></i><b>4.5.4</b> Change plot colors</a></li>
<li class="chapter" data-level="4.5.5" data-path="data-visualization.html"><a href="data-visualization.html#change-points-shapes-transparent-and-size"><i class="fa fa-check"></i><b>4.5.5</b> Change points shapes, transparent and size</a></li>
<li class="chapter" data-level="4.5.6" data-path="data-visualization.html"><a href="data-visualization.html#change-bars-position"><i class="fa fa-check"></i><b>4.5.6</b> Change bars position</a></li>
<li class="chapter" data-level="4.5.7" data-path="data-visualization.html"><a href="data-visualization.html#add-text-annotations"><i class="fa fa-check"></i><b>4.5.7</b> Add text annotations</a></li>
<li class="chapter" data-level="4.5.8" data-path="data-visualization.html"><a href="data-visualization.html#add-a-line-that-separates-points"><i class="fa fa-check"></i><b>4.5.8</b> Add a line that (separates points)</a></li>
<li class="chapter" data-level="4.5.9" data-path="data-visualization.html"><a href="data-visualization.html#using-scale_-function"><i class="fa fa-check"></i><b>4.5.9</b> Using scale_ function</a></li>
<li class="chapter" data-level="4.5.10" data-path="data-visualization.html"><a href="data-visualization.html#change-coordinates"><i class="fa fa-check"></i><b>4.5.10</b> Change coordinates</a></li>
<li class="chapter" data-level="4.5.11" data-path="data-visualization.html"><a href="data-visualization.html#customize-axis-ticks"><i class="fa fa-check"></i><b>4.5.11</b> Customize axis ticks</a></li>
<li class="chapter" data-level="4.5.12" data-path="data-visualization.html"><a href="data-visualization.html#flip-and-reverse-plot"><i class="fa fa-check"></i><b>4.5.12</b> Flip and reverse plot</a></li>
<li class="chapter" data-level="4.5.13" data-path="data-visualization.html"><a href="data-visualization.html#create-stats"><i class="fa fa-check"></i><b>4.5.13</b> Create stats</a></li>
<li class="chapter" data-level="4.5.14" data-path="data-visualization.html"><a href="data-visualization.html#facets"><i class="fa fa-check"></i><b>4.5.14</b> Facets</a></li>
<li class="chapter" data-level="4.5.15" data-path="data-visualization.html"><a href="data-visualization.html#theme"><i class="fa fa-check"></i><b>4.5.15</b> Theme</a></li>
<li class="chapter" data-level="4.5.16" data-path="data-visualization.html"><a href="data-visualization.html#how-to-setup-subscripts-or-superscripts"><i class="fa fa-check"></i><b>4.5.16</b> How to setup subscripts or superscripts</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="data-visualization.html"><a href="data-visualization.html#how-to-create-advanced-plots"><i class="fa fa-check"></i><b>4.6</b> How to create advanced plots</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="basic-statistics.html"><a href="basic-statistics.html"><i class="fa fa-check"></i><b>5</b> Basic statistics</a>
<ul>
<li class="chapter" data-level="5.1" data-path="basic-statistics.html"><a href="basic-statistics.html#the-essentials-of-r"><i class="fa fa-check"></i><b>5.1</b> The essentials of R</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="basic-statistics.html"><a href="basic-statistics.html#manipulation-of-vector"><i class="fa fa-check"></i><b>5.1.1</b> Manipulation of vector</a></li>
<li class="chapter" data-level="5.1.2" data-path="basic-statistics.html"><a href="basic-statistics.html#generate-sequence-or-repeted-sequece"><i class="fa fa-check"></i><b>5.1.2</b> Generate sequence or repeted sequece</a></li>
<li class="chapter" data-level="5.1.3" data-path="basic-statistics.html"><a href="basic-statistics.html#get-directory-and-write-data-out-and-in"><i class="fa fa-check"></i><b>5.1.3</b> Get directory and write data out and in</a></li>
<li class="chapter" data-level="5.1.4" data-path="basic-statistics.html"><a href="basic-statistics.html#function"><i class="fa fa-check"></i><b>5.1.4</b> Function</a></li>
<li class="chapter" data-level="5.1.5" data-path="basic-statistics.html"><a href="basic-statistics.html#plot"><i class="fa fa-check"></i><b>5.1.5</b> Plot</a></li>
<li class="chapter" data-level="5.1.6" data-path="basic-statistics.html"><a href="basic-statistics.html#build-model-and-plot"><i class="fa fa-check"></i><b>5.1.6</b> Build model and plot</a></li>
<li class="chapter" data-level="5.1.7" data-path="basic-statistics.html"><a href="basic-statistics.html#rename-names-of-columns"><i class="fa fa-check"></i><b>5.1.7</b> Rename names of columns</a></li>
<li class="chapter" data-level="5.1.8" data-path="basic-statistics.html"><a href="basic-statistics.html#class-of-dataframe"><i class="fa fa-check"></i><b>5.1.8</b> Class of dataframe</a></li>
<li class="chapter" data-level="5.1.9" data-path="basic-statistics.html"><a href="basic-statistics.html#generate-new-variable-for-dataframe-character"><i class="fa fa-check"></i><b>5.1.9</b> Generate new variable for dataframe (character)</a></li>
<li class="chapter" data-level="5.1.10" data-path="basic-statistics.html"><a href="basic-statistics.html#create-a-new-dataframe-using-rnorm---random-number-from-distribution"><i class="fa fa-check"></i><b>5.1.10</b> Create a new dataframe using ‘rnorm’ - random number from distribution</a></li>
<li class="chapter" data-level="5.1.11" data-path="basic-statistics.html"><a href="basic-statistics.html#left-join-two-dataframes"><i class="fa fa-check"></i><b>5.1.11</b> Left join two dataframes</a></li>
<li class="chapter" data-level="5.1.12" data-path="basic-statistics.html"><a href="basic-statistics.html#select-variables"><i class="fa fa-check"></i><b>5.1.12</b> Select variables</a></li>
<li class="chapter" data-level="5.1.13" data-path="basic-statistics.html"><a href="basic-statistics.html#filter-observations"><i class="fa fa-check"></i><b>5.1.13</b> Filter observations</a></li>
<li class="chapter" data-level="5.1.14" data-path="basic-statistics.html"><a href="basic-statistics.html#append-rows"><i class="fa fa-check"></i><b>5.1.14</b> Append rows</a></li>
<li class="chapter" data-level="5.1.15" data-path="basic-statistics.html"><a href="basic-statistics.html#create-new-variables-instead-of-old-variables"><i class="fa fa-check"></i><b>5.1.15</b> Create new variables instead of old variables</a></li>
<li class="chapter" data-level="5.1.16" data-path="basic-statistics.html"><a href="basic-statistics.html#summarise-statistics"><i class="fa fa-check"></i><b>5.1.16</b> summarise statistics</a></li>
<li class="chapter" data-level="5.1.17" data-path="basic-statistics.html"><a href="basic-statistics.html#group-dataframe-then-summarise-statistics"><i class="fa fa-check"></i><b>5.1.17</b> Group dataframe then summarise statistics</a></li>
<li class="chapter" data-level="5.1.18" data-path="basic-statistics.html"><a href="basic-statistics.html#ungroup-then-summarise-statistics"><i class="fa fa-check"></i><b>5.1.18</b> Ungroup then summarise statistics</a></li>
<li class="chapter" data-level="5.1.19" data-path="basic-statistics.html"><a href="basic-statistics.html#summary-linear-regression-model"><i class="fa fa-check"></i><b>5.1.19</b> Summary linear regression model</a></li>
<li class="chapter" data-level="5.1.20" data-path="basic-statistics.html"><a href="basic-statistics.html#create-frequency-table"><i class="fa fa-check"></i><b>5.1.20</b> Create frequency table</a></li>
<li class="chapter" data-level="5.1.21" data-path="basic-statistics.html"><a href="basic-statistics.html#value-and-variable-label"><i class="fa fa-check"></i><b>5.1.21</b> Value and variable label</a></li>
<li class="chapter" data-level="5.1.22" data-path="basic-statistics.html"><a href="basic-statistics.html#recode-a-variable"><i class="fa fa-check"></i><b>5.1.22</b> Recode a variable</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="basic-statistics.html"><a href="basic-statistics.html#central-limit-theorem"><i class="fa fa-check"></i><b>5.2</b> Central Limit Theorem</a></li>
<li class="chapter" data-level="5.3" data-path="basic-statistics.html"><a href="basic-statistics.html#common-statistical-distribution"><i class="fa fa-check"></i><b>5.3</b> Common statistical distribution</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="statistical-models.html"><a href="statistical-models.html"><i class="fa fa-check"></i><b>6</b> Statistical models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="statistical-models.html"><a href="statistical-models.html#simple-linear-regression"><i class="fa fa-check"></i><b>6.1</b> Simple linear regression</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="statistical-models.html"><a href="statistical-models.html#linear-regeression-assumptions"><i class="fa fa-check"></i><b>6.1.1</b> Linear regeression assumptions</a></li>
<li class="chapter" data-level="6.1.2" data-path="statistical-models.html"><a href="statistical-models.html#population-regression-function"><i class="fa fa-check"></i><b>6.1.2</b> Population regression function</a></li>
<li class="chapter" data-level="6.1.3" data-path="statistical-models.html"><a href="statistical-models.html#population-regression-model"><i class="fa fa-check"></i><b>6.1.3</b> Population regression model</a></li>
<li class="chapter" data-level="6.1.4" data-path="statistical-models.html"><a href="statistical-models.html#sample-regression-model"><i class="fa fa-check"></i><b>6.1.4</b> Sample regression model</a></li>
<li class="chapter" data-level="6.1.5" data-path="statistical-models.html"><a href="statistical-models.html#least-squares-minimize-qsum-y_i-haty_i2"><i class="fa fa-check"></i><b>6.1.5</b> Least squares: minimize <span class="math inline">\(Q=\sum (Y_i-\hat{Y}_i)^2\)</span></a></li>
<li class="chapter" data-level="6.1.6" data-path="statistical-models.html"><a href="statistical-models.html#solve-hatbeta_1hatbeta_2-and-variance"><i class="fa fa-check"></i><b>6.1.6</b> Solve <span class="math inline">\(\hat{\beta}_1,\hat{\beta}_2\)</span> and variance</a></li>
<li class="chapter" data-level="6.1.7" data-path="statistical-models.html"><a href="statistical-models.html#calculate-the-variance-hatsigma2-of-error-e_i"><i class="fa fa-check"></i><b>6.1.7</b> Calculate the variance <span class="math inline">\(\hat{\sigma}^2\)</span> of error <span class="math inline">\(e_i\)</span></a></li>
<li class="chapter" data-level="6.1.8" data-path="statistical-models.html"><a href="statistical-models.html#sum-of-squares-decomposition"><i class="fa fa-check"></i><b>6.1.8</b> Sum of squares decomposition</a></li>
<li class="chapter" data-level="6.1.9" data-path="statistical-models.html"><a href="statistical-models.html#coefficient-of-determination-r2-and-goodness-of-fit"><i class="fa fa-check"></i><b>6.1.9</b> Coefficient of determination <span class="math inline">\(R^2\)</span> and goodness of fit</a></li>
<li class="chapter" data-level="6.1.10" data-path="statistical-models.html"><a href="statistical-models.html#test-of-regression-coefficients"><i class="fa fa-check"></i><b>6.1.10</b> Test of regression coefficients</a></li>
<li class="chapter" data-level="6.1.11" data-path="statistical-models.html"><a href="statistical-models.html#statistical-test-of-model"><i class="fa fa-check"></i><b>6.1.11</b> Statistical test of model</a></li>
<li class="chapter" data-level="6.1.12" data-path="statistical-models.html"><a href="statistical-models.html#mean-prediction"><i class="fa fa-check"></i><b>6.1.12</b> Mean prediction</a></li>
<li class="chapter" data-level="6.1.13" data-path="statistical-models.html"><a href="statistical-models.html#individual-prediction"><i class="fa fa-check"></i><b>6.1.13</b> Individual prediction</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="statistical-models.html"><a href="statistical-models.html#multiple-linear-regression"><i class="fa fa-check"></i><b>6.2</b> Multiple linear regression</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="statistical-models.html"><a href="statistical-models.html#matrix-format"><i class="fa fa-check"></i><b>6.2.1</b> Matrix format</a></li>
<li class="chapter" data-level="6.2.2" data-path="statistical-models.html"><a href="statistical-models.html#variance-covariance-matrix-of-random-errors"><i class="fa fa-check"></i><b>6.2.2</b> Variance covariance matrix of random errors</a></li>
<li class="chapter" data-level="6.2.3" data-path="statistical-models.html"><a href="statistical-models.html#minimize-qsum-y-haty2"><i class="fa fa-check"></i><b>6.2.3</b> Minimize <span class="math inline">\(Q=\sum (y-\hat{y})^2\)</span></a></li>
<li class="chapter" data-level="6.2.4" data-path="statistical-models.html"><a href="statistical-models.html#solve-hatbeta-by-derivation"><i class="fa fa-check"></i><b>6.2.4</b> Solve <span class="math inline">\(\hat{\beta}\)</span> by derivation</a></li>
<li class="chapter" data-level="6.2.5" data-path="statistical-models.html"><a href="statistical-models.html#solve-vartext-covmathbfhatbeta"><i class="fa fa-check"></i><b>6.2.5</b> Solve <span class="math inline">\(var\text{-}cov(\mathbf{\hat{\beta}})\)</span></a></li>
<li class="chapter" data-level="6.2.6" data-path="statistical-models.html"><a href="statistical-models.html#solve-s2mathbfhatbeta-sample"><i class="fa fa-check"></i><b>6.2.6</b> Solve <span class="math inline">\(S^2(\mathbf{\hat{\beta}})\)</span> (sample)</a></li>
<li class="chapter" data-level="6.2.7" data-path="statistical-models.html"><a href="statistical-models.html#sum-of-squares-decomposition-matrix-format"><i class="fa fa-check"></i><b>6.2.7</b> Sum of squares decomposition (matrix format)</a></li>
<li class="chapter" data-level="6.2.8" data-path="statistical-models.html"><a href="statistical-models.html#determination-coefficient-r2-and-goodness-of-fit"><i class="fa fa-check"></i><b>6.2.8</b> Determination coefficient <span class="math inline">\(R^2\)</span> and goodness of fit</a></li>
<li class="chapter" data-level="6.2.9" data-path="statistical-models.html"><a href="statistical-models.html#test-of-regression-coefficients-1"><i class="fa fa-check"></i><b>6.2.9</b> Test of regression coefficients</a></li>
<li class="chapter" data-level="6.2.10" data-path="statistical-models.html"><a href="statistical-models.html#test-of-model"><i class="fa fa-check"></i><b>6.2.10</b> Test of model</a></li>
<li class="chapter" data-level="6.2.11" data-path="statistical-models.html"><a href="statistical-models.html#mean-prediction-multiple-regression"><i class="fa fa-check"></i><b>6.2.11</b> Mean prediction (multiple regression)</a></li>
<li class="chapter" data-level="6.2.12" data-path="statistical-models.html"><a href="statistical-models.html#individual-prediction-multiple-regression"><i class="fa fa-check"></i><b>6.2.12</b> Individual prediction (multiple regression)</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="statistical-models.html"><a href="statistical-models.html#multiple-linear-regression-practice"><i class="fa fa-check"></i><b>6.3</b> Multiple linear regression practice</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="statistical-models.html"><a href="statistical-models.html#load-required-packages"><i class="fa fa-check"></i><b>6.3.1</b> Load required packages</a></li>
<li class="chapter" data-level="6.3.2" data-path="statistical-models.html"><a href="statistical-models.html#loading-and-describing-data"><i class="fa fa-check"></i><b>6.3.2</b> Loading and describing data</a></li>
<li class="chapter" data-level="6.3.3" data-path="statistical-models.html"><a href="statistical-models.html#create-table-1"><i class="fa fa-check"></i><b>6.3.3</b> Create table 1</a></li>
<li class="chapter" data-level="6.3.4" data-path="statistical-models.html"><a href="statistical-models.html#missingness-checking"><i class="fa fa-check"></i><b>6.3.4</b> Missingness checking</a></li>
<li class="chapter" data-level="6.3.5" data-path="statistical-models.html"><a href="statistical-models.html#exploratory-data-analysis"><i class="fa fa-check"></i><b>6.3.5</b> Exploratory data analysis</a></li>
<li class="chapter" data-level="6.3.6" data-path="statistical-models.html"><a href="statistical-models.html#transformations"><i class="fa fa-check"></i><b>6.3.6</b> Transformations</a></li>
<li class="chapter" data-level="6.3.7" data-path="statistical-models.html"><a href="statistical-models.html#check-linearity-between-y-and-x"><i class="fa fa-check"></i><b>6.3.7</b> Check linearity between <span class="math inline">\(y\)</span> and <span class="math inline">\(x\)</span></a></li>
<li class="chapter" data-level="6.3.8" data-path="statistical-models.html"><a href="statistical-models.html#data-imputation-and-normalization"><i class="fa fa-check"></i><b>6.3.8</b> Data imputation and normalization</a></li>
<li class="chapter" data-level="6.3.9" data-path="statistical-models.html"><a href="statistical-models.html#generate-dummy-variables"><i class="fa fa-check"></i><b>6.3.9</b> Generate dummy variables</a></li>
<li class="chapter" data-level="6.3.10" data-path="statistical-models.html"><a href="statistical-models.html#splitting-data-into-training-and-test-data"><i class="fa fa-check"></i><b>6.3.10</b> Splitting data into training and test data</a></li>
<li class="chapter" data-level="6.3.11" data-path="statistical-models.html"><a href="statistical-models.html#step-regression"><i class="fa fa-check"></i><b>6.3.11</b> Step regression</a></li>
<li class="chapter" data-level="6.3.12" data-path="statistical-models.html"><a href="statistical-models.html#create-a-model-after-selecting-variables"><i class="fa fa-check"></i><b>6.3.12</b> Create a model after selecting variables</a></li>
<li class="chapter" data-level="6.3.13" data-path="statistical-models.html"><a href="statistical-models.html#multicollinearity-checking"><i class="fa fa-check"></i><b>6.3.13</b> Multicollinearity checking</a></li>
<li class="chapter" data-level="6.3.14" data-path="statistical-models.html"><a href="statistical-models.html#plot-model-to-check-assumptions"><i class="fa fa-check"></i><b>6.3.14</b> Plot model to check assumptions</a></li>
<li class="chapter" data-level="6.3.15" data-path="statistical-models.html"><a href="statistical-models.html#add-polynomial-quadratic-terms"><i class="fa fa-check"></i><b>6.3.15</b> Add polynomial (quadratic) terms</a></li>
<li class="chapter" data-level="6.3.16" data-path="statistical-models.html"><a href="statistical-models.html#add-interaction-terms"><i class="fa fa-check"></i><b>6.3.16</b> Add interaction terms</a></li>
<li class="chapter" data-level="6.3.17" data-path="statistical-models.html"><a href="statistical-models.html#robust-regression"><i class="fa fa-check"></i><b>6.3.17</b> Robust regression</a></li>
<li class="chapter" data-level="6.3.18" data-path="statistical-models.html"><a href="statistical-models.html#create-a-model-before-transforming-data"><i class="fa fa-check"></i><b>6.3.18</b> Create a model before transforming data</a></li>
<li class="chapter" data-level="6.3.19" data-path="statistical-models.html"><a href="statistical-models.html#k-fold-cross-validation"><i class="fa fa-check"></i><b>6.3.19</b> K-fold cross validation</a></li>
<li class="chapter" data-level="6.3.20" data-path="statistical-models.html"><a href="statistical-models.html#nonnest-models-comparisons"><i class="fa fa-check"></i><b>6.3.20</b> Nonnest models comparisons</a></li>
<li class="chapter" data-level="6.3.21" data-path="statistical-models.html"><a href="statistical-models.html#posterior-predictive-diagnostic-checks"><i class="fa fa-check"></i><b>6.3.21</b> Posterior predictive / diagnostic checks</a></li>
<li class="chapter" data-level="6.3.22" data-path="statistical-models.html"><a href="statistical-models.html#forest-plot-for-coefficients"><i class="fa fa-check"></i><b>6.3.22</b> Forest plot for coefficients</a></li>
<li class="chapter" data-level="6.3.23" data-path="statistical-models.html"><a href="statistical-models.html#relative-importance"><i class="fa fa-check"></i><b>6.3.23</b> Relative Importance</a></li>
<li class="chapter" data-level="6.3.24" data-path="statistical-models.html"><a href="statistical-models.html#model-prediction"><i class="fa fa-check"></i><b>6.3.24</b> Model prediction</a></li>
<li class="chapter" data-level="6.3.25" data-path="statistical-models.html"><a href="statistical-models.html#compare-predictions-vs-actual-values"><i class="fa fa-check"></i><b>6.3.25</b> Compare predictions vs actual values</a></li>
<li class="chapter" data-level="6.3.26" data-path="statistical-models.html"><a href="statistical-models.html#manual-computation-haty-and-confidence-interval"><i class="fa fa-check"></i><b>6.3.26</b> Manual computation: <span class="math inline">\(\hat{y}\)</span> and confidence interval</a></li>
<li class="chapter" data-level="6.3.27" data-path="statistical-models.html"><a href="statistical-models.html#external-data-validation"><i class="fa fa-check"></i><b>6.3.27</b> External data validation</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="statistical-models.html"><a href="statistical-models.html#variable-selection"><i class="fa fa-check"></i><b>6.4</b> Variable selection</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="statistical-models.html"><a href="statistical-models.html#chapter-takeaways"><i class="fa fa-check"></i><b>6.4.1</b> Chapter takeaways</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="statistical-models.html"><a href="statistical-models.html#linear-mixed-model-theory"><i class="fa fa-check"></i><b>6.5</b> Linear mixed model theory</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="statistical-models.html"><a href="statistical-models.html#matrix-format-1"><i class="fa fa-check"></i><b>6.5.1</b> Matrix format</a></li>
<li class="chapter" data-level="6.5.2" data-path="statistical-models.html"><a href="statistical-models.html#why-random-effects-create-correlation"><i class="fa fa-check"></i><b>6.5.2</b> Why random effects create correlation</a></li>
<li class="chapter" data-level="6.5.3" data-path="statistical-models.html"><a href="statistical-models.html#example-reducing-the-work-stress-of-nurses"><i class="fa fa-check"></i><b>6.5.3</b> Example: reducing the work stress of nurses</a></li>
<li class="chapter" data-level="6.5.4" data-path="statistical-models.html"><a href="statistical-models.html#the-dependent-variable-mathbfy"><i class="fa fa-check"></i><b>6.5.4</b> The dependent variable <span class="math inline">\(\mathbf{y}\)</span></a></li>
<li class="chapter" data-level="6.5.5" data-path="statistical-models.html"><a href="statistical-models.html#fixed-effects-design-matrix-mathbfx"><i class="fa fa-check"></i><b>6.5.5</b> Fixed effects design matrix <span class="math inline">\(\mathbf{X}\)</span></a></li>
<li class="chapter" data-level="6.5.6" data-path="statistical-models.html"><a href="statistical-models.html#fixed-effect-coefficients-boldsymbolhatbeta"><i class="fa fa-check"></i><b>6.5.6</b> Fixed effect coefficients <span class="math inline">\(\boldsymbol{\hat{\beta}}\)</span></a></li>
<li class="chapter" data-level="6.5.7" data-path="statistical-models.html"><a href="statistical-models.html#variancecovariance-matrix-of-hatbeta"><i class="fa fa-check"></i><b>6.5.7</b> Variance–covariance matrix of <span class="math inline">\(\hat{\beta}\)</span></a></li>
<li class="chapter" data-level="6.5.8" data-path="statistical-models.html"><a href="statistical-models.html#random-effects-design-matrix-mathbfz"><i class="fa fa-check"></i><b>6.5.8</b> Random effects design matrix <span class="math inline">\(\mathbf{Z}\)</span></a></li>
<li class="chapter" data-level="6.5.9" data-path="statistical-models.html"><a href="statistical-models.html#random-effects-boldsymbolu-and-blup-intuition"><i class="fa fa-check"></i><b>6.5.9</b> Random effects <span class="math inline">\(\boldsymbol{u}\)</span> and BLUP intuition</a></li>
<li class="chapter" data-level="6.5.10" data-path="statistical-models.html"><a href="statistical-models.html#covariance-structures-mathbfg-mathbfr-and-mathbfv"><i class="fa fa-check"></i><b>6.5.10</b> Covariance structures: <span class="math inline">\(\mathbf{G}\)</span>, <span class="math inline">\(\mathbf{R}\)</span>, and <span class="math inline">\(\mathbf{V}\)</span></a></li>
<li class="chapter" data-level="6.5.11" data-path="statistical-models.html"><a href="statistical-models.html#estimating-variance-parameters"><i class="fa fa-check"></i><b>6.5.11</b> Estimating variance parameters</a></li>
<li class="chapter" data-level="6.5.12" data-path="statistical-models.html"><a href="statistical-models.html#model-statement-and-interpretation"><i class="fa fa-check"></i><b>6.5.12</b> Model statement and interpretation</a></li>
<li class="chapter" data-level="6.5.13" data-path="statistical-models.html"><a href="statistical-models.html#testing-and-model-comparison"><i class="fa fa-check"></i><b>6.5.13</b> Testing and model comparison</a></li>
<li class="chapter" data-level="6.5.14" data-path="statistical-models.html"><a href="statistical-models.html#diagnostics-what-to-actually-check"><i class="fa fa-check"></i><b>6.5.14</b> Diagnostics (what to actually check)</a></li>
<li class="chapter" data-level="6.5.15" data-path="statistical-models.html"><a href="statistical-models.html#practical-takeaway-for-readers"><i class="fa fa-check"></i><b>6.5.15</b> Practical takeaway for readers</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="statistical-models.html"><a href="statistical-models.html#linear-mixed-model-practice"><i class="fa fa-check"></i><b>6.6</b> Linear mixed model practice</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="statistical-models.html"><a href="statistical-models.html#loading-data-and-library"><i class="fa fa-check"></i><b>6.6.1</b> Loading data and library</a></li>
<li class="chapter" data-level="6.6.2" data-path="statistical-models.html"><a href="statistical-models.html#general-linear-regression-ols"><i class="fa fa-check"></i><b>6.6.2</b> General linear regression (OLS)</a></li>
<li class="chapter" data-level="6.6.3" data-path="statistical-models.html"><a href="statistical-models.html#generalized-linear-regression-glm"><i class="fa fa-check"></i><b>6.6.3</b> Generalized linear regression (GLM)</a></li>
<li class="chapter" data-level="6.6.4" data-path="statistical-models.html"><a href="statistical-models.html#varying-intercept-by-adding-a-stratum-variable-as-fixed-effect-glm"><i class="fa fa-check"></i><b>6.6.4</b> Varying intercept by adding a stratum variable as fixed effect (GLM)</a></li>
<li class="chapter" data-level="6.6.5" data-path="statistical-models.html"><a href="statistical-models.html#comparisons-of-models-fixed-effect-approach"><i class="fa fa-check"></i><b>6.6.5</b> Comparisons of models (fixed effect approach)</a></li>
<li class="chapter" data-level="6.6.6" data-path="statistical-models.html"><a href="statistical-models.html#adding-class-and-school-as-fixed-effects-glm"><i class="fa fa-check"></i><b>6.6.6</b> Adding class and school as fixed effects (GLM)</a></li>
<li class="chapter" data-level="6.6.7" data-path="statistical-models.html"><a href="statistical-models.html#considering-different-slopes-by-stratum-glm"><i class="fa fa-check"></i><b>6.6.7</b> Considering different slopes by stratum (GLM)</a></li>
<li class="chapter" data-level="6.6.8" data-path="statistical-models.html"><a href="statistical-models.html#varying-intercept-with-lmm"><i class="fa fa-check"></i><b>6.6.8</b> Varying intercept with LMM</a></li>
<li class="chapter" data-level="6.6.9" data-path="statistical-models.html"><a href="statistical-models.html#add-class-and-school-as-random-effects"><i class="fa fa-check"></i><b>6.6.9</b> Add class and school as random effects</a></li>
<li class="chapter" data-level="6.6.10" data-path="statistical-models.html"><a href="statistical-models.html#nested-terms-schoolclass"><i class="fa fa-check"></i><b>6.6.10</b> Nested terms: <code>school/class</code></a></li>
<li class="chapter" data-level="6.6.11" data-path="statistical-models.html"><a href="statistical-models.html#varying-slope-with-lmm"><i class="fa fa-check"></i><b>6.6.11</b> Varying slope with LMM</a></li>
<li class="chapter" data-level="6.6.12" data-path="statistical-models.html"><a href="statistical-models.html#summarize-model-8"><i class="fa fa-check"></i><b>6.6.12</b> Summarize model 8</a></li>
<li class="chapter" data-level="6.6.13" data-path="statistical-models.html"><a href="statistical-models.html#testing-random-effects-lrt-logic"><i class="fa fa-check"></i><b>6.6.13</b> Testing random effects (LRT logic)</a></li>
<li class="chapter" data-level="6.6.14" data-path="statistical-models.html"><a href="statistical-models.html#visualizing-grouping-structure"><i class="fa fa-check"></i><b>6.6.14</b> Visualizing grouping structure</a></li>
<li class="chapter" data-level="6.6.15" data-path="statistical-models.html"><a href="statistical-models.html#residual-checks-by-grouping-variables"><i class="fa fa-check"></i><b>6.6.15</b> Residual checks by grouping variables</a></li>
<li class="chapter" data-level="6.6.16" data-path="statistical-models.html"><a href="statistical-models.html#residuals-vs-explanatory-variables"><i class="fa fa-check"></i><b>6.6.16</b> Residuals vs explanatory variables</a></li>
<li class="chapter" data-level="6.6.17" data-path="statistical-models.html"><a href="statistical-models.html#normality-checks"><i class="fa fa-check"></i><b>6.6.17</b> Normality checks</a></li>
<li class="chapter" data-level="6.6.18" data-path="statistical-models.html"><a href="statistical-models.html#extracting-elements-parameters"><i class="fa fa-check"></i><b>6.6.18</b> Extracting elements (parameters)</a></li>
<li class="chapter" data-level="6.6.19" data-path="statistical-models.html"><a href="statistical-models.html#fitted-values-and-residuals"><i class="fa fa-check"></i><b>6.6.19</b> Fitted values and residuals</a></li>
<li class="chapter" data-level="6.6.20" data-path="statistical-models.html"><a href="statistical-models.html#fitted-lines-by-group"><i class="fa fa-check"></i><b>6.6.20</b> Fitted lines by group</a></li>
<li class="chapter" data-level="6.6.21" data-path="statistical-models.html"><a href="statistical-models.html#model-diagnostics-second-dataset-nurses"><i class="fa fa-check"></i><b>6.6.21</b> Model diagnostics (second dataset: Nurses)</a></li>
<li class="chapter" data-level="6.6.22" data-path="statistical-models.html"><a href="statistical-models.html#intra-class-correlation-icc"><i class="fa fa-check"></i><b>6.6.22</b> Intra class correlation (ICC)</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="statistical-models.html"><a href="statistical-models.html#linear-mixed-model-covariance-decomposition-with-random-intercept-lme4"><i class="fa fa-check"></i><b>6.7</b> Linear mixed model covariance decomposition with random intercept — lme4</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="statistical-models.html"><a href="statistical-models.html#load-data"><i class="fa fa-check"></i><b>6.7.1</b> Load data</a></li>
<li class="chapter" data-level="6.7.2" data-path="statistical-models.html"><a href="statistical-models.html#plot-means-and-variances-by-higher-level-variable-grouping"><i class="fa fa-check"></i><b>6.7.2</b> Plot means and variances by higher level variable (grouping)</a></li>
<li class="chapter" data-level="6.7.3" data-path="statistical-models.html"><a href="statistical-models.html#using-glm-style-fixed-effects-baseline-reference"><i class="fa fa-check"></i><b>6.7.3</b> Using glm-style fixed effects (baseline reference)</a></li>
<li class="chapter" data-level="6.7.4" data-path="statistical-models.html"><a href="statistical-models.html#using-lmm-random-intercept-in-lme4"><i class="fa fa-check"></i><b>6.7.4</b> Using LMM (random intercept) in lme4</a></li>
<li class="chapter" data-level="6.7.5" data-path="statistical-models.html"><a href="statistical-models.html#get-mathbfx-mathbfy-mathbfz"><i class="fa fa-check"></i><b>6.7.5</b> Get <span class="math inline">\(\mathbf{X}\)</span>, <span class="math inline">\(\mathbf{y}\)</span>, <span class="math inline">\(\mathbf{Z}\)</span></a></li>
<li class="chapter" data-level="6.7.6" data-path="statistical-models.html"><a href="statistical-models.html#get-fixed-and-random-effect-coefficients"><i class="fa fa-check"></i><b>6.7.6</b> Get fixed and random effect coefficients</a></li>
<li class="chapter" data-level="6.7.7" data-path="statistical-models.html"><a href="statistical-models.html#random-effect-covariance-structure-and-the-role-of-theta"><i class="fa fa-check"></i><b>6.7.7</b> Random effect covariance structure and the role of <span class="math inline">\(\theta\)</span></a></li>
<li class="chapter" data-level="6.7.8" data-path="statistical-models.html"><a href="statistical-models.html#residual-variance-and-mathbfrsigma2mathbfi"><i class="fa fa-check"></i><b>6.7.8</b> Residual variance and <span class="math inline">\(\mathbf{R}=\sigma^2\mathbf{I}\)</span></a></li>
<li class="chapter" data-level="6.7.9" data-path="statistical-models.html"><a href="statistical-models.html#marginal-covariance-matrix-mathbfv-of-mathbfy"><i class="fa fa-check"></i><b>6.7.9</b> Marginal covariance matrix <span class="math inline">\(\mathbf{V}\)</span> of <span class="math inline">\(\mathbf{y}\)</span></a></li>
<li class="chapter" data-level="6.7.10" data-path="statistical-models.html"><a href="statistical-models.html#fixed-effect-coefficient-covariance-matrix"><i class="fa fa-check"></i><b>6.7.10</b> Fixed effect coefficient covariance matrix</a></li>
<li class="chapter" data-level="6.7.11" data-path="statistical-models.html"><a href="statistical-models.html#random-effect-covariance-matrix-standard-deviation-scale"><i class="fa fa-check"></i><b>6.7.11</b> Random effect covariance matrix (standard deviation scale)</a></li>
<li class="chapter" data-level="6.7.12" data-path="statistical-models.html"><a href="statistical-models.html#compute-fixed-effect-coefficients-manually-gls"><i class="fa fa-check"></i><b>6.7.12</b> Compute fixed effect coefficients manually (GLS)</a></li>
<li class="chapter" data-level="6.7.13" data-path="statistical-models.html"><a href="statistical-models.html#compute-covariance-of-fixed-effect-coefficients-manually"><i class="fa fa-check"></i><b>6.7.13</b> Compute covariance of fixed effect coefficients manually</a></li>
<li class="chapter" data-level="6.7.14" data-path="statistical-models.html"><a href="statistical-models.html#compute-random-effect-coefficients-manually-blups"><i class="fa fa-check"></i><b>6.7.14</b> Compute random effect coefficients manually (BLUPs)</a></li>
<li class="chapter" data-level="6.7.15" data-path="statistical-models.html"><a href="statistical-models.html#compute-predicted-values"><i class="fa fa-check"></i><b>6.7.15</b> Compute predicted values</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="statistical-models.html"><a href="statistical-models.html#linear-mixed-model-covariance-decomposition-with-random-slopes-lme4"><i class="fa fa-check"></i><b>6.8</b> Linear Mixed Model Covariance Decomposition with Random Slopes (lme4)</a>
<ul>
<li class="chapter" data-level="6.8.1" data-path="statistical-models.html"><a href="statistical-models.html#load-data-1"><i class="fa fa-check"></i><b>6.8.1</b> Load data</a></li>
<li class="chapter" data-level="6.8.2" data-path="statistical-models.html"><a href="statistical-models.html#using-a-linear-mixed-model-with-random-slopes"><i class="fa fa-check"></i><b>6.8.2</b> Using a linear mixed model with random slopes</a></li>
<li class="chapter" data-level="6.8.3" data-path="statistical-models.html"><a href="statistical-models.html#extracting-the-design-matrices-x-y-and-z"><i class="fa fa-check"></i><b>6.8.3</b> Extracting the design matrices X, y, and Z</a></li>
<li class="chapter" data-level="6.8.4" data-path="statistical-models.html"><a href="statistical-models.html#fixed-and-random-effect-coefficients"><i class="fa fa-check"></i><b>6.8.4</b> Fixed and random effect coefficients</a></li>
<li class="chapter" data-level="6.8.5" data-path="statistical-models.html"><a href="statistical-models.html#random-effect-covariance-structure-matrix-expansion"><i class="fa fa-check"></i><b>6.8.5</b> Random-effect covariance structure (matrix expansion)</a></li>
<li class="chapter" data-level="6.8.6" data-path="statistical-models.html"><a href="statistical-models.html#residual-variance-and-identity-matrix"><i class="fa fa-check"></i><b>6.8.6</b> Residual variance and identity matrix</a></li>
<li class="chapter" data-level="6.8.7" data-path="statistical-models.html"><a href="statistical-models.html#covariance-matrix-of-the-response-vector-y"><i class="fa fa-check"></i><b>6.8.7</b> Covariance matrix of the response vector y</a></li>
<li class="chapter" data-level="6.8.8" data-path="statistical-models.html"><a href="statistical-models.html#covariance-matrix-of-fixed-effect-coefficients"><i class="fa fa-check"></i><b>6.8.8</b> Covariance matrix of fixed-effect coefficients</a></li>
<li class="chapter" data-level="6.8.9" data-path="statistical-models.html"><a href="statistical-models.html#random-effect-covariance-matrix"><i class="fa fa-check"></i><b>6.8.9</b> Random-effect covariance matrix</a></li>
<li class="chapter" data-level="6.8.10" data-path="statistical-models.html"><a href="statistical-models.html#computing-fixed-effect-coefficients-manually"><i class="fa fa-check"></i><b>6.8.10</b> Computing fixed-effect coefficients manually</a></li>
<li class="chapter" data-level="6.8.11" data-path="statistical-models.html"><a href="statistical-models.html#covariance-of-fixed-effect-coefficients"><i class="fa fa-check"></i><b>6.8.11</b> Covariance of fixed-effect coefficients</a></li>
<li class="chapter" data-level="6.8.12" data-path="statistical-models.html"><a href="statistical-models.html#computing-random-effect-coefficients"><i class="fa fa-check"></i><b>6.8.12</b> Computing random-effect coefficients</a></li>
<li class="chapter" data-level="6.8.13" data-path="statistical-models.html"><a href="statistical-models.html#predicted-values"><i class="fa fa-check"></i><b>6.8.13</b> Predicted values</a></li>
<li class="chapter" data-level="6.8.14" data-path="statistical-models.html"><a href="statistical-models.html#model-with-two-grouping-factors"><i class="fa fa-check"></i><b>6.8.14</b> Model with two grouping factors</a></li>
<li class="chapter" data-level="6.8.15" data-path="statistical-models.html"><a href="statistical-models.html#extracting-z-for-the-two-factor-model"><i class="fa fa-check"></i><b>6.8.15</b> Extracting Z for the two-factor model</a></li>
<li class="chapter" data-level="6.8.16" data-path="statistical-models.html"><a href="statistical-models.html#nested-versus-crossed-random-effects"><i class="fa fa-check"></i><b>6.8.16</b> Nested versus crossed random effects</a></li>
<li class="chapter" data-level="6.8.17" data-path="statistical-models.html"><a href="statistical-models.html#remark-nested-vs.-crossed-random-effects"><i class="fa fa-check"></i><b>6.8.17</b> Remark: Nested vs. crossed random effects</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="statistical-models.html"><a href="statistical-models.html#linear-mixed-model-covariance-decomposition-nlme"><i class="fa fa-check"></i><b>6.9</b> Linear Mixed Model Covariance Decomposition (nlme)</a>
<ul>
<li class="chapter" data-level="6.9.1" data-path="statistical-models.html"><a href="statistical-models.html#load-data-2"><i class="fa fa-check"></i><b>6.9.1</b> Load data</a></li>
<li class="chapter" data-level="6.9.2" data-path="statistical-models.html"><a href="statistical-models.html#exploratory-visualization"><i class="fa fa-check"></i><b>6.9.2</b> Exploratory visualization</a></li>
<li class="chapter" data-level="6.9.3" data-path="statistical-models.html"><a href="statistical-models.html#using-lme-nlme"><i class="fa fa-check"></i><b>6.9.3</b> Using lme (nlme)</a></li>
<li class="chapter" data-level="6.9.4" data-path="statistical-models.html"><a href="statistical-models.html#inference-for-fixed-effects"><i class="fa fa-check"></i><b>6.9.4</b> Inference for fixed effects</a></li>
<li class="chapter" data-level="6.9.5" data-path="statistical-models.html"><a href="statistical-models.html#model-diagnosing"><i class="fa fa-check"></i><b>6.9.5</b> Model diagnosing</a></li>
<li class="chapter" data-level="6.9.6" data-path="statistical-models.html"><a href="statistical-models.html#get-x-y-z-matrices-using-lme4"><i class="fa fa-check"></i><b>6.9.6</b> Get X, y, Z matrices (using lme4)</a></li>
<li class="chapter" data-level="6.9.7" data-path="statistical-models.html"><a href="statistical-models.html#fixed-effect-coefficient"><i class="fa fa-check"></i><b>6.9.7</b> Fixed effect coefficient</a></li>
<li class="chapter" data-level="6.9.8" data-path="statistical-models.html"><a href="statistical-models.html#random-effect-coefficient"><i class="fa fa-check"></i><b>6.9.8</b> Random effect coefficient</a></li>
<li class="chapter" data-level="6.9.9" data-path="statistical-models.html"><a href="statistical-models.html#fixed-effect-coefficients-covariance"><i class="fa fa-check"></i><b>6.9.9</b> Fixed effect coefficients covariance</a></li>
<li class="chapter" data-level="6.9.10" data-path="statistical-models.html"><a href="statistical-models.html#random-effect-covariance-and-correlation"><i class="fa fa-check"></i><b>6.9.10</b> Random effect covariance and correlation</a></li>
<li class="chapter" data-level="6.9.11" data-path="statistical-models.html"><a href="statistical-models.html#get-y-covariance-directly"><i class="fa fa-check"></i><b>6.9.11</b> Get y covariance directly</a></li>
<li class="chapter" data-level="6.9.12" data-path="statistical-models.html"><a href="statistical-models.html#residual-variance"><i class="fa fa-check"></i><b>6.9.12</b> Residual variance</a></li>
<li class="chapter" data-level="6.9.13" data-path="statistical-models.html"><a href="statistical-models.html#compute-fixed-effect-coefficients-by-gls"><i class="fa fa-check"></i><b>6.9.13</b> Compute fixed effect coefficients (by GLS)</a></li>
<li class="chapter" data-level="6.9.14" data-path="statistical-models.html"><a href="statistical-models.html#compute-covariance-of-fixed-effect-coefficients"><i class="fa fa-check"></i><b>6.9.14</b> Compute covariance of fixed effect coefficients</a></li>
<li class="chapter" data-level="6.9.15" data-path="statistical-models.html"><a href="statistical-models.html#compute-random-effect-coefficients-blup"><i class="fa fa-check"></i><b>6.9.15</b> Compute random effect coefficients (BLUP)</a></li>
<li class="chapter" data-level="6.9.16" data-path="statistical-models.html"><a href="statistical-models.html#compute-predicted-values-1"><i class="fa fa-check"></i><b>6.9.16</b> Compute predicted values</a></li>
<li class="chapter" data-level="6.9.17" data-path="statistical-models.html"><a href="statistical-models.html#the-marginal-distribution"><i class="fa fa-check"></i><b>6.9.17</b> The marginal distribution</a></li>
<li class="chapter" data-level="6.9.18" data-path="statistical-models.html"><a href="statistical-models.html#extending-the-covariance-structure-correlated-residual-errors"><i class="fa fa-check"></i><b>6.9.18</b> Extending the covariance structure: correlated residual errors</a></li>
<li class="chapter" data-level="6.9.19" data-path="statistical-models.html"><a href="statistical-models.html#using-lme-with-gaussian-correlation"><i class="fa fa-check"></i><b>6.9.19</b> Using lme with Gaussian correlation</a></li>
<li class="chapter" data-level="6.9.20" data-path="statistical-models.html"><a href="statistical-models.html#using-lme-with-autoregressive-ar1"><i class="fa fa-check"></i><b>6.9.20</b> Using lme with autoregressive (AR1)</a></li>
<li class="chapter" data-level="6.9.21" data-path="statistical-models.html"><a href="statistical-models.html#using-lme-with-exponential-correlation"><i class="fa fa-check"></i><b>6.9.21</b> Using lme with exponential correlation</a></li>
<li class="chapter" data-level="6.9.22" data-path="statistical-models.html"><a href="statistical-models.html#using-lme-with-unstructured-residual-correlation-corsymm"><i class="fa fa-check"></i><b>6.9.22</b> Using lme with unstructured residual correlation (corSymm)</a></li>
<li class="chapter" data-level="6.9.23" data-path="statistical-models.html"><a href="statistical-models.html#using-lme-with-compound-symmetry-residual-correlation-corcompsymm"><i class="fa fa-check"></i><b>6.9.23</b> Using lme with compound symmetry residual correlation (corCompSymm)</a></li>
<li class="chapter" data-level="6.9.24" data-path="statistical-models.html"><a href="statistical-models.html#gls-models-correlation-in-residuals-without-random-effects"><i class="fa fa-check"></i><b>6.9.24</b> GLS models: correlation in residuals without random effects</a></li>
<li class="chapter" data-level="6.9.25" data-path="statistical-models.html"><a href="statistical-models.html#gls-with-unstructured-correlation"><i class="fa fa-check"></i><b>6.9.25</b> GLS with unstructured correlation</a></li>
<li class="chapter" data-level="6.9.26" data-path="statistical-models.html"><a href="statistical-models.html#gls-with-compound-symmetry"><i class="fa fa-check"></i><b>6.9.26</b> GLS with compound symmetry</a></li>
<li class="chapter" data-level="6.9.27" data-path="statistical-models.html"><a href="statistical-models.html#practical-limitation-of-lme4"><i class="fa fa-check"></i><b>6.9.27</b> Practical limitation of lme4</a></li>
</ul></li>
<li class="chapter" data-level="6.10" data-path="statistical-models.html"><a href="statistical-models.html#manual-simulating-data-for-linear-mix-model"><i class="fa fa-check"></i><b>6.10</b> Manual simulating data for linear mix model</a></li>
<li class="chapter" data-level="6.11" data-path="statistical-models.html"><a href="statistical-models.html#how-to-calculate-the-prediction-interval-for-lmm"><i class="fa fa-check"></i><b>6.11</b> How to calculate the prediction interval for LMM</a></li>
<li class="chapter" data-level="6.12" data-path="statistical-models.html"><a href="statistical-models.html#least-squares-means-with-interaction-effect"><i class="fa fa-check"></i><b>6.12</b> Least-squares means with interaction effect</a></li>
<li class="chapter" data-level="6.13" data-path="statistical-models.html"><a href="statistical-models.html#spline-regression"><i class="fa fa-check"></i><b>6.13</b> Spline regression</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="probability.html"><a href="probability.html"><i class="fa fa-check"></i><b>7</b> Probability</a>
<ul>
<li class="chapter" data-level="7.1" data-path="probability.html"><a href="probability.html#probability-basics"><i class="fa fa-check"></i><b>7.1</b> Probability basics</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="probability.html"><a href="probability.html#events"><i class="fa fa-check"></i><b>7.1.1</b> Events</a></li>
<li class="chapter" data-level="7.1.2" data-path="probability.html"><a href="probability.html#probability-formulas"><i class="fa fa-check"></i><b>7.1.2</b> Probability formulas</a></li>
<li class="chapter" data-level="7.1.3" data-path="probability.html"><a href="probability.html#calculation-of-probability-operations"><i class="fa fa-check"></i><b>7.1.3</b> Calculation of probability (operations)</a></li>
<li class="chapter" data-level="7.1.4" data-path="probability.html"><a href="probability.html#bayess-theorem"><i class="fa fa-check"></i><b>7.1.4</b> Bayes’s theorem</a></li>
<li class="chapter" data-level="7.1.5" data-path="probability.html"><a href="probability.html#random-variables-and-distribution-functions"><i class="fa fa-check"></i><b>7.1.5</b> Random variables and distribution functions</a></li>
<li class="chapter" data-level="7.1.6" data-path="probability.html"><a href="probability.html#probability-distributions-joint-marginal-conditional"><i class="fa fa-check"></i><b>7.1.6</b> Probability distributions (joint, marginal, conditional)</a></li>
<li class="chapter" data-level="7.1.7" data-path="probability.html"><a href="probability.html#conditional-expectation"><i class="fa fa-check"></i><b>7.1.7</b> Conditional expectation</a></li>
<li class="chapter" data-level="7.1.8" data-path="probability.html"><a href="probability.html#conditional-variance"><i class="fa fa-check"></i><b>7.1.8</b> Conditional variance</a></li>
<li class="chapter" data-level="7.1.9" data-path="probability.html"><a href="probability.html#sampling"><i class="fa fa-check"></i><b>7.1.9</b> Sampling</a></li>
<li class="chapter" data-level="7.1.10" data-path="probability.html"><a href="probability.html#central-limit-theorem-and-law-of-large-numbers"><i class="fa fa-check"></i><b>7.1.10</b> Central limit theorem and law of large numbers</a></li>
<li class="chapter" data-level="7.1.11" data-path="probability.html"><a href="probability.html#confidence-interval"><i class="fa fa-check"></i><b>7.1.11</b> Confidence interval</a></li>
<li class="chapter" data-level="7.1.12" data-path="probability.html"><a href="probability.html#introduction-to-hypothesis-testing"><i class="fa fa-check"></i><b>7.1.12</b> Introduction to hypothesis testing</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="probability.html"><a href="probability.html#probability-r-practice"><i class="fa fa-check"></i><b>7.2</b> Probability R practice</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="probability.html"><a href="probability.html#integrate"><i class="fa fa-check"></i><b>7.2.1</b> Integrate</a></li>
<li class="chapter" data-level="7.2.2" data-path="probability.html"><a href="probability.html#derivation-symbolic-differentiation"><i class="fa fa-check"></i><b>7.2.2</b> Derivation (symbolic differentiation)</a></li>
<li class="chapter" data-level="7.2.3" data-path="probability.html"><a href="probability.html#create-random-variables-with-specific-distributions"><i class="fa fa-check"></i><b>7.2.3</b> Create random variables with specific distributions</a></li>
<li class="chapter" data-level="7.2.4" data-path="probability.html"><a href="probability.html#probability-function-examples"><i class="fa fa-check"></i><b>7.2.4</b> Probability function examples</a></li>
<li class="chapter" data-level="7.2.5" data-path="probability.html"><a href="probability.html#vector-and-operations"><i class="fa fa-check"></i><b>7.2.5</b> Vector and operations</a></li>
<li class="chapter" data-level="7.2.6" data-path="probability.html"><a href="probability.html#select-and-substitute-elements-of-vector"><i class="fa fa-check"></i><b>7.2.6</b> Select and substitute elements of vector</a></li>
<li class="chapter" data-level="7.2.7" data-path="probability.html"><a href="probability.html#matrix-and-operations"><i class="fa fa-check"></i><b>7.2.7</b> Matrix and operations</a></li>
<li class="chapter" data-level="7.2.8" data-path="probability.html"><a href="probability.html#compute-inverse-determinant-and-eigenvalues"><i class="fa fa-check"></i><b>7.2.8</b> Compute inverse, determinant and eigenvalues</a></li>
<li class="chapter" data-level="7.2.9" data-path="probability.html"><a href="probability.html#dataframe"><i class="fa fa-check"></i><b>7.2.9</b> Dataframe</a></li>
<li class="chapter" data-level="7.2.10" data-path="probability.html"><a href="probability.html#solve-problems-using-simulation"><i class="fa fa-check"></i><b>7.2.10</b> Solve problems using simulation</a></li>
<li class="chapter" data-level="7.2.11" data-path="probability.html"><a href="probability.html#permutations-and-combinations"><i class="fa fa-check"></i><b>7.2.11</b> Permutations and combinations</a></li>
<li class="chapter" data-level="7.2.12" data-path="probability.html"><a href="probability.html#search-value-position-in-vector"><i class="fa fa-check"></i><b>7.2.12</b> Search value position in vector</a></li>
<li class="chapter" data-level="7.2.13" data-path="probability.html"><a href="probability.html#solve-directly-and-optimize"><i class="fa fa-check"></i><b>7.2.13</b> Solve directly and optimize</a></li>
<li class="chapter" data-level="7.2.14" data-path="probability.html"><a href="probability.html#calculate-probability-using-simulation-method"><i class="fa fa-check"></i><b>7.2.14</b> Calculate probability using simulation method</a></li>
<li class="chapter" data-level="7.2.15" data-path="probability.html"><a href="probability.html#discrete-random-variable"><i class="fa fa-check"></i><b>7.2.15</b> Discrete random variable</a></li>
<li class="chapter" data-level="7.2.16" data-path="probability.html"><a href="probability.html#exponent-distribution"><i class="fa fa-check"></i><b>7.2.16</b> Exponent distribution</a></li>
<li class="chapter" data-level="7.2.17" data-path="probability.html"><a href="probability.html#normal-distribution-plot"><i class="fa fa-check"></i><b>7.2.17</b> Normal distribution plot</a></li>
<li class="chapter" data-level="7.2.18" data-path="probability.html"><a href="probability.html#distribution-of-random-variable-function"><i class="fa fa-check"></i><b>7.2.18</b> Distribution of random variable function</a></li>
<li class="chapter" data-level="7.2.19" data-path="probability.html"><a href="probability.html#joint-and-marginal-probability-simulation-approach"><i class="fa fa-check"></i><b>7.2.19</b> Joint and marginal probability (simulation approach)</a></li>
<li class="chapter" data-level="7.2.20" data-path="probability.html"><a href="probability.html#multiple-random-variables-derived-distributions"><i class="fa fa-check"></i><b>7.2.20</b> Multiple random variables: derived distributions</a></li>
<li class="chapter" data-level="7.2.21" data-path="probability.html"><a href="probability.html#sum-of-two-independent-normal-variables"><i class="fa fa-check"></i><b>7.2.21</b> Sum of two independent normal variables</a></li>
<li class="chapter" data-level="7.2.22" data-path="probability.html"><a href="probability.html#generate-a-circle-using-simulated-random-dots"><i class="fa fa-check"></i><b>7.2.22</b> Generate a circle using simulated random dots</a></li>
<li class="chapter" data-level="7.2.23" data-path="probability.html"><a href="probability.html#expectation-simulation"><i class="fa fa-check"></i><b>7.2.23</b> Expectation (simulation)</a></li>
<li class="chapter" data-level="7.2.24" data-path="probability.html"><a href="probability.html#central-limit-theorem-simulation"><i class="fa fa-check"></i><b>7.2.24</b> Central Limit Theorem (simulation)</a></li>
<li class="chapter" data-level="7.2.25" data-path="probability.html"><a href="probability.html#law-of-large-numbers"><i class="fa fa-check"></i><b>7.2.25</b> Law of large numbers</a></li>
<li class="chapter" data-level="7.2.26" data-path="probability.html"><a href="probability.html#empirical-distribution-function-ecdf"><i class="fa fa-check"></i><b>7.2.26</b> Empirical distribution function (ECDF)</a></li>
<li class="chapter" data-level="7.2.27" data-path="probability.html"><a href="probability.html#probability-of-mean-3-simulation"><i class="fa fa-check"></i><b>7.2.27</b> Probability of mean &gt; 3 (simulation)</a></li>
<li class="chapter" data-level="7.2.28" data-path="probability.html"><a href="probability.html#maximum-likelihood-estimate-mle"><i class="fa fa-check"></i><b>7.2.28</b> Maximum likelihood estimate (MLE)</a></li>
<li class="chapter" data-level="7.2.29" data-path="probability.html"><a href="probability.html#t-distribution-f-distribution-plots-and-common-distributions"><i class="fa fa-check"></i><b>7.2.29</b> t distribution, F distribution plots, and common distributions</a></li>
<li class="chapter" data-level="" data-path="probability.html"><a href="probability.html#closing-perspective"><i class="fa fa-check"></i>Closing perspective</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="algorithms.html"><a href="algorithms.html"><i class="fa fa-check"></i><b>8</b> Algorithms</a>
<ul>
<li class="chapter" data-level="8.1" data-path="algorithms.html"><a href="algorithms.html#maximum-likelihood-estimation"><i class="fa fa-check"></i><b>8.1</b> Maximum likelihood estimation</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="algorithms.html"><a href="algorithms.html#likelihood-estimation"><i class="fa fa-check"></i><b>8.1.1</b> Likelihood estimation</a></li>
<li class="chapter" data-level="8.1.2" data-path="algorithms.html"><a href="algorithms.html#negative-log-likelihood-scalar-form"><i class="fa fa-check"></i><b>8.1.2</b> Negative log-likelihood (scalar form)</a></li>
<li class="chapter" data-level="8.1.3" data-path="algorithms.html"><a href="algorithms.html#matrix-formulation"><i class="fa fa-check"></i><b>8.1.3</b> Matrix formulation</a></li>
<li class="chapter" data-level="8.1.4" data-path="algorithms.html"><a href="algorithms.html#minimizing-the-negative-log-likelihood"><i class="fa fa-check"></i><b>8.1.4</b> Minimizing the negative log-likelihood</a></li>
<li class="chapter" data-level="8.1.5" data-path="algorithms.html"><a href="algorithms.html#taking-derivatives"><i class="fa fa-check"></i><b>8.1.5</b> Taking derivatives</a></li>
<li class="chapter" data-level="8.1.6" data-path="algorithms.html"><a href="algorithms.html#reml-versus-ml"><i class="fa fa-check"></i><b>8.1.6</b> REML versus ML</a></li>
<li class="chapter" data-level="8.1.7" data-path="algorithms.html"><a href="algorithms.html#r-demonstration"><i class="fa fa-check"></i><b>8.1.7</b> R demonstration</a></li>
<li class="chapter" data-level="8.1.8" data-path="algorithms.html"><a href="algorithms.html#confidence-intervals-from-likelihood"><i class="fa fa-check"></i><b>8.1.8</b> Confidence intervals from likelihood</a></li>
<li class="chapter" data-level="8.1.9" data-path="algorithms.html"><a href="algorithms.html#maximum-likelihood-estimate-practice"><i class="fa fa-check"></i><b>8.1.9</b> Maximum likelihood estimate practice</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="algorithms.html"><a href="algorithms.html#gradient-descent"><i class="fa fa-check"></i><b>8.2</b> Gradient descent</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="algorithms.html"><a href="algorithms.html#linear-regression-example"><i class="fa fa-check"></i><b>8.2.1</b> Linear regression example</a></li>
<li class="chapter" data-level="8.2.2" data-path="algorithms.html"><a href="algorithms.html#cost-function-and-gradient-descent"><i class="fa fa-check"></i><b>8.2.2</b> Cost function and gradient descent</a></li>
<li class="chapter" data-level="8.2.3" data-path="algorithms.html"><a href="algorithms.html#cost-function-convergence"><i class="fa fa-check"></i><b>8.2.3</b> Cost function convergence</a></li>
<li class="chapter" data-level="8.2.4" data-path="algorithms.html"><a href="algorithms.html#comparing-gradient-descent-and-linear-regression"><i class="fa fa-check"></i><b>8.2.4</b> Comparing gradient descent and linear regression</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="algorithms.html"><a href="algorithms.html#markov-chain-monte-carlo"><i class="fa fa-check"></i><b>8.3</b> Markov chain Monte Carlo</a></li>
<li class="chapter" data-level="8.4" data-path="algorithms.html"><a href="algorithms.html#expectation-maximum"><i class="fa fa-check"></i><b>8.4</b> Expectation maximum</a></li>
<li class="chapter" data-level="8.5" data-path="algorithms.html"><a href="algorithms.html#combine-estimates-by-pooling-rules"><i class="fa fa-check"></i><b>8.5</b> Combine estimates by pooling rules</a></li>
<li class="chapter" data-level="8.6" data-path="algorithms.html"><a href="algorithms.html#simulations-and-bootstrapping"><i class="fa fa-check"></i><b>8.6</b> Simulations and Bootstrapping</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="sasmarkdown.html"><a href="sasmarkdown.html"><i class="fa fa-check"></i><b>9</b> SASmarkdown</a>
<ul>
<li class="chapter" data-level="9.1" data-path="sasmarkdown.html"><a href="sasmarkdown.html#how-to-install-sasmarkdown"><i class="fa fa-check"></i><b>9.1</b> How to install SASmarkdown</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="sasmarkdown.html"><a href="sasmarkdown.html#use-an-engine"><i class="fa fa-check"></i><b>9.1.1</b> Use an engine</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="sasmarkdown.html"><a href="sasmarkdown.html#common-statements"><i class="fa fa-check"></i><b>9.2</b> Common statements</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="sasmarkdown.html"><a href="sasmarkdown.html#read-in-data-using-informats-date-data"><i class="fa fa-check"></i><b>9.2.1</b> Read in data using informats (date data)</a></li>
<li class="chapter" data-level="9.2.2" data-path="sasmarkdown.html"><a href="sasmarkdown.html#compute-mean-and-frequency"><i class="fa fa-check"></i><b>9.2.2</b> Compute mean and frequency</a></li>
<li class="chapter" data-level="9.2.3" data-path="sasmarkdown.html"><a href="sasmarkdown.html#sort-a-dataset"><i class="fa fa-check"></i><b>9.2.3</b> Sort a dataset</a></li>
<li class="chapter" data-level="9.2.4" data-path="sasmarkdown.html"><a href="sasmarkdown.html#transpose-or-reshape"><i class="fa fa-check"></i><b>9.2.4</b> Transpose or reshape</a></li>
<li class="chapter" data-level="9.2.5" data-path="sasmarkdown.html"><a href="sasmarkdown.html#conditional-statements"><i class="fa fa-check"></i><b>9.2.5</b> Conditional statements</a></li>
<li class="chapter" data-level="9.2.6" data-path="sasmarkdown.html"><a href="sasmarkdown.html#like-operation-to-select-rows-containing-a-pattern"><i class="fa fa-check"></i><b>9.2.6</b> LIKE operation to select rows containing a pattern</a></li>
<li class="chapter" data-level="9.2.7" data-path="sasmarkdown.html"><a href="sasmarkdown.html#change-format-of-a-variable"><i class="fa fa-check"></i><b>9.2.7</b> Change format of a variable</a></li>
<li class="chapter" data-level="9.2.8" data-path="sasmarkdown.html"><a href="sasmarkdown.html#basic-operations"><i class="fa fa-check"></i><b>9.2.8</b> Basic operations</a></li>
<li class="chapter" data-level="9.2.9" data-path="sasmarkdown.html"><a href="sasmarkdown.html#rename-variables-1"><i class="fa fa-check"></i><b>9.2.9</b> Rename variables</a></li>
<li class="chapter" data-level="9.2.10" data-path="sasmarkdown.html"><a href="sasmarkdown.html#text-manipulation"><i class="fa fa-check"></i><b>9.2.10</b> Text manipulation</a></li>
<li class="chapter" data-level="9.2.11" data-path="sasmarkdown.html"><a href="sasmarkdown.html#create-a-report"><i class="fa fa-check"></i><b>9.2.11</b> Create a report</a></li>
<li class="chapter" data-level="9.2.12" data-path="sasmarkdown.html"><a href="sasmarkdown.html#random-variables"><i class="fa fa-check"></i><b>9.2.12</b> Random variables</a></li>
<li class="chapter" data-level="9.2.13" data-path="sasmarkdown.html"><a href="sasmarkdown.html#combine-two-texts-compress-spaces-locate-a-substring-change-case"><i class="fa fa-check"></i><b>9.2.13</b> Combine two texts, compress spaces, locate a substring, change case</a></li>
<li class="chapter" data-level="9.2.14" data-path="sasmarkdown.html"><a href="sasmarkdown.html#deduplication-1"><i class="fa fa-check"></i><b>9.2.14</b> Deduplication</a></li>
<li class="chapter" data-level="9.2.15" data-path="sasmarkdown.html"><a href="sasmarkdown.html#select-a-subset-of-rows"><i class="fa fa-check"></i><b>9.2.15</b> Select a subset of rows</a></li>
<li class="chapter" data-level="9.2.16" data-path="sasmarkdown.html"><a href="sasmarkdown.html#create-macros-with-do-loops"><i class="fa fa-check"></i><b>9.2.16</b> Create macros with DO loops</a></li>
<li class="chapter" data-level="9.2.17" data-path="sasmarkdown.html"><a href="sasmarkdown.html#output-intermediate-tables-with-ods"><i class="fa fa-check"></i><b>9.2.17</b> Output intermediate tables with ODS</a></li>
<li class="chapter" data-level="9.2.18" data-path="sasmarkdown.html"><a href="sasmarkdown.html#create-sequence-numbers"><i class="fa fa-check"></i><b>9.2.18</b> Create sequence numbers</a></li>
<li class="chapter" data-level="9.2.19" data-path="sasmarkdown.html"><a href="sasmarkdown.html#merge-datasets"><i class="fa fa-check"></i><b>9.2.19</b> Merge datasets</a></li>
<li class="chapter" data-level="9.2.20" data-path="sasmarkdown.html"><a href="sasmarkdown.html#create-table-1-1"><i class="fa fa-check"></i><b>9.2.20</b> Create Table 1</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="sasmarkdown.html"><a href="sasmarkdown.html#using-macros"><i class="fa fa-check"></i><b>9.3</b> Using macros</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="sasmarkdown.html"><a href="sasmarkdown.html#proc-report-for-flexible-summaries"><i class="fa fa-check"></i><b>9.3.1</b> PROC REPORT for flexible summaries</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="sasmarkdown.html"><a href="sasmarkdown.html#use-sas-formats"><i class="fa fa-check"></i><b>9.4</b> Use SAS formats</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="sasmarkdown.html"><a href="sasmarkdown.html#storing-formats-to-a-library"><i class="fa fa-check"></i><b>9.4.1</b> Storing formats to a library</a></li>
<li class="chapter" data-level="9.4.2" data-path="sasmarkdown.html"><a href="sasmarkdown.html#modify-formats"><i class="fa fa-check"></i><b>9.4.2</b> Modify formats</a></li>
<li class="chapter" data-level="9.4.3" data-path="sasmarkdown.html"><a href="sasmarkdown.html#transform-missing-to-character-then-to-numeric-again"><i class="fa fa-check"></i><b>9.4.3</b> Transform missing to character then to numeric again</a></li>
<li class="chapter" data-level="9.4.4" data-path="sasmarkdown.html"><a href="sasmarkdown.html#output-format-definition-details"><i class="fa fa-check"></i><b>9.4.4</b> Output format definition details</a></li>
<li class="chapter" data-level="9.4.5" data-path="sasmarkdown.html"><a href="sasmarkdown.html#a-macro-to-copy-an-existing-proc-format"><i class="fa fa-check"></i><b>9.4.5</b> A macro to copy an existing PROC FORMAT</a></li>
<li class="chapter" data-level="9.4.6" data-path="sasmarkdown.html"><a href="sasmarkdown.html#a-macro-to-view-the-list-of-variables"><i class="fa fa-check"></i><b>9.4.6</b> A macro to view the list of variables</a></li>
<li class="chapter" data-level="9.4.7" data-path="sasmarkdown.html"><a href="sasmarkdown.html#practical-workflow-recommendations-for-sasmarkdown"><i class="fa fa-check"></i><b>9.4.7</b> Practical workflow recommendations for SASmarkdown</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="causal-inference.html"><a href="causal-inference.html"><i class="fa fa-check"></i><b>10</b> Causal inference</a>
<ul>
<li class="chapter" data-level="10.1" data-path="causal-inference.html"><a href="causal-inference.html#causal-inference-introduction"><i class="fa fa-check"></i><b>10.1</b> Causal inference introduction</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="causal-inference.html"><a href="causal-inference.html#definitions-and-directed-acyclic-graph-dag"><i class="fa fa-check"></i><b>10.1.1</b> Definitions and directed acyclic graph (DAG)</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="causal-inference.html"><a href="causal-inference.html#inverse-probability-weighting"><i class="fa fa-check"></i><b>10.2</b> Inverse probability weighting</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="causal-inference.html"><a href="causal-inference.html#matching-and-weighting-wo-imputation"><i class="fa fa-check"></i><b>10.2.1</b> Matching and weighting w/o imputation</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="causal-inference.html"><a href="causal-inference.html#g-formula"><i class="fa fa-check"></i><b>10.3</b> G formula</a></li>
<li class="chapter" data-level="10.4" data-path="causal-inference.html"><a href="causal-inference.html#double-robust-estimators"><i class="fa fa-check"></i><b>10.4</b> Double Robust Estimators</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="causal-inference.html"><a href="causal-inference.html#superlearner"><i class="fa fa-check"></i><b>10.4.1</b> SuperLearner</a></li>
<li class="chapter" data-level="10.4.2" data-path="causal-inference.html"><a href="causal-inference.html#double-robust-estimators-using-superlearner_sl3"><i class="fa fa-check"></i><b>10.4.2</b> Double robust estimators using SuperLearner_sl3</a></li>
<li class="chapter" data-level="10.4.3" data-path="causal-inference.html"><a href="causal-inference.html#double-robust-estimators-using-tmle"><i class="fa fa-check"></i><b>10.4.3</b> Double robust estimators using TMLE</a></li>
<li class="chapter" data-level="10.4.4" data-path="causal-inference.html"><a href="causal-inference.html#longitudinal-targeted-maximum-likelihood-estimation"><i class="fa fa-check"></i><b>10.4.4</b> Longitudinal targeted maximum likelihood estimation</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="causal-inference.html"><a href="causal-inference.html#instrumental-variable-regression"><i class="fa fa-check"></i><b>10.5</b> Instrumental variable regression</a></li>
<li class="chapter" data-level="10.6" data-path="causal-inference.html"><a href="causal-inference.html#mediation-analysis"><i class="fa fa-check"></i><b>10.6</b> Mediation analysis</a></li>
<li class="chapter" data-level="10.7" data-path="causal-inference.html"><a href="causal-inference.html#confounding-and-effect-measure-modification"><i class="fa fa-check"></i><b>10.7</b> Confounding and effect measure modification</a></li>
<li class="chapter" data-level="10.8" data-path="causal-inference.html"><a href="causal-inference.html#causal-inference-and-associated-regression"><i class="fa fa-check"></i><b>10.8</b> Causal inference and associated regression</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="clinical-trial.html"><a href="clinical-trial.html"><i class="fa fa-check"></i><b>11</b> Clinical Trial</a>
<ul>
<li class="chapter" data-level="11.1" data-path="clinical-trial.html"><a href="clinical-trial.html#statistics-in-clinical-trial"><i class="fa fa-check"></i><b>11.1</b> Statistics in clinical trial</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="clinical-trial.html"><a href="clinical-trial.html#sample-size-interim-data-reports-and-randomization-of-assignment"><i class="fa fa-check"></i><b>11.1.1</b> Sample size, interim data reports and randomization of assignment</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="common-statistical-models.html"><a href="common-statistical-models.html"><i class="fa fa-check"></i><b>12</b> Common statistical models</a>
<ul>
<li class="chapter" data-level="12.1" data-path="common-statistical-models.html"><a href="common-statistical-models.html#survival-analysis"><i class="fa fa-check"></i><b>12.1</b> Survival analysis</a></li>
<li class="chapter" data-level="12.2" data-path="common-statistical-models.html"><a href="common-statistical-models.html#logistical-regression"><i class="fa fa-check"></i><b>12.2</b> Logistical regression</a></li>
<li class="chapter" data-level="12.3" data-path="common-statistical-models.html"><a href="common-statistical-models.html#poisson-regression"><i class="fa fa-check"></i><b>12.3</b> Poisson regression</a></li>
<li class="chapter" data-level="12.4" data-path="common-statistical-models.html"><a href="common-statistical-models.html#quantile-regression"><i class="fa fa-check"></i><b>12.4</b> Quantile regression</a></li>
<li class="chapter" data-level="12.5" data-path="common-statistical-models.html"><a href="common-statistical-models.html#principle-components-analysis"><i class="fa fa-check"></i><b>12.5</b> Principle components analysis</a></li>
<li class="chapter" data-level="12.6" data-path="common-statistical-models.html"><a href="common-statistical-models.html#which-covariates-should-be-adjusted"><i class="fa fa-check"></i><b>12.6</b> Which covariates should be adjusted</a></li>
<li class="chapter" data-level="12.7" data-path="common-statistical-models.html"><a href="common-statistical-models.html#variable-selection-1"><i class="fa fa-check"></i><b>12.7</b> Variable selection</a></li>
<li class="chapter" data-level="12.8" data-path="common-statistical-models.html"><a href="common-statistical-models.html#fit-regression-model-with-a-fan-shaped-relation"><i class="fa fa-check"></i><b>12.8</b> Fit regression model with a fan-shaped relation</a></li>
<li class="chapter" data-level="12.9" data-path="common-statistical-models.html"><a href="common-statistical-models.html#save-and-finalize-your-trained-model"><i class="fa fa-check"></i><b>12.9</b> Save And Finalize Your trained Model</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="bayesian-statistics.html"><a href="bayesian-statistics.html"><i class="fa fa-check"></i><b>13</b> Bayesian statistics</a>
<ul>
<li class="chapter" data-level="13.1" data-path="bayesian-statistics.html"><a href="bayesian-statistics.html#bayesian-inference-in-r"><i class="fa fa-check"></i><b>13.1</b> Bayesian Inference in R</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="epidemiolgy.html"><a href="epidemiolgy.html"><i class="fa fa-check"></i><b>14</b> Epidemiolgy</a>
<ul>
<li class="chapter" data-level="14.1" data-path="epidemiolgy.html"><a href="epidemiolgy.html#introduction"><i class="fa fa-check"></i><b>14.1</b> Introduction</a></li>
<li class="chapter" data-level="14.2" data-path="epidemiolgy.html"><a href="epidemiolgy.html#bias-analysis-and-control-in-r"><i class="fa fa-check"></i><b>14.2</b> Bias analysis and control in R</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="bioinformation.html"><a href="bioinformation.html"><i class="fa fa-check"></i><b>15</b> Bioinformation</a>
<ul>
<li class="chapter" data-level="15.1" data-path="bioinformation.html"><a href="bioinformation.html#sequence-analysis"><i class="fa fa-check"></i><b>15.1</b> Sequence Analysis</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="common-issues-in-statistics.html"><a href="common-issues-in-statistics.html"><i class="fa fa-check"></i><b>16</b> Common issues in Statistics</a></li>
<li class="chapter" data-level="17" data-path="miscellaneous.html"><a href="miscellaneous.html"><i class="fa fa-check"></i><b>17</b> Miscellaneous</a>
<ul>
<li class="chapter" data-level="17.1" data-path="miscellaneous.html"><a href="miscellaneous.html#linear-algebra"><i class="fa fa-check"></i><b>17.1</b> Linear algebra</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="miscellaneous.html"><a href="miscellaneous.html#matrix-basics"><i class="fa fa-check"></i><b>17.1.1</b> Matrix basics</a></li>
<li class="chapter" data-level="17.1.2" data-path="miscellaneous.html"><a href="miscellaneous.html#operations"><i class="fa fa-check"></i><b>17.1.2</b> Operations</a></li>
<li class="chapter" data-level="17.1.3" data-path="miscellaneous.html"><a href="miscellaneous.html#eigen-decomposition"><i class="fa fa-check"></i><b>17.1.3</b> Eigen decomposition</a></li>
<li class="chapter" data-level="17.1.4" data-path="miscellaneous.html"><a href="miscellaneous.html#advanced-operations"><i class="fa fa-check"></i><b>17.1.4</b> Advanced operations</a></li>
<li class="chapter" data-level="17.1.5" data-path="miscellaneous.html"><a href="miscellaneous.html#solve-linear-equations"><i class="fa fa-check"></i><b>17.1.5</b> Solve linear equations</a></li>
<li class="chapter" data-level="17.1.6" data-path="miscellaneous.html"><a href="miscellaneous.html#summary"><i class="fa fa-check"></i><b>17.1.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="miscellaneous.html"><a href="miscellaneous.html#calculus"><i class="fa fa-check"></i><b>17.2</b> Calculus</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="miscellaneous.html"><a href="miscellaneous.html#derivation"><i class="fa fa-check"></i><b>17.2.1</b> Derivation</a></li>
<li class="chapter" data-level="17.2.2" data-path="miscellaneous.html"><a href="miscellaneous.html#integration"><i class="fa fa-check"></i><b>17.2.2</b> Integration</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="miscellaneous.html"><a href="miscellaneous.html#sample-size-calculation-simulation-based-power"><i class="fa fa-check"></i><b>17.3</b> Sample size calculation (simulation-based power)</a></li>
<li class="chapter" data-level="17.4" data-path="miscellaneous.html"><a href="miscellaneous.html#how-to-evaluate-a-z-score"><i class="fa fa-check"></i><b>17.4</b> How to evaluate a z score</a>
<ul>
<li class="chapter" data-level="17.4.1" data-path="miscellaneous.html"><a href="miscellaneous.html#call-the-parameter-estimates-file"><i class="fa fa-check"></i><b>17.4.1</b> Call the parameter estimates file</a></li>
<li class="chapter" data-level="17.4.2" data-path="miscellaneous.html"><a href="miscellaneous.html#calculate-mean-and-standard-deviation-at-a-specific-value"><i class="fa fa-check"></i><b>17.4.2</b> Calculate mean and standard deviation at a specific value</a></li>
<li class="chapter" data-level="17.4.3" data-path="miscellaneous.html"><a href="miscellaneous.html#output-the-calculated-mean-on-exp-scale"><i class="fa fa-check"></i><b>17.4.3</b> Output the calculated mean (on exp scale)</a></li>
<li class="chapter" data-level="17.4.4" data-path="miscellaneous.html"><a href="miscellaneous.html#calculate-z-score"><i class="fa fa-check"></i><b>17.4.4</b> Calculate z score</a></li>
<li class="chapter" data-level="17.4.5" data-path="miscellaneous.html"><a href="miscellaneous.html#result-checking"><i class="fa fa-check"></i><b>17.4.5</b> Result checking</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="miscellaneous.html"><a href="miscellaneous.html#mathematical-coupling"><i class="fa fa-check"></i><b>17.5</b> Mathematical coupling</a></li>
<li class="chapter" data-level="17.6" data-path="miscellaneous.html"><a href="miscellaneous.html#how-to-create-a-bookdown"><i class="fa fa-check"></i><b>17.6</b> How to create a bookdown</a>
<ul>
<li class="chapter" data-level="17.6.1" data-path="miscellaneous.html"><a href="miscellaneous.html#how-to-git-up-a-project-into-github"><i class="fa fa-check"></i><b>17.6.1</b> How to git up a project into GitHub</a></li>
<li class="chapter" data-level="17.6.2" data-path="miscellaneous.html"><a href="miscellaneous.html#how-to-git-down-a-project-into-your-pc"><i class="fa fa-check"></i><b>17.6.2</b> How to git down a project into your PC</a></li>
<li class="chapter" data-level="17.6.3" data-path="miscellaneous.html"><a href="miscellaneous.html#how-to-return-to-a-previous-version"><i class="fa fa-check"></i><b>17.6.3</b> How to return to a previous version</a></li>
</ul></li>
<li class="chapter" data-level="17.7" data-path="miscellaneous.html"><a href="miscellaneous.html#how-to-create-a-blogdown"><i class="fa fa-check"></i><b>17.7</b> How to create a blogdown</a></li>
<li class="chapter" data-level="17.8" data-path="miscellaneous.html"><a href="miscellaneous.html#how-to-install-tensorflow-and-keras"><i class="fa fa-check"></i><b>17.8</b> How to install tensorflow and keras</a></li>
<li class="chapter" data-level="17.9" data-path="miscellaneous.html"><a href="miscellaneous.html#how-to-use-github-in-a-team"><i class="fa fa-check"></i><b>17.9</b> How to use GitHub in a team</a></li>
<li class="chapter" data-level="17.10" data-path="miscellaneous.html"><a href="miscellaneous.html#how-to-insert-a-picture-indirectly-in-markdown"><i class="fa fa-check"></i><b>17.10</b> How to insert a picture indirectly in markdown</a></li>
<li class="chapter" data-level="17.11" data-path="miscellaneous.html"><a href="miscellaneous.html#r-cheatsheets"><i class="fa fa-check"></i><b>17.11</b> R cheatsheets</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Biostatistics Handbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="statistical-models" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> Statistical models<a href="statistical-models.html#statistical-models" class="anchor-section" aria-label="Anchor link to header"></a></h1>

<div id="simple-linear-regression" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Simple linear regression<a href="statistical-models.html#simple-linear-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Simple linear regression is the most common “first model” in applied statistics. It answers a basic question:</p>
<blockquote>
<p>How does the expected value of an outcome <span class="math inline">\(Y\)</span> change as a function of a single predictor <span class="math inline">\(X\)</span>?</p>
</blockquote>
<p>Even if your final analysis uses more sophisticated methods (mixed models, GLMs, survival models), simple linear regression remains a key building block. It teaches you how estimation works, why assumptions matter, and how uncertainty is quantified through standard errors, confidence intervals, and hypothesis tests.</p>
<p>In practice, regression has two equally important goals:
1) <strong>Explanation</strong> (estimating association or effect size), and<br />
2) <strong>Prediction</strong> (forecasting outcomes at new values of <span class="math inline">\(X\)</span>).</p>
<hr />
<div id="linear-regeression-assumptions" class="section level3 hasAnchor" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> Linear regeression assumptions<a href="statistical-models.html#linear-regeression-assumptions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A regression model is only as reliable as its assumptions. In real-world analysis, the assumptions are rarely perfect, but they guide diagnostics and help you understand when inference may break down.</p>
<p>There are four principal assumptions:</p>
<ul>
<li><p><strong>Linearity</strong> of the relationship between dependent and independent variables.<br />
This means the conditional mean <span class="math inline">\(E(Y|X)\)</span> is well-approximated by a straight line. If the true relationship is curved, the linear model may still be useful as a local approximation, but interpretation can become misleading.</p></li>
<li><p><strong>Statistical independence</strong> of the errors with <span class="math inline">\(y\)</span> variable.<br />
Independence is often violated in longitudinal data, clustered data (e.g., patients within sites), or time series. When independence fails, standard errors are typically wrong—often <strong>too small</strong>, leading to overly optimistic p-values and confidence intervals that are too narrow.</p></li>
<li><p><strong>Homoscedasticity</strong> (constant variance) of the errors for all <span class="math inline">\(x\)</span>.<br />
If variability increases with <span class="math inline">\(X\)</span> (a “fanning out” pattern), the model may still estimate the mean trend reasonably, but standard errors and tests can be distorted unless you use robust methods or transform variables.</p></li>
<li><p><strong>Normality</strong> of the error distribution.<br />
Normality matters mainly for <em>small-sample inference</em>. Large samples rely less on strict normality due to asymptotic approximations. Also note: normality is assumed for the <strong>errors</strong>, not necessarily for <span class="math inline">\(X\)</span> or <span class="math inline">\(Y\)</span> marginally.</p></li>
</ul>
<p><code>if independent assumption violated, the estimated standard errors tend to underestimate the true standard error. P value associated thus is lower.</code></p>
<p><code>only the prediction errors need to be normally distributed. but with extremely asymmetric or long-tailed, it may be hard to fit them (x and y) into a linear model whose errors will be normally distributed.</code></p>
<hr />
</div>
<div id="population-regression-function" class="section level3 hasAnchor" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> Population regression function<a href="statistical-models.html#population-regression-function" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <strong>population regression function</strong> is the ideal target we would like to know: the true conditional mean of <span class="math inline">\(Y\)</span> given <span class="math inline">\(X\)</span>. Regression is fundamentally about modeling and estimating this conditional expectation.</p>
<p>Regression is to estimate and/or predict the population mean (expectation) of dependent variable (yi) by a known or a set value of explanatory variables (xi). Population regression line (PRL) is the trajectory of the conditional expectation value given Xi.</p>
<p><span class="math display">\[
E(Y|X_i)=f(X_i)=\beta_1+\beta_2X_i
\]</span></p>
<p><code>This is an unknown but fixed value (can be estimated).</code></p>
<p>A key interpretation:
- <span class="math inline">\(\beta_1\)</span> is the expected value of <span class="math inline">\(Y\)</span> when <span class="math inline">\(X=0\)</span> (sometimes meaningful, sometimes not).
- <span class="math inline">\(\beta_2\)</span> is the expected change in <span class="math inline">\(Y\)</span> for a one-unit increase in <span class="math inline">\(X\)</span>.</p>
<hr />
</div>
<div id="population-regression-model" class="section level3 hasAnchor" number="6.1.3">
<h3><span class="header-section-number">6.1.3</span> Population regression model<a href="statistical-models.html#population-regression-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the population, actual observations deviate from the regression function due to randomness and unmeasured factors. We represent this deviation as an error term <span class="math inline">\(u_i\)</span>.</p>
<p><span class="math display">\[
Y_i=\beta_1+\beta_2X_i+u_i
\]</span></p>
<p>the errors <span class="math inline">\(u_i=y_i-\hat{y}_i\)</span> have equal variance</p>
<p>In applied interpretation, <span class="math inline">\(u_i\)</span> captures everything not explained by <span class="math inline">\(X\)</span>: measurement noise, omitted variables, and inherent randomness.</p>
<hr />
</div>
<div id="sample-regression-model" class="section level3 hasAnchor" number="6.1.4">
<h3><span class="header-section-number">6.1.4</span> Sample regression model<a href="statistical-models.html#sample-regression-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In practice we observe data and estimate coefficients. The <strong>sample regression model</strong> replaces unknown population parameters with estimates (hats), and uses residuals <span class="math inline">\(e_i\)</span> as estimated errors.</p>
<p>(using hat to indicate sample)</p>
<p><span class="math display">\[
Y_i=\hat{\beta}_1+\hat{\beta}_2X_i+e_i
\]</span></p>
<p>since</p>
<p><span class="math display">\[
u_i  \sim N(0,\sigma^2)
\]</span>
or
<span class="math display">\[
e_i  \sim N(0,\hat{\sigma} ^2)
\]</span></p>
<p>and</p>
<p><code>i.i.d., independent identically distribution,  the probability distributions are all the same and variables are independent of each other.</code></p>
<p><span class="math display">\[
\begin{align}
u_i \sim i.i.d \ N(0,\sigma^2)  
\end{align}
\]</span></p>
<p>then</p>
<p><span class="math display">\[
\begin{align}
Y_i- \beta_1+\beta_2X_i (\hat{Y_i}) &amp;\sim i.i.d \ N(0,\sigma^2)\\
\end{align}
\]</span></p>
<p>This i.i.d. assumption is what allows us to derive standard errors and perform t-tests and F-tests in the classical linear regression framework.</p>
<hr />
</div>
<div id="least-squares-minimize-qsum-y_i-haty_i2" class="section level3 hasAnchor" number="6.1.5">
<h3><span class="header-section-number">6.1.5</span> Least squares: minimize <span class="math inline">\(Q=\sum (Y_i-\hat{Y}_i)^2\)</span><a href="statistical-models.html#least-squares-minimize-qsum-y_i-haty_i2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The ordinary least squares (OLS) estimator chooses coefficients that minimize the total squared residual error. Squaring penalizes large deviations and gives a unique and mathematically convenient solution.</p>
<p>thence, to minimize Q <span class="math inline">\(\sum{(Y_i-\hat{Y}_i)^2}\)</span> to solve b0 and b1.</p>
<p><span class="math display">\[
\begin{align}
Min(Q) &amp;=\sum{(Y_i-\hat{Y}_i)^2}\\
&amp;=\sum{\left ( Y_i-(\hat{\beta}_1+\hat{\beta}_2X_i) \right )^2}\\
       &amp;=f(\hat{\beta}_1,\hat{\beta}_2)
\end{align}
\]</span></p>
<hr />
</div>
<div id="solve-hatbeta_1hatbeta_2-and-variance" class="section level3 hasAnchor" number="6.1.6">
<h3><span class="header-section-number">6.1.6</span> Solve <span class="math inline">\(\hat{\beta}_1,\hat{\beta}_2\)</span> and variance<a href="statistical-models.html#solve-hatbeta_1hatbeta_2-and-variance" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Once the least squares problem is solved, you get closed-form estimators for the slope and intercept. The sampling variability of these estimators depends on:
- the error variance <span class="math inline">\(\sigma^2\)</span>,
- the spread of <span class="math inline">\(X\)</span> values (more spread → more information → smaller variance).</p>
<p><span class="math display">\[
\begin{align}
  \begin{split}
  \hat{\beta}_2 &amp;=\frac{\sum{x_iy_i}}{\sum{x_i^2}}\\
  \hat{\beta_1} &amp;=\bar{Y}_i-\hat{\beta}_2\bar{X}_i
  \end{split} \\
var(\hat{\beta}_2) =\sigma_{\hat{\beta}_2}^2&amp;=\frac{1}{\sum{x_i^2}}\cdot\sigma^2&amp;&amp;\text{} \\
var(\hat{\beta}_1) =\sigma_{\hat{\beta}_1}^2 &amp;=\frac{\sum{X_i^2}}{n\sum{x_i^2}}\cdot\sigma^2
\end{align}
\]</span></p>
<p>A practical takeaway: if your <span class="math inline">\(X\)</span> values are tightly clustered, <span class="math inline">\(\sum x_i^2\)</span> is small and the slope becomes hard to estimate precisely.</p>
<hr />
</div>
<div id="calculate-the-variance-hatsigma2-of-error-e_i" class="section level3 hasAnchor" number="6.1.7">
<h3><span class="header-section-number">6.1.7</span> Calculate the variance <span class="math inline">\(\hat{\sigma}^2\)</span> of error <span class="math inline">\(e_i\)</span><a href="statistical-models.html#calculate-the-variance-hatsigma2-of-error-e_i" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The residual variance is estimated from the residual sum of squares. Conceptually, it measures how much unexplained variability remains after fitting the regression line.</p>
<p>(for sample)</p>
<p><span class="math display">\[
\begin{align}
  \hat{Y}_i &amp;=\hat{\beta}_1+\hat{\beta}_2X_i  \\
  e_i &amp;=Y_i-\hat{Y}_i  \\
  \hat{\sigma}^2 &amp;=\frac{\sum{e_i^2}}{n-1}=\frac{\sum{(Y_i-\hat{Y}_i)^2}}{n-1}  
\end{align}
\]</span></p>
<p>(Practical note: in classical regression, the unbiased estimator typically uses <span class="math inline">\(n-2\)</span> in the denominator for simple linear regression because two parameters were estimated. Your expression shows the core idea—estimating variance from squared residuals.)</p>
<hr />
</div>
<div id="sum-of-squares-decomposition" class="section level3 hasAnchor" number="6.1.8">
<h3><span class="header-section-number">6.1.8</span> Sum of squares decomposition<a href="statistical-models.html#sum-of-squares-decomposition" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A central identity in regression is that total variability can be decomposed into explained and unexplained components. This is the basis of <span class="math inline">\(R^2\)</span> and the ANOVA-style F test.</p>
<p><span class="math display">\[
\begin{align}
(Y_i-\bar{Y_i})  &amp;= (\hat{Y_i}-\bar{Y_i}) +(Y_i-\hat{Y_i})  \\
\sum{y_i^2} &amp;= \sum{\hat{y_i}^2} +\sum{e_i^2}  \\
TSS&amp;=ESS+RSS  
\end{align}
\]</span></p>
<p>Interpretation:
- <strong>TSS</strong>: total sum of squares (overall variability around the mean)
- <strong>ESS</strong>: explained sum of squares (variability explained by the regression)
- <strong>RSS</strong>: residual sum of squares (unexplained variability)</p>
<hr />
</div>
<div id="coefficient-of-determination-r2-and-goodness-of-fit" class="section level3 hasAnchor" number="6.1.9">
<h3><span class="header-section-number">6.1.9</span> Coefficient of determination <span class="math inline">\(R^2\)</span> and goodness of fit<a href="statistical-models.html#coefficient-of-determination-r2-and-goodness-of-fit" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><span class="math inline">\(R^2\)</span> is the proportion of variability explained by the model. It is descriptive: a higher <span class="math inline">\(R^2\)</span> means the fitted line tracks the data more closely, but it does not guarantee causality or correctness of assumptions.</p>
<p><span class="math display">\[
\begin{align}
r^2 &amp;=\frac{ESS}{TSS}=\frac{\sum{(\hat{Y_i}-\bar{Y})^2}}{\sum{(Y_i-\bar{Y})^2}}\\
    &amp;=1-\frac{RSS}{TSS}=1-\frac{\sum{(Y_i-\hat{Y_i})^2}}{\sum{(Y_i-\bar{Y})^2}}
\end{align}
\]</span></p>
<p>In practice, always interpret <span class="math inline">\(R^2\)</span> alongside residual diagnostics. A model can have a decent <span class="math inline">\(R^2\)</span> but still violate key assumptions (e.g., heteroscedasticity).</p>
<hr />
</div>
<div id="test-of-regression-coefficients" class="section level3 hasAnchor" number="6.1.10">
<h3><span class="header-section-number">6.1.10</span> Test of regression coefficients<a href="statistical-models.html#test-of-regression-coefficients" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Hypothesis testing in regression typically focuses on whether coefficients differ from zero (or another clinically meaningful value). Under classical assumptions, coefficients are normally distributed around their true values.</p>
<p>since<br />
<span class="math display">\[
\begin{align}
\hat{\beta_2} &amp;\sim N(\beta_2,\sigma^2_{\hat{\beta_2}})  \\
\hat{\beta_1} &amp;\sim N(\beta_1,\sigma^2_{\hat{\beta_1}})  
\end{align}
\]</span></p>
<p>and
<span class="math display">\[
\begin{align}
S_{\hat{\beta}_2} &amp;=\sqrt{\frac{1}{\sum{x_i^2}}}\cdot\hat{\sigma}
\\
S_{\hat{\beta}_1} &amp;=\sqrt{\frac{\sum{X_i^2}}{n\sum{x_i^2}}}\cdot\hat{\sigma}
\end{align}
\]</span></p>
<p>therefore<br />
<span class="math display">\[
\begin{align}
t_{\hat{\beta_2}}^{\ast}&amp;=\frac{\hat{\beta_2}-\beta_2}{S_{\hat{\beta_2}}}
=\frac{\hat{\beta_2}}{S_{\hat{\beta_2}}}
=\frac{\hat{\beta_2}}{\sqrt{\frac{1}{\sum{x_i^2}}}\cdot\hat{\sigma}}
\sim t(n-2)
  \\
t_{\hat{\beta_1}}^{\ast}&amp;=\frac{\hat{\beta_1}-\beta_1}{S_{\hat{\beta_1}}}
=\frac{\hat{\beta_1}}{S_{\hat{\beta_1}}}
=\frac{\hat{\beta_1}}{\sqrt{\frac{\sum{X_i^2}}{n\sum{x_i^2}}}\cdot\hat{\sigma}}
\sim t(n-2)
\end{align}
\]</span></p>
<p>In applied reporting, the slope test is often the primary focus, because it corresponds to whether <span class="math inline">\(X\)</span> is associated with <span class="math inline">\(Y\)</span> in a linear trend.</p>
<hr />
</div>
<div id="statistical-test-of-model" class="section level3 hasAnchor" number="6.1.11">
<h3><span class="header-section-number">6.1.11</span> Statistical test of model<a href="statistical-models.html#statistical-test-of-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Beyond individual coefficients, we may want to test whether the model as a whole explains a statistically significant amount of variability compared with a null model.</p>
<p>since
<span class="math display">\[
\begin{align}
Y_i&amp;\sim i.i.d \ N(\beta_1+\beta_2X_i,\sigma^2)\\
\end{align}
\]</span></p>
<p>and<br />
<span class="math display">\[
\begin{align}
ESS&amp;=\sum{(\hat{Y_i}-\bar{Y})^2} \sim \chi^2(df_{ESS})  \\
RSS&amp;=\sum{(Y_i-\hat{Y_i})^2} \sim \chi^2(df_{RSS})  
\end{align}
\]</span></p>
<p>therefore
<span class="math display">\[
\begin{align}
F^{\ast}&amp;=\frac{ESS/df_{ESS}}{RSS/df_{RSS}}=\frac{MSS_{ESS}}{MSS_{RSS}}\\
        &amp;=\frac{\sum{(\hat{Y_i}-\bar{Y})^2}/df_{ESS}}{\sum{(Y_i-\hat{Y_i})^2}/df_{RSS}} \\
        &amp;=\frac{\hat{\beta_2}^2\sum{x_i^2}}{\sum{e_i^2}/{(n-2)}}\\
        &amp;=\frac{\hat{\beta_2}^2\sum{x_i^2}}{\hat{\sigma}^2}
\end{align}
\]</span></p>
<p>The F test evaluates whether the explained variation (ESS) is large relative to residual variation (RSS), after accounting for degrees of freedom.</p>
<hr />
</div>
<div id="mean-prediction" class="section level3 hasAnchor" number="6.1.12">
<h3><span class="header-section-number">6.1.12</span> Mean prediction<a href="statistical-models.html#mean-prediction" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Prediction in regression has two common targets:</p>
<ol style="list-style-type: decimal">
<li><strong>Mean prediction</strong>: the expected outcome for individuals with a given <span class="math inline">\(X_0\)</span>.<br />
</li>
<li><strong>Individual prediction</strong>: the outcome for a <em>new single individual</em> with <span class="math inline">\(X_0\)</span>.</li>
</ol>
<p>Mean prediction is more precise because it estimates an average, not a single future value.</p>
<p>since</p>
<p><span class="math display">\[
\begin{align}
\mu_{\hat{Y}_0}&amp;=E(\hat{Y}_0)\\
&amp;=E(\hat{\beta}_1+\hat{\beta}_2X_0)\\
&amp;=\beta_1+\beta_2X_0\\
&amp;=E(Y|X_0)
\end{align}
\]</span></p>
<p>and
<span class="math display">\[
\begin{align}
var(\hat{Y}_0)&amp;=\sigma^2_{\hat{Y}_0}\\
&amp;=E(\hat{\beta}_1+\hat{\beta}_2X_0)\\
&amp;=\sigma^2 \left( \frac{1}{n}+ \frac{(X_0-\bar{X})^2}{\sum{x_i^2}} \right)
\end{align}
\]</span></p>
<p>therefore
<span class="math display">\[
\begin{align}
\hat{Y}_0&amp; \sim N(\mu_{\hat{Y}_0},\sigma^2_{\hat{Y}_0})\\
\hat{Y}_0&amp; \sim N \left(E(Y|X_0), \sigma^2 \left( \frac{1}{n}+ \frac{(X_0-\bar{X})^2}{\sum{x_i^2}} \right) \right)
\end{align}
\]</span></p>
<p>then <code>construct t statistic</code> to estimate CI
<span class="math display">\[
\begin{align}
t_{\hat{Y}_0}&amp; =\frac{\hat{Y}_0-E(Y|X_0)}{S_{\hat{Y}_0}} \sim t(n-2)
\end{align}
\]</span></p>
<p><span class="math display">\[
\begin{align}
\hat{Y}_0-t_{1-\alpha/2}(n-2) \cdot S_{\hat{Y}_0} \leq E(Y|X_0) \leq \hat{Y}_0+t_{1-\alpha/2}(n-2) \cdot S_{\hat{Y}_0}
\end{align}
\]</span></p>
<p>Interpretation: the CI here is for the <em>mean response</em> at <span class="math inline">\(X_0\)</span>. It is narrow when:
- <span class="math inline">\(n\)</span> is large, and
- <span class="math inline">\(X_0\)</span> is close to <span class="math inline">\(\bar{X}\)</span> (more information near the center of the data).</p>
<hr />
</div>
<div id="individual-prediction" class="section level3 hasAnchor" number="6.1.13">
<h3><span class="header-section-number">6.1.13</span> Individual prediction<a href="statistical-models.html#individual-prediction" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Individual prediction intervals are wider because they must account for:
- uncertainty in estimating the mean trend, and
- the irreducible random error for a new observation.</p>
<p>since</p>
<p><span class="math display">\[
\begin{align}
(Y_0-\hat{Y}_0)&amp; \sim N \left(\mu_{(Y_0-\hat{Y}_0)},\sigma^2_{(Y_0-\hat{Y}_0)} \right)\\
(Y_0-\hat{Y}_0)&amp; \sim N \left(0, \sigma^2 \left(1+ \frac{1}{n}+ \frac{(X_0-\bar{X})^2}{\sum{x_i^2}} \right) \right)
\end{align}
\]</span></p>
<p>and <code>Construct t statistic</code>
<span class="math display">\[
\begin{align}
t_{\hat{Y}_0}&amp; =\frac{\hat{Y}_0-E(Y|X_0)}{S_{\hat{Y}_0}} \sim t(n-2)
\end{align}
\]</span></p>
<p>and
<span class="math display">\[
\begin{align}
S_{\hat{Y}_0}&amp; = \sqrt{\hat{\sigma}^2 \left( \frac{1}{n}+ \frac{(X_0-\bar{X})^2}{\sum{x_i^2}} \right)}
\end{align}
\]</span></p>
<p>therefore</p>
<p><span class="math display">\[
\begin{align}
\hat{Y}_0-t_{1-\alpha/2}(n-2) \cdot S_{\hat{Y}_0} \leq E(Y|X_0) \leq \hat{Y}_0+t_{1-\alpha/2}(n-2) \cdot S_{\hat{Y}_0}
\end{align}
\]</span></p>
<p><code>it is harder to predict your weight based on your age than to predict the mean weight of people who are your age. so, the interval of individual prediction is wider than those of mean prediction.</code></p>
<p>A practical mental model:
- <strong>Mean CI</strong> answers: “What is the expected mean outcome at <span class="math inline">\(X_0\)</span>?”
- <strong>Prediction interval</strong> answers: “Where might a new individual outcome fall at <span class="math inline">\(X_0\)</span>?”</p>
<hr />
</div>
</div>
<div id="multiple-linear-regression" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Multiple linear regression<a href="statistical-models.html#multiple-linear-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Multiple linear regression generalizes the simple model by allowing multiple predictors. The key shift is that each coefficient is interpreted as an effect <strong>holding other variables constant</strong>.</p>
<div id="matrix-format" class="section level3 hasAnchor" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Matrix format<a href="statistical-models.html#matrix-format" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><span class="math display">\[
\begin{align}
Y_i&amp;=\beta_1+\beta_2X_{2i}+\beta_3X_{3i}+\cdots+\beta_kX_{ki}+u_i
&amp;&amp; \
\end{align}
\]</span></p>
<p><span class="math display">\[
\begin{equation}
  \begin{bmatrix}
  Y_1 \\  Y_2 \\  \cdots \\  Y_n \\
  \end{bmatrix}  =
  \begin{bmatrix}
  1 &amp;  X_{21} &amp; X_{31} &amp; \cdots &amp;  X_{k1} \\
  1 &amp;  X_{22} &amp; X_{32} &amp; \cdots &amp;  X_{k2} \\
  \cdots &amp;  \cdots &amp; \cdots &amp; \cdots &amp;  \cdots \\
  1 &amp;  X_{2n} &amp; X_{3n} &amp; \cdots &amp;  X_{kn}
  \end{bmatrix}
  \begin{bmatrix}
  \beta_1 \\  \beta_2 \\  \vdots \\  \beta_k \\
  \end{bmatrix}+
  \begin{bmatrix}
  u_1 \\  u_2 \\  \vdots \\  u_n \\
  \end{bmatrix}
\end{equation}
\]</span></p>
<p><span class="math display">\[
\begin{alignat}{4}
\mathbf{y} &amp;= &amp;\mathbf{X}&amp;\mathbf{\beta}&amp;+&amp;\mathbf{u}
\\
(n \times 1) &amp;  &amp;{(n \times k)} &amp;{(k \times 1)}&amp;+&amp;{(n \times 1)}
\end{alignat}
\]</span></p>
<p>The matrix form is not just notation—it simplifies derivations and makes the estimator compact and general.</p>
<hr />
</div>
<div id="variance-covariance-matrix-of-random-errors" class="section level3 hasAnchor" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> Variance covariance matrix of random errors<a href="statistical-models.html#variance-covariance-matrix-of-random-errors" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The classical assumption is that errors are independent, have equal variance, and have zero covariance. This leads to a diagonal variance-covariance structure proportional to the identity matrix.</p>
<p>because
<span class="math display">\[
\mathbf{u} \sim N(\mathbf{0},\sigma^2\mathbf{I})\text{    population}\\
\mathbf{e} \sim N(\mathbf{0},\sigma^2\mathbf{I})\text{    sample}\
\]</span></p>
<p>therefore
<span class="math display">\[
\begin{align}
var-cov(\mathbf{u})&amp;=E(\mathbf{uu&#39;})\\
&amp;=
  \begin{bmatrix}
  \sigma_1^2 &amp; \sigma_{12}^2  &amp;\cdots &amp;\sigma_{1n}^2\\
  \sigma_{21}^2 &amp; \sigma_2^2  &amp;\cdots &amp;\sigma_{2n}^2\\
  \vdots &amp; \vdots &amp;\vdots &amp;\vdots \\
  \sigma_{n1}^2 &amp; \sigma_{n2}^2  &amp;\cdots &amp;\sigma_n^2\\
  \end{bmatrix}  
  &amp;&amp; \leftarrow (E{(u_i)}=0)\\
&amp;=
  \begin{bmatrix}
  \sigma^2 &amp; \sigma_{12}^2  &amp;\cdots &amp;\sigma_{1n}^2\\
  \sigma_{21}^2 &amp; \sigma^2  &amp;\cdots &amp;\sigma_{2n}^2\\
  \vdots &amp; \vdots &amp;\vdots &amp;\vdots \\
  \sigma_{n1}^2 &amp; \sigma_{n2}^2  &amp;\cdots &amp;\sigma^2\\
  \end{bmatrix}
  &amp;&amp; \leftarrow (var{(u_i)}=\sigma^2)\\
&amp;=
  \begin{bmatrix}
  \sigma^2 &amp; 0  &amp;\cdots &amp;0\\
  0 &amp; \sigma^2  &amp;\cdots &amp;0\\
  \vdots &amp; \vdots &amp;\vdots &amp;\vdots \\
  0 &amp; 0  &amp;\cdots &amp;\sigma^2\\
  \end{bmatrix}
  &amp;&amp; \leftarrow (cov{(u_i,u_j)}=0,i \neq j)\\
&amp;=\sigma^2
  \begin{bmatrix}
  1 &amp; 0  &amp;\cdots &amp;0\\
  0 &amp; 1  &amp;\cdots &amp;0\\
  \vdots &amp; \vdots &amp;\vdots &amp;\vdots \\
  0 &amp; 0  &amp;\cdots &amp;1\\
  \end{bmatrix}\\
&amp;=\sigma^2\mathbf{I}
\end{align}
\]</span></p>
<p>In applied work, this assumption is often challenged by clustering and repeated measures. When violated, analysts may move to robust standard errors, GLS, or mixed effects models.</p>
<hr />
</div>
<div id="minimize-qsum-y-haty2" class="section level3 hasAnchor" number="6.2.3">
<h3><span class="header-section-number">6.2.3</span> Minimize <span class="math inline">\(Q=\sum (y-\hat{y})^2\)</span><a href="statistical-models.html#minimize-qsum-y-haty2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In matrix form, OLS still minimizes the squared residuals, but the algebra becomes compact and scalable.</p>
<p><span class="math display">\[
\begin{align}
Q&amp;=\sum{e_i^2}\\
&amp;=\mathbf{e&#39;e}\\
&amp;=\mathbf{(y-X\hat{\beta})&#39;(y-X\hat{\beta})}\\
&amp;=\mathbf{y&#39;y-2\hat{\beta}&#39;X&#39;y+\hat{\beta}&#39;X&#39;X\hat{\beta}}
\end{align}
\]</span></p>
<hr />
</div>
<div id="solve-hatbeta-by-derivation" class="section level3 hasAnchor" number="6.2.4">
<h3><span class="header-section-number">6.2.4</span> Solve <span class="math inline">\(\hat{\beta}\)</span> by derivation<a href="statistical-models.html#solve-hatbeta-by-derivation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Setting the derivative with respect to <span class="math inline">\(\hat{\beta}\)</span> equal to zero yields the normal equations. Solving them gives the closed-form OLS estimator.</p>
<p>(population=sample)</p>
<p><span class="math display">\[
\begin{align}
\frac{\partial Q}{\partial \mathbf{\hat{\beta}}}&amp;=0\\
\frac{\partial(\mathbf{y&#39;y-2\hat{\beta}&#39;X&#39;y+\hat{\beta}&#39;X&#39;X\hat{\beta}})}{\partial \mathbf{\hat{\beta}}}&amp;=0\\
-2\mathbf{X&#39;y}+2\mathbf{X&#39;X\hat{\beta}}&amp;=0\\
-\mathbf{X&#39;y}+\mathbf{X&#39;X\hat{\beta}}&amp;=0\\
\mathbf{X&#39;X\hat{\beta}} &amp;=\mathbf{X&#39;y}
\end{align}
\]</span></p>
<p><span class="math display">\[
\begin{align}
\mathbf{\hat{\beta}} &amp;=\mathbf{(X&#39;X)^{-1}X&#39;y}
\end{align}
\]</span></p>
<p>Interpretation: <span class="math inline">\((X&#39;X)^{-1}\)</span> reflects the information in the design matrix. When predictors are highly correlated (multicollinearity), <span class="math inline">\(X&#39;X\)</span> becomes nearly singular and coefficient estimates become unstable.</p>
<hr />
</div>
<div id="solve-vartext-covmathbfhatbeta" class="section level3 hasAnchor" number="6.2.5">
<h3><span class="header-section-number">6.2.5</span> Solve <span class="math inline">\(var\text{-}cov(\mathbf{\hat{\beta}})\)</span><a href="statistical-models.html#solve-vartext-covmathbfhatbeta" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The variance-covariance matrix of <span class="math inline">\(\hat{\beta}\)</span> is the core object for inference in multiple regression. It contains:
- variances of each coefficient (diagonal),
- covariances between coefficients (off-diagonal).</p>
<p><span class="math display">\[
\begin{align}
var-cov(\mathbf{\hat{\beta}})
&amp;=\mathbf{E\left( \left(\hat{\beta}-E(\hat{\beta}) \right) \left( \hat{\beta}-E(\hat{\beta}) \right )&#39; \right)}\\
&amp;=\mathbf{E\left( \left(\hat{\beta}-{\beta} \right) \left( \hat{\beta}-\beta \right )&#39; \right)} \\
&amp;=\mathbf{E\left( \left((X&#39;X)^{-1}X&#39;u \right) \left( (X&#39;X)^{-1}X&#39;u \right )&#39; \right)} \\
&amp;=\mathbf{E\left( (X&#39;X)^{-1}X&#39;uu&#39;X(X&#39;X)^{-1}  \right)} \\
&amp;= \mathbf{(X&#39;X)^{-1}X&#39;E(uu&#39;)X(X&#39;X)^{-1}}   \\
&amp;= \mathbf{(X&#39;X)^{-1}X&#39;}\sigma^2\mathbf{IX(X&#39;X)^{-1}}   \\
&amp;= \sigma^2\mathbf{(X&#39;X)^{-1}X&#39;X(X&#39;X)^{-1}}   \\
&amp;= \sigma^2\mathbf{(X&#39;X)^{-1}}   \\
\end{align}
\]</span></p>
<hr />
</div>
<div id="solve-s2mathbfhatbeta-sample" class="section level3 hasAnchor" number="6.2.6">
<h3><span class="header-section-number">6.2.6</span> Solve <span class="math inline">\(S^2(\mathbf{\hat{\beta}})\)</span> (sample)<a href="statistical-models.html#solve-s2mathbfhatbeta-sample" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In practice, <span class="math inline">\(\sigma^2\)</span> is unknown. We estimate it from residuals and then plug it into the variance-covariance formula.</p>
<p>where
<span class="math display">\[
\begin{align}
\hat{\sigma}^2&amp;=\frac{\sum{e_i^2}}{n-k}=\frac{\mathbf{e&#39;e}}{n-k} \\
E(\hat{\sigma}^2)&amp;=\sigma^2
\end{align}
\]</span></p>
<p>therefore
<span class="math display">\[
\begin{align}
S^2_{ij}(\mathbf{\hat{\beta}})
&amp;= \hat{\sigma}^2\mathbf{(X&#39;X)^{-1}}   \\
&amp;= \frac{\mathbf{e&#39;e}}{n-k}\mathbf{(X&#39;X)^{-1}}   \\
\end{align}
\]</span></p>
<p><code>which is variance-covariance of coefficients</code></p>
<hr />
</div>
<div id="sum-of-squares-decomposition-matrix-format" class="section level3 hasAnchor" number="6.2.7">
<h3><span class="header-section-number">6.2.7</span> Sum of squares decomposition (matrix format)<a href="statistical-models.html#sum-of-squares-decomposition-matrix-format" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The same TSS/ESS/RSS decomposition generalizes to multiple regression, forming the basis of <span class="math inline">\(R^2\)</span> and the overall F test.</p>
<p><span class="math display">\[
\begin{align}
TSS&amp;=\mathbf{y&#39;y}-n\bar{Y}^2 \\
RSS&amp;=\mathbf{ee&#39;}=\mathbf{yy&#39;-\hat{\beta}&#39;X&#39;y} \\
ESS&amp;=\mathbf{\hat{\beta}&#39;X&#39;y}-n\bar{Y}^2
\end{align}
\]</span></p>
<hr />
</div>
<div id="determination-coefficient-r2-and-goodness-of-fit" class="section level3 hasAnchor" number="6.2.8">
<h3><span class="header-section-number">6.2.8</span> Determination coefficient <span class="math inline">\(R^2\)</span> and goodness of fit<a href="statistical-models.html#determination-coefficient-r2-and-goodness-of-fit" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><span class="math display">\[
\begin{align}
R^2&amp;=\frac{ESS}{TSS}\\
&amp;=\frac{\mathbf{\hat{\beta}&#39;X&#39;y}-n\bar{Y}^2}{\mathbf{y&#39;y}-n\bar{Y}^2}
\end{align}
\]</span></p>
<p>Interpretation remains the same: <span class="math inline">\(R^2\)</span> is descriptive goodness-of-fit. In multiple regression it almost always increases as you add predictors, which is why adjusted <span class="math inline">\(R^2\)</span> or out-of-sample validation is often preferred for model selection.</p>
<hr />
</div>
<div id="test-of-regression-coefficients-1" class="section level3 hasAnchor" number="6.2.9">
<h3><span class="header-section-number">6.2.9</span> Test of regression coefficients<a href="statistical-models.html#test-of-regression-coefficients-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Multiple regression inference typically includes:
- <strong>individual coefficient tests</strong> (is <span class="math inline">\(\beta_j=0\)</span>?),
- <strong>joint tests</strong> (are multiple coefficients simultaneously zero?).</p>
<p>because
<span class="math display">\[
\begin{align}
\mathbf{u}&amp;\sim N(\mathbf{0},\sigma^2\mathbf{I})  \\
\mathbf{\hat{\beta}} &amp;\sim N\left(\mathbf{\beta},\sigma^2\mathbf{X&#39;X}^{-1} \right)   \\
\end{align}
\]</span></p>
<p>therefore</p>
<p><code>(for all coefficients test, vector, see above</code> <span class="math inline">\(S_{\hat{\beta}}^2\)</span> <code>)</code>
<span class="math display">\[
\begin{align}
\mathbf{t_{\hat{\beta}}}&amp;=\mathbf{\frac{\hat{\beta}-\beta}{S_{\hat{\beta}}}}
\sim \mathbf{t(n-k)}
\end{align}
\]</span></p>
<p><code>(for individual coefficient test)</code>
<span class="math display">\[
\begin{align}
\mathbf{t_{\hat{\beta}}^{\ast}}&amp;=\frac{\mathbf{\hat{\beta}}}{\mathbf{\sqrt{S^2_{ij}(\hat{\beta}_{kk})}}}
\end{align}
\]</span></p>
<p>where
<span class="math display">\[
S^2_{ij}(\hat{\beta}_{kk})=[s^2_{\hat{\beta}_1},s^2_{\hat{\beta}_2},\cdots,s^2_{\hat{\beta}_k}]&#39;
\]</span></p>
<p><code>they are on diagonal line of the matrix of</code> <span class="math inline">\(S^2(\mathbf{\hat{\beta}})\)</span></p>
<hr />
</div>
<div id="test-of-model" class="section level3 hasAnchor" number="6.2.10">
<h3><span class="header-section-number">6.2.10</span> Test of model<a href="statistical-models.html#test-of-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The overall model test compares:
- an <strong>unrestricted</strong> model with predictors, versus
- a <strong>restricted</strong> model (often intercept-only).</p>
<p>unrestricted model
<span class="math display">\[
\begin{align}
u_i &amp;\sim i.i.d \ N(0,\sigma^2)\\
Y_i&amp;\sim i.i.d \ N(\beta_1+\beta_2X_i+\cdots+\beta_kX_i,\sigma^2)\\
RSS_U&amp;=\sum{(Y_i-\hat{Y_i})^2} \sim \chi^2(n-k) \\
\end{align}
\]</span></p>
<p>restricted model
<span class="math display">\[
\begin{align}
u_i &amp;\sim i.i.d \ N(0,\sigma^2)\\
Y_i&amp;\sim i.i.d \ N(\beta_1,\sigma^2)\\
RSS_R&amp;=\sum{(Y_i-\hat{Y_i})^2} \sim \chi^2(n-1) \\
\end{align}
\]</span></p>
<p>F test
<span class="math display">\[
\begin{align}
F^{\ast}&amp;=\frac{(RSS_R-RSS_U)/(k-1)}{RSS_U/(n-k)} \\
        &amp;=\frac{ESS_U/df_{ESS_U}}{RSS_U/df_{RSS_U}} \\
        &amp;\sim F(df_{ESS_U},df_{RSS_U})
\end{align}
\]</span></p>
<p><span class="math display">\[
\begin{align}
F^{\ast}&amp;=\frac{ESS_U/df_{ESS_U}}{RSS_U/df_{RSS_U}}
=\frac{\left(\mathbf{\hat{\beta}&#39;X&#39;y}-n\bar{Y}^2  \right)/{(k-1)}}{\left(\mathbf{yy&#39;-\hat{\beta}&#39;X&#39;y}\right)/{(n-k)}}
\end{align}
\]</span></p>
<hr />
</div>
<div id="mean-prediction-multiple-regression" class="section level3 hasAnchor" number="6.2.11">
<h3><span class="header-section-number">6.2.11</span> Mean prediction (multiple regression)<a href="statistical-models.html#mean-prediction-multiple-regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The mean prediction generalizes naturally: you plug in a covariate vector <span class="math inline">\(X_0\)</span>. The uncertainty depends on the leverage of <span class="math inline">\(X_0\)</span> through <span class="math inline">\(X_0(X&#39;X)^{-1}X_0&#39;\)</span>.</p>
<p>since
<span class="math display">\[
\begin{align}
E(\hat{Y}_0)&amp;=E\mathbf{(X_0\hat{\beta})}=\mathbf{X_0\beta}=E\mathbf{(Y_0)}\\
var(\hat{Y}_0)&amp;=E\mathbf{(X_0\hat{\beta}-X_0\beta)}^2\\
              &amp;=E\mathbf{\left( X_0(\hat{\beta}-\beta)(\hat{\beta}-\beta)&#39;X_0&#39; \right)}\\
              &amp;=E\mathbf{X_0\left( (\hat{\beta}-\beta)(\hat{\beta}-\beta)&#39; \right)X_0&#39;}\\
              &amp;=\sigma^2\mathbf{X_0\left( X&#39;X \right)^{-1}X_0&#39;}\\
\end{align}
\]</span></p>
<p>and
<span class="math display">\[
\begin{align}
\hat{Y}_0&amp; \sim N(\mu_{\hat{Y}_0},\sigma^2_{\hat{Y}_0})\\
\hat{Y}_0&amp; \sim N\left(E(Y_0|X_0), \sigma^2\mathbf{X_0(X&#39;X)^{-1}X_0&#39;}\right)
\end{align}
\]</span></p>
<p><code>construct t statistic</code>
<span class="math display">\[
\begin{align}
t_{\hat{Y}_0}&amp; =\frac{\hat{Y}_0-E(Y|X_0)}{S_{\hat{Y}_0}}
&amp;\sim t(n-k)
\end{align}
\]</span></p>
<p>therefore
<span class="math display">\[
\begin{align}
\hat{Y}_0-t_{1-\alpha/2}(n-2) \cdot S_{\hat{Y}_0} \leq E(Y|X_0) \leq \hat{Y}_0+t_{1-\alpha/2}(n-2) \cdot S_{\hat{Y}_0}
\end{align}
\]</span></p>
<p>where
<span class="math display">\[
\begin{align}
\mathbf{S_{\hat{Y}_0}}
&amp;=\sqrt{\hat{\sigma}^2X_0(X&#39;X)^{-1}X_0&#39;} \\
\hat{\sigma}^2&amp;=\frac{\mathbf{ee&#39;}}{(n-k)}
\end{align}
\]</span></p>
<hr />
</div>
<div id="individual-prediction-multiple-regression" class="section level3 hasAnchor" number="6.2.12">
<h3><span class="header-section-number">6.2.12</span> Individual prediction (multiple regression)<a href="statistical-models.html#individual-prediction-multiple-regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Individual prediction adds the irreducible error term for a new observation, making the interval wider than the mean-response interval.</p>
<p>since
<span class="math display">\[
\begin{align}
e_0&amp;=Y_0-\hat{Y}_0
\end{align}
\]</span></p>
<p>and
<span class="math display">\[
\begin{align}
E(e_0)&amp;=E(Y_0-\hat{Y}_0)\\
      &amp;=E(\mathbf{X_0\beta}+u_0-\mathbf{X_0\hat{\beta}})\\
      &amp;=E\left(u_0-\mathbf{X_0 (\hat{\beta}- \beta)} \right)\\
      &amp;=E\left(u_0-\mathbf{X_0 (X&#39;X)^{-1}X&#39;u} \right)\\
      &amp;=0
\end{align}
\]</span></p>
<p><span class="math display">\[
\begin{align}
var(e_0)&amp;=E(Y_0-\hat{Y}_0)^2\\
        &amp;=E(e_0^2)\\
        &amp;=E\left(u_0-\mathbf{X_0 (X&#39;X)^{-1}X&#39;u} \right)^2\\
        &amp;=\sigma^2\left( 1+ \mathbf{X_0(X&#39;X)^{-1}X_0&#39;}\right)
\end{align}
\]</span></p>
<p>and<br />
<span class="math display">\[
\begin{align}
e_0&amp; \sim N(\mu_{e_0},\sigma^2_{e_0})\\
e_0&amp; \sim N\left(0, \sigma^2\left(1+\mathbf{X_0(X&#39;X)^{-1}X_0&#39;}\right)\right)
\end{align}
\]</span></p>
<p><code>construct a t statistic</code>
<span class="math display">\[
\begin{align}
t_{e_0}&amp; =\frac{\hat{Y}_0-Y_0}{S_{e_0}}
\sim t(n-k)
\end{align}
\]</span></p>
<p>therefore
<span class="math display">\[
\begin{align}
\hat{Y}_0-t_{1-\alpha/2}(n-2) \cdot S_{Y_0-\hat{Y}_0} \leq (Y_0|X_0) \leq \hat{Y}_0+t_{1-\alpha/2}(n-2) \cdot S_{Y_0-\hat{Y}_0}
\end{align}
\]</span></p>
<p>where
<span class="math display">\[
\begin{align}
S_{Y_0-\hat{Y}_0}=S_{e_0}
&amp;=\sqrt{\hat{\sigma}^2 \left( 1+X_0(X&#39;X)^{-1}X_0&#39; \right) } \\
\hat{\sigma}^2&amp;=\frac{\mathbf{ee&#39;}}{(n-k)}
\end{align}
\]</span></p>
<p>A final practical takeaway:
- If your goal is decision-making about the <em>average</em> response at a covariate profile, use mean-response inference.
- If your goal is forecasting an <em>individual</em> outcome, expect much wider uncertainty bands, even with a well-fitted model.</p>

</div>
</div>
<div id="multiple-linear-regression-practice" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Multiple linear regression practice<a href="statistical-models.html#multiple-linear-regression-practice" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section is a hands-on workflow for multiple linear regression using the classic <strong>Boston housing</strong> dataset. The goal is not only to fit a model, but to practice the full sequence that a statistician typically follows in real projects:</p>
<ol style="list-style-type: decimal">
<li>understand the dataset and variable types,<br />
</li>
<li>check missingness and data quality,<br />
</li>
<li>explore distributions and correlations,<br />
</li>
<li>consider transformations for modeling stability,<br />
</li>
<li>build training/test splits for honest evaluation,<br />
</li>
<li>fit models (baseline, stepwise, polynomial, interaction, robust),<br />
</li>
<li>check assumptions and diagnostics,<br />
</li>
<li>compare models using information criteria and cross-validation,<br />
</li>
<li>interpret coefficients and relative importance,<br />
</li>
<li>perform prediction and validate performance.</li>
</ol>
<p>Even though this example is not a clinical dataset, the workflow is transferable to many applied settings.</p>
<hr />
<div id="load-required-packages" class="section level3 hasAnchor" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> Load required packages<a href="statistical-models.html#load-required-packages" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We start by loading packages that support regression modeling, data exploration, and diagnostics:</p>
<ul>
<li><code>MASS</code>: contains the Boston dataset and robust regression (<code>rlm</code>)</li>
<li><code>psych</code>: descriptive summaries and EDA panels</li>
<li><code>car</code>: regression utilities like VIF</li>
</ul>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="statistical-models.html#cb475-1" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb475-2"><a href="statistical-models.html#cb475-2" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb475-3"><a href="statistical-models.html#cb475-3" tabindex="-1"></a><span class="fu">library</span>(psych)</span></code></pre></div>
<hr />
</div>
<div id="loading-and-describing-data" class="section level3 hasAnchor" number="6.3.2">
<h3><span class="header-section-number">6.3.2</span> Loading and describing data<a href="statistical-models.html#loading-and-describing-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We load the dataset and create a working copy. In a real analysis, it is good practice to keep a pristine “original” object and perform transformations on copies.</p>
<p><code>describe()</code> provides a compact summary: N, mean, SD, min/max, and distribution hints for each variable. This is often more informative than simply printing the first few rows.</p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="statistical-models.html#cb476-1" tabindex="-1"></a><span class="fu">data</span>(Boston)</span>
<span id="cb476-2"><a href="statistical-models.html#cb476-2" tabindex="-1"></a>data_ori <span class="ot">&lt;-</span> Boston</span>
<span id="cb476-3"><a href="statistical-models.html#cb476-3" tabindex="-1"></a><span class="fu">describe</span>(data_ori)</span></code></pre></div>
<pre><code>## data_ori 
## 
##  14  Variables      506  Observations
## --------------------------------------------------------------------------------
## crim 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##      506        0      504        1    3.614    5.794  0.02791  0.03819 
##      .25      .50      .75      .90      .95 
##  0.08204  0.25651  3.67708 10.75300 15.78915 
## 
## lowest : 0.00632 0.00906 0.01096 0.01301 0.01311
## highest: 45.7461 51.1358 67.9208 73.5341 88.9762
## --------------------------------------------------------------------------------
## zn 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##      506        0       26    0.603    11.36    18.77      0.0      0.0 
##      .25      .50      .75      .90      .95 
##      0.0      0.0     12.5     42.5     80.0 
## 
## lowest : 0    12.5 17.5 18   20  , highest: 82.5 85   90   95   100 
## --------------------------------------------------------------------------------
## indus 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##      506        0       76    0.982    11.14    7.705     2.18     2.91 
##      .25      .50      .75      .90      .95 
##     5.19     9.69    18.10    19.58    21.89 
## 
## lowest : 0.46  0.74  1.21  1.22  1.25 , highest: 18.1  19.58 21.89 25.65 27.74
## --------------------------------------------------------------------------------
## chas 
##        n  missing distinct     Info      Sum     Mean      Gmd 
##      506        0        2    0.193       35  0.06917    0.129 
## 
## --------------------------------------------------------------------------------
## nox 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##      506        0       81        1   0.5547   0.1295   0.4092   0.4270 
##      .25      .50      .75      .90      .95 
##   0.4490   0.5380   0.6240   0.7130   0.7400 
## 
## lowest : 0.385 0.389 0.392 0.394 0.398, highest: 0.713 0.718 0.74  0.77  0.871
## --------------------------------------------------------------------------------
## rm 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##      506        0      446        1    6.285   0.7515    5.314    5.594 
##      .25      .50      .75      .90      .95 
##    5.886    6.208    6.623    7.152    7.588 
## 
## lowest : 3.561 3.863 4.138 4.368 4.519, highest: 8.375 8.398 8.704 8.725 8.78 
## --------------------------------------------------------------------------------
## age 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##      506        0      356    0.999    68.57    31.52    17.72    26.95 
##      .25      .50      .75      .90      .95 
##    45.02    77.50    94.07    98.80   100.00 
## 
## lowest : 2.9  6    6.2  6.5  6.6 , highest: 98.8 98.9 99.1 99.3 100 
## --------------------------------------------------------------------------------
## dis 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##      506        0      412        1    3.795    2.298    1.462    1.628 
##      .25      .50      .75      .90      .95 
##    2.100    3.207    5.188    6.817    7.828 
## 
## lowest : 1.1296  1.137   1.1691  1.1742  1.1781 
## highest: 9.2203  9.2229  10.5857 10.7103 12.1265
## --------------------------------------------------------------------------------
## rad 
##        n  missing distinct     Info     Mean      Gmd 
##      506        0        9    0.959    9.549    8.518 
##                                                                 
## Value          1     2     3     4     5     6     7     8    24
## Frequency     20    24    38   110   115    26    17    24   132
## Proportion 0.040 0.047 0.075 0.217 0.227 0.051 0.034 0.047 0.261
## 
## For the frequency table, variable is rounded to the nearest 0
## --------------------------------------------------------------------------------
## tax 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##      506        0       66    0.981    408.2    181.7      222      233 
##      .25      .50      .75      .90      .95 
##      279      330      666      666      666 
## 
## lowest : 187 188 193 198 216, highest: 432 437 469 666 711
## --------------------------------------------------------------------------------
## ptratio 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##      506        0       46    0.978    18.46    2.383    14.70    14.75 
##      .25      .50      .75      .90      .95 
##    17.40    19.05    20.20    20.90    21.00 
## 
## lowest : 12.6 13   13.6 14.4 14.7, highest: 20.9 21   21.1 21.2 22  
## --------------------------------------------------------------------------------
## black 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##      506        0      357    0.986    356.7     65.5    84.59   290.27 
##      .25      .50      .75      .90      .95 
##   375.38   391.44   396.23   396.90   396.90 
## 
## lowest : 0.32   2.52   2.6    3.5    3.65  , highest: 396.28 396.3  396.33 396.42 396.9 
## --------------------------------------------------------------------------------
## lstat 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##      506        0      455        1    12.65    7.881    3.708    4.680 
##      .25      .50      .75      .90      .95 
##    6.950   11.360   16.955   23.035   26.808 
## 
## lowest : 1.73  1.92  1.98  2.47  2.87 , highest: 34.37 34.41 34.77 36.98 37.97
## --------------------------------------------------------------------------------
## medv 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##      506        0      229        1    22.53    9.778    10.20    12.75 
##      .25      .50      .75      .90      .95 
##    17.02    21.20    25.00    34.80    43.40 
## 
## lowest : 5    5.6  6.3  7    7.2 , highest: 46.7 48.3 48.5 48.8 50  
## --------------------------------------------------------------------------------</code></pre>
<p><code>summary()</code> is a base R quick scan: it gives min/median/mean/max for numeric variables and counts for factors. This is a standard first step to detect strange ranges or unrealistic values.</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="statistical-models.html#cb478-1" tabindex="-1"></a><span class="fu">summary</span>(data_ori)</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="1%" />
<col width="8%" />
<col width="7%" />
<col width="6%" />
<col width="7%" />
<col width="7%" />
<col width="6%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="6%" />
<col width="6%" />
<col width="7%" />
<col width="6%" />
<col width="6%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">crim</th>
<th align="left">zn</th>
<th align="left">indus</th>
<th align="left">chas</th>
<th align="left">nox</th>
<th align="left">rm</th>
<th align="left">age</th>
<th align="left">dis</th>
<th align="left">rad</th>
<th align="left">tax</th>
<th align="left">ptratio</th>
<th align="left">black</th>
<th align="left">lstat</th>
<th align="left">medv</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"></td>
<td align="left">Min. : 0.00632</td>
<td align="left">Min. : 0.00</td>
<td align="left">Min. : 0.46</td>
<td align="left">Min. :0.00000</td>
<td align="left">Min. :0.3850</td>
<td align="left">Min. :3.561</td>
<td align="left">Min. : 2.90</td>
<td align="left">Min. : 1.130</td>
<td align="left">Min. : 1.000</td>
<td align="left">Min. :187.0</td>
<td align="left">Min. :12.60</td>
<td align="left">Min. : 0.32</td>
<td align="left">Min. : 1.73</td>
<td align="left">Min. : 5.00</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">1st Qu.: 0.08205</td>
<td align="left">1st Qu.: 0.00</td>
<td align="left">1st Qu.: 5.19</td>
<td align="left">1st Qu.:0.00000</td>
<td align="left">1st Qu.:0.4490</td>
<td align="left">1st Qu.:5.886</td>
<td align="left">1st Qu.: 45.02</td>
<td align="left">1st Qu.: 2.100</td>
<td align="left">1st Qu.: 4.000</td>
<td align="left">1st Qu.:279.0</td>
<td align="left">1st Qu.:17.40</td>
<td align="left">1st Qu.:375.38</td>
<td align="left">1st Qu.: 6.95</td>
<td align="left">1st Qu.:17.02</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">Median : 0.25651</td>
<td align="left">Median : 0.00</td>
<td align="left">Median : 9.69</td>
<td align="left">Median :0.00000</td>
<td align="left">Median :0.5380</td>
<td align="left">Median :6.208</td>
<td align="left">Median : 77.50</td>
<td align="left">Median : 3.207</td>
<td align="left">Median : 5.000</td>
<td align="left">Median :330.0</td>
<td align="left">Median :19.05</td>
<td align="left">Median :391.44</td>
<td align="left">Median :11.36</td>
<td align="left">Median :21.20</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">Mean : 3.61352</td>
<td align="left">Mean : 11.36</td>
<td align="left">Mean :11.14</td>
<td align="left">Mean :0.06917</td>
<td align="left">Mean :0.5547</td>
<td align="left">Mean :6.285</td>
<td align="left">Mean : 68.57</td>
<td align="left">Mean : 3.795</td>
<td align="left">Mean : 9.549</td>
<td align="left">Mean :408.2</td>
<td align="left">Mean :18.46</td>
<td align="left">Mean :356.67</td>
<td align="left">Mean :12.65</td>
<td align="left">Mean :22.53</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">3rd Qu.: 3.67708</td>
<td align="left">3rd Qu.: 12.50</td>
<td align="left">3rd Qu.:18.10</td>
<td align="left">3rd Qu.:0.00000</td>
<td align="left">3rd Qu.:0.6240</td>
<td align="left">3rd Qu.:6.623</td>
<td align="left">3rd Qu.: 94.08</td>
<td align="left">3rd Qu.: 5.188</td>
<td align="left">3rd Qu.:24.000</td>
<td align="left">3rd Qu.:666.0</td>
<td align="left">3rd Qu.:20.20</td>
<td align="left">3rd Qu.:396.23</td>
<td align="left">3rd Qu.:16.95</td>
<td align="left">3rd Qu.:25.00</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">Max. :88.97620</td>
<td align="left">Max. :100.00</td>
<td align="left">Max. :27.74</td>
<td align="left">Max. :1.00000</td>
<td align="left">Max. :0.8710</td>
<td align="left">Max. :8.780</td>
<td align="left">Max. :100.00</td>
<td align="left">Max. :12.127</td>
<td align="left">Max. :24.000</td>
<td align="left">Max. :711.0</td>
<td align="left">Max. :22.00</td>
<td align="left">Max. :396.90</td>
<td align="left">Max. :37.97</td>
<td align="left">Max. :50.00</td>
</tr>
</tbody>
</table>
<hr />
</div>
<div id="create-table-1" class="section level3 hasAnchor" number="6.3.3">
<h3><span class="header-section-number">6.3.3</span> Create table 1<a href="statistical-models.html#create-table-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A “Table 1” is a standard descriptive table for reporting baseline characteristics (clinical trials, observational studies, epidemiology, etc.). Here we create a Table 1 across all variables without grouping, mainly to practice the tool and check distributions.</p>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="statistical-models.html#cb479-1" tabindex="-1"></a><span class="fu">library</span>(boot) </span>
<span id="cb479-2"><a href="statistical-models.html#cb479-2" tabindex="-1"></a><span class="fu">library</span>(table1)</span></code></pre></div>
<pre><code>## Warning: package &#39;table1&#39; was built under R version 4.4.3</code></pre>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb481-1"><a href="statistical-models.html#cb481-1" tabindex="-1"></a><span class="fu">table1</span>(<span class="sc">~</span> . , <span class="at">data=</span>data_ori)</span></code></pre></div>
<div class="Rtable1"><table class="Rtable1">
<thead>
<tr>
<th class='rowlabel firstrow lastrow'></th>
<th class='firstrow lastrow'><span class='stratlabel'>Overall<br/><span class='stratn'>(N=506)</span></span></th>
</tr>
</thead>
<tbody>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>crim</span></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>3.61 (8.60)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>0.257 [0.00632, 89.0]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>zn</span></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>11.4 (23.3)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>0 [0, 100]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>indus</span></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>11.1 (6.86)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>9.69 [0.460, 27.7]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>chas</span></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>0.0692 (0.254)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>0 [0, 1.00]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>nox</span></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>0.555 (0.116)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>0.538 [0.385, 0.871]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>rm</span></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>6.28 (0.703)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>6.21 [3.56, 8.78]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>age</span></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>68.6 (28.1)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>77.5 [2.90, 100]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>dis</span></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>3.80 (2.11)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>3.21 [1.13, 12.1]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>rad</span></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>9.55 (8.71)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>5.00 [1.00, 24.0]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>tax</span></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>408 (169)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>330 [187, 711]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>ptratio</span></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>18.5 (2.16)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>19.1 [12.6, 22.0]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>black</span></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>357 (91.3)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>391 [0.320, 397]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>lstat</span></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>12.7 (7.14)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>11.4 [1.73, 38.0]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>medv</span></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>22.5 (9.20)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>21.2 [5.00, 50.0]</td>
</tr>
</tbody>
</table>
</div>
<p>Practical note: in real reporting, Table 1 is usually stratified by a group (e.g., treatment arm), but the unstratified version is still useful as a data audit.</p>
<hr />
</div>
<div id="missingness-checking" class="section level3 hasAnchor" number="6.3.4">
<h3><span class="header-section-number">6.3.4</span> Missingness checking<a href="statistical-models.html#missingness-checking" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Before modeling, verify whether any variables have missing values and whether patterns exist. The Boston dataset is typically complete, but this step is included because real datasets almost never are.</p>
<p><code>md.pattern()</code> (from <code>mice</code>) shows missingness patterns and counts by variable.</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="statistical-models.html#cb482-1" tabindex="-1"></a><span class="fu">library</span>(mice)</span></code></pre></div>
<pre><code>## Warning: package &#39;mice&#39; was built under R version 4.4.3</code></pre>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="statistical-models.html#cb484-1" tabindex="-1"></a><span class="fu">md.pattern</span>(data_ori)</span></code></pre></div>
<pre><code>##  /\     /\
## {  `---&#39;  }
## {  O   O  }
## ==&gt;  V &lt;==  No need for mice. This data set is completely observed.
##  \  \|/  /
##   `-----&#39;</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-248-1.png" alt="" width="672" /></p>
<table style="width:100%;">
<colgroup>
<col width="5%" />
<col width="6%" />
<col width="4%" />
<col width="8%" />
<col width="6%" />
<col width="5%" />
<col width="4%" />
<col width="5%" />
<col width="5%" />
<col width="5%" />
<col width="5%" />
<col width="10%" />
<col width="8%" />
<col width="8%" />
<col width="6%" />
<col width="4%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">crim</th>
<th align="right">zn</th>
<th align="right">indus</th>
<th align="right">chas</th>
<th align="right">nox</th>
<th align="right">rm</th>
<th align="right">age</th>
<th align="right">dis</th>
<th align="right">rad</th>
<th align="right">tax</th>
<th align="right">ptratio</th>
<th align="right">black</th>
<th align="right">lstat</th>
<th align="right">medv</th>
<th align="right"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">506</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>If missingness exists, you should decide whether it is:
- MCAR (completely at random),
- MAR (at random conditional on observed data),
- MNAR (not at random).</p>
<p>That decision influences the imputation strategy and the validity of downstream inference.</p>
<hr />
</div>
<div id="exploratory-data-analysis" class="section level3 hasAnchor" number="6.3.5">
<h3><span class="header-section-number">6.3.5</span> Exploratory data analysis<a href="statistical-models.html#exploratory-data-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Exploratory data analysis (EDA) is where you learn the “shape” of the data: correlations, nonlinear relationships, skewness, and potential outliers.</p>
<div id="correlation-matrix-and-bivariate-panels" class="section level4 hasAnchor" number="6.3.5.1">
<h4><span class="header-section-number">6.3.5.1</span> Correlation matrix and bivariate panels<a href="statistical-models.html#correlation-matrix-and-bivariate-panels" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>pairs.panels()</code> is a powerful all-in-one diagnostic:
- scatterplots for each pair,
- correlations,
- histograms (or density plots) on the diagonal.</p>
<p>This often reveals multicollinearity and potential transformations needed.</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="statistical-models.html#cb486-1" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb486-2"><a href="statistical-models.html#cb486-2" tabindex="-1"></a><span class="fu">pairs.panels</span>(data_ori)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-249-1.png" alt="" width="672" /></p>
</div>
<div id="histograms" class="section level4 hasAnchor" number="6.3.5.2">
<h4><span class="header-section-number">6.3.5.2</span> Histograms<a href="statistical-models.html#histograms" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Histograms quickly show skewness, long tails, spikes, and potential coding problems (e.g., a continuous variable with only a few discrete values).</p>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="statistical-models.html#cb487-1" tabindex="-1"></a><span class="fu">library</span>(DataExplorer)</span>
<span id="cb487-2"><a href="statistical-models.html#cb487-2" tabindex="-1"></a><span class="fu">plot_histogram</span>(data_ori)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-250-1.png" alt="" width="672" /></p>
<hr />
</div>
</div>
<div id="transformations" class="section level3 hasAnchor" number="6.3.6">
<h3><span class="header-section-number">6.3.6</span> Transformations<a href="statistical-models.html#transformations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Many predictors in real-world socioeconomic and biomedical data are skewed. Transformations can:
- improve linearity,
- stabilize variance,
- reduce influence of extreme values,
- make residuals closer to normal.</p>
<p>Here you apply a set of transformations guided by a common heuristic:
- log transforms for strictly positive skewed variables,
- square root for moderately skewed,
- reflections when needed to “flip” direction (as shown with <code>age</code> and <code>black</code>).</p>
<p>The goal is not “making everything normal,” but making linear modeling assumptions more reasonable.</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="statistical-models.html#cb488-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb488-2"><a href="statistical-models.html#cb488-2" tabindex="-1"></a>data_trans <span class="ot">=</span> data_ori <span class="sc">%&gt;%</span>  <span class="fu">mutate</span>(<span class="at">age=</span> <span class="fu">sqrt</span>(<span class="fu">max</span>(age)<span class="sc">+</span><span class="dv">1</span><span class="sc">-</span>age),</span>
<span id="cb488-3"><a href="statistical-models.html#cb488-3" tabindex="-1"></a>                         <span class="at">black=</span> <span class="fu">log10</span>(<span class="fu">max</span>(black)<span class="sc">+</span><span class="dv">1</span><span class="sc">-</span>black),</span>
<span id="cb488-4"><a href="statistical-models.html#cb488-4" tabindex="-1"></a>                         <span class="at">crim=</span> <span class="fu">log10</span>(crim),</span>
<span id="cb488-5"><a href="statistical-models.html#cb488-5" tabindex="-1"></a>                         <span class="at">dis=</span> <span class="fu">sqrt</span>(dis)   )</span>
<span id="cb488-6"><a href="statistical-models.html#cb488-6" tabindex="-1"></a><span class="fu">plot_histogram</span>(data_trans)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-251-1.png" alt="" width="672" /></p>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="statistical-models.html#cb489-1" tabindex="-1"></a><span class="co"># pairs.panels(data2)</span></span></code></pre></div>
<p>! <a href="https://www.statisticssolutions.com/wp-content/uploads/2018/12/b2.png">How to transform data for normality.</a></p>
<p>A practical note: transformations should be applied thoughtfully and documented clearly, especially if you need interpretability. For example, a log-transformed predictor means coefficients represent changes per multiplicative change in the original scale.</p>
<hr />
</div>
<div id="check-linearity-between-y-and-x" class="section level3 hasAnchor" number="6.3.7">
<h3><span class="header-section-number">6.3.7</span> Check linearity between <span class="math inline">\(y\)</span> and <span class="math inline">\(x\)</span><a href="statistical-models.html#check-linearity-between-y-and-x" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Before fitting a multivariable model, it helps to check whether key predictors have roughly linear relationships with the outcome. Scatterplots can immediately show:
- curvature (suggesting polynomial terms),
- clusters (suggesting interactions or stratification),
- heteroscedasticity (spread changes with <span class="math inline">\(X\)</span>).</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="statistical-models.html#cb490-1" tabindex="-1"></a><span class="fu">attach</span>(data_trans)</span>
<span id="cb490-2"><a href="statistical-models.html#cb490-2" tabindex="-1"></a><span class="fu">plot</span>(medv, rm)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-252-1.png" alt="" width="672" /></p>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb491-1"><a href="statistical-models.html#cb491-1" tabindex="-1"></a><span class="fu">plot</span>(medv,lstat)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-252-2.png" alt="" width="672" /></p>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="statistical-models.html#cb492-1" tabindex="-1"></a><span class="fu">plot</span>(medv,age)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-252-3.png" alt="" width="672" /></p>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb493-1"><a href="statistical-models.html#cb493-1" tabindex="-1"></a><span class="fu">plot</span>(medv, black)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-252-4.png" alt="" width="672" /></p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb494-1"><a href="statistical-models.html#cb494-1" tabindex="-1"></a><span class="fu">plot</span>(medv,crim)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-252-5.png" alt="" width="672" /></p>
<p>In practice, the Boston housing dataset is known for strong relationships between <code>medv</code> and both <code>lstat</code> and <code>rm</code>, and these often show nonlinearity—motivating quadratic terms and interactions later.</p>
<hr />
</div>
<div id="data-imputation-and-normalization" class="section level3 hasAnchor" number="6.3.8">
<h3><span class="header-section-number">6.3.8</span> Data imputation and normalization<a href="statistical-models.html#data-imputation-and-normalization" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This workflow demonstrates <strong>KNN imputation</strong> using <code>caret::preProcess(method = "knnImpute")</code>. Even if the dataset has no missing values, this section is included because missingness is common in applied work.</p>
<div id="for-original-data" class="section level4 hasAnchor" number="6.3.8.1">
<h4><span class="header-section-number">6.3.8.1</span> For original “data”<a href="statistical-models.html#for-original-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We store <code>medv</code> separately before preprocessing, then restore it afterward. This preserves the target variable while applying preprocessing to predictors.</p>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb495-1"><a href="statistical-models.html#cb495-1" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb495-2"><a href="statistical-models.html#cb495-2" tabindex="-1"></a><span class="co"># Create the knn imputation model on the training data</span></span>
<span id="cb495-3"><a href="statistical-models.html#cb495-3" tabindex="-1"></a>y<span class="ot">=</span>data_ori<span class="sc">$</span>medv</span>
<span id="cb495-4"><a href="statistical-models.html#cb495-4" tabindex="-1"></a>preProcess_missingdata_model <span class="ot">&lt;-</span> <span class="fu">preProcess</span>(data_ori , <span class="at">method=</span><span class="st">&#39;knnImpute&#39;</span>)</span>
<span id="cb495-5"><a href="statistical-models.html#cb495-5" tabindex="-1"></a>preProcess_missingdata_model</span></code></pre></div>
<pre><code>## Created from 506 samples and 14 variables
## 
## Pre-processing:
##   - centered (14)
##   - ignored (0)
##   - 5 nearest neighbor imputation (14)
##   - scaled (14)</code></pre>
<p>Then we apply the model and verify missingness is resolved. <code>anyNA()</code> is a quick binary check; in larger projects you may also compute missing rates by column.</p>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="statistical-models.html#cb497-1" tabindex="-1"></a><span class="co"># Use the imputation model to predict the values of missing data points</span></span>
<span id="cb497-2"><a href="statistical-models.html#cb497-2" tabindex="-1"></a><span class="fu">library</span>(RANN)  <span class="co"># required for knnInpute</span></span></code></pre></div>
<pre><code>## Warning: package &#39;RANN&#39; was built under R version 4.4.3</code></pre>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb499-1"><a href="statistical-models.html#cb499-1" tabindex="-1"></a>data_ori  <span class="ot">&lt;-</span> <span class="fu">predict</span>(preProcess_missingdata_model, <span class="at">newdata =</span> data_ori )</span>
<span id="cb499-2"><a href="statistical-models.html#cb499-2" tabindex="-1"></a><span class="fu">anyNA</span>(data_ori )</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="statistical-models.html#cb501-1" tabindex="-1"></a>data_ori<span class="sc">$</span>medv <span class="ot">&lt;-</span> y</span></code></pre></div>
</div>
<div id="for-transformed-data2" class="section level4 hasAnchor" number="6.3.8.2">
<h4><span class="header-section-number">6.3.8.2</span> For transformed “data2”<a href="statistical-models.html#for-transformed-data2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We repeat the same workflow for the transformed dataset. This creates a fair comparison between “original scale” and “transformed scale” modeling pipelines.</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="statistical-models.html#cb502-1" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb502-2"><a href="statistical-models.html#cb502-2" tabindex="-1"></a>y2<span class="ot">=</span>data_trans<span class="sc">$</span>medv</span>
<span id="cb502-3"><a href="statistical-models.html#cb502-3" tabindex="-1"></a><span class="co"># Create the knn imputation model on the training data</span></span>
<span id="cb502-4"><a href="statistical-models.html#cb502-4" tabindex="-1"></a>preProcess_missingdata_model2 <span class="ot">&lt;-</span> <span class="fu">preProcess</span>(data_trans , <span class="at">method=</span><span class="st">&#39;knnImpute&#39;</span>)</span>
<span id="cb502-5"><a href="statistical-models.html#cb502-5" tabindex="-1"></a>preProcess_missingdata_model2</span></code></pre></div>
<pre><code>## Created from 506 samples and 14 variables
## 
## Pre-processing:
##   - centered (14)
##   - ignored (0)
##   - 5 nearest neighbor imputation (14)
##   - scaled (14)</code></pre>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb504-1"><a href="statistical-models.html#cb504-1" tabindex="-1"></a><span class="co"># Use the imputation model to predict the values of missing data points</span></span>
<span id="cb504-2"><a href="statistical-models.html#cb504-2" tabindex="-1"></a><span class="fu">library</span>(RANN)  <span class="co"># required for knnInpute</span></span>
<span id="cb504-3"><a href="statistical-models.html#cb504-3" tabindex="-1"></a>data_trans  <span class="ot">&lt;-</span> <span class="fu">predict</span>(preProcess_missingdata_model2, <span class="at">newdata =</span> data_trans )</span>
<span id="cb504-4"><a href="statistical-models.html#cb504-4" tabindex="-1"></a><span class="fu">anyNA</span>(data_trans )</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb506-1"><a href="statistical-models.html#cb506-1" tabindex="-1"></a>data_trans<span class="sc">$</span>medv <span class="ot">&lt;-</span> y2</span></code></pre></div>
<hr />
</div>
</div>
<div id="generate-dummy-variables" class="section level3 hasAnchor" number="6.3.9">
<h3><span class="header-section-number">6.3.9</span> Generate dummy variables<a href="statistical-models.html#generate-dummy-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Categorical predictors must be encoded properly before modeling. In many workflows, converting variables to <code>factor</code> is enough because <code>lm()</code> automatically handles factors using dummy coding (with a reference level).</p>
<ul>
<li>also can do using <code>as.factor</code> function for predictors <code>x</code></li>
</ul>
<p>In real projects, pay attention to:
- reference group selection,
- whether categories are sparse,
- and whether encoding must be consistent across train/test.</p>
<hr />
</div>
<div id="splitting-data-into-training-and-test-data" class="section level3 hasAnchor" number="6.3.10">
<h3><span class="header-section-number">6.3.10</span> Splitting data into training and test data<a href="statistical-models.html#splitting-data-into-training-and-test-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A training/test split provides external-style evaluation: the model is fit on training data and assessed on held-out test data.</p>
<p>This helps detect overfitting, especially when you:
- try many model variants,
- add polynomial terms,
- include interactions,
- or apply variable selection procedures.</p>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb507-1"><a href="statistical-models.html#cb507-1" tabindex="-1"></a><span class="co"># Create the training and test datasets</span></span>
<span id="cb507-2"><a href="statistical-models.html#cb507-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb507-3"><a href="statistical-models.html#cb507-3" tabindex="-1"></a><span class="co"># for original data </span></span>
<span id="cb507-4"><a href="statistical-models.html#cb507-4" tabindex="-1"></a><span class="co"># Step 1: Get row numbers for the training data</span></span>
<span id="cb507-5"><a href="statistical-models.html#cb507-5" tabindex="-1"></a>trainRowNumbers <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(data_ori<span class="sc">$</span>medv, <span class="at">p=</span><span class="fl">0.8</span>, <span class="at">list=</span><span class="cn">FALSE</span>)</span>
<span id="cb507-6"><a href="statistical-models.html#cb507-6" tabindex="-1"></a></span>
<span id="cb507-7"><a href="statistical-models.html#cb507-7" tabindex="-1"></a><span class="co"># Step 2: Create the training  dataset</span></span>
<span id="cb507-8"><a href="statistical-models.html#cb507-8" tabindex="-1"></a>data  <span class="ot">&lt;-</span> data_ori[trainRowNumbers,]</span>
<span id="cb507-9"><a href="statistical-models.html#cb507-9" tabindex="-1"></a></span>
<span id="cb507-10"><a href="statistical-models.html#cb507-10" tabindex="-1"></a><span class="co"># Step 3: Create the test dataset</span></span>
<span id="cb507-11"><a href="statistical-models.html#cb507-11" tabindex="-1"></a>testdata  <span class="ot">&lt;-</span> data_ori[<span class="sc">-</span>trainRowNumbers,]</span>
<span id="cb507-12"><a href="statistical-models.html#cb507-12" tabindex="-1"></a></span>
<span id="cb507-13"><a href="statistical-models.html#cb507-13" tabindex="-1"></a><span class="co"># for transformed data</span></span>
<span id="cb507-14"><a href="statistical-models.html#cb507-14" tabindex="-1"></a><span class="co"># Step 1: Get row numbers for the training data</span></span>
<span id="cb507-15"><a href="statistical-models.html#cb507-15" tabindex="-1"></a>trainRowNumbers2 <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(data_trans<span class="sc">$</span>medv, <span class="at">p=</span><span class="fl">0.8</span>, <span class="at">list=</span><span class="cn">FALSE</span>)</span>
<span id="cb507-16"><a href="statistical-models.html#cb507-16" tabindex="-1"></a></span>
<span id="cb507-17"><a href="statistical-models.html#cb507-17" tabindex="-1"></a><span class="co"># Step 2: Create the training  dataset</span></span>
<span id="cb507-18"><a href="statistical-models.html#cb507-18" tabindex="-1"></a>data2 <span class="ot">&lt;-</span> data_trans[trainRowNumbers2,]</span>
<span id="cb507-19"><a href="statistical-models.html#cb507-19" tabindex="-1"></a></span>
<span id="cb507-20"><a href="statistical-models.html#cb507-20" tabindex="-1"></a><span class="co"># Step 3: Create the test dataset</span></span>
<span id="cb507-21"><a href="statistical-models.html#cb507-21" tabindex="-1"></a>testdata2 <span class="ot">&lt;-</span> data_trans[<span class="sc">-</span>trainRowNumbers2,]</span></code></pre></div>
<p>Practical note: <code>createDataPartition()</code> creates balanced partitions with respect to the outcome distribution, which can be helpful when the outcome is skewed.</p>
<hr />
</div>
<div id="step-regression" class="section level3 hasAnchor" number="6.3.11">
<h3><span class="header-section-number">6.3.11</span> Step regression<a href="statistical-models.html#step-regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Stepwise regression is a common teaching tool and sometimes used in quick exploratory modeling. It iteratively adds/removes variables to optimize a criterion (typically AIC by default).</p>
<p>However, in serious applied work, stepwise selection can be unstable and can inflate type I error if you treat the final p-values as if selection never happened. Treat it as a <strong>screening tool</strong>, and validate with cross-validation.</p>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="statistical-models.html#cb508-1" tabindex="-1"></a>model_o <span class="ot">=</span> <span class="fu">lm</span>(  medv <span class="sc">~</span>.  , <span class="at">data=</span>data2)</span>
<span id="cb508-2"><a href="statistical-models.html#cb508-2" tabindex="-1"></a><span class="fu">step</span>(model_o,<span class="at">direction =</span> <span class="st">&quot;both&quot;</span>)</span></code></pre></div>
<pre><code>## Start:  AIC=1281.15
## medv ~ crim + zn + indus + chas + nox + rm + age + dis + rad + 
##     tax + ptratio + black + lstat
## 
##           Df Sum of Sq     RSS    AIC
## - black    1      0.17  8847.0 1279.2
## - age      1      7.07  8853.9 1279.5
## - crim     1     14.36  8861.2 1279.8
## - indus    1     24.08  8870.9 1280.3
## &lt;none&gt;                  8846.8 1281.2
## - rad      1    103.22  8950.0 1283.9
## - tax      1    156.33  9003.1 1286.3
## - zn       1    198.34  9045.2 1288.2
## - chas     1    251.31  9098.1 1290.5
## - nox      1    692.00  9538.8 1309.8
## - ptratio  1    840.04  9686.9 1316.1
## - rm       1    965.90  9812.7 1321.3
## - dis      1   1349.41 10196.2 1336.9
## - lstat    1   2766.14 11613.0 1389.9
## 
## Step:  AIC=1279.16
## medv ~ crim + zn + indus + chas + nox + rm + age + dis + rad + 
##     tax + ptratio + lstat
## 
##           Df Sum of Sq     RSS    AIC
## - age      1      7.15  8854.1 1277.5
## - crim     1     14.32  8861.3 1277.8
## - indus    1     24.52  8871.5 1278.3
## &lt;none&gt;                  8847.0 1279.2
## + black    1      0.17  8846.8 1281.2
## - rad      1    103.72  8950.7 1281.9
## - tax      1    157.40  9004.4 1284.3
## - zn       1    198.20  9045.2 1286.2
## - chas     1    251.25  9098.2 1288.6
## - nox      1    695.37  9542.4 1308.0
## - ptratio  1    850.76  9697.7 1314.5
## - rm       1    966.99  9814.0 1319.4
## - dis      1   1375.04 10222.0 1336.0
## - lstat    1   2770.28 11617.3 1388.0
## 
## Step:  AIC=1277.49
## medv ~ crim + zn + indus + chas + nox + rm + dis + rad + tax + 
##     ptratio + lstat
## 
##           Df Sum of Sq     RSS    AIC
## - crim     1     18.36  8872.5 1276.3
## - indus    1     25.56  8879.7 1276.7
## &lt;none&gt;                  8854.1 1277.5
## + age      1      7.15  8847.0 1279.2
## + black    1      0.26  8853.9 1279.5
## - rad      1     97.20  8951.3 1279.9
## - tax      1    152.93  9007.1 1282.5
## - zn       1    196.76  9050.9 1284.4
## - chas     1    255.17  9109.3 1287.0
## - nox      1    694.68  9548.8 1306.2
## - ptratio  1    843.66  9697.8 1312.5
## - rm       1   1023.40  9877.5 1320.0
## - dis      1   1633.60 10487.7 1344.4
## - lstat    1   2978.57 11832.7 1393.5
## 
## Step:  AIC=1276.33
## medv ~ zn + indus + chas + nox + rm + dis + rad + tax + ptratio + 
##     lstat
## 
##           Df Sum of Sq     RSS    AIC
## - indus    1     21.92  8894.4 1275.3
## &lt;none&gt;                  8872.5 1276.3
## + crim     1     18.36  8854.1 1277.5
## + age      1     11.19  8861.3 1277.8
## + black    1      0.13  8872.4 1278.3
## - tax      1    158.39  9030.9 1281.5
## - zn       1    180.19  9052.7 1282.5
## - rad      1    212.19  9084.7 1284.0
## - chas     1    249.50  9122.0 1285.6
## - nox      1    689.33  9561.8 1304.8
## - ptratio  1    873.78  9746.3 1312.6
## - rm       1   1025.43  9897.9 1318.8
## - dis      1   1701.37 10573.9 1345.7
## - lstat    1   2996.77 11869.3 1392.8
## 
## Step:  AIC=1275.34
## medv ~ zn + chas + nox + rm + dis + rad + tax + ptratio + lstat
## 
##           Df Sum of Sq     RSS    AIC
## &lt;none&gt;                  8894.4 1275.3
## + indus    1     21.92  8872.5 1276.3
## + crim     1     14.72  8879.7 1276.7
## + age      1     11.89  8882.5 1276.8
## + black    1      0.00  8894.4 1277.3
## - zn       1    206.52  9100.9 1282.7
## - chas     1    237.50  9131.9 1284.1
## - tax      1    281.42  9175.8 1286.0
## - rad      1    293.27  9187.7 1286.5
## - nox      1    800.54  9695.0 1308.4
## - ptratio  1    929.05  9823.5 1313.8
## - rm       1   1083.34  9977.8 1320.1
## - dis      1   1706.94 10601.4 1344.8
## - lstat    1   3024.07 11918.5 1392.5</code></pre>
<pre><code>## 
## Call:
## lm(formula = medv ~ zn + chas + nox + rm + dis + rad + tax + 
##     ptratio + lstat, data = data2)
## 
## Coefficients:
## (Intercept)           zn         chas          nox           rm          dis  
##      22.509        1.016        0.759       -2.764        2.176       -3.970  
##         rad          tax      ptratio        lstat  
##       2.119       -2.317       -1.991       -4.224</code></pre>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="statistical-models.html#cb511-1" tabindex="-1"></a><span class="co"># summary(step(model_o,direction = &quot;both&quot;))</span></span></code></pre></div>
<hr />
</div>
<div id="create-a-model-after-selecting-variables" class="section level3 hasAnchor" number="6.3.12">
<h3><span class="header-section-number">6.3.12</span> Create a model after selecting variables<a href="statistical-models.html#create-a-model-after-selecting-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>After variable selection (or based on domain knowledge), we fit a parsimonious model and inspect its statistical summary.</p>
<p>The <code>summary()</code> output gives:
- coefficient estimates,
- standard errors and t-tests,
- residual standard error,
- <span class="math inline">\(R^2\)</span> and adjusted <span class="math inline">\(R^2\)</span>,
- overall F-statistic.</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="statistical-models.html#cb512-1" tabindex="-1"></a>model_trasf <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> medv <span class="sc">~</span> zn <span class="sc">+</span> chas <span class="sc">+</span> nox <span class="sc">+</span> rm <span class="sc">+</span> dis <span class="sc">+</span> rad <span class="sc">+</span> tax <span class="sc">+</span> </span>
<span id="cb512-2"><a href="statistical-models.html#cb512-2" tabindex="-1"></a>    ptratio <span class="sc">+</span> lstat, <span class="at">data =</span> data2)</span>
<span id="cb512-3"><a href="statistical-models.html#cb512-3" tabindex="-1"></a><span class="fu">summary</span>(model_trasf)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = medv ~ zn + chas + nox + rm + dis + rad + tax + 
##     ptratio + lstat, data = data2)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -13.2923  -2.4690  -0.5086   1.6269  24.5813 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  22.5090     0.2352  95.718  &lt; 2e-16 ***
## zn            1.0161     0.3347   3.036 0.002554 ** 
## chas          0.7590     0.2331   3.256 0.001227 ** 
## nox          -2.7640     0.4624  -5.978 5.05e-09 ***
## rm            2.1760     0.3129   6.954 1.47e-11 ***
## dis          -3.9697     0.4548  -8.729  &lt; 2e-16 ***
## rad           2.1194     0.5858   3.618 0.000335 ***
## tax          -2.3171     0.6538  -3.544 0.000441 ***
## ptratio      -1.9909     0.3092  -6.440 3.47e-10 ***
## lstat        -4.2244     0.3636 -11.618  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 4.733 on 397 degrees of freedom
## Multiple R-squared:  0.7187, Adjusted R-squared:  0.7123 
## F-statistic: 112.7 on 9 and 397 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>At this stage, interpretability matters: each coefficient reflects the effect of that predictor <strong>holding others constant</strong>, assuming linearity and correct specification.</p>
<hr />
</div>
<div id="multicollinearity-checking" class="section level3 hasAnchor" number="6.3.13">
<h3><span class="header-section-number">6.3.13</span> Multicollinearity checking<a href="statistical-models.html#multicollinearity-checking" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Multicollinearity inflates standard errors and makes coefficient estimates unstable. Variance inflation factor (VIF) is a standard diagnostic:
- VIF ≈ 1: no collinearity
- VIF moderately large: correlation among predictors
- Very large VIF: serious instability</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="statistical-models.html#cb514-1" tabindex="-1"></a><span class="fu">vif</span>(model_trasf)</span></code></pre></div>
<pre><code>##       zn     chas      nox       rm      dis      rad      tax  ptratio 
## 2.024269 1.044796 4.074241 1.721080 3.759267 6.008751 7.469414 1.743359 
##    lstat 
## 2.372125</code></pre>
<p>In practice, multicollinearity is common in socioeconomic variables and in biomedical lab panels. If VIF is high, consider:
- removing redundant variables,
- combining variables (indexes),
- penalized regression methods (ridge/lasso).</p>
<hr />
</div>
<div id="plot-model-to-check-assumptions" class="section level3 hasAnchor" number="6.3.14">
<h3><span class="header-section-number">6.3.14</span> Plot model to check assumptions<a href="statistical-models.html#plot-model-to-check-assumptions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The default <code>plot(lm_object)</code> produces key diagnostic plots:
- residuals vs fitted (linearity, heteroscedasticity),
- normal Q-Q (normality of residuals),
- scale-location (variance stability),
- residuals vs leverage (influential points).</p>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="statistical-models.html#cb516-1" tabindex="-1"></a><span class="fu">plot</span>(model_trasf)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-261-1.png" alt="" width="672" /><img src="_main_files/figure-html/unnamed-chunk-261-2.png" alt="" width="672" /><img src="_main_files/figure-html/unnamed-chunk-261-3.png" alt="" width="672" /><img src="_main_files/figure-html/unnamed-chunk-261-4.png" alt="" width="672" /></p>
<div id="histogram-of-residuals" class="section level4 hasAnchor" number="6.3.14.1">
<h4><span class="header-section-number">6.3.14.1</span> Histogram of residuals<a href="statistical-models.html#histogram-of-residuals" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A quick distribution check; it complements the Q-Q plot.</p>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb517-1"><a href="statistical-models.html#cb517-1" tabindex="-1"></a>resid<span class="ot">&lt;-</span> model_trasf<span class="sc">$</span>residuals</span>
<span id="cb517-2"><a href="statistical-models.html#cb517-2" tabindex="-1"></a><span class="fu">hist</span>(resid)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-262-1.png" alt="" width="672" /></p>
</div>
<div id="f-test-of-model" class="section level4 hasAnchor" number="6.3.14.2">
<h4><span class="header-section-number">6.3.14.2</span> F test of model<a href="statistical-models.html#f-test-of-model" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>ANOVA for the fitted model provides model-level significance and decomposition of sums of squares.</p>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb518-1"><a href="statistical-models.html#cb518-1" tabindex="-1"></a><span class="fu">anova</span>(model_trasf)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Df</th>
<th align="right">Sum Sq</th>
<th align="right">Mean Sq</th>
<th align="right">F value</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">zn</td>
<td align="right">1</td>
<td align="right">4019.0308</td>
<td align="right">4019.03076</td>
<td align="right">179.38831</td>
<td align="right">0e+00</td>
</tr>
<tr class="even">
<td align="left">chas</td>
<td align="right">1</td>
<td align="right">1011.5766</td>
<td align="right">1011.57663</td>
<td align="right">45.15144</td>
<td align="right">0e+00</td>
</tr>
<tr class="odd">
<td align="left">nox</td>
<td align="right">1</td>
<td align="right">2785.8086</td>
<td align="right">2785.80857</td>
<td align="right">124.34378</td>
<td align="right">0e+00</td>
</tr>
<tr class="even">
<td align="left">rm</td>
<td align="right">1</td>
<td align="right">8487.0727</td>
<td align="right">8487.07268</td>
<td align="right">378.81810</td>
<td align="right">0e+00</td>
</tr>
<tr class="odd">
<td align="left">dis</td>
<td align="right">1</td>
<td align="right">951.7774</td>
<td align="right">951.77743</td>
<td align="right">42.48232</td>
<td align="right">0e+00</td>
</tr>
<tr class="even">
<td align="left">rad</td>
<td align="right">1</td>
<td align="right">558.8550</td>
<td align="right">558.85503</td>
<td align="right">24.94434</td>
<td align="right">9e-07</td>
</tr>
<tr class="odd">
<td align="left">tax</td>
<td align="right">1</td>
<td align="right">767.8718</td>
<td align="right">767.87176</td>
<td align="right">34.27374</td>
<td align="right">0e+00</td>
</tr>
<tr class="even">
<td align="left">ptratio</td>
<td align="right">1</td>
<td align="right">1119.3945</td>
<td align="right">1119.39453</td>
<td align="right">49.96386</td>
<td align="right">0e+00</td>
</tr>
<tr class="odd">
<td align="left">lstat</td>
<td align="right">1</td>
<td align="right">3024.0665</td>
<td align="right">3024.06652</td>
<td align="right">134.97836</td>
<td align="right">0e+00</td>
</tr>
<tr class="even">
<td align="left">Residuals</td>
<td align="right">397</td>
<td align="right">8894.4215</td>
<td align="right">22.40408</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
</div>
<div id="coefficients-table" class="section level4 hasAnchor" number="6.3.14.3">
<h4><span class="header-section-number">6.3.14.3</span> Coefficients table<a href="statistical-models.html#coefficients-table" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This is the standard regression table with estimates, SEs, t-statistics, and p-values.</p>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb519-1"><a href="statistical-models.html#cb519-1" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">summary</span>(model_trasf))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Estimate</th>
<th align="right">Std. Error</th>
<th align="right">t value</th>
<th align="right">Pr(&gt;|t|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">22.5089571</td>
<td align="right">0.2351584</td>
<td align="right">95.718273</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">zn</td>
<td align="right">1.0160975</td>
<td align="right">0.3346703</td>
<td align="right">3.036115</td>
<td align="right">0.0025545</td>
</tr>
<tr class="odd">
<td align="left">chas</td>
<td align="right">0.7589909</td>
<td align="right">0.2331142</td>
<td align="right">3.255876</td>
<td align="right">0.0012275</td>
</tr>
<tr class="even">
<td align="left">nox</td>
<td align="right">-2.7639762</td>
<td align="right">0.4623875</td>
<td align="right">-5.977619</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">rm</td>
<td align="right">2.1760130</td>
<td align="right">0.3129267</td>
<td align="right">6.953747</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">dis</td>
<td align="right">-3.9697228</td>
<td align="right">0.4547944</td>
<td align="right">-8.728609</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">rad</td>
<td align="right">2.1193795</td>
<td align="right">0.5857829</td>
<td align="right">3.618029</td>
<td align="right">0.0003352</td>
</tr>
<tr class="even">
<td align="left">tax</td>
<td align="right">-2.3171470</td>
<td align="right">0.6537962</td>
<td align="right">-3.544143</td>
<td align="right">0.0004408</td>
</tr>
<tr class="odd">
<td align="left">ptratio</td>
<td align="right">-1.9908948</td>
<td align="right">0.3091666</td>
<td align="right">-6.439552</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">lstat</td>
<td align="right">-4.2244121</td>
<td align="right">0.3636086</td>
<td align="right">-11.618019</td>
<td align="right">0.0000000</td>
</tr>
</tbody>
</table>
</div>
<div id="confidence-intervals" class="section level4 hasAnchor" number="6.3.14.4">
<h4><span class="header-section-number">6.3.14.4</span> Confidence intervals<a href="statistical-models.html#confidence-intervals" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Confidence intervals help quantify uncertainty around effect sizes and are generally more informative than p-values alone.</p>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="statistical-models.html#cb520-1" tabindex="-1"></a><span class="fu">confint</span>(model_trasf)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">2.5 %</th>
<th align="right">97.5 %</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">22.0466457</td>
<td align="right">22.971269</td>
</tr>
<tr class="even">
<td align="left">zn</td>
<td align="right">0.3581500</td>
<td align="right">1.674045</td>
</tr>
<tr class="odd">
<td align="left">chas</td>
<td align="right">0.3006983</td>
<td align="right">1.217283</td>
</tr>
<tr class="even">
<td align="left">nox</td>
<td align="right">-3.6730103</td>
<td align="right">-1.854942</td>
</tr>
<tr class="odd">
<td align="left">rm</td>
<td align="right">1.5608125</td>
<td align="right">2.791214</td>
</tr>
<tr class="even">
<td align="left">dis</td>
<td align="right">-4.8638292</td>
<td align="right">-3.075616</td>
</tr>
<tr class="odd">
<td align="left">rad</td>
<td align="right">0.9677553</td>
<td align="right">3.271004</td>
</tr>
<tr class="even">
<td align="left">tax</td>
<td align="right">-3.6024824</td>
<td align="right">-1.031812</td>
</tr>
<tr class="odd">
<td align="left">ptratio</td>
<td align="right">-2.5987032</td>
<td align="right">-1.383086</td>
</tr>
<tr class="even">
<td align="left">lstat</td>
<td align="right">-4.9392512</td>
<td align="right">-3.509573</td>
</tr>
</tbody>
</table>
<hr />
</div>
</div>
<div id="add-polynomial-quadratic-terms" class="section level3 hasAnchor" number="6.3.15">
<h3><span class="header-section-number">6.3.15</span> Add polynomial (quadratic) terms<a href="statistical-models.html#add-polynomial-quadratic-terms" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When scatterplots suggest curvature, a quadratic term can capture nonlinearity without fully abandoning linear regression.</p>
<p>Here we add <span class="math inline">\(rm^2\)</span> and <span class="math inline">\(lstat^2\)</span>. This often improves fit when relationships are curved.</p>
<div class="sourceCode" id="cb521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb521-1"><a href="statistical-models.html#cb521-1" tabindex="-1"></a>model_trasf_poly <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> medv <span class="sc">~</span> zn <span class="sc">+</span> chas <span class="sc">+</span> nox <span class="sc">+</span>  <span class="fu">I</span>(rm<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> dis <span class="sc">+</span> rad <span class="sc">+</span> tax <span class="sc">+</span> </span>
<span id="cb521-2"><a href="statistical-models.html#cb521-2" tabindex="-1"></a>    ptratio <span class="sc">+</span>   <span class="fu">I</span>(lstat<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> data2)</span>
<span id="cb521-3"><a href="statistical-models.html#cb521-3" tabindex="-1"></a><span class="fu">summary</span>(model_trasf_poly)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = medv ~ zn + chas + nox + I(rm^2) + dis + rad + tax + 
##     ptratio + I(lstat^2), data = data2)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -19.0736  -3.4029  -0.6212   2.8340  29.4942 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  22.2859     0.3526  63.212  &lt; 2e-16 ***
## zn            1.5524     0.4096   3.790 0.000174 ***
## chas          0.9570     0.2834   3.377 0.000805 ***
## nox          -4.4962     0.5455  -8.242 2.50e-15 ***
## I(rm^2)       1.5313     0.1589   9.637  &lt; 2e-16 ***
## dis          -3.3186     0.5644  -5.880 8.69e-09 ***
## rad           3.0529     0.7024   4.346 1.76e-05 ***
## tax          -3.6647     0.7861  -4.662 4.28e-06 ***
## ptratio      -2.6800     0.3706  -7.232 2.47e-12 ***
## I(lstat^2)   -1.3170     0.1918  -6.865 2.56e-11 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 5.763 on 397 degrees of freedom
## Multiple R-squared:  0.583,  Adjusted R-squared:  0.5735 
## F-statistic: 61.67 on 9 and 397 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Practical note: polynomial terms can improve fit but may complicate interpretation. Always validate that the improvement generalizes (e.g., CV).</p>
<hr />
</div>
<div id="add-interaction-terms" class="section level3 hasAnchor" number="6.3.16">
<h3><span class="header-section-number">6.3.16</span> Add interaction terms<a href="statistical-models.html#add-interaction-terms" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Interactions allow the effect of one predictor to depend on another. Conceptually, they represent effect modification.</p>
<p>Here we model the interaction <span class="math inline">\(rm \times lstat\)</span>. This is a meaningful interaction in Boston housing: the benefit of more rooms may differ across neighborhood socioeconomic status proxies.</p>
<ul>
<li><code>rm and lstat</code><br />
</li>
<li>R2 &gt;0.7 indicates a good fit of the model</li>
</ul>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="statistical-models.html#cb523-1" tabindex="-1"></a>model_trasf_term <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> medv <span class="sc">~</span> zn <span class="sc">+</span> chas <span class="sc">+</span> nox <span class="sc">+</span>  (rm<span class="sc">*</span>  lstat) <span class="sc">+</span> dis <span class="sc">+</span> rad <span class="sc">+</span> tax <span class="sc">+</span> </span>
<span id="cb523-2"><a href="statistical-models.html#cb523-2" tabindex="-1"></a>    ptratio  , <span class="at">data =</span> data2)</span>
<span id="cb523-3"><a href="statistical-models.html#cb523-3" tabindex="-1"></a><span class="fu">summary</span>(model_trasf_term)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = medv ~ zn + chas + nox + (rm * lstat) + dis + rad + 
##     tax + ptratio, data = data2)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -19.4595  -2.3458  -0.2389   1.7950  26.6992 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  21.4297     0.2379  90.060  &lt; 2e-16 ***
## zn            0.5221     0.3046   1.714 0.087296 .  
## chas          0.6538     0.2095   3.120 0.001941 ** 
## nox          -2.0295     0.4218  -4.812 2.13e-06 ***
## rm            1.6459     0.2860   5.754 1.75e-08 ***
## lstat        -5.8715     0.3669 -16.002  &lt; 2e-16 ***
## dis          -3.1810     0.4161  -7.645 1.60e-13 ***
## rad           1.9251     0.5262   3.658 0.000288 ***
## tax          -1.9187     0.5883  -3.261 0.001205 ** 
## ptratio      -1.5554     0.2811  -5.534 5.70e-08 ***
## rm:lstat     -1.8202     0.1852  -9.830  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 4.249 on 396 degrees of freedom
## Multiple R-squared:  0.7739, Adjusted R-squared:  0.7682 
## F-statistic: 135.5 on 10 and 396 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Diagnostic plots remain essential because adding interactions can create leverage points and change residual structure.</p>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb525-1"><a href="statistical-models.html#cb525-1" tabindex="-1"></a><span class="fu">plot</span>(model_trasf_term)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-268-1.png" alt="" width="672" /><img src="_main_files/figure-html/unnamed-chunk-268-2.png" alt="" width="672" /><img src="_main_files/figure-html/unnamed-chunk-268-3.png" alt="" width="672" /><img src="_main_files/figure-html/unnamed-chunk-268-4.png" alt="" width="672" /></p>
<hr />
</div>
<div id="robust-regression" class="section level3 hasAnchor" number="6.3.17">
<h3><span class="header-section-number">6.3.17</span> Robust regression<a href="statistical-models.html#robust-regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Outliers and influential points can dominate OLS. Robust regression (<code>rlm</code>) downweights extreme residuals and can produce more stable estimates.</p>
<p>This is especially relevant when:
- the dataset contains measurement errors,
- there are heavy tails,
- influential observations distort inference.</p>
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb526-1"><a href="statistical-models.html#cb526-1" tabindex="-1"></a>robust_model_term <span class="ot">&lt;-</span> <span class="fu">rlm</span>(medv <span class="sc">~</span> zn <span class="sc">+</span> chas <span class="sc">+</span> nox <span class="sc">+</span>  (rm<span class="sc">*</span>  lstat) <span class="sc">+</span> dis <span class="sc">+</span> rad <span class="sc">+</span> tax <span class="sc">+</span> </span>
<span id="cb526-2"><a href="statistical-models.html#cb526-2" tabindex="-1"></a>    ptratio  , <span class="at">data =</span> data2)</span>
<span id="cb526-3"><a href="statistical-models.html#cb526-3" tabindex="-1"></a><span class="fu">summary</span>(robust_model_term)</span></code></pre></div>
<pre><code>## 
## Call: rlm(formula = medv ~ zn + chas + nox + (rm * lstat) + dis + rad + 
##     tax + ptratio, data = data2)
## Residuals:
##       Min        1Q    Median        3Q       Max 
## -20.90999  -1.74873  -0.09845   1.92931  33.87244 
## 
## Coefficients:
##             Value    Std. Error t value 
## (Intercept)  20.9624   0.1656   126.5763
## zn            0.1998   0.2120     0.9424
## chas          0.5198   0.1458     3.5643
## nox          -1.3458   0.2935    -4.5846
## rm            2.8773   0.1991    14.4524
## lstat        -4.5706   0.2554   -17.8979
## dis          -1.9208   0.2896    -6.6326
## rad           0.9005   0.3663     2.4586
## tax          -1.7199   0.4095    -4.2004
## ptratio      -1.2451   0.1956    -6.3652
## rm:lstat     -1.9899   0.1289   -15.4398
## 
## Residual standard error: 2.698 on 396 degrees of freedom</code></pre>
<p>Practical note: robust regression changes the objective function and standard inference is different. It’s often used for sensitivity analysis rather than as the sole primary model.</p>
<hr />
</div>
<div id="create-a-model-before-transforming-data" class="section level3 hasAnchor" number="6.3.18">
<h3><span class="header-section-number">6.3.18</span> Create a model before transforming data<a href="statistical-models.html#create-a-model-before-transforming-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To understand the impact of transformation, we fit the analogous model on the original (non-transformed) training dataset. This helps assess whether transformation improves:
- fit,
- residual behavior,
- predictive performance.</p>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb528-1"><a href="statistical-models.html#cb528-1" tabindex="-1"></a>model_trasf_orig <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> medv <span class="sc">~</span> zn <span class="sc">+</span> chas <span class="sc">+</span> nox <span class="sc">+</span> rm <span class="sc">+</span> dis <span class="sc">+</span> rad <span class="sc">+</span> tax <span class="sc">+</span> </span>
<span id="cb528-2"><a href="statistical-models.html#cb528-2" tabindex="-1"></a>    ptratio <span class="sc">+</span> lstat, <span class="at">data =</span> data)</span>
<span id="cb528-3"><a href="statistical-models.html#cb528-3" tabindex="-1"></a><span class="fu">summary</span>(model_trasf_orig)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = medv ~ zn + chas + nox + rm + dis + rad + tax + 
##     ptratio + lstat, data = data)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -14.219  -2.729  -0.463   1.920  25.992 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  22.5094     0.2430  92.619  &lt; 2e-16 ***
## zn            0.8232     0.3754   2.193 0.028904 *  
## chas          0.6582     0.2412   2.728 0.006652 ** 
## nox          -1.9351     0.4727  -4.093 5.15e-05 ***
## rm            2.3985     0.3128   7.668 1.36e-13 ***
## dis          -2.9289     0.4565  -6.416 3.99e-10 ***
## rad           2.2109     0.6348   3.483 0.000551 ***
## tax          -2.1880     0.6896  -3.173 0.001627 ** 
## ptratio      -2.0274     0.3254  -6.230 1.19e-09 ***
## lstat        -4.3534     0.3844 -11.325  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 4.895 on 397 degrees of freedom
## Multiple R-squared:  0.7212, Adjusted R-squared:  0.7149 
## F-statistic: 114.1 on 9 and 397 DF,  p-value: &lt; 2.2e-16</code></pre>
<div id="non-nested-model-comparisons-aic" class="section level4 hasAnchor" number="6.3.18.1">
<h4><span class="header-section-number">6.3.18.1</span> Non-nested model comparisons (AIC)<a href="statistical-models.html#non-nested-model-comparisons-aic" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>AIC compares models by balancing fit and complexity. Lower AIC indicates better tradeoff (within the candidate set).</p>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb530-1"><a href="statistical-models.html#cb530-1" tabindex="-1"></a><span class="fu">AIC</span>(model_trasf,model_trasf_orig)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">df</th>
<th align="right">AIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">model_trasf</td>
<td align="right">11</td>
<td align="right">2432.353</td>
</tr>
<tr class="even">
<td align="left">model_trasf_orig</td>
<td align="right">11</td>
<td align="right">2459.780</td>
</tr>
</tbody>
</table>
<hr />
</div>
</div>
<div id="k-fold-cross-validation" class="section level3 hasAnchor" number="6.3.19">
<h3><span class="header-section-number">6.3.19</span> K-fold cross validation<a href="statistical-models.html#k-fold-cross-validation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Cross-validation provides a more direct estimate of predictive performance. It is especially important after model selection or when comparing multiple model families.</p>
<p>Here we use 10-fold CV via <code>DAAG::cv.glm()</code>.</p>
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb531-1"><a href="statistical-models.html#cb531-1" tabindex="-1"></a><span class="co"># install.packages(&quot;DAAG&quot;)</span></span>
<span id="cb531-2"><a href="statistical-models.html#cb531-2" tabindex="-1"></a><span class="fu">library</span>(DAAG)</span></code></pre></div>
<pre><code>## Warning: package &#39;DAAG&#39; was built under R version 4.4.3</code></pre>
<div class="sourceCode" id="cb533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb533-1"><a href="statistical-models.html#cb533-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb533-2"><a href="statistical-models.html#cb533-2" tabindex="-1"></a>model_trasf_term_cv <span class="ot">&lt;-</span> <span class="fu">glm</span>( medv <span class="sc">~</span> zn <span class="sc">+</span> chas <span class="sc">+</span> nox <span class="sc">+</span>  (rm<span class="sc">*</span>  lstat) <span class="sc">+</span> dis <span class="sc">+</span> rad <span class="sc">+</span> tax <span class="sc">+</span> </span>
<span id="cb533-3"><a href="statistical-models.html#cb533-3" tabindex="-1"></a>    ptratio  , <span class="at">data =</span> data2)</span>
<span id="cb533-4"><a href="statistical-models.html#cb533-4" tabindex="-1"></a>cv.err  <span class="ot">&lt;-</span> <span class="fu">cv.glm</span>(data2, model_trasf_term_cv, <span class="at">K =</span> <span class="dv">10</span>)<span class="sc">$</span>delta</span>
<span id="cb533-5"><a href="statistical-models.html#cb533-5" tabindex="-1"></a>cv.err </span></code></pre></div>
<pre><code>## [1] 19.24588 19.15400</code></pre>
<p>Interpretation:
- The <code>delta</code> output typically includes raw and adjusted CV error estimates.
- Compare CV errors across competing models; smaller values indicate better predictive performance.</p>
<hr />
</div>
<div id="nonnest-models-comparisons" class="section level3 hasAnchor" number="6.3.20">
<h3><span class="header-section-number">6.3.20</span> Nonnest models comparisons<a href="statistical-models.html#nonnest-models-comparisons" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Once you have multiple candidate models (original scale, transformed, polynomial, interaction), compare them side-by-side.</p>
<p>AIC is one way; CV error is another. In applied practice, you often consider both:
- AIC for model parsimony,
- CV for predictive robustness.</p>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb535-1"><a href="statistical-models.html#cb535-1" tabindex="-1"></a><span class="fu">AIC</span>(model_trasf_term,model_trasf,model_trasf_orig,model_trasf_poly)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">df</th>
<th align="right">AIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">model_trasf_term</td>
<td align="right">12</td>
<td align="right">2345.492</td>
</tr>
<tr class="even">
<td align="left">model_trasf</td>
<td align="right">11</td>
<td align="right">2432.353</td>
</tr>
<tr class="odd">
<td align="left">model_trasf_orig</td>
<td align="right">11</td>
<td align="right">2459.780</td>
</tr>
<tr class="even">
<td align="left">model_trasf_poly</td>
<td align="right">11</td>
<td align="right">2592.584</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb536-1"><a href="statistical-models.html#cb536-1" tabindex="-1"></a><span class="co"># interaction, transformation, original, polynomial by order (`data` has been normalized but not `data2`)</span></span></code></pre></div>
<hr />
</div>
<div id="posterior-predictive-diagnostic-checks" class="section level3 hasAnchor" number="6.3.21">
<h3><span class="header-section-number">6.3.21</span> Posterior predictive / diagnostic checks<a href="statistical-models.html#posterior-predictive-diagnostic-checks" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Even after selecting a “best” model, the most important step is to verify assumptions and identify influential observations.</p>
<p><code>performance::check_model()</code> provides a comprehensive set of diagnostics in one call:
- linearity,
- homoscedasticity,
- influential points,
- collinearity,
- normality of residuals.</p>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb537-1"><a href="statistical-models.html#cb537-1" tabindex="-1"></a><span class="co"># install.packages(&quot;performance&quot;)</span></span>
<span id="cb537-2"><a href="statistical-models.html#cb537-2" tabindex="-1"></a><span class="fu">library</span>(performance)</span></code></pre></div>
<pre><code>## Warning: package &#39;performance&#39; was built under R version 4.4.3</code></pre>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb539-1"><a href="statistical-models.html#cb539-1" tabindex="-1"></a><span class="fu">check_model</span>(model_trasf_term)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-274-1.png" alt="" width="672" /></p>
<p>In practice, if diagnostics are poor, consider:
- transformations,
- adding nonlinear terms,
- robust SEs,
- or moving to a more appropriate model class.</p>
<hr />
</div>
<div id="forest-plot-for-coefficients" class="section level3 hasAnchor" number="6.3.22">
<h3><span class="header-section-number">6.3.22</span> Forest plot for coefficients<a href="statistical-models.html#forest-plot-for-coefficients" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Coefficient plots help communicate results clearly. They emphasize effect size and uncertainty, not only p-values.</p>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="statistical-models.html#cb540-1" tabindex="-1"></a><span class="fu">library</span>(sjPlot) </span>
<span id="cb540-2"><a href="statistical-models.html#cb540-2" tabindex="-1"></a><span class="fu">plot_model</span>(model_trasf_term, <span class="at">show.values =</span> <span class="cn">TRUE</span>, <span class="at">value.offset =</span> <span class="fl">0.4</span>) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-275-1.png" alt="" width="672" /></p>
<hr />
</div>
<div id="relative-importance" class="section level3 hasAnchor" number="6.3.23">
<h3><span class="header-section-number">6.3.23</span> Relative Importance<a href="statistical-models.html#relative-importance" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When predictors are correlated, raw coefficients are not always a good measure of “importance.” Relative importance methods attempt to quantify each predictor’s contribution to explained variance.</p>
<p>Here, <code>relaimpo</code> is used with bootstrap resampling to assess stability.</p>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb541-1"><a href="statistical-models.html#cb541-1" tabindex="-1"></a><span class="fu">library</span>(relaimpo)</span></code></pre></div>
<pre><code>## Warning: package &#39;relaimpo&#39; was built under R version 4.4.3</code></pre>
<pre><code>## Warning: package &#39;survey&#39; was built under R version 4.4.3</code></pre>
<pre><code>## Warning: package &#39;mitools&#39; was built under R version 4.4.3</code></pre>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb545-1"><a href="statistical-models.html#cb545-1" tabindex="-1"></a><span class="co"># calc.relimp(fit,type=c(&quot;lmg&quot;,&quot;last&quot;,&quot;first&quot;,&quot;pratt&quot;),</span></span>
<span id="cb545-2"><a href="statistical-models.html#cb545-2" tabindex="-1"></a><span class="co">#    rela=TRUE)</span></span>
<span id="cb545-3"><a href="statistical-models.html#cb545-3" tabindex="-1"></a><span class="co"># Bootstrap Measures of Relative Importance (1000 samples)</span></span>
<span id="cb545-4"><a href="statistical-models.html#cb545-4" tabindex="-1"></a>boot <span class="ot">&lt;-</span> <span class="fu">boot.relimp</span>(model_trasf_term, <span class="at">b =</span> <span class="dv">10</span>, <span class="at">type =</span><span class="fu">c</span>(<span class="st">&quot;lmg&quot;</span> ), <span class="at">rank =</span> <span class="cn">TRUE</span>,</span>
<span id="cb545-5"><a href="statistical-models.html#cb545-5" tabindex="-1"></a>                    <span class="co"># type =c(&quot;lmg&quot;,&quot;last&quot;,&quot;first&quot;,&quot;pratt&quot;)</span></span>
<span id="cb545-6"><a href="statistical-models.html#cb545-6" tabindex="-1"></a>  <span class="at">diff =</span> <span class="cn">TRUE</span>, <span class="at">rela =</span> <span class="cn">TRUE</span>)</span>
<span id="cb545-7"><a href="statistical-models.html#cb545-7" tabindex="-1"></a><span class="fu">booteval.relimp</span>(boot) <span class="co"># print result</span></span></code></pre></div>
<pre><code>## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints</code></pre>
<pre><code>## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints</code></pre>
<pre><code>## Response variable: medv 
## Total response variance: 77.88147 
## Analysis based on 407 observations 
## 
## 10 Regressors: 
## zn chas nox rm lstat dis rad tax ptratio rm:lstat 
## Proportion of variance explained by model: 77.39%
## Metrics are normalized to sum to 100% (rela=TRUE). 
## 
## Relative importance metrics: 
## 
##                 lmg
## zn       0.03220843
## chas     0.01925573
## nox      0.05753222
## rm       0.24841214
## lstat    0.32582422
## dis      0.04647715
## rad      0.03216196
## tax      0.05940953
## ptratio  0.09003437
## rm:lstat 0.08868423
## 
## Average coefficients for different model sizes: 
## 
##                  1X        2Xs        3Xs        4Xs        5Xs        6Xs
## zn        3.1505046  2.1309586  1.5419108  1.1885764  0.9622432  0.8066737
## chas      1.4317561  1.3828980  1.2922217  1.1827563  1.0710746  0.9666952
## nox      -3.6683140 -2.8590532 -2.3987148 -2.1635246 -2.0628637 -2.0336275
## rm        5.8715576  5.1812470  4.6686609  4.2214027  3.7902531  3.3584729
## lstat    -6.3961998 -6.2413211 -6.1543204 -6.0962610 -6.0505503 -6.0111059
## dis       2.3495853  0.6106749 -0.5986185 -1.4554886 -2.0655023 -2.4944977
## rad      -3.2090101 -1.5469225 -0.4505596  0.2850626  0.7884232  1.1408255
## tax      -4.1727995 -3.6061521 -3.1776467 -2.8413999 -2.5683300 -2.3434564
## ptratio  -4.2048171 -3.4233285 -2.9476391 -2.6199136 -2.3633992 -2.1469790
## rm:lstat -0.7386853 -1.0072327 -1.1975350 -1.3430505 -1.4610987 -1.5602846
##                 7Xs        8Xs        9Xs       10Xs
## zn        0.6942682  0.6122971  0.5558327  0.5221292
## chas      0.8734919  0.7916003  0.7191770  0.6537613
## nox      -2.0351844 -2.0434312 -2.0444974 -2.0294702
## rm        2.9235837  2.4886854  2.0599352  1.6458985
## lstat    -5.9756419 -5.9424093 -5.9088868 -5.8714971
## dis      -2.7882468 -2.9825750 -3.1064663 -3.1809633
## rad       1.3969994  1.5963587  1.7666711  1.9250667
## tax      -2.1625306 -2.0281734 -1.9455332 -1.9186629
## ptratio  -1.9610124 -1.8027959 -1.6694147 -1.5553973
## rm:lstat -1.6447082 -1.7160362 -1.7745576 -1.8202278
## 
##  
##  Confidence interval information ( 10 bootstrap replicates, bty= perc ): 
## Relative Contributions with confidence intervals: 
##  
##                                    Lower  Upper
##              percentage 0.95       0.95   0.95  
## zn.lmg       0.0322     _______HIJ 0.0204 0.0357
## chas.lmg     0.0193     ______GHIJ 0.0016 0.0501
## nox.lmg      0.0575     ____EFG___ 0.0430 0.0708
## rm.lmg       0.2484     AB________ 0.1916 0.3284
## lstat.lmg    0.3258     AB________ 0.2617 0.3836
## dis.lmg      0.0465     _____FGHIJ 0.0286 0.0548
## rad.lmg      0.0322     ______GHIJ 0.0215 0.0465
## tax.lmg      0.0594     ___DEF____ 0.0479 0.0796
## ptratio.lmg  0.0900     __CD______ 0.0711 0.1202
## rm:lstat.lmg 0.0887     __CDE_____ 0.0606 0.1037
## 
## Letters indicate the ranks covered by bootstrap CIs. 
## (Rank bootstrap confidence intervals always obtained by percentile method) 
## CAUTION: Bootstrap confidence intervals can be somewhat liberal. 
## 
##  
##  Differences between Relative Contributions: 
##  
##                                      Lower   Upper
##                      difference 0.95 0.95    0.95   
## zn-chas.lmg           0.0130         -0.0192  0.0276
## zn-nox.lmg           -0.0253     *   -0.0504 -0.0137
## zn-rm.lmg            -0.2162     *   -0.3028 -0.1559
## zn-lstat.lmg         -0.2936     *   -0.3478 -0.2274
## zn-dis.lmg           -0.0143         -0.0235  0.0019
## zn-rad.lmg            0.0000         -0.0221  0.0084
## zn-tax.lmg           -0.0272     *   -0.0532 -0.0166
## zn-ptratio.lmg       -0.0578     *   -0.0911 -0.0377
## zn-rm:lstat.lmg      -0.0565     *   -0.0746 -0.0305
## chas-nox.lmg         -0.0383     *   -0.0584 -0.0033
## chas-rm.lmg          -0.2292     *   -0.3144 -0.1753
## chas-lstat.lmg       -0.3066     *   -0.3672 -0.2117
## chas-dis.lmg         -0.0272         -0.0385  0.0137
## chas-rad.lmg         -0.0129         -0.0449  0.0201
## chas-tax.lmg         -0.0402     *   -0.0781 -0.0008
## chas-ptratio.lmg     -0.0708     *   -0.1187 -0.0260
## chas-rm:lstat.lmg    -0.0694     *   -0.1021 -0.0338
## nox-rm.lmg           -0.1909     *   -0.2781 -0.1378
## nox-lstat.lmg        -0.2683     *   -0.3298 -0.2047
## nox-dis.lmg           0.0111         -0.0010  0.0275
## nox-rad.lmg           0.0254     *    0.0048  0.0288
## nox-tax.lmg          -0.0019         -0.0283  0.0061
## nox-ptratio.lmg      -0.0325     *   -0.0689 -0.0130
## nox-rm:lstat.lmg     -0.0312     *   -0.0525 -0.0008
## rm-lstat.lmg         -0.0774         -0.1920  0.0488
## rm-dis.lmg            0.2019     *    0.1368  0.2922
## rm-rad.lmg            0.2163     *    0.1599  0.3069
## rm-tax.lmg            0.1890     *    0.1310  0.2806
## rm-ptratio.lmg        0.1584     *    0.1065  0.2525
## rm-rm:lstat.lmg       0.1597     *    0.1047  0.2605
## lstat-dis.lmg         0.2793     *    0.2253  0.3288
## lstat-rad.lmg         0.2937     *    0.2231  0.3519
## lstat-tax.lmg         0.2664     *    0.1899  0.3229
## lstat-ptratio.lmg     0.2358     *    0.1493  0.2985
## lstat-rm:lstat.lmg    0.2371     *    0.1658  0.3018
## dis-rad.lmg           0.0143         -0.0088  0.0231
## dis-tax.lmg          -0.0129     *   -0.0419 -0.0043
## dis-ptratio.lmg      -0.0436     *   -0.0825 -0.0303
## dis-rm:lstat.lmg     -0.0422     *   -0.0660 -0.0071
## rad-tax.lmg          -0.0272     *   -0.0331 -0.0205
## rad-ptratio.lmg      -0.0579     *   -0.0737 -0.0367
## rad-rm:lstat.lmg     -0.0565     *   -0.0714 -0.0240
## tax-ptratio.lmg      -0.0306     *   -0.0462 -0.0123
## tax-rm:lstat.lmg     -0.0293         -0.0453  0.0050
## ptratio-rm:lstat.lmg  0.0014         -0.0253  0.0346
## 
## * indicates that CI for difference does not include 0. 
## CAUTION: Bootstrap confidence intervals can be somewhat liberal.</code></pre>
<div class="sourceCode" id="cb549"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb549-1"><a href="statistical-models.html#cb549-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">booteval.relimp</span>(boot,<span class="at">sort=</span><span class="cn">TRUE</span>)) <span class="co"># plot result</span></span></code></pre></div>
<pre><code>## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints
## Warning in norm.inter(t, alpha): extreme order statistics used as endpoints</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-276-1.png" alt="" width="672" /></p>
<p>Practical note: bootstrap sample size <code>b</code> should be much larger (e.g., 500–2000) for stable inference; here it is small for demonstration.</p>
<hr />
</div>
<div id="model-prediction" class="section level3 hasAnchor" number="6.3.24">
<h3><span class="header-section-number">6.3.24</span> Model prediction<a href="statistical-models.html#model-prediction" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Prediction is where the model becomes operational. We generate:
- prediction intervals (<code>interval="predict"</code>) for individual outcomes,
- confidence intervals (<code>interval="confidence"</code>) for mean responses.</p>
<p>First, create a predictor dataset.</p>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb551-1"><a href="statistical-models.html#cb551-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb551-2"><a href="statistical-models.html#cb551-2" tabindex="-1"></a>data_pred <span class="ot">&lt;-</span>   dplyr<span class="sc">::</span><span class="fu">select</span>(data2 , zn , chas , nox , rm , dis , rad , tax , </span>
<span id="cb551-3"><a href="statistical-models.html#cb551-3" tabindex="-1"></a>    ptratio , lstat)</span>
<span id="cb551-4"><a href="statistical-models.html#cb551-4" tabindex="-1"></a>data_pred[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="2%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="9%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">zn</th>
<th align="right">chas</th>
<th align="right">nox</th>
<th align="right">rm</th>
<th align="right">dis</th>
<th align="right">rad</th>
<th align="right">tax</th>
<th align="right">ptratio</th>
<th align="right">lstat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">0.2845483</td>
<td align="right">-0.2723291</td>
<td align="right">-0.1440749</td>
<td align="right">0.4132629</td>
<td align="right">0.2785465</td>
<td align="right">-0.9818712</td>
<td align="right">-0.6659492</td>
<td align="right">-1.4575580</td>
<td align="right">-1.0744990</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">-0.4872402</td>
<td align="right">-0.2723291</td>
<td align="right">-0.7395304</td>
<td align="right">0.1940824</td>
<td align="right">0.6786919</td>
<td align="right">-0.8670245</td>
<td align="right">-0.9863534</td>
<td align="right">-0.3027945</td>
<td align="right">-0.4919525</td>
</tr>
<tr class="odd">
<td align="left">4</td>
<td align="right">-0.4872402</td>
<td align="right">-0.2723291</td>
<td align="right">-0.8344581</td>
<td align="right">1.0152978</td>
<td align="right">1.1314532</td>
<td align="right">-0.7521778</td>
<td align="right">-1.1050216</td>
<td align="right">0.1129203</td>
<td align="right">-1.3601708</td>
</tr>
<tr class="even">
<td align="left">5</td>
<td align="right">-0.4872402</td>
<td align="right">-0.2723291</td>
<td align="right">-0.8344581</td>
<td align="right">1.2273620</td>
<td align="right">1.1314532</td>
<td align="right">-0.7521778</td>
<td align="right">-1.1050216</td>
<td align="right">0.1129203</td>
<td align="right">-1.0254866</td>
</tr>
<tr class="odd">
<td align="left">6</td>
<td align="right">-0.4872402</td>
<td align="right">-0.2723291</td>
<td align="right">-0.8344581</td>
<td align="right">0.2068916</td>
<td align="right">1.1314532</td>
<td align="right">-0.7521778</td>
<td align="right">-1.1050216</td>
<td align="right">0.1129203</td>
<td align="right">-1.0422909</td>
</tr>
<tr class="even">
<td align="left">7</td>
<td align="right">0.0487240</td>
<td align="right">-0.2723291</td>
<td align="right">-0.2648919</td>
<td align="right">-0.3880270</td>
<td align="right">0.9295961</td>
<td align="right">-0.5224844</td>
<td align="right">-0.5769480</td>
<td align="right">-1.5037485</td>
<td align="right">-0.0312367</td>
</tr>
<tr class="odd">
<td align="left">8</td>
<td align="right">0.0487240</td>
<td align="right">-0.2723291</td>
<td align="right">-0.2648919</td>
<td align="right">-0.1603069</td>
<td align="right">1.0872565</td>
<td align="right">-0.5224844</td>
<td align="right">-0.5769480</td>
<td align="right">-1.5037485</td>
<td align="right">0.9097999</td>
</tr>
<tr class="even">
<td align="left">9</td>
<td align="right">0.0487240</td>
<td align="right">-0.2723291</td>
<td align="right">-0.2648919</td>
<td align="right">-0.9302853</td>
<td align="right">1.1392843</td>
<td align="right">-0.5224844</td>
<td align="right">-0.5769480</td>
<td align="right">-1.5037485</td>
<td align="right">2.4193794</td>
</tr>
<tr class="odd">
<td align="left">10</td>
<td align="right">0.0487240</td>
<td align="right">-0.2723291</td>
<td align="right">-0.2648919</td>
<td align="right">-0.3994130</td>
<td align="right">1.3357787</td>
<td align="right">-0.5224844</td>
<td align="right">-0.5769480</td>
<td align="right">-1.5037485</td>
<td align="right">0.6227277</td>
</tr>
<tr class="even">
<td align="left">11</td>
<td align="right">0.0487240</td>
<td align="right">-0.2723291</td>
<td align="right">-0.2648919</td>
<td align="right">0.1314594</td>
<td align="right">1.2422167</td>
<td align="right">-0.5224844</td>
<td align="right">-0.5769480</td>
<td align="right">-1.5037485</td>
<td align="right">1.0918456</td>
</tr>
</tbody>
</table>
<div id="prediction-interval-individual-prediction" class="section level4 hasAnchor" number="6.3.24.1">
<h4><span class="header-section-number">6.3.24.1</span> Prediction interval (individual prediction)<a href="statistical-models.html#prediction-interval-individual-prediction" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Prediction intervals are wider because they include residual variability.</p>
<div class="sourceCode" id="cb552"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb552-1"><a href="statistical-models.html#cb552-1" tabindex="-1"></a>predy <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_trasf_term, data_pred[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,], <span class="at">interval=</span><span class="st">&quot;predict&quot;</span>)</span>
<span id="cb552-2"><a href="statistical-models.html#cb552-2" tabindex="-1"></a>predy</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fit</th>
<th align="right">lwr</th>
<th align="right">upr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">30.258620</td>
<td align="right">21.8534712</td>
<td align="right">38.66377</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">24.415330</td>
<td align="right">16.0263022</td>
<td align="right">32.80436</td>
</tr>
<tr class="odd">
<td align="left">4</td>
<td align="right">31.759215</td>
<td align="right">23.3073401</td>
<td align="right">40.21109</td>
</tr>
<tr class="even">
<td align="left">5</td>
<td align="right">29.920476</td>
<td align="right">21.4789966</td>
<td align="right">38.36196</td>
</tr>
<tr class="odd">
<td align="left">6</td>
<td align="right">26.441050</td>
<td align="right">18.0254500</td>
<td align="right">34.85665</td>
</tr>
<tr class="even">
<td align="left">7</td>
<td align="right">20.820462</td>
<td align="right">12.3963513</td>
<td align="right">29.24457</td>
</tr>
<tr class="odd">
<td align="left">8</td>
<td align="right">15.455998</td>
<td align="right">6.9807773</td>
<td align="right">23.93122</td>
</tr>
<tr class="even">
<td align="left">9</td>
<td align="right">8.991037</td>
<td align="right">0.4048231</td>
<td align="right">17.57725</td>
</tr>
<tr class="odd">
<td align="left">10</td>
<td align="right">16.144719</td>
<td align="right">7.6745761</td>
<td align="right">24.61486</td>
</tr>
<tr class="even">
<td align="left">11</td>
<td align="right">13.847673</td>
<td align="right">5.3305253</td>
<td align="right">22.36482</td>
</tr>
</tbody>
</table>
</div>
<div id="confidence-interval-mean-prediction" class="section level4 hasAnchor" number="6.3.24.2">
<h4><span class="header-section-number">6.3.24.2</span> Confidence interval (mean prediction)<a href="statistical-models.html#confidence-interval-mean-prediction" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Confidence intervals for the mean response are narrower than prediction intervals.</p>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb553-1"><a href="statistical-models.html#cb553-1" tabindex="-1"></a>confy <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_trasf_term, data_pred[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,], <span class="at">interval=</span><span class="st">&quot;confidence&quot;</span>)</span>
<span id="cb553-2"><a href="statistical-models.html#cb553-2" tabindex="-1"></a>confy</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">fit</th>
<th align="right">lwr</th>
<th align="right">upr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">30.258620</td>
<td align="right">29.329961</td>
<td align="right">31.18728</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">24.415330</td>
<td align="right">23.646134</td>
<td align="right">25.18452</td>
</tr>
<tr class="odd">
<td align="left">4</td>
<td align="right">31.759215</td>
<td align="right">30.474666</td>
<td align="right">33.04376</td>
</tr>
<tr class="even">
<td align="left">5</td>
<td align="right">29.920476</td>
<td align="right">28.706202</td>
<td align="right">31.13475</td>
</tr>
<tr class="odd">
<td align="left">6</td>
<td align="right">26.441050</td>
<td align="right">25.422125</td>
<td align="right">27.45998</td>
</tr>
<tr class="even">
<td align="left">7</td>
<td align="right">20.820462</td>
<td align="right">19.733484</td>
<td align="right">21.90744</td>
</tr>
<tr class="odd">
<td align="left">8</td>
<td align="right">15.455998</td>
<td align="right">14.025877</td>
<td align="right">16.88612</td>
</tr>
<tr class="even">
<td align="left">9</td>
<td align="right">8.991037</td>
<td align="right">7.006358</td>
<td align="right">10.97572</td>
</tr>
<tr class="odd">
<td align="left">10</td>
<td align="right">16.144719</td>
<td align="right">14.745003</td>
<td align="right">17.54443</td>
</tr>
<tr class="even">
<td align="left">11</td>
<td align="right">13.847673</td>
<td align="right">12.187044</td>
<td align="right">15.50830</td>
</tr>
</tbody>
</table>
</div>
<div id="ci-width" class="section level4 hasAnchor" number="6.3.24.3">
<h4><span class="header-section-number">6.3.24.3</span> CI width<a href="statistical-models.html#ci-width" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A quick way to compute interval width is upper minus lower bound.</p>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb554-1"><a href="statistical-models.html#cb554-1" tabindex="-1"></a>confy <span class="sc">%*%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span></code></pre></div>
<table>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">1.857318</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">1.538391</td>
</tr>
<tr class="odd">
<td align="left">4</td>
<td align="right">2.569097</td>
</tr>
<tr class="even">
<td align="left">5</td>
<td align="right">2.428550</td>
</tr>
<tr class="odd">
<td align="left">6</td>
<td align="right">2.037850</td>
</tr>
<tr class="even">
<td align="left">7</td>
<td align="right">2.173956</td>
</tr>
<tr class="odd">
<td align="left">8</td>
<td align="right">2.860241</td>
</tr>
<tr class="even">
<td align="left">9</td>
<td align="right">3.969358</td>
</tr>
<tr class="odd">
<td align="left">10</td>
<td align="right">2.799431</td>
</tr>
<tr class="even">
<td align="left">11</td>
<td align="right">3.321259</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb555"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb555-1"><a href="statistical-models.html#cb555-1" tabindex="-1"></a>predy <span class="sc">%*%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span></code></pre></div>
<table>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">16.81030</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">16.77805</td>
</tr>
<tr class="odd">
<td align="left">4</td>
<td align="right">16.90375</td>
</tr>
<tr class="even">
<td align="left">5</td>
<td align="right">16.88296</td>
</tr>
<tr class="odd">
<td align="left">6</td>
<td align="right">16.83120</td>
</tr>
<tr class="even">
<td align="left">7</td>
<td align="right">16.84822</td>
</tr>
<tr class="odd">
<td align="left">8</td>
<td align="right">16.95044</td>
</tr>
<tr class="even">
<td align="left">9</td>
<td align="right">17.17243</td>
</tr>
<tr class="odd">
<td align="left">10</td>
<td align="right">16.94029</td>
</tr>
<tr class="even">
<td align="left">11</td>
<td align="right">17.03430</td>
</tr>
</tbody>
</table>
<hr />
</div>
</div>
<div id="compare-predictions-vs-actual-values" class="section level3 hasAnchor" number="6.3.25">
<h3><span class="header-section-number">6.3.25</span> Compare predictions vs actual values<a href="statistical-models.html#compare-predictions-vs-actual-values" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A scatterplot of observed vs predicted values provides a quick sense of calibration. If the model is well-calibrated, points tend to align along the diagonal; the fitted line provides a rough check.</p>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb556-1"><a href="statistical-models.html#cb556-1" tabindex="-1"></a><span class="fu">plot</span>(data2<span class="sc">$</span>medv,<span class="fu">predict</span>(model_trasf_term) )</span>
<span id="cb556-2"><a href="statistical-models.html#cb556-2" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">predict</span>(model_trasf_term)<span class="sc">~</span>data2<span class="sc">$</span>medv)</span>
<span id="cb556-3"><a href="statistical-models.html#cb556-3" tabindex="-1"></a><span class="fu">abline</span>(fit)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-281-1.png" alt="" width="672" /></p>
<hr />
</div>
<div id="manual-computation-haty-and-confidence-interval" class="section level3 hasAnchor" number="6.3.26">
<h3><span class="header-section-number">6.3.26</span> Manual computation: <span class="math inline">\(\hat{y}\)</span> and confidence interval<a href="statistical-models.html#manual-computation-haty-and-confidence-interval" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This section demonstrates how the regression prediction and CI formulas relate to matrix algebra. It is useful for understanding what <code>predict()</code> does internally.</p>
<p>We fit a smaller model and compute <span class="math inline">\(\hat{y}\)</span> using <span class="math inline">\(X\hat{\beta}\)</span>.</p>
<div class="sourceCode" id="cb557"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb557-1"><a href="statistical-models.html#cb557-1" tabindex="-1"></a>data_ci <span class="ot">&lt;-</span>  dplyr<span class="sc">::</span><span class="fu">select</span>(data2, zn ,chas ,tax , medv)</span>
<span id="cb557-2"><a href="statistical-models.html#cb557-2" tabindex="-1"></a>model_ci <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> medv <span class="sc">~</span> zn <span class="sc">+</span> chas <span class="sc">+</span>tax , <span class="at">data =</span> data_ci)</span>
<span id="cb557-3"><a href="statistical-models.html#cb557-3" tabindex="-1"></a><span class="fu">summary</span>(model_ci)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = medv ~ zn + chas + tax, data = data_ci)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -13.182  -4.715  -1.305   2.345  34.377 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  22.3073     0.3699  60.307  &lt; 2e-16 ***
## zn            2.1080     0.3919   5.379 1.27e-07 ***
## chas          1.4174     0.3599   3.939 9.66e-05 ***
## tax          -3.4463     0.3985  -8.649  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 7.46 on 403 degrees of freedom
## Multiple R-squared:  0.2907, Adjusted R-squared:  0.2855 
## F-statistic: 55.07 on 3 and 403 DF,  p-value: &lt; 2.2e-16</code></pre>
<p><code>compute y hat and compare with y predict and actual y</code></p>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb559-1"><a href="statistical-models.html#cb559-1" tabindex="-1"></a>XCI <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">intercept=</span><span class="dv">1</span>, data_ci[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span>
<span id="cb559-2"><a href="statistical-models.html#cb559-2" tabindex="-1"></a>comp_y <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(XCI)<span class="sc">%*%</span><span class="fu">as.numeric</span>(model_ci<span class="sc">$</span>coefficients)</span>
<span id="cb559-3"><a href="statistical-models.html#cb559-3" tabindex="-1"></a></span>
<span id="cb559-4"><a href="statistical-models.html#cb559-4" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">cbind</span>(comp_y,<span class="fu">predict</span>(model_ci, XCI), data_ci[,<span class="dv">4</span>]))</span></code></pre></div>
<table>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">24.81617</td>
<td align="right">24.81617</td>
<td align="right">24.0</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">24.29345</td>
<td align="right">24.29345</td>
<td align="right">21.6</td>
</tr>
<tr class="odd">
<td align="left">4</td>
<td align="right">24.70242</td>
<td align="right">24.70242</td>
<td align="right">33.4</td>
</tr>
<tr class="even">
<td align="left">5</td>
<td align="right">24.70242</td>
<td align="right">24.70242</td>
<td align="right">36.2</td>
</tr>
<tr class="odd">
<td align="left">6</td>
<td align="right">24.70242</td>
<td align="right">24.70242</td>
<td align="right">28.7</td>
</tr>
<tr class="even">
<td align="left">7</td>
<td align="right">24.01233</td>
<td align="right">24.01233</td>
<td align="right">22.9</td>
</tr>
</tbody>
</table>
<p><code>compute ci</code></p>
<div class="sourceCode" id="cb560"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb560-1"><a href="statistical-models.html#cb560-1" tabindex="-1"></a><span class="fu">library</span>(matlib)</span></code></pre></div>
<pre><code>## Warning: package &#39;matlib&#39; was built under R version 4.4.3</code></pre>
<pre><code>## 
## Attaching package: &#39;matlib&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:psych&#39;:
## 
##     tr</code></pre>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb564-1"><a href="statistical-models.html#cb564-1" tabindex="-1"></a>var.yhat <span class="ot">&lt;-</span> <span class="fu">sigma</span>(model_ci)<span class="sc">**</span><span class="dv">2</span><span class="sc">*</span> <span class="fu">as.matrix</span>(XCI[<span class="dv">1</span> ,]) <span class="sc">%*%</span> <span class="fu">inv</span>(<span class="fu">t</span>(<span class="fu">as.matrix</span>(XCI)) <span class="sc">%*%</span> <span class="fu">as.matrix</span> (XCI))<span class="sc">%*%</span><span class="fu">t</span>(<span class="fu">as.matrix</span>(XCI[<span class="dv">1</span> ,]))</span>
<span id="cb564-2"><a href="statistical-models.html#cb564-2" tabindex="-1"></a><span class="co"># var.yhat</span></span>
<span id="cb564-3"><a href="statistical-models.html#cb564-3" tabindex="-1"></a><span class="fu">cbind</span>(</span>
<span id="cb564-4"><a href="statistical-models.html#cb564-4" tabindex="-1"></a>(<span class="fu">predict</span>(model_ci, XCI[<span class="dv">1</span> ,])<span class="sc">-</span><span class="fl">1.96</span> <span class="sc">*</span> <span class="fu">sqrt</span>(var.yhat)),</span>
<span id="cb564-5"><a href="statistical-models.html#cb564-5" tabindex="-1"></a>(<span class="fu">predict</span>(model_ci, XCI[<span class="dv">1</span> ,]) ),</span>
<span id="cb564-6"><a href="statistical-models.html#cb564-6" tabindex="-1"></a>(<span class="fu">predict</span>(model_ci, XCI[<span class="dv">1</span> ,])<span class="sc">+</span><span class="fl">1.96</span> <span class="sc">*</span> <span class="fu">sqrt</span>(var.yhat))</span>
<span id="cb564-7"><a href="statistical-models.html#cb564-7" tabindex="-1"></a>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">1</th>
<th align="right"></th>
<th align="right">1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">23.91998</td>
<td align="right">24.81617</td>
<td align="right">25.71237</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb565"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb565-1"><a href="statistical-models.html#cb565-1" tabindex="-1"></a><span class="fu">predict</span>(model_ci, XCI[<span class="dv">1</span> ,], <span class="at">interval=</span><span class="st">&quot;confidence&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">fit</th>
<th align="right">lwr</th>
<th align="right">upr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">24.81617</td>
<td align="right">23.9173</td>
<td align="right">25.71505</td>
</tr>
</tbody>
</table>
<p><span class="math display">\[
E(\hat{Y}_0)=\sigma^2\mathbf{X_0\left( X&#39;X\right)^{-1}X_0&#39;}
\]</span></p>
<p>This matrix form highlights the concept of <strong>leverage</strong>: when <span class="math inline">\(X_0\)</span> is far from the center of the predictor space, uncertainty increases.</p>
<hr />
</div>
<div id="external-data-validation" class="section level3 hasAnchor" number="6.3.27">
<h3><span class="header-section-number">6.3.27</span> External data validation<a href="statistical-models.html#external-data-validation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This is a simple demonstration of external-style validation: evaluate performance on the held-out test set created earlier.</p>
<p>We compute common predictive metrics:
- <span class="math inline">\(R^2\)</span> (proportion of variance explained),
- RMSE (penalizes larger errors),
- MAE (more robust to outliers).</p>
<div class="sourceCode" id="cb566"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb566-1"><a href="statistical-models.html#cb566-1" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb566-2"><a href="statistical-models.html#cb566-2" tabindex="-1"></a>testdata2_pred <span class="ot">&lt;-</span>   dplyr<span class="sc">::</span><span class="fu">select</span>(testdata2, zn , chas , nox , rm , dis , rad , tax , </span>
<span id="cb566-3"><a href="statistical-models.html#cb566-3" tabindex="-1"></a>    ptratio , lstat)</span>
<span id="cb566-4"><a href="statistical-models.html#cb566-4" tabindex="-1"></a></span>
<span id="cb566-5"><a href="statistical-models.html#cb566-5" tabindex="-1"></a>R_sq <span class="ot">&lt;-</span> <span class="fu">R2</span>(testdata2<span class="sc">$</span>medv,<span class="fu">predict</span>(model_trasf_term,testdata2_pred))</span>
<span id="cb566-6"><a href="statistical-models.html#cb566-6" tabindex="-1"></a>RMSE <span class="ot">&lt;-</span> <span class="fu">RMSE</span>(testdata2<span class="sc">$</span>medv,<span class="fu">predict</span>(model_trasf_term,testdata2_pred))</span>
<span id="cb566-7"><a href="statistical-models.html#cb566-7" tabindex="-1"></a>MAE <span class="ot">&lt;-</span> <span class="fu">MAE</span>(testdata2<span class="sc">$</span>medv,<span class="fu">predict</span>(model_trasf_term,testdata2_pred))</span>
<span id="cb566-8"><a href="statistical-models.html#cb566-8" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(R_sq, RMSE, MAE))</span></code></pre></div>
<pre><code>## [1] 0.8465718 4.1960036 3.4352611</code></pre>
<p>In applied practice, the held-out evaluation is often the most trusted summary of model usefulness, especially when many model variants were tried.</p>
<hr />
</div>
</div>
<div id="variable-selection" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> Variable selection<a href="statistical-models.html#variable-selection" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Variable selection is a large topic. In practice, you should align the selection method with your goal:
- inference (interpretability, prespecified covariates, stability),
- prediction (regularization, cross-validation, performance focus).</p>
<p><a href="https://rpubs.com/Daniel_He/1044963">see here</a></p>
<hr />
<div id="chapter-takeaways" class="section level3 hasAnchor" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> Chapter takeaways<a href="statistical-models.html#chapter-takeaways" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This multiple regression practice section demonstrates a complete applied modeling workflow:
- <strong>data understanding</strong> (describe/summary/Table 1),
- <strong>quality checks</strong> (missingness),
- <strong>EDA</strong> (histograms, correlations, scatterplots),
- <strong>transformations</strong> (stabilize modeling assumptions),
- <strong>model building</strong> (baseline, stepwise, polynomial, interaction, robust),
- <strong>diagnostics</strong> (assumption checks),
- <strong>comparison</strong> (AIC, CV),
- <strong>interpretation</strong> (coefficients, CI, relative importance),
- <strong>prediction and validation</strong> (intervals, test-set metrics).</p>
<p>The same structure generalizes naturally to clinical and biomedical regression problems—only the outcome type and modeling family may change.</p>

</div>
</div>
<div id="linear-mixed-model-theory" class="section level2 hasAnchor" number="6.5">
<h2><span class="header-section-number">6.5</span> Linear mixed model theory<a href="statistical-models.html#linear-mixed-model-theory" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Linear mixed models (LMMs) extend ordinary linear regression to handle <strong>correlated data</strong>. In practice, correlation arises when observations are clustered or repeated, for example:</p>
<ul>
<li>patients nested within hospitals,</li>
<li>students nested within schools,</li>
<li>repeated lab measurements within a subject,</li>
<li>longitudinal follow-up over time.</li>
</ul>
<p>If we ignore this correlation and use ordinary regression, standard errors are often too small, confidence intervals become too narrow, and p-values may look more “significant” than they should. LMMs address this by modeling two sources of variation:</p>
<ol style="list-style-type: decimal">
<li><strong>fixed effects</strong>: population-average effects you want to estimate (e.g., treatment, age, sex)<br />
</li>
<li><strong>random effects</strong>: cluster- or subject-specific deviations that induce correlation (e.g., hospital-specific baseline stress)</li>
</ol>
<hr />
<div id="matrix-format-1" class="section level3 hasAnchor" number="6.5.1">
<h3><span class="header-section-number">6.5.1</span> Matrix format<a href="statistical-models.html#matrix-format-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The mixed model is commonly written as:</p>
<p><span class="math display">\[
\mathbf{y} = \boldsymbol{X\beta} + \boldsymbol{Zu} + \boldsymbol{\varepsilon}
\]</span></p>
<p>Interpretation of each component:</p>
<ul>
<li><span class="math inline">\(\mathbf{y}\)</span>: <span class="math inline">\(N \times 1\)</span> outcome vector<br />
</li>
<li><span class="math inline">\(\mathbf{X}\)</span>: <span class="math inline">\(N \times r\)</span> design matrix for <strong>fixed effects</strong><br />
</li>
<li><span class="math inline">\(\boldsymbol{\beta}\)</span>: <span class="math inline">\(r \times 1\)</span> coefficient vector for fixed effects<br />
</li>
<li><span class="math inline">\(\mathbf{Z}\)</span>: <span class="math inline">\(N \times m\)</span> design matrix for <strong>random effects</strong><br />
</li>
<li><span class="math inline">\(\boldsymbol{u}\)</span>: <span class="math inline">\(m \times 1\)</span> random effect vector<br />
</li>
<li><span class="math inline">\(\boldsymbol{\varepsilon}\)</span>: <span class="math inline">\(N \times 1\)</span> residual vector</li>
</ul>
<p>So, <span class="math inline">\(\mathbf{X\beta}\)</span> describes the <strong>systematic (population-average)</strong> part of the mean, while <span class="math inline">\(\mathbf{Zu}\)</span> describes <strong>cluster-specific departures</strong> from that mean.</p>
<p>The dimension bookkeeping is worth emphasizing because it prevents many implementation errors:</p>
<p><span class="math display">\[
\overbrace{\mathbf{y}}^{N \times 1}=
\overbrace{\underbrace{\mathbf{X}}_{N \times r}\underbrace{\boldsymbol{\beta}}_{r \times 1}}^{N \times 1}
+
\overbrace{\underbrace{\mathbf{Z}}_{N \times m}\underbrace{\boldsymbol{u}}_{m \times 1}}^{N \times 1}
+
\overbrace{\boldsymbol{\varepsilon}}^{N \times 1}.
\]</span></p>
<hr />
</div>
<div id="why-random-effects-create-correlation" class="section level3 hasAnchor" number="6.5.2">
<h3><span class="header-section-number">6.5.2</span> Why random effects create correlation<a href="statistical-models.html#why-random-effects-create-correlation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A key conceptual point: observations within the same cluster share the same random effect(s).<br />
That shared term makes them correlated.</p>
<p>For example, with a random intercept by hospital,
<span class="math display">\[
Y_{ij} = \beta_0 + u_{0j} + \beta_1 X_{ij} + \varepsilon_{ij},
\]</span>
two nurses <span class="math inline">\(i\)</span> and <span class="math inline">\(i&#39;\)</span> in the same hospital <span class="math inline">\(j\)</span> both include <span class="math inline">\(u_{0j}\)</span>, so they are correlated even if their residual errors <span class="math inline">\(\varepsilon\)</span> are independent.</p>
<hr />
</div>
<div id="example-reducing-the-work-stress-of-nurses" class="section level3 hasAnchor" number="6.5.3">
<h3><span class="header-section-number">6.5.3</span> Example: reducing the work stress of nurses<a href="statistical-models.html#example-reducing-the-work-stress-of-nurses" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Suppose you measure work stress from <span class="math inline">\(N=1000\)</span> nurses across 25 hospitals. Let:</p>
<ul>
<li>outcome <span class="math inline">\(y\)</span>: stress score<br />
</li>
<li>fixed effects <span class="math inline">\(X\)</span>: age, gender, experience, ward type, intervention<br />
</li>
<li>random effect: <strong>hospital-level random intercept only</strong></li>
</ul>
<p>The model is:
<span class="math display">\[
\mathbf{y} = \mathbf{X}\boldsymbol{\beta} + \mathbf{Z}\boldsymbol{u} + \boldsymbol{\varepsilon},
\]</span>
with dimensions:
<span class="math display">\[
\overbrace{\mathbf{y}}^{1000 \times 1} =
\overbrace{\underbrace{\mathbf{X}}_{1000 \times r}\underbrace{\boldsymbol{\beta}}_{r \times 1}}^{1000 \times 1} +
\overbrace{\underbrace{\mathbf{Z}}_{1000 \times 25}\underbrace{\boldsymbol{u}}_{25 \times 1}}^{1000 \times 1} +
\overbrace{\boldsymbol{\varepsilon}}^{1000 \times 1}.
\]</span></p>
<p>A practical interpretation of the random intercept:
- each hospital has its own baseline stress level,
- fixed effects estimate population-average effects after accounting for hospital differences.</p>
<hr />
</div>
<div id="the-dependent-variable-mathbfy" class="section level3 hasAnchor" number="6.5.4">
<h3><span class="header-section-number">6.5.4</span> The dependent variable <span class="math inline">\(\mathbf{y}\)</span><a href="statistical-models.html#the-dependent-variable-mathbfy" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Your vector representation emphasizes that outcomes are stacked:</p>
<p><span class="math display">\[
\mathbf{y} =
\left[
\begin{array}{c}
y_1\\
y_2\\
\vdots\\
y_{1000}
\end{array}
\right].
\]</span></p>
<p>In practice, the ordering can be any consistent ordering (by hospital then nurse, or by nurse id then time), as long as <span class="math inline">\(\mathbf{X}\)</span> and <span class="math inline">\(\mathbf{Z}\)</span> align row-by-row.</p>
<hr />
</div>
<div id="fixed-effects-design-matrix-mathbfx" class="section level3 hasAnchor" number="6.5.5">
<h3><span class="header-section-number">6.5.5</span> Fixed effects design matrix <span class="math inline">\(\mathbf{X}\)</span><a href="statistical-models.html#fixed-effects-design-matrix-mathbfx" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><span class="math inline">\(\mathbf{X}\)</span> contains covariates used to estimate the population-average mean function.<br />
An intercept column is usually included.</p>
<p>Your example matrix is exactly what <span class="math inline">\(\mathbf{X}\)</span> is meant to represent: a structured layout of predictors aligned with each observation.</p>
<p>Two practical reminders:</p>
<ul>
<li>Categorical variables (gender, ward type, intervention) are represented through indicator columns (dummy coding) once you fit the model in software.</li>
<li>Centering/scaling continuous variables (age, experience) is often helpful, especially when random slopes or interactions are present.</li>
</ul>
<hr />
</div>
<div id="fixed-effect-coefficients-boldsymbolhatbeta" class="section level3 hasAnchor" number="6.5.6">
<h3><span class="header-section-number">6.5.6</span> Fixed effect coefficients <span class="math inline">\(\boldsymbol{\hat{\beta}}\)</span><a href="statistical-models.html#fixed-effect-coefficients-boldsymbolhatbeta" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><span class="math inline">\(\boldsymbol{\beta}\)</span> answers questions like:</p>
<ul>
<li>“What is the average difference in stress between intervention and control, after adjusting for covariates and hospital clustering?”</li>
<li>“How does stress change with age, on average, after controlling for hospital differences?”</li>
</ul>
<p>In LMMs, fixed effect interpretation is typically <strong>conditional on the random effects structure being correct</strong>, but the coefficients represent population-average contrasts in the linear predictor.</p>
<hr />
<div id="how-hatbeta-is-estimated-ml-and-reml" class="section level4 hasAnchor" number="6.5.6.1">
<h4><span class="header-section-number">6.5.6.1</span> How <span class="math inline">\(\hat{\beta}\)</span> is estimated (ML and REML)<a href="statistical-models.html#how-hatbeta-is-estimated-ml-and-reml" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A clean way to explain estimation is to separate:
- the <strong>mean model</strong>: <span class="math inline">\(\mathbf{X}\beta\)</span><br />
- the <strong>covariance model</strong>: <span class="math inline">\(\mathbf{V} = \mathbf{ZGZ&#39;} + \mathbf{R}\)</span></p>
<p>Once <span class="math inline">\(\mathbf{V}\)</span> is known, the generalized least squares estimator for <span class="math inline">\(\beta\)</span> is:</p>
<p><span class="math display">\[
\hat{\beta}(\gamma)=\left(\mathbf{X}&#39;\mathbf{V}(\gamma)^{-1}\mathbf{X}\right)^{-1}\mathbf{X}&#39;\mathbf{V}(\gamma)^{-1}\mathbf{y},
\]</span>
where <span class="math inline">\(\gamma\)</span> represents covariance parameters (e.g., <span class="math inline">\(\sigma^2\)</span>, <span class="math inline">\(\sigma_u^2\)</span>, correlations).</p>
<p>This highlights the logic:
- ordinary least squares weights by <span class="math inline">\((X&#39;X)^{-1}\)</span>,
- mixed models weight by <span class="math inline">\((X&#39;V^{-1}X)^{-1}\)</span> because observations are correlated.</p>
<p><strong>ML vs REML (intuition):</strong>
- ML estimates <span class="math inline">\(\beta\)</span> and variance parameters together by maximizing the likelihood of <span class="math inline">\(\mathbf{y}\)</span>.
- REML maximizes a likelihood of linear combinations of <span class="math inline">\(\mathbf{y}\)</span> that remove fixed effects, helping reduce small-sample bias in variance components.</p>
<p>Your “three-step” profile approach is the standard computational idea:
1) write <span class="math inline">\(\hat{\beta}\)</span> as a function of variance parameters,<br />
2) optimize the likelihood over variance parameters,<br />
3) plug back to obtain <span class="math inline">\(\hat{\beta}\)</span>.</p>
<hr />
</div>
</div>
<div id="variancecovariance-matrix-of-hatbeta" class="section level3 hasAnchor" number="6.5.7">
<h3><span class="header-section-number">6.5.7</span> Variance–covariance matrix of <span class="math inline">\(\hat{\beta}\)</span><a href="statistical-models.html#variancecovariance-matrix-of-hatbeta" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Once variance parameters are estimated, the approximate sampling distribution is:</p>
<p><span class="math display">\[
\hat{\beta} \sim \mathcal{N}\left(\beta,\; \mathrm{Var}(\hat{\beta})\right),
\quad
\mathrm{Var}(\hat{\beta})=\left(\mathbf{X}&#39;\mathbf{V}^{-1}\mathbf{X}\right)^{-1}.
\]</span></p>
<p>This matrix is the engine behind:
- standard errors,
- Wald tests,
- confidence intervals for fixed effects.</p>
<p>A practical note: in many software outputs, the reported degrees of freedom for fixed effects tests are not simply <span class="math inline">\(N-r\)</span>, because correlation and random effects reduce effective information. Approximations like Satterthwaite/Kenward–Roger are widely used.</p>
<hr />
</div>
<div id="random-effects-design-matrix-mathbfz" class="section level3 hasAnchor" number="6.5.8">
<h3><span class="header-section-number">6.5.8</span> Random effects design matrix <span class="math inline">\(\mathbf{Z}\)</span><a href="statistical-models.html#random-effects-design-matrix-mathbfz" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Your <span class="math inline">\(\mathbf{Z}\)</span> matrix is a clean illustration of a <strong>random intercept by hospital</strong>:</p>
<ul>
<li>each row has a “1” in the column corresponding to that nurse’s hospital,</li>
<li>zeros elsewhere.</li>
</ul>
<p>This structure ensures every observation in hospital <span class="math inline">\(j\)</span> shares the same <span class="math inline">\(u_j\)</span>.</p>
<p>If you add random slopes (say, random slope of time within hospital), <span class="math inline">\(\mathbf{Z}\)</span> gets additional columns corresponding to those slope terms, and <span class="math inline">\(\mathbf{G}\)</span> becomes a block structure rather than purely diagonal.</p>
<hr />
</div>
<div id="random-effects-boldsymbolu-and-blup-intuition" class="section level3 hasAnchor" number="6.5.9">
<h3><span class="header-section-number">6.5.9</span> Random effects <span class="math inline">\(\boldsymbol{u}\)</span> and BLUP intuition<a href="statistical-models.html#random-effects-boldsymbolu-and-blup-intuition" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We usually assume:
<span class="math display">\[
\boldsymbol{u}\sim \mathcal{N}(\mathbf{0},\mathbf{G}),\qquad
\boldsymbol{\varepsilon}\sim \mathcal{N}(\mathbf{0},\mathbf{R}),
\]</span>
and independence between <span class="math inline">\(\boldsymbol{u}\)</span> and <span class="math inline">\(\boldsymbol{\varepsilon}\)</span>.</p>
<p>The conditional mean of <span class="math inline">\(u\)</span> given the data leads to the familiar “BLUP” form:</p>
<p><span class="math display">\[
\hat{\mathbf{u}}=\mathbf{G}\mathbf{Z}&#39;\mathbf{V}^{-1}(\mathbf{y}-\mathbf{X}\hat{\beta}).
\]</span></p>
<p>Interpretation:
- if a hospital’s observed mean stress is above the overall mean, <span class="math inline">\(\hat{u}_j\)</span> tends to be positive,
- the estimate is <strong>shrunk</strong> toward zero depending on <span class="math inline">\(\sigma^2\)</span> and <span class="math inline">\(\sigma_u^2\)</span>,
- shrinkage is stronger when within-hospital noise is large or hospital sample size is small.</p>
<p>This “partial pooling” is a major advantage of mixed models.</p>
<hr />
</div>
<div id="covariance-structures-mathbfg-mathbfr-and-mathbfv" class="section level3 hasAnchor" number="6.5.10">
<h3><span class="header-section-number">6.5.10</span> Covariance structures: <span class="math inline">\(\mathbf{G}\)</span>, <span class="math inline">\(\mathbf{R}\)</span>, and <span class="math inline">\(\mathbf{V}\)</span><a href="statistical-models.html#covariance-structures-mathbfg-mathbfr-and-mathbfv" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The total covariance of <span class="math inline">\(\mathbf{y}\)</span> is:</p>
<p><span class="math display">\[
\mathbf{V}=\mathrm{Var}(\mathbf{y})=\mathbf{Z}\mathbf{G}\mathbf{Z}&#39;+\mathbf{R}.
\]</span></p>
<p><strong>Random intercept only:</strong>
- <span class="math inline">\(\mathbf{G}\)</span> is often <span class="math inline">\(\sigma_u^2\mathbf{I}\)</span> (simple diagonal).
- <span class="math inline">\(\mathbf{R}\)</span> is often <span class="math inline">\(\sigma^2\mathbf{I}\)</span> (i.i.d. residuals).</p>
<p>But LMMs become most powerful when you allow more realistic <span class="math inline">\(\mathbf{R}\)</span> structures for repeated measures:</p>
<ul>
<li>compound symmetry (equal correlations),</li>
<li>AR(1) (correlation decays with lag),</li>
<li>unstructured (max flexibility, parameter-heavy),</li>
<li>spatial correlation (depends on distance/time).</li>
</ul>
<p>A useful applied rule is: start simple, then add complexity only when diagnostics or design justify it.</p>
<hr />
</div>
<div id="estimating-variance-parameters" class="section level3 hasAnchor" number="6.5.11">
<h3><span class="header-section-number">6.5.11</span> Estimating variance parameters<a href="statistical-models.html#estimating-variance-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In practice, <span class="math inline">\(\sigma^2\)</span> and variance components like <span class="math inline">\(\sigma_u^2\)</span> are estimated by optimizing ML or REML criteria. Your derivation illustrates the idea that in special balanced cases, closed-form relationships connect variance parameters to mean squares; generally software uses numerical optimization.</p>
<p>A simple intuition:
- <span class="math inline">\(\sigma_u^2\)</span> measures <strong>between-cluster</strong> variability,
- <span class="math inline">\(\sigma^2\)</span> measures <strong>within-cluster</strong> variability.</p>
<p>Their ratio is tightly related to the intraclass correlation (ICC) in random-intercept models:
<span class="math display">\[
\mathrm{ICC}=\frac{\sigma_u^2}{\sigma_u^2+\sigma^2}.
\]</span>
(Useful for interpreting how strongly clustered the data are.)</p>
<hr />
</div>
<div id="model-statement-and-interpretation" class="section level3 hasAnchor" number="6.5.12">
<h3><span class="header-section-number">6.5.12</span> Model statement and interpretation<a href="statistical-models.html#model-statement-and-interpretation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Your final distribution statement is an important “model contract”:</p>
<p><span class="math display">\[
(\mathbf{y}\mid \beta,\; \boldsymbol{u}=u)\sim
\mathcal{N}(\mathbf{X}\beta+\mathbf{Z}u,\mathbf{R}).
\]</span></p>
<p>Meaning:
- conditional on random effects, observations follow a linear model with residual covariance <span class="math inline">\(\mathbf{R}\)</span>;
- marginally (integrating out <span class="math inline">\(u\)</span>), <span class="math inline">\(\mathbf{y}\sim \mathcal{N}(\mathbf{X}\beta,\mathbf{V})\)</span>.</p>
<p>This distinction matters because:
- <strong>fixed effects</strong> often describe marginal mean trends,
- <strong>random effects</strong> describe cluster-specific deviations and induce correlation.</p>
<hr />
</div>
<div id="testing-and-model-comparison" class="section level3 hasAnchor" number="6.5.13">
<h3><span class="header-section-number">6.5.13</span> Testing and model comparison<a href="statistical-models.html#testing-and-model-comparison" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There are two common testing layers:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Fixed effects tests</strong>: test linear hypotheses <span class="math inline">\(L&#39;\beta=c\)</span>.<br />
Wald-type tests are common, but degrees-of-freedom approximations (Satterthwaite/KR) often improve accuracy in finite samples.</p></li>
<li><p><strong>Random effects / variance components tests</strong>: compare nested models via likelihood ratio tests.<br />
Boundary issues (variance ≥ 0) lead to mixture <span class="math inline">\(\chi^2\)</span> null distributions in simple cases, which is why “half p-values” sometimes appear in random-effect tests.</p></li>
</ol>
<p>For non-nested models, AIC/BIC provide pragmatic selection criteria:
<span class="math display">\[
\mathrm{AIC}=-2\log L+2p,\qquad
\mathrm{BIC}=-2\log L+p\log(n).
\]</span></p>
<p>Applied note:
- AIC tends to favor predictive performance (less penalty),
- BIC tends to favor simpler models (more penalty as <span class="math inline">\(n\)</span> grows).</p>
<hr />
</div>
<div id="diagnostics-what-to-actually-check" class="section level3 hasAnchor" number="6.5.14">
<h3><span class="header-section-number">6.5.14</span> Diagnostics (what to actually check)<a href="statistical-models.html#diagnostics-what-to-actually-check" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Diagnostics in mixed models should be done with the data structure in mind:</p>
<ul>
<li><strong>Residual vs fitted</strong>: check nonlinearity and heteroscedasticity<br />
</li>
<li><strong>Normal Q-Q</strong>: for residuals and sometimes for random effects<br />
</li>
<li><strong>Influence</strong>: clusters can be influential (a single hospital)<br />
</li>
<li><strong>Random effects</strong>: do they look approximately normal and centered?<br />
</li>
<li><strong>Correlation structure</strong>: does the chosen <span class="math inline">\(\mathbf{R}\)</span> fit the repeated-measures pattern?</li>
</ul>
<p>Standardized or studentized residual ideas carry over, but “leverage” and “influence” are more complex because of correlation and random effects.</p>
<hr />
</div>
<div id="practical-takeaway-for-readers" class="section level3 hasAnchor" number="6.5.15">
<h3><span class="header-section-number">6.5.15</span> Practical takeaway for readers<a href="statistical-models.html#practical-takeaway-for-readers" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you remember only one framework, remember this:</p>
<ol style="list-style-type: decimal">
<li>Choose a <strong>mean model</strong>: <span class="math inline">\(\mathbf{X}\beta\)</span> (what predictors affect the outcome?)<br />
</li>
<li>Choose a <strong>correlation model</strong>: <span class="math inline">\(\mathbf{V}=\mathbf{ZGZ&#39;}+\mathbf{R}\)</span> (why are observations correlated?)<br />
</li>
<li>Fit with ML/REML, then evaluate:
<ul>
<li>fixed effect interpretability,</li>
<li>variance components (how much clustering/repeated correlation exists),</li>
<li>diagnostics,</li>
<li>and model comparison (AIC/BIC/LRT/CV).</li>
</ul></li>
</ol>
<p>That workflow is what makes LMMs a practical tool for longitudinal and multilevel data.</p>

</div>
</div>
<div id="linear-mixed-model-practice" class="section level2 hasAnchor" number="6.6">
<h2><span class="header-section-number">6.6</span> Linear mixed model practice<a href="statistical-models.html#linear-mixed-model-practice" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section walks through a practical progression from <strong>ordinary regression</strong> to <strong>mixed-effects modeling</strong>, using two datasets:</p>
<ol style="list-style-type: decimal">
<li><code>lmm.data</code>: a continuous outcome example (<code>extro</code>) with predictors (<code>open</code>, <code>agree</code>, <code>social</code>) and grouping variables (<code>school</code>, <code>class</code>).<br />
</li>
<li><code>nurse</code>: a multilevel stress dataset with hospital/ward clustering.</li>
</ol>
<p>The overall learning objectives are:</p>
<ul>
<li>Understand <em>why</em> we move from OLS/GLM to LMM (correlated observations within clusters).</li>
<li>Learn the difference between treating a grouping variable as a <strong>fixed effect</strong> vs a <strong>random effect</strong>.</li>
<li>Practice specifying nested random effects, random slopes, and comparing models.</li>
<li>Extract model components (fixed effects, random effects, fitted values, residuals).</li>
<li>Apply common mixed-model diagnostics and post-hoc summaries.</li>
<li>Use ICC to quantify clustering strength.</li>
</ul>
<p>Throughout, we keep the R code intact and focus on interpretation, reasoning, and “what to look for”.</p>
<hr />
<div id="loading-data-and-library" class="section level3 hasAnchor" number="6.6.1">
<h3><span class="header-section-number">6.6.1</span> Loading data and library<a href="statistical-models.html#loading-data-and-library" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We begin with <code>lme4</code> for fitting mixed models using <code>lmer()</code>, and <code>arm</code> for convenient display output. The dataset is read from a URL and inspected.</p>
<p>Conceptually, when you see <code>school</code> and <code>class</code> in the same dataset, you should immediately ask:</p>
<ul>
<li>Are observations within the same school/class likely correlated?</li>
<li>Is <code>class</code> nested within <code>school</code>, or can the same class label appear in multiple schools?</li>
</ul>
<p>Those questions guide whether you use <code>(1|school)</code>, <code>(1|class)</code>, or nested terms like <code>(1|school/class)</code>.</p>
<div class="sourceCode" id="cb568"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb568-1"><a href="statistical-models.html#cb568-1" tabindex="-1"></a><span class="co"># --- Linear Mixed Model (LMM) Data Simulation ---</span></span>
<span id="cb568-2"><a href="statistical-models.html#cb568-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb568-3"><a href="statistical-models.html#cb568-3" tabindex="-1"></a></span>
<span id="cb568-4"><a href="statistical-models.html#cb568-4" tabindex="-1"></a><span class="co"># 1. Define Data Structure</span></span>
<span id="cb568-5"><a href="statistical-models.html#cb568-5" tabindex="-1"></a>n_schools <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb568-6"><a href="statistical-models.html#cb568-6" tabindex="-1"></a>n_classes_per_school <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb568-7"><a href="statistical-models.html#cb568-7" tabindex="-1"></a>n_students_per_class <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb568-8"><a href="statistical-models.html#cb568-8" tabindex="-1"></a>total_n <span class="ot">&lt;-</span> n_schools <span class="sc">*</span> n_classes_per_school <span class="sc">*</span> n_students_per_class <span class="co"># Total: 1200 observations</span></span>
<span id="cb568-9"><a href="statistical-models.html#cb568-9" tabindex="-1"></a></span>
<span id="cb568-10"><a href="statistical-models.html#cb568-10" tabindex="-1"></a><span class="co"># 2. Generate Hierarchical IDs</span></span>
<span id="cb568-11"><a href="statistical-models.html#cb568-11" tabindex="-1"></a><span class="co"># School level (Level 3)</span></span>
<span id="cb568-12"><a href="statistical-models.html#cb568-12" tabindex="-1"></a>school_ids <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">paste0</span>(<span class="st">&quot;School_&quot;</span>, <span class="dv">1</span><span class="sc">:</span>n_schools), </span>
<span id="cb568-13"><a href="statistical-models.html#cb568-13" tabindex="-1"></a>                  <span class="at">each =</span> n_classes_per_school <span class="sc">*</span> n_students_per_class)</span>
<span id="cb568-14"><a href="statistical-models.html#cb568-14" tabindex="-1"></a></span>
<span id="cb568-15"><a href="statistical-models.html#cb568-15" tabindex="-1"></a><span class="co"># Class level (Level 2) - Nested within schools</span></span>
<span id="cb568-16"><a href="statistical-models.html#cb568-16" tabindex="-1"></a>class_ids  <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rep</span>(letters[<span class="dv">1</span><span class="sc">:</span>n_classes_per_school], </span>
<span id="cb568-17"><a href="statistical-models.html#cb568-17" tabindex="-1"></a>                      <span class="at">each =</span> n_students_per_class), <span class="at">times =</span> n_schools)</span>
<span id="cb568-18"><a href="statistical-models.html#cb568-18" tabindex="-1"></a></span>
<span id="cb568-19"><a href="statistical-models.html#cb568-19" tabindex="-1"></a><span class="co"># Individual student level (Level 1)</span></span>
<span id="cb568-20"><a href="statistical-models.html#cb568-20" tabindex="-1"></a>student_ids <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>total_n</span>
<span id="cb568-21"><a href="statistical-models.html#cb568-21" tabindex="-1"></a></span>
<span id="cb568-22"><a href="statistical-models.html#cb568-22" tabindex="-1"></a><span class="co"># 3. Generate Predictors (Fixed Effects)</span></span>
<span id="cb568-23"><a href="statistical-models.html#cb568-23" tabindex="-1"></a><span class="co"># Simulating psychological assessment scores using Normal Distribution</span></span>
<span id="cb568-24"><a href="statistical-models.html#cb568-24" tabindex="-1"></a>open   <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(total_n, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">10</span>) <span class="co"># Openness</span></span>
<span id="cb568-25"><a href="statistical-models.html#cb568-25" tabindex="-1"></a>agree  <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(total_n, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">10</span>) <span class="co"># Agreeableness</span></span>
<span id="cb568-26"><a href="statistical-models.html#cb568-26" tabindex="-1"></a>social <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(total_n, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">10</span>) <span class="co"># Social Engagement</span></span>
<span id="cb568-27"><a href="statistical-models.html#cb568-27" tabindex="-1"></a></span>
<span id="cb568-28"><a href="statistical-models.html#cb568-28" tabindex="-1"></a><span class="co"># 4. Generate Random Effects</span></span>
<span id="cb568-29"><a href="statistical-models.html#cb568-29" tabindex="-1"></a><span class="co"># Intercept deviations for schools and classes (Random Intercepts)</span></span>
<span id="cb568-30"><a href="statistical-models.html#cb568-30" tabindex="-1"></a>school_effects <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rnorm</span>(n_schools, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">5</span>), </span>
<span id="cb568-31"><a href="statistical-models.html#cb568-31" tabindex="-1"></a>                      <span class="at">each =</span> n_classes_per_school <span class="sc">*</span> n_students_per_class)</span>
<span id="cb568-32"><a href="statistical-models.html#cb568-32" tabindex="-1"></a></span>
<span id="cb568-33"><a href="statistical-models.html#cb568-33" tabindex="-1"></a>class_effects  <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rnorm</span>(n_schools <span class="sc">*</span> n_classes_per_school, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>), </span>
<span id="cb568-34"><a href="statistical-models.html#cb568-34" tabindex="-1"></a>                      <span class="at">each =</span> n_students_per_class)</span>
<span id="cb568-35"><a href="statistical-models.html#cb568-35" tabindex="-1"></a></span>
<span id="cb568-36"><a href="statistical-models.html#cb568-36" tabindex="-1"></a><span class="co"># 5. Generate Dependent Variable (Outcome: Extroversion)</span></span>
<span id="cb568-37"><a href="statistical-models.html#cb568-37" tabindex="-1"></a><span class="co"># Equation: extro = intercept + coefficients * predictors + random_effects + error</span></span>
<span id="cb568-38"><a href="statistical-models.html#cb568-38" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(total_n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">2</span>) <span class="co"># Residual error</span></span>
<span id="cb568-39"><a href="statistical-models.html#cb568-39" tabindex="-1"></a></span>
<span id="cb568-40"><a href="statistical-models.html#cb568-40" tabindex="-1"></a>extro <span class="ot">&lt;-</span> <span class="dv">30</span> <span class="sc">+</span> (<span class="fl">0.5</span> <span class="sc">*</span> open) <span class="sc">+</span> (<span class="fl">0.3</span> <span class="sc">*</span> agree) <span class="sc">+</span> (<span class="fl">0.2</span> <span class="sc">*</span> social) <span class="sc">+</span> </span>
<span id="cb568-41"><a href="statistical-models.html#cb568-41" tabindex="-1"></a>         school_effects <span class="sc">+</span> class_effects <span class="sc">+</span> error</span>
<span id="cb568-42"><a href="statistical-models.html#cb568-42" tabindex="-1"></a></span>
<span id="cb568-43"><a href="statistical-models.html#cb568-43" tabindex="-1"></a><span class="co"># 6. Combine into Data Frame</span></span>
<span id="cb568-44"><a href="statistical-models.html#cb568-44" tabindex="-1"></a>lmm_data_sim <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb568-45"><a href="statistical-models.html#cb568-45" tabindex="-1"></a>  <span class="at">id =</span> student_ids,</span>
<span id="cb568-46"><a href="statistical-models.html#cb568-46" tabindex="-1"></a>  <span class="at">extro =</span> extro,</span>
<span id="cb568-47"><a href="statistical-models.html#cb568-47" tabindex="-1"></a>  <span class="at">open =</span> open,</span>
<span id="cb568-48"><a href="statistical-models.html#cb568-48" tabindex="-1"></a>  <span class="at">agree =</span> agree,</span>
<span id="cb568-49"><a href="statistical-models.html#cb568-49" tabindex="-1"></a>  <span class="at">social =</span> social,</span>
<span id="cb568-50"><a href="statistical-models.html#cb568-50" tabindex="-1"></a>  <span class="at">class =</span> class_ids,</span>
<span id="cb568-51"><a href="statistical-models.html#cb568-51" tabindex="-1"></a>  <span class="at">school =</span> school_ids</span>
<span id="cb568-52"><a href="statistical-models.html#cb568-52" tabindex="-1"></a>)</span>
<span id="cb568-53"><a href="statistical-models.html#cb568-53" tabindex="-1"></a></span>
<span id="cb568-54"><a href="statistical-models.html#cb568-54" tabindex="-1"></a><span class="co"># Preview the first few rows</span></span>
<span id="cb568-55"><a href="statistical-models.html#cb568-55" tabindex="-1"></a><span class="fu">head</span>(lmm_data_sim)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">id</th>
<th align="right">extro</th>
<th align="right">open</th>
<th align="right">agree</th>
<th align="right">social</th>
<th align="left">class</th>
<th align="left">school</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">92.96908</td>
<td align="right">63.70958</td>
<td align="right">42.53484</td>
<td align="right">63.27505</td>
<td align="left">a</td>
<td align="left">School_1</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">81.63828</td>
<td align="right">44.35302</td>
<td align="right">50.36606</td>
<td align="right">43.99164</td>
<td align="left">a</td>
<td align="left">School_1</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">87.33240</td>
<td align="right">53.63128</td>
<td align="right">53.23310</td>
<td align="right">50.56507</td>
<td align="left">a</td>
<td align="left">School_1</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">84.91356</td>
<td align="right">56.32863</td>
<td align="right">53.79676</td>
<td align="right">44.68924</td>
<td align="left">a</td>
<td align="left">School_1</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">89.25167</td>
<td align="right">54.04268</td>
<td align="right">58.76557</td>
<td align="right">49.19101</td>
<td align="left">a</td>
<td align="left">School_1</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">90.21962</td>
<td align="right">48.93875</td>
<td align="right">59.33388</td>
<td align="right">51.60756</td>
<td align="left">a</td>
<td align="left">School_1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb569-1"><a href="statistical-models.html#cb569-1" tabindex="-1"></a><span class="fu">library</span>(lme4) <span class="co"># load library</span></span>
<span id="cb569-2"><a href="statistical-models.html#cb569-2" tabindex="-1"></a><span class="fu">library</span>(arm) <span class="co"># convenience functions for regression in R</span></span></code></pre></div>
<pre><code>## Warning: package &#39;arm&#39; was built under R version 4.4.3</code></pre>
<pre><code>## 
## arm (Version 1.14-4, built: 2024-4-1)</code></pre>
<pre><code>## Working directory is C:/Users/hed2/Downloads/others/mybook2/mybook2</code></pre>
<pre><code>## 
## Attaching package: &#39;arm&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:performance&#39;:
## 
##     display</code></pre>
<pre><code>## The following object is masked from &#39;package:boot&#39;:
## 
##     logit</code></pre>
<pre><code>## The following object is masked from &#39;package:car&#39;:
## 
##     logit</code></pre>
<pre><code>## The following object is masked from &#39;package:scales&#39;:
## 
##     rescale</code></pre>
<pre><code>## The following objects are masked from &#39;package:psych&#39;:
## 
##     logit, rescale, sim</code></pre>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb579-1"><a href="statistical-models.html#cb579-1" tabindex="-1"></a>lmm.data <span class="ot">&lt;-</span> lmm_data_sim</span>
<span id="cb579-2"><a href="statistical-models.html#cb579-2" tabindex="-1"></a>  <span class="co"># read.table(&quot;http://jaredknowles.com/s/lmm.data.txt&quot;, </span></span>
<span id="cb579-3"><a href="statistical-models.html#cb579-3" tabindex="-1"></a>  <span class="co">#                      header=TRUE, sep=&quot;,&quot;, na.strings=&quot;NA&quot;, dec=&quot;.&quot;, strip.white=TRUE) </span></span>
<span id="cb579-4"><a href="statistical-models.html#cb579-4" tabindex="-1"></a><span class="co">#summary(lmm.data)</span></span>
<span id="cb579-5"><a href="statistical-models.html#cb579-5" tabindex="-1"></a><span class="fu">head</span>(lmm.data)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">id</th>
<th align="right">extro</th>
<th align="right">open</th>
<th align="right">agree</th>
<th align="right">social</th>
<th align="left">class</th>
<th align="left">school</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">92.96908</td>
<td align="right">63.70958</td>
<td align="right">42.53484</td>
<td align="right">63.27505</td>
<td align="left">a</td>
<td align="left">School_1</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">81.63828</td>
<td align="right">44.35302</td>
<td align="right">50.36606</td>
<td align="right">43.99164</td>
<td align="left">a</td>
<td align="left">School_1</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">87.33240</td>
<td align="right">53.63128</td>
<td align="right">53.23310</td>
<td align="right">50.56507</td>
<td align="left">a</td>
<td align="left">School_1</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">84.91356</td>
<td align="right">56.32863</td>
<td align="right">53.79676</td>
<td align="right">44.68924</td>
<td align="left">a</td>
<td align="left">School_1</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">89.25167</td>
<td align="right">54.04268</td>
<td align="right">58.76557</td>
<td align="right">49.19101</td>
<td align="left">a</td>
<td align="left">School_1</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">90.21962</td>
<td align="right">48.93875</td>
<td align="right">59.33388</td>
<td align="right">51.60756</td>
<td align="left">a</td>
<td align="left">School_1</td>
</tr>
</tbody>
</table>
<hr />
</div>
<div id="general-linear-regression-ols" class="section level3 hasAnchor" number="6.6.2">
<h3><span class="header-section-number">6.6.2</span> General linear regression (OLS)<a href="statistical-models.html#general-linear-regression-ols" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This is the baseline model that assumes:</p>
<ul>
<li>all observations are independent,</li>
<li>a single residual variance applies to all observations,</li>
<li>no clustering correlation exists.</li>
</ul>
<p>Even if this model fits numerically, it can give misleading standard errors when data are clustered.</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb580-1"><a href="statistical-models.html#cb580-1" tabindex="-1"></a>OLSexamp <span class="ot">&lt;-</span> <span class="fu">lm</span>(extro <span class="sc">~</span> open <span class="sc">+</span> agree <span class="sc">+</span> social, <span class="at">data =</span> lmm.data)</span>
<span id="cb580-2"><a href="statistical-models.html#cb580-2" tabindex="-1"></a><span class="fu">display</span>(OLSexamp)</span></code></pre></div>
<pre><code>## lm(formula = extro ~ open + agree + social, data = lmm.data)
##             coef.est coef.se
## (Intercept) 30.80     1.07  
## open         0.51     0.01  
## agree        0.30     0.01  
## social       0.19     0.01  
## ---
## n = 1200, k = 4
## residual sd = 4.29, R-Squared = 0.68</code></pre>
<p><strong>What to look at here</strong>
- Which predictors appear associated with <code>extro</code>?
- Do the effect sizes seem plausible?
- This model provides a baseline for later comparison.</p>
<hr />
</div>
<div id="generalized-linear-regression-glm" class="section level3 hasAnchor" number="6.6.3">
<h3><span class="header-section-number">6.6.3</span> Generalized linear regression (GLM)<a href="statistical-models.html#generalized-linear-regression-glm" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here you fit <code>glm()</code> with the same formula. Since no <code>family=</code> argument is specified, it defaults to <strong>Gaussian</strong>, meaning it is essentially equivalent to <code>lm()</code> for continuous outcomes (up to minor implementation differences).</p>
<p>This step is mainly a bridge to show “we can also use the GLM framework,” but the independence assumption is still the same.</p>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb582-1"><a href="statistical-models.html#cb582-1" tabindex="-1"></a>MLexamp <span class="ot">&lt;-</span> <span class="fu">glm</span>(extro <span class="sc">~</span> open <span class="sc">+</span> agree <span class="sc">+</span> social, <span class="at">data=</span>lmm.data)</span>
<span id="cb582-2"><a href="statistical-models.html#cb582-2" tabindex="-1"></a><span class="fu">display</span>(MLexamp)</span></code></pre></div>
<pre><code>## glm(formula = extro ~ open + agree + social, data = lmm.data)
##             coef.est coef.se
## (Intercept) 30.80     1.07  
## open         0.51     0.01  
## agree        0.30     0.01  
## social       0.19     0.01  
## ---
##   n = 1200, k = 4
##   residual deviance = 22048.4, null deviance = 67937.3 (difference = 45888.9)
##   overdispersion parameter = 18.4
##   residual sd is sqrt(overdispersion) = 4.29</code></pre>
<hr />
</div>
<div id="varying-intercept-by-adding-a-stratum-variable-as-fixed-effect-glm" class="section level3 hasAnchor" number="6.6.4">
<h3><span class="header-section-number">6.6.4</span> Varying intercept by adding a stratum variable as fixed effect (GLM)<a href="statistical-models.html#varying-intercept-by-adding-a-stratum-variable-as-fixed-effect-glm" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now we include <code>class</code> as a fixed effect. This means:</p>
<ul>
<li>each class gets its own intercept shift,</li>
<li>we estimate a separate parameter for each class (minus a reference level).</li>
</ul>
<p>This approach can work well when the number of classes is small and you only care about those specific classes.<br />
But when there are many classes, fixed effects can become parameter-heavy and reduce generalizability.</p>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb584-1"><a href="statistical-models.html#cb584-1" tabindex="-1"></a>MLexamp<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">glm</span>(extro <span class="sc">~</span> open <span class="sc">+</span> agree <span class="sc">+</span> social <span class="sc">+</span> class, <span class="at">data=</span>lmm.data )</span>
<span id="cb584-2"><a href="statistical-models.html#cb584-2" tabindex="-1"></a><span class="fu">display</span>(MLexamp<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## glm(formula = extro ~ open + agree + social + class, data = lmm.data)
##             coef.est coef.se
## (Intercept) 31.03     1.06  
## open         0.51     0.01  
## agree        0.29     0.01  
## social       0.19     0.01  
## classb       0.51     0.34  
## classc       0.38     0.34  
## classd      -2.13     0.34  
## ---
##   n = 1200, k = 7
##   residual deviance = 20687.5, null deviance = 67937.3 (difference = 47249.8)
##   overdispersion parameter = 17.3
##   residual sd is sqrt(overdispersion) = 4.16</code></pre>
<hr />
</div>
<div id="comparisons-of-models-fixed-effect-approach" class="section level3 hasAnchor" number="6.6.5">
<h3><span class="header-section-number">6.6.5</span> Comparisons of models (fixed effect approach)<a href="statistical-models.html#comparisons-of-models-fixed-effect-approach" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Comparing AIC between the model without and with class fixed effects gives a first signal: does adding class improve fit enough to justify the extra parameters?</p>
<p>The <code>anova(..., test="F")</code> here compares nested Gaussian models.</p>
<div class="sourceCode" id="cb586"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb586-1"><a href="statistical-models.html#cb586-1" tabindex="-1"></a><span class="fu">AIC</span>(MLexamp)</span></code></pre></div>
<pre><code>## [1] 6908.556</code></pre>
<div class="sourceCode" id="cb588"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb588-1"><a href="statistical-models.html#cb588-1" tabindex="-1"></a><span class="fu">AIC</span>(MLexamp<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## [1] 6838.103</code></pre>
<div class="sourceCode" id="cb590"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb590-1"><a href="statistical-models.html#cb590-1" tabindex="-1"></a><span class="fu">anova</span>(MLexamp, MLexamp<span class="fl">.2</span>, <span class="at">test=</span><span class="st">&quot;F&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">Resid. Df</th>
<th align="right">Resid. Dev</th>
<th align="right">Df</th>
<th align="right">Deviance</th>
<th align="right">F</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1196</td>
<td align="right">22048.42</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">1193</td>
<td align="right">20687.51</td>
<td align="right">3</td>
<td align="right">1360.911</td>
<td align="right">26.16018</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Interpretation guide</strong>
- If adding <code>class</code> meaningfully improves fit, it suggests there is between-class variability (i.e., intercepts differ by class).
- But fixed effects do not explicitly model correlation; they just soak up mean differences.</p>
<hr />
</div>
<div id="adding-class-and-school-as-fixed-effects-glm" class="section level3 hasAnchor" number="6.6.6">
<h3><span class="header-section-number">6.6.6</span> Adding class and school as fixed effects (GLM)<a href="statistical-models.html#adding-class-and-school-as-fixed-effects-glm" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This expands the fixed-effect stratification by adding the interaction <code>school:class</code>, which is effectively a <strong>separate intercept for each school-by-class combination</strong>.</p>
<p>This can become even more parameter-heavy, but it mimics what a nested random intercept structure is trying to capture—except without shrinkage and without a variance-component interpretation.</p>
<div class="sourceCode" id="cb591"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb591-1"><a href="statistical-models.html#cb591-1" tabindex="-1"></a>MLexamp<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">glm</span>(extro <span class="sc">~</span> open <span class="sc">+</span> agree <span class="sc">+</span> social <span class="sc">+</span> school<span class="sc">:</span>class, <span class="at">data=</span>lmm.data )</span>
<span id="cb591-2"><a href="statistical-models.html#cb591-2" tabindex="-1"></a><span class="fu">display</span>(MLexamp<span class="fl">.4</span>)</span></code></pre></div>
<pre><code>## glm(formula = extro ~ open + agree + social + school:class, data = lmm.data)
##                       coef.est coef.se
## (Intercept)            34.93     0.58 
## open                    0.50     0.01 
## agree                   0.29     0.01 
## social                  0.20     0.01 
## schoolSchool_1:classa   0.40     0.40 
## schoolSchool_2:classa  -3.03     0.40 
## schoolSchool_3:classa  -3.59     0.40 
## schoolSchool_4:classa -12.58     0.40 
## schoolSchool_5:classa  -7.94     0.40 
## schoolSchool_6:classa   5.06     0.40 
## schoolSchool_1:classb  -1.89     0.40 
## schoolSchool_2:classb  -1.05     0.40 
## schoolSchool_3:classb  -6.62     0.40 
## schoolSchool_4:classb  -4.28     0.40 
## schoolSchool_5:classb  -2.07     0.40 
## schoolSchool_6:classb  -2.63     0.40 
## schoolSchool_1:classc  -4.95     0.40 
## schoolSchool_2:classc  -6.09     0.40 
## schoolSchool_3:classc  -0.06     0.40 
## schoolSchool_4:classc  -6.35     0.40 
## schoolSchool_5:classc  -3.27     0.40 
## schoolSchool_6:classc   1.40     0.40 
## schoolSchool_1:classd  -8.65     0.40 
## schoolSchool_2:classd  -6.48     0.40 
## schoolSchool_3:classd  -7.07     0.40 
## schoolSchool_4:classd  -8.39     0.40 
## schoolSchool_5:classd  -3.75     0.40 
## ---
##   n = 1200, k = 27
##   residual deviance = 4777.8, null deviance = 67937.3 (difference = 63159.6)
##   overdispersion parameter = 4.1
##   residual sd is sqrt(overdispersion) = 2.02</code></pre>
<div class="sourceCode" id="cb593"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb593-1"><a href="statistical-models.html#cb593-1" tabindex="-1"></a><span class="fu">AIC</span>(MLexamp)</span></code></pre></div>
<pre><code>## [1] 6908.556</code></pre>
<div class="sourceCode" id="cb595"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb595-1"><a href="statistical-models.html#cb595-1" tabindex="-1"></a><span class="fu">AIC</span>(MLexamp<span class="fl">.4</span>)</span></code></pre></div>
<pre><code>## [1] 5119.435</code></pre>
<div class="sourceCode" id="cb597"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb597-1"><a href="statistical-models.html#cb597-1" tabindex="-1"></a><span class="fu">anova</span>(MLexamp, MLexamp<span class="fl">.4</span>, <span class="at">test=</span><span class="st">&quot;F&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">Resid. Df</th>
<th align="right">Resid. Dev</th>
<th align="right">Df</th>
<th align="right">Deviance</th>
<th align="right">F</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1196</td>
<td align="right">22048.422</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">1173</td>
<td align="right">4777.768</td>
<td align="right">23</td>
<td align="right">17270.65</td>
<td align="right">184.3546</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Practical warning</strong>
- Fixed-effect stratification can overfit when many groups exist, especially with small group sizes.
- Mixed models typically handle this more gracefully via partial pooling.</p>
<hr />
</div>
<div id="considering-different-slopes-by-stratum-glm" class="section level3 hasAnchor" number="6.6.7">
<h3><span class="header-section-number">6.6.7</span> Considering different slopes by stratum (GLM)<a href="statistical-models.html#considering-different-slopes-by-stratum-glm" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here you fit separate regression models within each <code>(school, class)</code> stratum. This is a “fully stratified” approach:</p>
<ul>
<li>each group gets its own intercept and its own slopes for <code>open</code>, <code>agree</code>, <code>social</code>.</li>
</ul>
<p>This is useful for exploration: it shows whether slopes vary meaningfully across groups.<br />
But it creates many separate models and makes it hard to summarize results.</p>
<div class="sourceCode" id="cb598"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb598-1"><a href="statistical-models.html#cb598-1" tabindex="-1"></a><span class="fu">require</span>(plyr)</span>
<span id="cb598-2"><a href="statistical-models.html#cb598-2" tabindex="-1"></a></span>
<span id="cb598-3"><a href="statistical-models.html#cb598-3" tabindex="-1"></a>modellist <span class="ot">&lt;-</span> <span class="fu">dlply</span>(lmm.data, .(school, class), <span class="cf">function</span>(x) </span>
<span id="cb598-4"><a href="statistical-models.html#cb598-4" tabindex="-1"></a>                              <span class="fu">glm</span>(extro<span class="sc">~</span> open <span class="sc">+</span> agree <span class="sc">+</span> social, <span class="at">data=</span>x))</span>
<span id="cb598-5"><a href="statistical-models.html#cb598-5" tabindex="-1"></a>strat1 <span class="ot">&lt;-</span> <span class="fu">display</span>(modellist[[<span class="dv">1</span>]])</span></code></pre></div>
<pre><code>## glm(formula = extro ~ open + agree + social, data = x)
##             coef.est coef.se
## (Intercept) 35.42     2.73  
## open         0.48     0.02  
## agree        0.29     0.03  
## social       0.21     0.04  
## ---
##   n = 50, k = 4
##   residual deviance = 174.7, null deviance = 2113.8 (difference = 1939.2)
##   overdispersion parameter = 3.8
##   residual sd is sqrt(overdispersion) = 1.95</code></pre>
<div class="sourceCode" id="cb600"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb600-1"><a href="statistical-models.html#cb600-1" tabindex="-1"></a>strat2 <span class="ot">&lt;-</span> <span class="fu">display</span>(modellist[[<span class="dv">2</span>]])</span></code></pre></div>
<pre><code>## glm(formula = extro ~ open + agree + social, data = x)
##             coef.est coef.se
## (Intercept) 33.40     2.32  
## open         0.46     0.03  
## agree        0.32     0.03  
## social       0.20     0.03  
## ---
##   n = 50, k = 4
##   residual deviance = 198.8, null deviance = 2211.3 (difference = 2012.6)
##   overdispersion parameter = 4.3
##   residual sd is sqrt(overdispersion) = 2.08</code></pre>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb602-1"><a href="statistical-models.html#cb602-1" tabindex="-1"></a>strat24 <span class="ot">&lt;-</span> <span class="fu">display</span>(modellist[[<span class="dv">24</span>]])</span></code></pre></div>
<pre><code>## glm(formula = extro ~ open + agree + social, data = x)
##             coef.est coef.se
## (Intercept) 34.32     3.17  
## open         0.54     0.03  
## agree        0.30     0.04  
## social       0.15     0.03  
## ---
##   n = 50, k = 4
##   residual deviance = 220.2, null deviance = 1843.6 (difference = 1623.5)
##   overdispersion parameter = 4.8
##   residual sd is sqrt(overdispersion) = 2.19</code></pre>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb604-1"><a href="statistical-models.html#cb604-1" tabindex="-1"></a><span class="fu">AIC</span>(MLexamp)</span></code></pre></div>
<pre><code>## [1] 6908.556</code></pre>
<div class="sourceCode" id="cb606"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb606-1"><a href="statistical-models.html#cb606-1" tabindex="-1"></a><span class="co"># AIC(strat1)</span></span>
<span id="cb606-2"><a href="statistical-models.html#cb606-2" tabindex="-1"></a><span class="co"># AIC(strat2)</span></span>
<span id="cb606-3"><a href="statistical-models.html#cb606-3" tabindex="-1"></a><span class="co"># AIC(strat24)</span></span></code></pre></div>
<p><code>how to combine these models?</code></p>
<p>From a modeling standpoint, this question motivates mixed models:</p>
<ul>
<li>If intercepts vary across groups → random intercept.</li>
<li>If slopes vary across groups → random slope(s).</li>
<li>Mixed models combine evidence across groups through shrinkage, instead of fitting each group completely separately.</li>
</ul>
<p>So “combining these models” typically means <em>moving to a hierarchical model</em> where group-to-group differences are random effects rather than separate fixed models.</p>
<hr />
</div>
<div id="varying-intercept-with-lmm" class="section level3 hasAnchor" number="6.6.8">
<h3><span class="header-section-number">6.6.8</span> Varying intercept with LMM<a href="statistical-models.html#varying-intercept-with-lmm" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now we switch to a true mixed-effects model.<br />
Adding <code>(1|class)</code> says: “each class has its own intercept deviation.”</p>
<p>This is a direct way to model within-class correlation:
- observations within the same class share the same random intercept.</p>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb607-1"><a href="statistical-models.html#cb607-1" tabindex="-1"></a>MLexamp<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">lmer</span>(extro <span class="sc">~</span> open <span class="sc">+</span> agree <span class="sc">+</span> social <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>class), <span class="at">data=</span>lmm.data)</span>
<span id="cb607-2"><a href="statistical-models.html#cb607-2" tabindex="-1"></a><span class="fu">display</span>(MLexamp<span class="fl">.6</span>)</span></code></pre></div>
<pre><code>## lmer(formula = extro ~ open + agree + social + (1 | class), data = lmm.data)
##             coef.est coef.se
## (Intercept) 30.72     1.20  
## open         0.51     0.01  
## agree        0.29     0.01  
## social       0.19     0.01  
## 
## Error terms:
##  Groups   Name        Std.Dev.
##  class    (Intercept) 1.21    
##  Residual             4.16    
## ---
## number of obs: 1200, groups: class, 4
## AIC = 6870.4, DIC = 6817.7
## deviance = 6838.0</code></pre>
<p><strong>How to interpret</strong>
- Fixed effects (<code>open</code>, <code>agree</code>, <code>social</code>) are population-average.
- The random intercept variance tells you how much extroversion differs across classes after adjusting for covariates.</p>
<div id="compare-fixed-effect-class-vs-random-effect-class" class="section level4 hasAnchor" number="6.6.8.1">
<h4><span class="header-section-number">6.6.8.1</span> Compare fixed-effect <code>class</code> vs random-effect <code>class</code><a href="statistical-models.html#compare-fixed-effect-class-vs-random-effect-class" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>You compare AIC of:
- <code>MLexamp.2</code> (class fixed effects)
- <code>MLexamp.6</code> (class random intercept)</p>
<p>Lower AIC suggests better tradeoff of fit vs complexity.</p>
<div class="sourceCode" id="cb609"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb609-1"><a href="statistical-models.html#cb609-1" tabindex="-1"></a><span class="fu">AIC</span>(MLexamp<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## [1] 6838.103</code></pre>
<div class="sourceCode" id="cb611"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb611-1"><a href="statistical-models.html#cb611-1" tabindex="-1"></a><span class="fu">AIC</span>(MLexamp<span class="fl">.6</span>)</span></code></pre></div>
<pre><code>## [1] 6870.354</code></pre>
<hr />
</div>
</div>
<div id="add-class-and-school-as-random-effects" class="section level3 hasAnchor" number="6.6.9">
<h3><span class="header-section-number">6.6.9</span> Add class and school as random effects<a href="statistical-models.html#add-class-and-school-as-random-effects" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This specifies two crossed random intercepts:</p>
<ul>
<li><code>(1|school)</code> allows schools to differ in baseline <code>extro</code></li>
<li><code>(1|class)</code> allows classes to differ as well</li>
</ul>
<p>This is appropriate if <code>class</code> is not strictly nested in <code>school</code> <em>in coding</em>, or if there are shared class labels across schools.</p>
<div class="sourceCode" id="cb613"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb613-1"><a href="statistical-models.html#cb613-1" tabindex="-1"></a>MLexamp<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">lmer</span>(extro <span class="sc">~</span> open <span class="sc">+</span> agree <span class="sc">+</span> social <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>school) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>class), <span class="at">data=</span>lmm.data)</span>
<span id="cb613-2"><a href="statistical-models.html#cb613-2" tabindex="-1"></a><span class="fu">display</span>(MLexamp<span class="fl">.7</span>)</span></code></pre></div>
<pre><code>## lmer(formula = extro ~ open + agree + social + (1 | school) + 
##     (1 | class), data = lmm.data)
##             coef.est coef.se
## (Intercept) 31.24     1.54  
## open         0.50     0.01  
## agree        0.29     0.01  
## social       0.19     0.01  
## 
## Error terms:
##  Groups   Name        Std.Dev.
##  school   (Intercept) 2.82    
##  class    (Intercept) 1.21    
##  Residual             3.27    
## ---
## number of obs: 1200, groups: school, 6; class, 4
## AIC = 6320.3, DIC = 6266
## deviance = 6286.2</code></pre>
<hr />
</div>
<div id="nested-terms-schoolclass" class="section level3 hasAnchor" number="6.6.10">
<h3><span class="header-section-number">6.6.10</span> Nested terms: <code>school/class</code><a href="statistical-models.html#nested-terms-schoolclass" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This explicitly encodes nesting:</p>
<ul>
<li><code>(1|school/class)</code> expands to <code>(1|school) + (1|school:class)</code></li>
</ul>
<p>Meaning:
- school random intercept, plus
- class-within-school random intercept.</p>
<p>This is usually the right structure when each class belongs to only one school.</p>
<div class="sourceCode" id="cb615"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb615-1"><a href="statistical-models.html#cb615-1" tabindex="-1"></a>MLexamp<span class="fl">.8</span> <span class="ot">&lt;-</span> <span class="fu">lmer</span>(extro <span class="sc">~</span> open <span class="sc">+</span> agree <span class="sc">+</span> social <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>school<span class="sc">/</span>class), <span class="at">data=</span>lmm.data)</span>
<span id="cb615-2"><a href="statistical-models.html#cb615-2" tabindex="-1"></a><span class="fu">display</span>(MLexamp<span class="fl">.8</span>)</span></code></pre></div>
<pre><code>## lmer(formula = extro ~ open + agree + social + (1 | school/class), 
##     data = lmm.data)
##             coef.est coef.se
## (Intercept) 31.02     1.26  
## open         0.50     0.01  
## agree        0.29     0.01  
## social       0.20     0.01  
## 
## Error terms:
##  Groups       Name        Std.Dev.
##  class:school (Intercept) 3.20    
##  school       (Intercept) 2.33    
##  Residual                 2.02    
## ---
## number of obs: 1200, groups: class:school, 24; school, 6
## AIC = 5247, DIC = 5186.3
## deviance = 5209.6</code></pre>
<hr />
</div>
<div id="varying-slope-with-lmm" class="section level3 hasAnchor" number="6.6.11">
<h3><span class="header-section-number">6.6.11</span> Varying slope with LMM<a href="statistical-models.html#varying-slope-with-lmm" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Random slopes allow the effect of a predictor (here <code>open</code>) to vary across clusters.</p>
<p><code>(1+open|school/class)</code> means:
- random intercept and random slope of <code>open</code> at the <code>school:class</code> level,
- plus the corresponding variance and covariance between intercept and slope.</p>
<p>This answers a deeper scientific question:
- does “openness” relate to extroversion differently across different classes/schools?</p>
<div class="sourceCode" id="cb617"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb617-1"><a href="statistical-models.html#cb617-1" tabindex="-1"></a>MLexamp<span class="fl">.9</span> <span class="ot">&lt;-</span> <span class="fu">lmer</span>(extro <span class="sc">~</span> open <span class="sc">+</span> agree <span class="sc">+</span> social <span class="sc">+</span> (<span class="dv">1</span><span class="sc">+</span>open<span class="sc">|</span>school<span class="sc">/</span>class), <span class="at">data=</span>lmm.data)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see help(&#39;isSingular&#39;)</code></pre>
<div class="sourceCode" id="cb619"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb619-1"><a href="statistical-models.html#cb619-1" tabindex="-1"></a><span class="fu">display</span>(MLexamp<span class="fl">.9</span>)</span></code></pre></div>
<pre><code>## lmer(formula = extro ~ open + agree + social + (1 + open | school/class), 
##     data = lmm.data)
##             coef.est coef.se
## (Intercept) 30.96     1.02  
## open         0.50     0.01  
## agree        0.29     0.01  
## social       0.20     0.01  
## 
## Error terms:
##  Groups       Name        Std.Dev. Corr  
##  class:school (Intercept) 3.31           
##               open        0.01     -1.00 
##  school       (Intercept) 1.42           
##               open        0.02     1.00  
##  Residual                 2.01           
## ---
## number of obs: 1200, groups: class:school, 24; school, 6
## AIC = 5246, DIC = 5178.7
## deviance = 5201.3</code></pre>
<div id="compare-aic-across-candidate-structures" class="section level4 hasAnchor" number="6.6.11.1">
<h4><span class="header-section-number">6.6.11.1</span> Compare AIC across candidate structures<a href="statistical-models.html#compare-aic-across-candidate-structures" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This is a practical model selection exercise:</p>
<ul>
<li><code>MLexamp.4</code> uses <strong>fixed</strong> school:class intercepts</li>
<li><code>MLexamp.7</code> uses <strong>random</strong> school and class intercepts (separate)</li>
<li><code>MLexamp.8</code> uses <strong>nested random intercepts</strong></li>
<li><code>MLexamp.9</code> adds <strong>random slope</strong> of <code>open</code></li>
</ul>
<div class="sourceCode" id="cb621"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb621-1"><a href="statistical-models.html#cb621-1" tabindex="-1"></a><span class="fu">AIC</span>(MLexamp<span class="fl">.4</span>) <span class="co">#using the interaction of class and school as fixed effect</span></span></code></pre></div>
<pre><code>## [1] 5119.435</code></pre>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb623-1"><a href="statistical-models.html#cb623-1" tabindex="-1"></a><span class="fu">AIC</span>(MLexamp<span class="fl">.7</span>) <span class="co">#using class and school as random intercepts</span></span></code></pre></div>
<pre><code>## [1] 6320.338</code></pre>
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb625-1"><a href="statistical-models.html#cb625-1" tabindex="-1"></a><span class="fu">AIC</span>(MLexamp<span class="fl">.8</span>) <span class="co">#using nested term of class and school as random intercepts</span></span></code></pre></div>
<pre><code>## [1] 5246.96</code></pre>
<div class="sourceCode" id="cb627"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb627-1"><a href="statistical-models.html#cb627-1" tabindex="-1"></a><span class="fu">AIC</span>(MLexamp<span class="fl">.9</span>) <span class="co">#adding open as random slope based on MLexamp.8</span></span></code></pre></div>
<pre><code>## [1] 5245.997</code></pre>
<p><strong>Interpretation guide</strong>
- If random effects variances are near zero and AIC does not improve, random effects may not be needed.
- If AIC improves substantially when adding nesting or random slopes, clustering and/or slope heterogeneity is likely important.</p>
<hr />
</div>
</div>
<div id="summarize-model-8" class="section level3 hasAnchor" number="6.6.12">
<h3><span class="header-section-number">6.6.12</span> Summarize model 8<a href="statistical-models.html#summarize-model-8" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>summary()</code> provides:</p>
<ul>
<li>fixed effects estimates and standard errors,</li>
<li>random effects variance components (school and class-within-school),</li>
<li>residual variance,</li>
<li>fit criteria.</li>
</ul>
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb629-1"><a href="statistical-models.html#cb629-1" tabindex="-1"></a><span class="fu">summary</span>(MLexamp<span class="fl">.8</span>)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: extro ~ open + agree + social + (1 | school/class)
##    Data: lmm.data
## 
## REML criterion at convergence: 5233
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -3.12970 -0.68636 -0.00039  0.67466  2.95243 
## 
## Random effects:
##  Groups       Name        Variance Std.Dev.
##  class:school (Intercept) 10.247   3.201   
##  school       (Intercept)  5.413   2.327   
##  Residual                  4.073   2.018   
## Number of obs: 1200, groups:  class:school, 24; school, 6
## 
## Fixed effects:
##              Estimate Std. Error t value
## (Intercept) 31.016666   1.259145   24.63
## open         0.495711   0.005878   84.33
## agree        0.293323   0.005936   49.41
## social       0.195343   0.005725   34.12
## 
## Correlation of Fixed Effects:
##        (Intr) open   agree 
## open   -0.233              
## agree  -0.228 -0.022       
## social -0.229  0.026 -0.015</code></pre>
<p>Your note is exactly the applied takeaway:</p>
<p>If the variance components for random effects are extremely small relative to the total variance, then there is little clustering signal; LMM may not be necessary.<br />
But be careful: “small” depends on outcome scale and study design—often it is better to quantify via ICC (later section).</p>
<hr />
</div>
<div id="testing-random-effects-lrt-logic" class="section level3 hasAnchor" number="6.6.13">
<h3><span class="header-section-number">6.6.13</span> Testing random effects (LRT logic)<a href="statistical-models.html#testing-random-effects-lrt-logic" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Testing random effects is subtle because variance parameters lie on the boundary (they cannot be negative). This breaks standard chi-square asymptotics.</p>
<p>Your code demonstrates a conservative mixture-chi-square approach by hand.</p>
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb631-1"><a href="statistical-models.html#cb631-1" tabindex="-1"></a><span class="co"># W2 will have to build the test statistic by hand because we cannot rely on asymptotics</span></span>
<span id="cb631-2"><a href="statistical-models.html#cb631-2" tabindex="-1"></a>L_Model<span class="ot">=</span> <span class="fu">logLik</span>(MLexamp<span class="fl">.8</span>)[<span class="dv">1</span>]</span>
<span id="cb631-3"><a href="statistical-models.html#cb631-3" tabindex="-1"></a>L_Model1<span class="ot">=</span><span class="fu">logLik</span>(MLexamp<span class="fl">.9</span>)[<span class="dv">1</span>]</span>
<span id="cb631-4"><a href="statistical-models.html#cb631-4" tabindex="-1"></a>LRT_statistic<span class="ot">=</span><span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>(L_Model1<span class="sc">-</span>L_Model)</span>
<span id="cb631-5"><a href="statistical-models.html#cb631-5" tabindex="-1"></a><span class="co"># Model has 3 parameters associated with the Random Effects</span></span>
<span id="cb631-6"><a href="statistical-models.html#cb631-6" tabindex="-1"></a><span class="co"># Model1 has 1 parameter associated with the Random Effects</span></span>
<span id="cb631-7"><a href="statistical-models.html#cb631-7" tabindex="-1"></a><span class="co"># DF=2</span></span>
<span id="cb631-8"><a href="statistical-models.html#cb631-8" tabindex="-1"></a><span class="co"># We will look at a mixture of chi-squared distributions with 1 and 2 degrees of freedom</span></span>
<span id="cb631-9"><a href="statistical-models.html#cb631-9" tabindex="-1"></a><span class="fl">0.5</span><span class="sc">*</span><span class="fu">pchisq</span>(LRT_statistic,<span class="at">df=</span><span class="dv">2</span>,<span class="at">lower.tail =</span> F)<span class="sc">+</span><span class="fl">0.5</span><span class="sc">*</span><span class="fu">pchisq</span>(LRT_statistic,<span class="at">df=</span><span class="dv">1</span>,<span class="at">lower.tail =</span> F)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>Practical guidance:
- Use LRT for nested random effects cautiously.
- In real applied work, AIC/BIC + stability + diagnostics are often used together rather than relying only on a p-value.</p>
<hr />
</div>
<div id="visualizing-grouping-structure" class="section level3 hasAnchor" number="6.6.14">
<h3><span class="header-section-number">6.6.14</span> Visualizing grouping structure<a href="statistical-models.html#visualizing-grouping-structure" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A grouped line plot helps you “see” whether the relationship between <code>open</code> and <code>extro</code> differs by school:</p>
<ul>
<li>parallel-ish lines suggest varying intercepts,</li>
<li>different slopes suggest random slopes may be needed.</li>
</ul>
<div class="sourceCode" id="cb633"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb633-1"><a href="statistical-models.html#cb633-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb633-2"><a href="statistical-models.html#cb633-2" tabindex="-1"></a><span class="fu">ggplot</span>(lmm.data,<span class="fu">aes</span>(<span class="at">x=</span> open,<span class="at">y=</span>extro  ,<span class="at">group=</span>school,<span class="at">color=</span> school))<span class="sc">+</span><span class="fu">geom_line</span>() </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-308-1.png" alt="" width="672" /></p>
<hr />
</div>
<div id="residual-checks-by-grouping-variables" class="section level3 hasAnchor" number="6.6.15">
<h3><span class="header-section-number">6.6.15</span> Residual checks by grouping variables<a href="statistical-models.html#residual-checks-by-grouping-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>These plots help detect whether certain schools or classes have systematically different residual behavior (e.g., variance differences, outliers, patterning).</p>
<div class="sourceCode" id="cb634"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb634-1"><a href="statistical-models.html#cb634-1" tabindex="-1"></a><span class="fu">plot</span>(MLexamp<span class="fl">.8</span>, school<span class="sc">~</span><span class="fu">resid</span>(.))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-309-1.png" alt="" width="672" /></p>
<div class="sourceCode" id="cb635"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb635-1"><a href="statistical-models.html#cb635-1" tabindex="-1"></a><span class="fu">plot</span>(MLexamp<span class="fl">.8</span>, class<span class="sc">~</span><span class="fu">resid</span>(.))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-309-2.png" alt="" width="672" /></p>
<hr />
</div>
<div id="residuals-vs-explanatory-variables" class="section level3 hasAnchor" number="6.6.16">
<h3><span class="header-section-number">6.6.16</span> Residuals vs explanatory variables<a href="statistical-models.html#residuals-vs-explanatory-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A common check for:
- nonlinearity,
- heteroscedasticity (variance changes with predictor level),
- outliers.</p>
<div class="sourceCode" id="cb636"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb636-1"><a href="statistical-models.html#cb636-1" tabindex="-1"></a><span class="fu">plot</span>(MLexamp<span class="fl">.8</span>, <span class="fu">resid</span>(.)<span class="sc">~</span>open)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-310-1.png" alt="" width="672" /></p>
<div class="sourceCode" id="cb637"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb637-1"><a href="statistical-models.html#cb637-1" tabindex="-1"></a><span class="co"># plot(MLexamp.8,resid(.,type=&quot;p&quot;)~fitted(.) | BMIGRP_fm002)</span></span></code></pre></div>
<hr />
</div>
<div id="normality-checks" class="section level3 hasAnchor" number="6.6.17">
<h3><span class="header-section-number">6.6.17</span> Normality checks<a href="statistical-models.html#normality-checks" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="qq-plot-of-residuals" class="section level4 hasAnchor" number="6.6.17.1">
<h4><span class="header-section-number">6.6.17.1</span> QQ plot of residuals<a href="statistical-models.html#qq-plot-of-residuals" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Residual normality is not always critical for point estimation, but it matters more for small-sample inference and extreme prediction intervals.</p>
<div class="sourceCode" id="cb638"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb638-1"><a href="statistical-models.html#cb638-1" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">resid</span>(MLexamp<span class="fl">.8</span>)  )</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-311-1.png" alt="" width="672" /></p>
</div>
<div id="random-effect-coefficients-normality" class="section level4 hasAnchor" number="6.6.17.2">
<h4><span class="header-section-number">6.6.17.2</span> Random effect coefficients normality<a href="statistical-models.html#random-effect-coefficients-normality" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Random effects are assumed normal in standard LMMs.<br />
A QQ plot of estimated random intercepts (or slopes) checks whether this seems reasonable.</p>
<div class="sourceCode" id="cb639"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb639-1"><a href="statistical-models.html#cb639-1" tabindex="-1"></a>test<span class="ot">=</span> ((<span class="fu">ranef</span>(MLexamp<span class="fl">.8</span>)[<span class="dv">1</span>])[[<span class="st">&quot;class:school&quot;</span>]])</span>
<span id="cb639-2"><a href="statistical-models.html#cb639-2" tabindex="-1"></a><span class="fu">qqnorm</span> ((test<span class="sc">$</span><span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>) )</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-312-1.png" alt="" width="672" /></p>
<hr />
</div>
</div>
<div id="extracting-elements-parameters" class="section level3 hasAnchor" number="6.6.18">
<h3><span class="header-section-number">6.6.18</span> Extracting elements (parameters)<a href="statistical-models.html#extracting-elements-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>These are the standard extraction tools:</p>
<ul>
<li><code>fixef()</code>: fixed effects <span class="math inline">\(\hat{\beta}\)</span></li>
<li><code>ranef()</code>: random effects <span class="math inline">\(\hat{u}\)</span></li>
<li><code>coef()</code>: conditional coefficients (fixed + random), i.e., group-specific coefficients</li>
</ul>
<div class="sourceCode" id="cb640"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb640-1"><a href="statistical-models.html#cb640-1" tabindex="-1"></a><span class="fu">fixef</span>(MLexamp<span class="fl">.8</span>) </span></code></pre></div>
<pre><code>## (Intercept)        open       agree      social 
##  31.0166664   0.4957109   0.2933230   0.1953426</code></pre>
<div class="sourceCode" id="cb642"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb642-1"><a href="statistical-models.html#cb642-1" tabindex="-1"></a><span class="fu">ranef</span>(MLexamp<span class="fl">.8</span>) </span></code></pre></div>
<pre><code>## $`class:school`
##            (Intercept)
## a:School_1   4.1886142
## a:School_2   1.0466568
## a:School_3   0.6059617
## a:School_4  -5.9229747
## a:School_5  -3.7634378
## a:School_6   5.6331936
## b:School_1   1.9100724
## b:School_2   3.0071916
## b:School_3  -2.4043278
## b:School_4   2.3149458
## b:School_5   2.0630662
## b:School_6  -2.0026469
## c:School_1  -1.1286244
## c:School_2  -1.9962792
## c:School_3   4.1081884
## c:School_4   0.2610122
## c:School_5   0.8674500
## c:School_6   1.9964598
## d:School_1  -4.7916596
## d:School_2  -2.3777254
## d:School_3  -2.8508902
## d:School_4  -1.7647766
## d:School_5   0.3896333
## d:School_6   0.6108966
## 
## $school
##          (Intercept)
## School_1  0.09424432
## School_2 -0.16912820
## School_3 -0.28582870
## School_4 -2.70039511
## School_5 -0.23417485
## School_6  3.29528254
## 
## with conditional variances for &quot;class:school&quot; &quot;school&quot;</code></pre>
<div class="sourceCode" id="cb644"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb644-1"><a href="statistical-models.html#cb644-1" tabindex="-1"></a><span class="fu">coef</span>(MLexamp<span class="fl">.8</span>)</span></code></pre></div>
<pre><code>## $`class:school`
##            (Intercept)      open    agree    social
## a:School_1    35.20528 0.4957109 0.293323 0.1953426
## a:School_2    32.06332 0.4957109 0.293323 0.1953426
## a:School_3    31.62263 0.4957109 0.293323 0.1953426
## a:School_4    25.09369 0.4957109 0.293323 0.1953426
## a:School_5    27.25323 0.4957109 0.293323 0.1953426
## a:School_6    36.64986 0.4957109 0.293323 0.1953426
## b:School_1    32.92674 0.4957109 0.293323 0.1953426
## b:School_2    34.02386 0.4957109 0.293323 0.1953426
## b:School_3    28.61234 0.4957109 0.293323 0.1953426
## b:School_4    33.33161 0.4957109 0.293323 0.1953426
## b:School_5    33.07973 0.4957109 0.293323 0.1953426
## b:School_6    29.01402 0.4957109 0.293323 0.1953426
## c:School_1    29.88804 0.4957109 0.293323 0.1953426
## c:School_2    29.02039 0.4957109 0.293323 0.1953426
## c:School_3    35.12485 0.4957109 0.293323 0.1953426
## c:School_4    31.27768 0.4957109 0.293323 0.1953426
## c:School_5    31.88412 0.4957109 0.293323 0.1953426
## c:School_6    33.01313 0.4957109 0.293323 0.1953426
## d:School_1    26.22501 0.4957109 0.293323 0.1953426
## d:School_2    28.63894 0.4957109 0.293323 0.1953426
## d:School_3    28.16578 0.4957109 0.293323 0.1953426
## d:School_4    29.25189 0.4957109 0.293323 0.1953426
## d:School_5    31.40630 0.4957109 0.293323 0.1953426
## d:School_6    31.62756 0.4957109 0.293323 0.1953426
## 
## $school
##          (Intercept)      open    agree    social
## School_1    31.11091 0.4957109 0.293323 0.1953426
## School_2    30.84754 0.4957109 0.293323 0.1953426
## School_3    30.73084 0.4957109 0.293323 0.1953426
## School_4    28.31627 0.4957109 0.293323 0.1953426
## School_5    30.78249 0.4957109 0.293323 0.1953426
## School_6    34.31195 0.4957109 0.293323 0.1953426
## 
## attr(,&quot;class&quot;)
## [1] &quot;coef.mer&quot;</code></pre>
<hr />
</div>
<div id="fitted-values-and-residuals" class="section level3 hasAnchor" number="6.6.19">
<h3><span class="header-section-number">6.6.19</span> Fitted values and residuals<a href="statistical-models.html#fitted-values-and-residuals" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Fitted values (<code>fitted</code>) represent the model’s conditional mean, which includes group-level random effects.<br />
Residuals represent the within-group deviations not explained by the model.</p>
<div class="sourceCode" id="cb646"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb646-1"><a href="statistical-models.html#cb646-1" tabindex="-1"></a>yhat <span class="ot">&lt;-</span> <span class="fu">fitted</span>(MLexamp<span class="fl">.8</span>)</span>
<span id="cb646-2"><a href="statistical-models.html#cb646-2" tabindex="-1"></a><span class="fu">head</span>(yhat)</span></code></pre></div>
<pre><code>##        1        2        3        4        5        6 
## 91.71782 80.65276 87.37714 87.73178 88.93546 87.04414</code></pre>
<div class="sourceCode" id="cb648"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb648-1"><a href="statistical-models.html#cb648-1" tabindex="-1"></a><span class="fu">summary</span>(yhat) </span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">Min.</th>
<th align="right">1st Qu.</th>
<th align="right">Median</th>
<th align="right">Mean</th>
<th align="right">3rd Qu.</th>
<th align="right">Max.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">59.11443</td>
<td align="right">75.30169</td>
<td align="right">80.02914</td>
<td align="right">80.06942</td>
<td align="right">84.89566</td>
<td align="right">102.5105</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb649"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb649-1"><a href="statistical-models.html#cb649-1" tabindex="-1"></a>residuals <span class="ot">&lt;-</span> <span class="fu">resid</span>(MLexamp<span class="fl">.8</span>)</span>
<span id="cb649-2"><a href="statistical-models.html#cb649-2" tabindex="-1"></a><span class="fu">head</span>(residuals)</span></code></pre></div>
<pre><code>##           1           2           3           4           5           6 
##  1.25126333  0.98551428 -0.04473698 -2.81822020  0.31620284  3.17547575</code></pre>
<div class="sourceCode" id="cb651"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb651-1"><a href="statistical-models.html#cb651-1" tabindex="-1"></a><span class="fu">summary</span>(residuals) </span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">Min.</th>
<th align="right">1st Qu.</th>
<th align="right">Median</th>
<th align="right">Mean</th>
<th align="right">3rd Qu.</th>
<th align="right">Max.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">-6.316344</td>
<td align="right">-1.385218</td>
<td align="right">-0.0007856</td>
<td align="right">0</td>
<td align="right">1.3616</td>
<td align="right">5.958581</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb652"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb652-1"><a href="statistical-models.html#cb652-1" tabindex="-1"></a><span class="fu">hist</span>(residuals,<span class="dv">50</span>) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-317-1.png" alt="" width="672" /></p>
<hr />
</div>
<div id="fitted-lines-by-group" class="section level3 hasAnchor" number="6.6.20">
<h3><span class="header-section-number">6.6.20</span> Fitted lines by group<a href="statistical-models.html#fitted-lines-by-group" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This plot visualizes model-implied trajectories by school.<br />
Because fitted values in a random-intercept model contain partial pooling, you often see <em>less variation</em> than raw group means—this is expected and is one of the main benefits of mixed models.</p>
<div class="sourceCode" id="cb653"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb653-1"><a href="statistical-models.html#cb653-1" tabindex="-1"></a>lmm.data<span class="sc">$</span>Fitted<span class="ot">=</span><span class="fu">predict</span>(MLexamp<span class="fl">.8</span>)</span>
<span id="cb653-2"><a href="statistical-models.html#cb653-2" tabindex="-1"></a><span class="co"># subjects=unique(lmm.data$school) #Taking the identifiers and saving it</span></span>
<span id="cb653-3"><a href="statistical-models.html#cb653-3" tabindex="-1"></a><span class="co"># sam=&quot;V&quot; # Taking a random sample of 10 Subjects</span></span>
<span id="cb653-4"><a href="statistical-models.html#cb653-4" tabindex="-1"></a> </span>
<span id="cb653-5"><a href="statistical-models.html#cb653-5" tabindex="-1"></a><span class="fu">ggplot</span>(lmm.data    ,<span class="fu">aes</span>(<span class="at">x=</span>open ,<span class="at">y=</span>Fitted,<span class="at">group=</span>school,<span class="at">color=</span>school ) )<span class="sc">+</span><span class="fu">geom_line</span>(<span class="at">se=</span>F)</span></code></pre></div>
<pre><code>## Warning in geom_line(se = F): Ignoring unknown parameters: `se`</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-318-1.png" alt="" width="672" /></p>
<hr />
</div>
<div id="model-diagnostics-second-dataset-nurses" class="section level3 hasAnchor" number="6.6.21">
<h3><span class="header-section-number">6.6.21</span> Model diagnostics (second dataset: Nurses)<a href="statistical-models.html#model-diagnostics-second-dataset-nurses" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This section shows how the same mixed model ideas apply in a more realistic hierarchical structure: hospital/ward.</p>
<div id="loading-nurse-data" class="section level4 hasAnchor" number="6.6.21.1">
<h4><span class="header-section-number">6.6.21.1</span> Loading <code>nurse</code> data<a href="statistical-models.html#loading-nurse-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>You read an SPSS dataset from GitHub and fit a nested random intercept model.</p>
<p>Important conceptual point: if the outcome is truly ordinal, a Gaussian LMM is an approximation.<br />
For ordinal outcomes, you would typically consider an ordinal mixed model (e.g., cumulative logit mixed model).<br />
But as you note, this is for demonstration of diagnostics.</p>
<div class="sourceCode" id="cb655"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb655-1"><a href="statistical-models.html#cb655-1" tabindex="-1"></a><span class="co"># --- Data Simulation ---</span></span>
<span id="cb655-2"><a href="statistical-models.html#cb655-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb655-3"><a href="statistical-models.html#cb655-3" tabindex="-1"></a></span>
<span id="cb655-4"><a href="statistical-models.html#cb655-4" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2026</span>)</span>
<span id="cb655-5"><a href="statistical-models.html#cb655-5" tabindex="-1"></a></span>
<span id="cb655-6"><a href="statistical-models.html#cb655-6" tabindex="-1"></a><span class="co"># --- 1. Define Hierarchical Structure ---</span></span>
<span id="cb655-7"><a href="statistical-models.html#cb655-7" tabindex="-1"></a>n_hospitals <span class="ot">&lt;-</span> <span class="dv">5</span>           <span class="co"># Number of hospitals (Level 3)</span></span>
<span id="cb655-8"><a href="statistical-models.html#cb655-8" tabindex="-1"></a>n_wards_per_hosp <span class="ot">&lt;-</span> <span class="dv">10</span>     <span class="co"># Wards per hospital (Total 50 wards)</span></span>
<span id="cb655-9"><a href="statistical-models.html#cb655-9" tabindex="-1"></a>n_nurses_per_ward <span class="ot">&lt;-</span> <span class="dv">15</span>    <span class="co"># Nurses per ward (Total 750 nurses)</span></span>
<span id="cb655-10"><a href="statistical-models.html#cb655-10" tabindex="-1"></a>total_n <span class="ot">&lt;-</span> n_hospitals <span class="sc">*</span> n_wards_per_hosp <span class="sc">*</span> n_nurses_per_ward</span>
<span id="cb655-11"><a href="statistical-models.html#cb655-11" tabindex="-1"></a></span>
<span id="cb655-12"><a href="statistical-models.html#cb655-12" tabindex="-1"></a><span class="co"># --- 2. Generate Hierarchical IDs ---</span></span>
<span id="cb655-13"><a href="statistical-models.html#cb655-13" tabindex="-1"></a>hospital <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_hospitals, <span class="at">each =</span> n_wards_per_hosp <span class="sc">*</span> n_nurses_per_ward)</span>
<span id="cb655-14"><a href="statistical-models.html#cb655-14" tabindex="-1"></a>ward     <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>(n_hospitals <span class="sc">*</span> n_wards_per_hosp), <span class="at">each =</span> n_nurses_per_ward)</span>
<span id="cb655-15"><a href="statistical-models.html#cb655-15" tabindex="-1"></a>nurse_id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>total_n</span>
<span id="cb655-16"><a href="statistical-models.html#cb655-16" tabindex="-1"></a></span>
<span id="cb655-17"><a href="statistical-models.html#cb655-17" tabindex="-1"></a><span class="co"># --- 3. Generate Predictors (Fixed Effects) ---</span></span>
<span id="cb655-18"><a href="statistical-models.html#cb655-18" tabindex="-1"></a><span class="co"># experien: Nurse work experience in years (ranging 1-25)</span></span>
<span id="cb655-19"><a href="statistical-models.html#cb655-19" tabindex="-1"></a>experien <span class="ot">&lt;-</span> <span class="fu">runif</span>(total_n, <span class="dv">1</span>, <span class="dv">25</span>)</span>
<span id="cb655-20"><a href="statistical-models.html#cb655-20" tabindex="-1"></a></span>
<span id="cb655-21"><a href="statistical-models.html#cb655-21" tabindex="-1"></a><span class="co"># wardtype: Type of ward (0 = General, 1 = Special/ICU) - Level 2 variable</span></span>
<span id="cb655-22"><a href="statistical-models.html#cb655-22" tabindex="-1"></a><span class="co"># First generate types for each ward, then broadcast to individual nurses</span></span>
<span id="cb655-23"><a href="statistical-models.html#cb655-23" tabindex="-1"></a>unique_ward_types <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n_hospitals <span class="sc">*</span> n_wards_per_hosp, <span class="dv">1</span>, <span class="fl">0.4</span>)</span>
<span id="cb655-24"><a href="statistical-models.html#cb655-24" tabindex="-1"></a>wardtype <span class="ot">&lt;-</span> <span class="fu">rep</span>(unique_ward_types, <span class="at">each =</span> n_nurses_per_ward)</span>
<span id="cb655-25"><a href="statistical-models.html#cb655-25" tabindex="-1"></a></span>
<span id="cb655-26"><a href="statistical-models.html#cb655-26" tabindex="-1"></a><span class="co"># expcon: Experience control/interaction term (binary experimental condition)</span></span>
<span id="cb655-27"><a href="statistical-models.html#cb655-27" tabindex="-1"></a>expcon <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(total_n, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb655-28"><a href="statistical-models.html#cb655-28" tabindex="-1"></a></span>
<span id="cb655-29"><a href="statistical-models.html#cb655-29" tabindex="-1"></a><span class="co"># --- 4. Define Random Effects (Intercept Deviations) ---</span></span>
<span id="cb655-30"><a href="statistical-models.html#cb655-30" tabindex="-1"></a><span class="co"># Hospital-level random intercepts (u_h) - Variance at Level 3</span></span>
<span id="cb655-31"><a href="statistical-models.html#cb655-31" tabindex="-1"></a>u_h <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rnorm</span>(n_hospitals, <span class="dv">0</span>, <span class="fl">0.8</span>), <span class="at">each =</span> n_wards_per_hosp <span class="sc">*</span> n_nurses_per_ward)</span>
<span id="cb655-32"><a href="statistical-models.html#cb655-32" tabindex="-1"></a></span>
<span id="cb655-33"><a href="statistical-models.html#cb655-33" tabindex="-1"></a><span class="co"># Ward-level random intercepts (u_w) - Variance at Level 2</span></span>
<span id="cb655-34"><a href="statistical-models.html#cb655-34" tabindex="-1"></a>u_w <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rnorm</span>(n_hospitals <span class="sc">*</span> n_wards_per_hosp, <span class="dv">0</span>, <span class="fl">1.2</span>), <span class="at">each =</span> n_nurses_per_ward)</span>
<span id="cb655-35"><a href="statistical-models.html#cb655-35" tabindex="-1"></a></span>
<span id="cb655-36"><a href="statistical-models.html#cb655-36" tabindex="-1"></a><span class="co"># --- 5. Generate Dependent Variable: stress ---</span></span>
<span id="cb655-37"><a href="statistical-models.html#cb655-37" tabindex="-1"></a><span class="co"># Model Equation: </span></span>
<span id="cb655-38"><a href="statistical-models.html#cb655-38" tabindex="-1"></a><span class="co"># stress = intercept + 0.5*wardtype - 0.1*experien + 0.3*expcon + Random Effects + Residual Error</span></span>
<span id="cb655-39"><a href="statistical-models.html#cb655-39" tabindex="-1"></a>intercept <span class="ot">&lt;-</span> <span class="fl">5.0</span></span>
<span id="cb655-40"><a href="statistical-models.html#cb655-40" tabindex="-1"></a>beta_wardtype <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb655-41"><a href="statistical-models.html#cb655-41" tabindex="-1"></a>beta_experien <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.1</span></span>
<span id="cb655-42"><a href="statistical-models.html#cb655-42" tabindex="-1"></a>beta_expcon <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb655-43"><a href="statistical-models.html#cb655-43" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(total_n, <span class="dv">0</span>, <span class="fl">1.0</span>) <span class="co"># Residual error (Level 1 variance)</span></span>
<span id="cb655-44"><a href="statistical-models.html#cb655-44" tabindex="-1"></a></span>
<span id="cb655-45"><a href="statistical-models.html#cb655-45" tabindex="-1"></a>stress <span class="ot">&lt;-</span> intercept <span class="sc">+</span> (beta_wardtype <span class="sc">*</span> wardtype) <span class="sc">+</span> (beta_experien <span class="sc">*</span> experien) <span class="sc">+</span> </span>
<span id="cb655-46"><a href="statistical-models.html#cb655-46" tabindex="-1"></a>          (beta_expcon <span class="sc">*</span> expcon) <span class="sc">+</span> u_h <span class="sc">+</span> u_w <span class="sc">+</span> error</span>
<span id="cb655-47"><a href="statistical-models.html#cb655-47" tabindex="-1"></a></span>
<span id="cb655-48"><a href="statistical-models.html#cb655-48" tabindex="-1"></a><span class="co"># --- 6. Assemble into Data Frame ---</span></span>
<span id="cb655-49"><a href="statistical-models.html#cb655-49" tabindex="-1"></a>nurses_sim_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb655-50"><a href="statistical-models.html#cb655-50" tabindex="-1"></a>  <span class="at">nurse_id =</span> nurse_id,</span>
<span id="cb655-51"><a href="statistical-models.html#cb655-51" tabindex="-1"></a>  <span class="at">hospital =</span> <span class="fu">as.factor</span>(hospital),</span>
<span id="cb655-52"><a href="statistical-models.html#cb655-52" tabindex="-1"></a>  <span class="at">ward =</span> <span class="fu">as.factor</span>(ward),</span>
<span id="cb655-53"><a href="statistical-models.html#cb655-53" tabindex="-1"></a>  <span class="at">wardtype =</span> <span class="fu">as.factor</span>(wardtype),</span>
<span id="cb655-54"><a href="statistical-models.html#cb655-54" tabindex="-1"></a>  <span class="at">experien =</span> experien,</span>
<span id="cb655-55"><a href="statistical-models.html#cb655-55" tabindex="-1"></a>  <span class="at">expcon =</span> expcon,</span>
<span id="cb655-56"><a href="statistical-models.html#cb655-56" tabindex="-1"></a>  <span class="at">stress =</span> stress</span>
<span id="cb655-57"><a href="statistical-models.html#cb655-57" tabindex="-1"></a>)</span>
<span id="cb655-58"><a href="statistical-models.html#cb655-58" tabindex="-1"></a></span>
<span id="cb655-59"><a href="statistical-models.html#cb655-59" tabindex="-1"></a><span class="co"># Display the first few rows of the simulated dataset</span></span>
<span id="cb655-60"><a href="statistical-models.html#cb655-60" tabindex="-1"></a><span class="fu">head</span>(nurses_sim_data)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">nurse_id</th>
<th align="left">hospital</th>
<th align="left">ward</th>
<th align="left">wardtype</th>
<th align="right">experien</th>
<th align="right">expcon</th>
<th align="right">stress</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="right">17.768163</td>
<td align="right">1</td>
<td align="right">5.001246</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="right">14.356732</td>
<td align="right">0</td>
<td align="right">7.377821</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="right">4.363359</td>
<td align="right">1</td>
<td align="right">6.298894</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="right">7.857359</td>
<td align="right">1</td>
<td align="right">5.904764</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="right">14.328856</td>
<td align="right">0</td>
<td align="right">4.593614</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="right">1.603148</td>
<td align="right">1</td>
<td align="right">3.892058</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb656"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb656-1"><a href="statistical-models.html#cb656-1" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb656-2"><a href="statistical-models.html#cb656-2" tabindex="-1"></a>nurse <span class="ot">&lt;-</span> nurses_sim_data</span>
<span id="cb656-3"><a href="statistical-models.html#cb656-3" tabindex="-1"></a>  <span class="co"># read_sav(file=&quot;https://github.com/MultiLevelAnalysis/Datasets-third-edition-Multilevel-book/blob/master/chapter%202/Nurses/SPSS/Nurses.sav?raw=true&quot;)</span></span></code></pre></div>
<div class="sourceCode" id="cb657"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb657-1"><a href="statistical-models.html#cb657-1" tabindex="-1"></a>MLexamp<span class="fl">.18</span> <span class="ot">&lt;-</span> <span class="fu">lmer</span>(stress <span class="sc">~</span> experien<span class="sc">+</span> wardtype<span class="sc">+</span> expcon  <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>hospital<span class="sc">/</span>ward), <span class="at">data=</span>nurse)</span>
<span id="cb657-2"><a href="statistical-models.html#cb657-2" tabindex="-1"></a><span class="fu">summary</span>(MLexamp<span class="fl">.18</span>)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: stress ~ experien + wardtype + expcon + (1 | hospital/ward)
##    Data: nurse
## 
## REML criterion at convergence: 2293.4
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -3.08705 -0.64245  0.01861  0.61302  2.58650 
## 
## Random effects:
##  Groups        Name        Variance Std.Dev.
##  ward:hospital (Intercept) 2.1225   1.4569  
##  hospital      (Intercept) 0.4072   0.6382  
##  Residual                  0.9680   0.9839  
## Number of obs: 750, groups:  ward:hospital, 50; hospital, 5
## 
## Fixed effects:
##              Estimate Std. Error t value
## (Intercept)  5.035277   0.396294  12.706
## experien    -0.111048   0.005457 -20.350
## wardtype1    0.426834   0.442263   0.965
## expcon       0.481870   0.074216   6.493
## 
## Correlation of Fixed Effects:
##           (Intr) expern wrdty1
## experien  -0.179              
## wardtype1 -0.402  0.000       
## expcon    -0.101  0.016  0.004</code></pre>
<p><em><code>outcome is ordinal variable</code></em></p>
<hr />
</div>
<div id="residual-normality-residual-vs-fitted-qq-plot" class="section level4 hasAnchor" number="6.6.21.2">
<h4><span class="header-section-number">6.6.21.2</span> Residual normality: residual vs fitted, QQ plot<a href="statistical-models.html#residual-normality-residual-vs-fitted-qq-plot" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>You compute residuals and inspect:
- scale-location style behavior via <span class="math inline">\(\sqrt{|residual|}\)</span> vs fitted,
- normality via QQ plot.</p>
<div class="sourceCode" id="cb659"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb659-1"><a href="statistical-models.html#cb659-1" tabindex="-1"></a>lmerresid <span class="ot">&lt;-</span> <span class="fu">resid</span>(MLexamp<span class="fl">.18</span>)</span>
<span id="cb659-2"><a href="statistical-models.html#cb659-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb659-3"><a href="statistical-models.html#cb659-3" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">sqrt</span>(<span class="fu">abs</span>(lmerresid)) <span class="sc">~</span> <span class="fu">predict</span>(MLexamp<span class="fl">.18</span>))</span>
<span id="cb659-4"><a href="statistical-models.html#cb659-4" tabindex="-1"></a><span class="fu">qqnorm</span>(lmerresid)</span>
<span id="cb659-5"><a href="statistical-models.html#cb659-5" tabindex="-1"></a><span class="fu">qqline</span>(lmerresid)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-322-1.png" alt="" width="672" /></p>
<p>Interpretation guide:
- A strong trend in residual spread vs fitted suggests heteroscedasticity.
- Strong deviation from the QQ line suggests heavy tails or skewness.</p>
<hr />
</div>
<div id="checking-variance-homogeneity" class="section level4 hasAnchor" number="6.6.21.3">
<h4><span class="header-section-number">6.6.21.3</span> Checking variance homogeneity<a href="statistical-models.html#checking-variance-homogeneity" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Residuals plotted against predictors can reveal:
- differing variance across categories (<code>wardtype</code>, <code>expcon</code>),
- nonlinear patterns (<code>experien</code>).</p>
<p>Your plotting uses color palettes for readability.</p>
<div class="sourceCode" id="cb660"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb660-1"><a href="statistical-models.html#cb660-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb660-2"><a href="statistical-models.html#cb660-2" tabindex="-1"></a><span class="fu">plot</span>(lmerresid <span class="sc">~</span> <span class="fu">fitted</span>(MLexamp<span class="fl">.18</span>))</span>
<span id="cb660-3"><a href="statistical-models.html#cb660-3" tabindex="-1"></a><span class="fu">with</span>(nurse, <span class="fu">plot</span>(lmerresid <span class="sc">~</span> experien , <span class="at">col =</span> <span class="fu">heat.colors</span>(<span class="dv">20</span>)))</span>
<span id="cb660-4"><a href="statistical-models.html#cb660-4" tabindex="-1"></a><span class="fu">with</span>(nurse, <span class="fu">plot</span>(lmerresid <span class="sc">~</span> wardtype , <span class="at">col =</span> <span class="fu">rainbow</span>(<span class="dv">3</span>)))</span>
<span id="cb660-5"><a href="statistical-models.html#cb660-5" tabindex="-1"></a><span class="fu">with</span>(nurse, <span class="fu">plot</span>(lmerresid <span class="sc">~</span> expcon , <span class="at">col =</span> <span class="fu">rainbow</span>(<span class="dv">5</span>)))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-323-1.png" alt="" width="672" /></p>
<div class="sourceCode" id="cb661"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb661-1"><a href="statistical-models.html#cb661-1" tabindex="-1"></a><span class="co"># with(lmm.data, plot(lmerresid ~ class, col = rainbow(5)))</span></span></code></pre></div>
<hr />
</div>
<div id="influence-points-cooks-distance" class="section level4 hasAnchor" number="6.6.21.4">
<h4><span class="header-section-number">6.6.21.4</span> Influence points (Cook’s distance)<a href="statistical-models.html#influence-points-cooks-distance" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Influence in mixed models can be assessed using tools like <code>influence.ME</code>.<br />
Cook’s distance highlights observations that disproportionately change fixed effects.</p>
<p>In clustered data, influential points can be:
- a single extreme observation,
- or an entire cluster with unusual behavior.</p>
<div class="sourceCode" id="cb662"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb662-1"><a href="statistical-models.html#cb662-1" tabindex="-1"></a><span class="fu">library</span>(influence.ME)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;influence.ME&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:arm&#39;:
## 
##     se.fixef</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     influence</code></pre>
<div class="sourceCode" id="cb666"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb666-1"><a href="statistical-models.html#cb666-1" tabindex="-1"></a>lmer3.infl <span class="ot">&lt;-</span> <span class="fu">influence</span>(MLexamp<span class="fl">.18</span>, <span class="at">obs =</span> <span class="cn">TRUE</span>)</span>
<span id="cb666-2"><a href="statistical-models.html#cb666-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb666-3"><a href="statistical-models.html#cb666-3" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">cooks.distance</span>(lmer3.infl), <span class="at">type =</span> <span class="st">&quot;p&quot;</span>, <span class="at">pch =</span> <span class="dv">20</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-324-1.png" alt="" width="672" /></p>
<hr />
</div>
<div id="random-effect-normality" class="section level4 hasAnchor" number="6.6.21.5">
<h4><span class="header-section-number">6.6.21.5</span> Random effect normality<a href="statistical-models.html#random-effect-normality" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A QQ plot of the estimated random intercepts checks whether the random effects distribution is approximately normal.</p>
<div class="sourceCode" id="cb667"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb667-1"><a href="statistical-models.html#cb667-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb667-2"><a href="statistical-models.html#cb667-2" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">ranef</span>(MLexamp<span class="fl">.18</span>)<span class="sc">$</span><span class="st">`</span><span class="at">ward:hospital</span><span class="st">`</span><span class="sc">$</span><span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-325-1.png" alt="" width="672" /></p>
<p>(If the QQ plot shows strong asymmetry or heavy tails, consider whether the random effects distribution assumption is reasonable, or whether model specification is missing covariates.)</p>
<hr />
</div>
<div id="post-hoc-analysis" class="section level4 hasAnchor" number="6.6.21.6">
<h4><span class="header-section-number">6.6.21.6</span> Post hoc analysis<a href="statistical-models.html#post-hoc-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>confint()</code> can provide confidence intervals for variance parameters (and fixed effects depending on settings).<br />
You request parameters <code>1:4</code>, which typically corresponds to variance components and fixed effects depending on the model and method.</p>
<div class="sourceCode" id="cb668"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb668-1"><a href="statistical-models.html#cb668-1" tabindex="-1"></a><span class="fu">confint</span>(MLexamp<span class="fl">.18</span>, <span class="at">parm =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">oldNames =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Computing profile confidence intervals ...</code></pre>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">2.5 %</th>
<th align="right">97.5 %</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">sd_(Intercept)|ward:hospital</td>
<td align="right">1.1784347</td>
<td align="right">1.808224</td>
</tr>
<tr class="even">
<td align="left">sd_(Intercept)|hospital</td>
<td align="right">0.0000000</td>
<td align="right">1.467998</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">0.9331689</td>
<td align="right">1.036270</td>
</tr>
<tr class="even">
<td align="left">(Intercept)</td>
<td align="right">4.2180132</td>
<td align="right">5.848215</td>
</tr>
</tbody>
</table>
<div id="estimated-marginal-means-lsmeans-emmeans" class="section level5 hasAnchor" number="6.6.21.6.1">
<h5><span class="header-section-number">6.6.21.6.1</span> Estimated marginal means (lsmeans / emmeans)<a href="statistical-models.html#estimated-marginal-means-lsmeans-emmeans" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p><code>emmeans</code> produces adjusted means (marginal means) for categorical predictors, averaged over other covariates.</p>
<p>The interaction plot helps interpret whether the effect of <code>expcon</code> differs by <code>wardtype</code> (effect modification).</p>
<div class="sourceCode" id="cb670"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb670-1"><a href="statistical-models.html#cb670-1" tabindex="-1"></a>mylsmeans <span class="ot">&lt;-</span> emmeans<span class="sc">::</span><span class="fu">emmeans</span>(MLexamp<span class="fl">.18</span>, <span class="fu">c</span>(<span class="st">&quot;wardtype&quot;</span>, <span class="st">&quot;expcon&quot;</span> ))</span>
<span id="cb670-2"><a href="statistical-models.html#cb670-2" tabindex="-1"></a>sum_mylsmeans <span class="ot">&lt;-</span> <span class="fu">summary</span>(mylsmeans)</span>
<span id="cb670-3"><a href="statistical-models.html#cb670-3" tabindex="-1"></a><span class="fu">with</span>(sum_mylsmeans, <span class="fu">interaction.plot</span>(wardtype , expcon ,emmean, <span class="at">col =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-327-1.png" alt="" width="672" /></p>
</div>
<div id="pairwise-comparisons" class="section level5 hasAnchor" number="6.6.21.6.2">
<h5><span class="header-section-number">6.6.21.6.2</span> Pairwise comparisons<a href="statistical-models.html#pairwise-comparisons" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Pairwise differences provide estimated contrasts; plotting SE and estimates is a quick way to see magnitude and uncertainty.</p>
<div class="sourceCode" id="cb671"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb671-1"><a href="statistical-models.html#cb671-1" tabindex="-1"></a>sum_difflsmeans <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">pairs</span>(mylsmeans))</span>
<span id="cb671-2"><a href="statistical-models.html#cb671-2" tabindex="-1"></a><span class="fu">head</span>(sum_difflsmeans)</span></code></pre></div>
<table>
<colgroup>
<col width="42%" />
<col width="12%" />
<col width="11%" />
<col width="11%" />
<col width="12%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">contrast</th>
<th align="right">estimate</th>
<th align="right">SE</th>
<th align="right">df</th>
<th align="right">t.ratio</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">wardtype0 expcon0 - wardtype1 expcon0</td>
<td align="right">-0.4268335</td>
<td align="right">0.4461313</td>
<td align="right">45.32772</td>
<td align="right">-0.9567443</td>
<td align="right">0.7743988</td>
</tr>
<tr class="even">
<td align="left">wardtype0 expcon0 - wardtype0 expcon1</td>
<td align="right">-0.4818697</td>
<td align="right">0.0742242</td>
<td align="right">700.55632</td>
<td align="right">-6.4920809</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">wardtype0 expcon0 - wardtype1 expcon1</td>
<td align="right">-0.9087032</td>
<td align="right">0.4525239</td>
<td align="right">48.02449</td>
<td align="right">-2.0080779</td>
<td align="right">0.1993094</td>
</tr>
<tr class="even">
<td align="left">wardtype1 expcon0 - wardtype0 expcon1</td>
<td align="right">-0.0550361</td>
<td align="right">0.4520031</td>
<td align="right">47.79373</td>
<td align="right">-0.1217605</td>
<td align="right">0.9993454</td>
</tr>
<tr class="odd">
<td align="left">wardtype1 expcon0 - wardtype1 expcon1</td>
<td align="right">-0.4818697</td>
<td align="right">0.0742242</td>
<td align="right">700.55632</td>
<td align="right">-6.4920809</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">wardtype0 expcon1 - wardtype1 expcon1</td>
<td align="right">-0.4268335</td>
<td align="right">0.4461313</td>
<td align="right">45.32772</td>
<td align="right">-0.9567443</td>
<td align="right">0.7743988</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb672"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb672-1"><a href="statistical-models.html#cb672-1" tabindex="-1"></a><span class="fu">barplot</span>(sum_difflsmeans<span class="sc">$</span>SE)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-328-1.png" alt="" width="672" /></p>
<div class="sourceCode" id="cb673"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb673-1"><a href="statistical-models.html#cb673-1" tabindex="-1"></a><span class="fu">barplot</span>(sum_difflsmeans<span class="sc">$</span>estimate)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-328-2.png" alt="" width="672" /></p>
</div>
<div id="one-stop-diagnostic-plot" class="section level5 hasAnchor" number="6.6.21.6.3">
<h5><span class="header-section-number">6.6.21.6.3</span> One-stop diagnostic plot<a href="statistical-models.html#one-stop-diagnostic-plot" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p><code>performance::check_model()</code> is a convenient diagnostic suite for mixed models (residuals, QQ, collinearity, etc.).</p>
<div class="sourceCode" id="cb674"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb674-1"><a href="statistical-models.html#cb674-1" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_model</span>(MLexamp<span class="fl">.18</span>)</span></code></pre></div>
<hr />
</div>
</div>
</div>
<div id="intra-class-correlation-icc" class="section level3 hasAnchor" number="6.6.22">
<h3><span class="header-section-number">6.6.22</span> Intra class correlation (ICC)<a href="statistical-models.html#intra-class-correlation-icc" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ICC quantifies the proportion of outcome variance attributable to clustering.<br />
It is often the fastest way to decide whether mixed modeling is warranted.</p>
<p>Your code fits the null model and prints the summary, from which you can compute ICC.</p>
<div class="sourceCode" id="cb675"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb675-1"><a href="statistical-models.html#cb675-1" tabindex="-1"></a> lmm.null <span class="ot">&lt;-</span> <span class="fu">lmer</span>(extro <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>school), <span class="at">data =</span> lmm.data)</span>
<span id="cb675-2"><a href="statistical-models.html#cb675-2" tabindex="-1"></a> <span class="fu">summary</span>(lmm.null) </span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: extro ~ 1 + (1 | school)
##    Data: lmm.data
## 
## REML criterion at convergence: 8100.8
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -2.75973 -0.65491 -0.00704  0.64908  2.99247 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  school   (Intercept)  8.855   2.976   
##  Residual             49.276   7.020   
## Number of obs: 1200, groups:  school, 6
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)   80.069      1.232   65.01</code></pre>
<p>Your interpretation statement is exactly the right reading:
a large ICC means that group membership (school) accounts for a large portion of variance in <code>extro</code>, strongly supporting the need for random effects.</p>
<hr />
<div id="notice-practical-reminders" class="section level4 hasAnchor" number="6.6.22.1">
<h4><span class="header-section-number">6.6.22.1</span> Notice / practical reminders<a href="statistical-models.html#notice-practical-reminders" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><strong>Back-transforming expected values</strong>: if you transform the outcome, marginal means should be interpreted on the transformed scale unless explicitly back-transformed.</li>
<li><strong>Box–Cox</strong> transformations can help stabilize variance and improve normality when residual diagnostics show strong deviations.</li>
<li>Mixed model choice should balance:
<ul>
<li>scientific interpretability,</li>
<li>diagnostics,</li>
<li>parsimony (AIC/BIC),</li>
<li>and validation where possible.</li>
</ul></li>
</ul>
<p>This section now gives a complete “from OLS to LMM” practical pipeline: build, compare, diagnose, interpret, and quantify clustering (ICC).</p>

</div>
</div>
</div>
<div id="linear-mixed-model-covariance-decomposition-with-random-intercept-lme4" class="section level2 hasAnchor" number="6.7">
<h2><span class="header-section-number">6.7</span> Linear mixed model covariance decomposition with random intercept — lme4<a href="statistical-models.html#linear-mixed-model-covariance-decomposition-with-random-intercept-lme4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section walks through <em>the same workflow you used above</em>, but with a stronger emphasis on (1) what each matrix represents, (2) where the covariance decomposition shows up, and (3) how the “manual” computations match <code>lme4</code>.</p>
<p>We focus on the random-intercept LMM:</p>
<p><span class="math display">\[
\mathbf{y} = \mathbf{X}\beta + \mathbf{Z}u + \varepsilon,
\qquad
u \sim N(0,\mathbf{G}),
\qquad
\varepsilon \sim N(0,\mathbf{R})
\]</span></p>
<p>with the implied marginal model</p>
<p><span class="math display">\[
\mathbf{y} \sim N(\mathbf{X}\beta,\ \mathbf{V}),
\qquad
\mathbf{V}=\mathbf{Z}\mathbf{G}\mathbf{Z}&#39;+\mathbf{R}.
\]</span></p>
<p>In <code>lme4</code> (without <code>nlme</code> residual correlation structures), residuals are independent:</p>
<p><span class="math display">\[
\mathbf{R}=\sigma^2\mathbf{I}.
\]</span></p>
<p>For a <strong>random intercept only</strong> model with grouping variable Subject, the random-effect covariance is</p>
<p><span class="math display">\[
\mathbf{G}=\sigma_u^2\mathbf{I}.
\]</span></p>
<p>This is the classic compound symmetry pattern: within a subject, all repeated observations share covariance <span class="math inline">\(\sigma_u^2\)</span>, and the diagonal includes <span class="math inline">\(\sigma_u^2+\sigma^2\)</span>.</p>
<hr />
<div id="load-data" class="section level3 hasAnchor" number="6.7.1">
<h3><span class="header-section-number">6.7.1</span> Load data<a href="statistical-models.html#load-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We use the <code>Orthodont</code> dataset and store it as <code>Data</code>.</p>
<div class="sourceCode" id="cb677"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb677-1"><a href="statistical-models.html#cb677-1" tabindex="-1"></a><span class="fu">data</span>(Orthodont, <span class="at">package=</span><span class="st">&quot;nlme&quot;</span>)</span>
<span id="cb677-2"><a href="statistical-models.html#cb677-2" tabindex="-1"></a>Data <span class="ot">&lt;-</span> Orthodont</span></code></pre></div>
<hr />
</div>
<div id="plot-means-and-variances-by-higher-level-variable-grouping" class="section level3 hasAnchor" number="6.7.2">
<h3><span class="header-section-number">6.7.2</span> Plot means and variances by higher level variable (grouping)<a href="statistical-models.html#plot-means-and-variances-by-higher-level-variable-grouping" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Before fitting models, we quickly examine whether subjects differ in their outcome level and variability.</p>
<ul>
<li>If subject means vary a lot, random intercepts are plausible.</li>
<li>If within-subject variances vary wildly, a more complex residual structure might be needed (though <code>lme4</code> cannot directly specify correlated residuals).</li>
</ul>
<div class="sourceCode" id="cb678"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb678-1"><a href="statistical-models.html#cb678-1" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">with</span>(Data, <span class="fu">tapply</span>(distance, <span class="fu">list</span>(<span class="at">subject =</span> Subject), mean)))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-332-1.png" alt="" width="672" /></p>
<div class="sourceCode" id="cb679"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb679-1"><a href="statistical-models.html#cb679-1" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">with</span>(Data, <span class="fu">tapply</span>(distance, <span class="fu">list</span>(<span class="at">subject =</span> Subject), var)))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-332-2.png" alt="" width="672" /></p>
<hr />
</div>
<div id="using-glm-style-fixed-effects-baseline-reference" class="section level3 hasAnchor" number="6.7.3">
<h3><span class="header-section-number">6.7.3</span> Using glm-style fixed effects (baseline reference)<a href="statistical-models.html#using-glm-style-fixed-effects-baseline-reference" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="using-glm-subject-as-fixed-effect" class="section level4 hasAnchor" number="6.7.3.1">
<h4><span class="header-section-number">6.7.3.1</span> Using glm (subject as fixed effect)<a href="statistical-models.html#using-glm-subject-as-fixed-effect" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This model allows a separate intercept for each subject as a fixed parameter:</p>
<p><span class="math display">\[
\text{distance}_{ij}=\beta_0+\beta_1\text{age}_{ij}+\beta_2\text{Sex}_{ij}+\alpha_j+\varepsilon_{ij}.
\]</span></p>
<p>It often fits well, but it treats subject effects as fixed and does not provide a variance component interpretation <span class="math inline">\(\sigma_u^2\)</span>.</p>
<div class="sourceCode" id="cb680"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb680-1"><a href="statistical-models.html#cb680-1" tabindex="-1"></a>fit.lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(distance <span class="sc">~</span> age<span class="sc">+</span> Sex <span class="sc">+</span> Subject, <span class="at">data =</span> Data) </span>
<span id="cb680-2"><a href="statistical-models.html#cb680-2" tabindex="-1"></a><span class="fu">anova</span>(fit.lm)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Df</th>
<th align="right">Sum Sq</th>
<th align="right">Mean Sq</th>
<th align="right">F value</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">age</td>
<td align="right">1</td>
<td align="right">235.3560</td>
<td align="right">235.356019</td>
<td align="right">114.838287</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Sex</td>
<td align="right">1</td>
<td align="right">140.4649</td>
<td align="right">140.464857</td>
<td align="right">68.537629</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Subject</td>
<td align="right">25</td>
<td align="right">377.9148</td>
<td align="right">15.116591</td>
<td align="right">7.375904</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Residuals</td>
<td align="right">80</td>
<td align="right">163.9565</td>
<td align="right">2.049456</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<hr />
</div>
<div id="using-glm-with-random-slopes-aov-error-term" class="section level4 hasAnchor" number="6.7.3.2">
<h4><span class="header-section-number">6.7.3.2</span> Using glm with random slopes (aov Error term)<a href="statistical-models.html#using-glm-with-random-slopes-aov-error-term" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This approach is the classical ANOVA / variance-component view. For balanced repeated measures, it connects to mean squares.</p>
<div class="sourceCode" id="cb681"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb681-1"><a href="statistical-models.html#cb681-1" tabindex="-1"></a>fit.aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(distance <span class="sc">~</span> age<span class="sc">+</span> Sex <span class="sc">+</span> <span class="fu">Error</span>(Subject), <span class="at">data =</span> Data) </span>
<span id="cb681-2"><a href="statistical-models.html#cb681-2" tabindex="-1"></a><span class="fu">summary</span>(fit.aov)</span></code></pre></div>
<pre><code>## 
## Error: Subject
##           Df Sum Sq Mean Sq F value  Pr(&gt;F)   
## Sex        1  140.5  140.46   9.292 0.00538 **
## Residuals 25  377.9   15.12                   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Error: Within
##           Df Sum Sq Mean Sq F value Pr(&gt;F)    
## age        1  235.4  235.36   114.8 &lt;2e-16 ***
## Residuals 80  164.0    2.05                   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div id="how-can-we-compute-sigma_a2-from-this-output" class="section level5 hasAnchor" number="6.7.3.2.1">
<h5><span class="header-section-number">6.7.3.2.1</span> How can we compute <span class="math inline">\(\sigma_a^2\)</span> from this output?<a href="statistical-models.html#how-can-we-compute-sigma_a2-from-this-output" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Your note is the key identity:</p>
<ul>
<li><span class="math inline">\(\sigma^2 = \mathrm{MSE}\)</span></li>
<li><span class="math inline">\(E(\mathrm{MSA}) = \sigma_a^2 + n\sigma^2\)</span></li>
</ul>
<p>so</p>
<p><span class="math display">\[
\sigma_a^2=\frac{\mathrm{MSA}-\mathrm{MSE}}{n}.
\]</span></p>
<p><strong>Practical caution:</strong> <code>Orthodont</code> is not perfectly balanced in the same way as textbook ANOVA examples, so this computation is best viewed as an approximation. Likelihood-based LMM estimation (REML/ML) is typically preferred for unbalanced data.</p>
<hr />
</div>
</div>
</div>
<div id="using-lmm-random-intercept-in-lme4" class="section level3 hasAnchor" number="6.7.4">
<h3><span class="header-section-number">6.7.4</span> Using LMM (random intercept) in lme4<a href="statistical-models.html#using-lmm-random-intercept-in-lme4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="fit-the-random-intercept-model" class="section level4 hasAnchor" number="6.7.4.1">
<h4><span class="header-section-number">6.7.4.1</span> Fit the random intercept model<a href="statistical-models.html#fit-the-random-intercept-model" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We fit</p>
<p><span class="math display">\[
\text{distance}_{ij}=\beta_0+\beta_1\text{age}_{ij}+\beta_2\text{Sex}_{ij}+u_{0j}+\varepsilon_{ij},
\]</span></p>
<p>with <span class="math inline">\(u_{0j}\sim N(0,\sigma_u^2)\)</span>, <span class="math inline">\(\varepsilon_{ij}\sim N(0,\sigma^2)\)</span>.</p>
<div class="sourceCode" id="cb683"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb683-1"><a href="statistical-models.html#cb683-1" tabindex="-1"></a><span class="fu">library</span>(lme4) </span>
<span id="cb683-2"><a href="statistical-models.html#cb683-2" tabindex="-1"></a>fit.lmer <span class="ot">&lt;-</span> <span class="fu">lmer</span>(distance <span class="sc">~</span> age <span class="sc">+</span> Sex  <span class="sc">+</span>(<span class="dv">1</span> <span class="sc">|</span> Subject), <span class="at">data =</span> Data) </span>
<span id="cb683-3"><a href="statistical-models.html#cb683-3" tabindex="-1"></a><span class="fu">summary</span>(fit.lmer)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: distance ~ age + Sex + (1 | Subject)
##    Data: Data
## 
## REML criterion at convergence: 437.5
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.7489 -0.5503 -0.0252  0.4534  3.6575 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  Subject  (Intercept) 3.267    1.807   
##  Residual             2.049    1.432   
## Number of obs: 108, groups:  Subject, 27
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept) 17.70671    0.83392  21.233
## age          0.66019    0.06161  10.716
## SexFemale   -2.32102    0.76142  -3.048
## 
## Correlation of Fixed Effects:
##           (Intr) age   
## age       -0.813       
## SexFemale -0.372  0.000</code></pre>
<p><strong>default is compound symmetry</strong> (induced by the random intercept).<br />
More precisely:</p>
<ul>
<li>the random intercept implies constant covariance <span class="math inline">\(\sigma_u^2\)</span> for any two observations from the same subject,</li>
<li>residual errors are independent (identity <span class="math inline">\(\mathbf{R}=\sigma^2\mathbf{I}\)</span>).</li>
</ul>
<hr />
</div>
</div>
<div id="get-mathbfx-mathbfy-mathbfz" class="section level3 hasAnchor" number="6.7.5">
<h3><span class="header-section-number">6.7.5</span> Get <span class="math inline">\(\mathbf{X}\)</span>, <span class="math inline">\(\mathbf{y}\)</span>, <span class="math inline">\(\mathbf{Z}\)</span><a href="statistical-models.html#get-mathbfx-mathbfy-mathbfz" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>These are the core objects behind the matrix formulas.</p>
<ul>
<li><span class="math inline">\(\mathbf{X}\)</span>: fixed-effects design matrix (Intercept, age, Sex…)</li>
<li><span class="math inline">\(\mathbf{y}\)</span>: response vector</li>
<li><span class="math inline">\(\mathbf{Z}\)</span>: random-effects design matrix (subject membership for random intercept)</li>
</ul>
<div class="sourceCode" id="cb685"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb685-1"><a href="statistical-models.html#cb685-1" tabindex="-1"></a>X<span class="ot">=</span>(<span class="fu">getME</span>(fit.lmer, <span class="st">&quot;X&quot;</span>))</span>
<span id="cb685-2"><a href="statistical-models.html#cb685-2" tabindex="-1"></a><span class="fu">head</span>(X)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">(Intercept)</th>
<th align="right">age</th>
<th align="right">SexFemale</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">8</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">10</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">12</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">14</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">8</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">10</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb686"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb686-1"><a href="statistical-models.html#cb686-1" tabindex="-1"></a>y<span class="ot">=</span><span class="fu">getME</span>(fit.lmer, <span class="st">&quot;y&quot;</span>)</span>
<span id="cb686-2"><a href="statistical-models.html#cb686-2" tabindex="-1"></a><span class="fu">head</span>(y)</span></code></pre></div>
<pre><code>## [1] 26.0 25.0 29.0 31.0 21.5 22.5</code></pre>
<div class="sourceCode" id="cb688"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb688-1"><a href="statistical-models.html#cb688-1" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">getME</span>(fit.lmer, <span class="st">&quot;Z&quot;</span>)</span>
<span id="cb688-2"><a href="statistical-models.html#cb688-2" tabindex="-1"></a><span class="fu">head</span>(Z)</span></code></pre></div>
<pre><code>## 6 x 27 sparse Matrix of class &quot;dgCMatrix&quot;</code></pre>
<pre><code>##   [[ suppressing 27 column names &#39;M16&#39;, &#39;M05&#39;, &#39;M02&#39; ... ]]</code></pre>
<pre><code>##                                                        
## 1 . . . . . . . . . . . . . . 1 . . . . . . . . . . . .
## 2 . . . . . . . . . . . . . . 1 . . . . . . . . . . . .
## 3 . . . . . . . . . . . . . . 1 . . . . . . . . . . . .
## 4 . . . . . . . . . . . . . . 1 . . . . . . . . . . . .
## 5 . . 1 . . . . . . . . . . . . . . . . . . . . . . . .
## 6 . . 1 . . . . . . . . . . . . . . . . . . . . . . . .</code></pre>
<hr />
</div>
<div id="get-fixed-and-random-effect-coefficients" class="section level3 hasAnchor" number="6.7.6">
<h3><span class="header-section-number">6.7.6</span> Get fixed and random effect coefficients<a href="statistical-models.html#get-fixed-and-random-effect-coefficients" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><span class="math inline">\(\hat{\beta}\)</span> are population-average (fixed) coefficients.</li>
<li><span class="math inline">\(\hat{u}\)</span> are BLUPs (random intercepts per subject).</li>
<li><code>coef()</code> combines them into subject-specific coefficients.</li>
</ul>
<div class="sourceCode" id="cb692"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb692-1"><a href="statistical-models.html#cb692-1" tabindex="-1"></a>bhat <span class="ot">&lt;-</span> <span class="fu">getME</span>(fit.lmer, <span class="st">&quot;fixef&quot;</span>) <span class="co">#getME(fit.lmer, &quot;beta&quot;)  # fixef(fit.lmer)</span></span>
<span id="cb692-2"><a href="statistical-models.html#cb692-2" tabindex="-1"></a>bhat </span></code></pre></div>
<pre><code>## (Intercept)         age   SexFemale 
##  17.7067130   0.6601852  -2.3210227</code></pre>
<div class="sourceCode" id="cb694"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb694-1"><a href="statistical-models.html#cb694-1" tabindex="-1"></a>uhat <span class="ot">&lt;-</span> <span class="fu">ranef</span>(fit.lmer) </span>
<span id="cb694-2"><a href="statistical-models.html#cb694-2" tabindex="-1"></a>uhat</span></code></pre></div>
<pre><code>## $Subject
##     (Intercept)
## M16 -1.70183357
## M05 -1.70183357
## M02 -1.37767479
## M11 -1.16156894
## M07 -1.05351602
## M08 -0.94546309
## M03 -0.62130432
## M12 -0.62130432
## M13 -0.62130432
## M14 -0.08103969
## M09  0.13506616
## M15  0.78338371
## M06  1.21559540
## M04  1.43170125
## M01  2.40417758
## M10  3.91691853
## F10 -3.58539251
## F09 -1.31628108
## F06 -1.31628108
## F01 -1.10017524
## F05 -0.01964599
## F07  0.30451279
## F02  0.30451279
## F08  0.62867156
## F03  0.95283034
## F04  1.92530666
## F11  3.22194176
## 
## with conditional variances for &quot;Subject&quot;</code></pre>
<div class="sourceCode" id="cb696"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb696-1"><a href="statistical-models.html#cb696-1" tabindex="-1"></a><span class="fu">coef</span>(fit.lmer)</span></code></pre></div>
<pre><code>## $Subject
##     (Intercept)       age SexFemale
## M16    16.00488 0.6601852 -2.321023
## M05    16.00488 0.6601852 -2.321023
## M02    16.32904 0.6601852 -2.321023
## M11    16.54514 0.6601852 -2.321023
## M07    16.65320 0.6601852 -2.321023
## M08    16.76125 0.6601852 -2.321023
## M03    17.08541 0.6601852 -2.321023
## M12    17.08541 0.6601852 -2.321023
## M13    17.08541 0.6601852 -2.321023
## M14    17.62567 0.6601852 -2.321023
## M09    17.84178 0.6601852 -2.321023
## M15    18.49010 0.6601852 -2.321023
## M06    18.92231 0.6601852 -2.321023
## M04    19.13841 0.6601852 -2.321023
## M01    20.11089 0.6601852 -2.321023
## M10    21.62363 0.6601852 -2.321023
## F10    14.12132 0.6601852 -2.321023
## F09    16.39043 0.6601852 -2.321023
## F06    16.39043 0.6601852 -2.321023
## F01    16.60654 0.6601852 -2.321023
## F05    17.68707 0.6601852 -2.321023
## F07    18.01123 0.6601852 -2.321023
## F02    18.01123 0.6601852 -2.321023
## F08    18.33538 0.6601852 -2.321023
## F03    18.65954 0.6601852 -2.321023
## F04    19.63202 0.6601852 -2.321023
## F11    20.92865 0.6601852 -2.321023
## 
## attr(,&quot;class&quot;)
## [1] &quot;coef.mer&quot;</code></pre>
<p>Interpretation:</p>
<ul>
<li><span class="math inline">\(\hat{\beta}_0\)</span> is the overall intercept.</li>
<li><span class="math inline">\(\hat{u}_j\)</span> is subject <span class="math inline">\(j\)</span>’s deviation from the overall intercept.</li>
<li>Subject <span class="math inline">\(j\)</span>’s conditional intercept is <span class="math inline">\(\hat{\beta}_0+\hat{u}_j\)</span>.</li>
</ul>
<hr />
</div>
<div id="random-effect-covariance-structure-and-the-role-of-theta" class="section level3 hasAnchor" number="6.7.7">
<h3><span class="header-section-number">6.7.7</span> Random effect covariance structure and the role of <span class="math inline">\(\theta\)</span><a href="statistical-models.html#random-effect-covariance-structure-and-the-role-of-theta" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In <code>lme4</code>, random-effects parameters are represented via a Cholesky-factor parameterization. Conceptually:</p>
<ul>
<li><span class="math inline">\(\theta\)</span> parameterizes the <em>relative Cholesky factors</em>,</li>
<li>from <span class="math inline">\(\theta\)</span> we can reconstruct the random-effect covariance <span class="math inline">\(\Sigma\)</span> (often denoted <span class="math inline">\(\mathbf{G}\)</span> for a random-effect term).</li>
</ul>
<p>Your 2×2 example (intercept + slope) illustrates:</p>
<p><span class="math display">\[
\Sigma =
\left(
\begin{array}{cc}
\theta_1 &amp; 0 \\
\theta_2 &amp; \theta_3
\end{array}
\right)
\left(
\begin{array}{cc}
\theta_1 &amp; \theta_2 \\
0 &amp; \theta_3
\end{array}
\right)
=
\left(
\begin{array}{cc}
\theta_1^2 &amp; \theta_1 \theta_2 \\
\theta_1 \theta_2 &amp; \theta_2^2 + \theta_3^2
\end{array}
\right)
=
\left(
\begin{array}{cc}
\sigma_1^2 &amp; \sigma_{12} \\
\sigma_{12} &amp; \sigma_2^2
\end{array}
\right).
\]</span></p>
<p>For a <strong>random intercept only</strong> model, there is only one standard deviation parameter, so <span class="math inline">\(\theta\)</span> reduces to <span class="math inline">\(\sigma_u\)</span> (up to the scaling conventions used internally).</p>
<hr />
<div id="build-a-random-intercept-covariance-object-for-subject" class="section level4 hasAnchor" number="6.7.7.1">
<h4><span class="header-section-number">6.7.7.1</span> Build a “random intercept covariance object” for Subject<a href="statistical-models.html#build-a-random-intercept-covariance-object-for-subject" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>VarCorr(fit.lmer)</code> reports the random intercept SD for <code>Subject</code>.
You build a diagonal matrix of that SD across subjects:</p>
<div class="sourceCode" id="cb698"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb698-1"><a href="statistical-models.html#cb698-1" tabindex="-1"></a>vc <span class="ot">&lt;-</span> <span class="fu">VarCorr</span>(fit.lmer) </span>
<span id="cb698-2"><a href="statistical-models.html#cb698-2" tabindex="-1"></a>Lambda_new <span class="ot">&lt;-</span>vc[[<span class="st">&quot;Subject&quot;</span>]][<span class="dv">1</span>]<span class="sc">*</span><span class="fu">diag</span>(<span class="fu">length</span>(<span class="fu">levels</span>(Data<span class="sc">$</span>Subject)))</span>
<span id="cb698-3"><a href="statistical-models.html#cb698-3" tabindex="-1"></a><span class="fu">head</span>(Lambda_new)</span></code></pre></div>
<table>
<colgroup>
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="right">3.266784</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0.000000</td>
<td align="right">3.266784</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">3.266784</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">3.266784</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">3.266784</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">3.266784</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb699"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb699-1"><a href="statistical-models.html#cb699-1" tabindex="-1"></a><span class="fu">dim</span>(Lambda_new)</span></code></pre></div>
<pre><code>## [1] 27 27</code></pre>
<p>Notes for interpretation:</p>
<ul>
<li>If you want <span class="math inline">\(\mathbf{G}\)</span> on the <strong>variance</strong> scale, it is <span class="math inline">\(\sigma_u^2\mathbf{I}\)</span>.</li>
<li>Many internal pieces in <code>lme4</code> are stored in factorized form; the important point is that the random intercept induces a block-constant covariance when mapped through <span class="math inline">\(\mathbf{Z}\)</span>.</li>
</ul>
<hr />
</div>
</div>
<div id="residual-variance-and-mathbfrsigma2mathbfi" class="section level3 hasAnchor" number="6.7.8">
<h3><span class="header-section-number">6.7.8</span> Residual variance and <span class="math inline">\(\mathbf{R}=\sigma^2\mathbf{I}\)</span><a href="statistical-models.html#residual-variance-and-mathbfrsigma2mathbfi" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Extract residual SD from the fitted model and square it:</p>
<p><span class="math display">\[
\mathbf{R}=\sigma^2\mathbf{I}_N.
\]</span></p>
<div class="sourceCode" id="cb701"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb701-1"><a href="statistical-models.html#cb701-1" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">getME</span>(fit.lmer, <span class="st">&quot;sigma&quot;</span>)<span class="sc">**</span><span class="dv">2</span> </span>
<span id="cb701-2"><a href="statistical-models.html#cb701-2" tabindex="-1"></a>sigma</span></code></pre></div>
<pre><code>## [1] 2.049456</code></pre>
<div class="sourceCode" id="cb703"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb703-1"><a href="statistical-models.html#cb703-1" tabindex="-1"></a><span class="fu">head</span>(sigma<span class="sc">*</span><span class="fu">diag</span>(<span class="fu">nrow</span>(Data)))</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="right">2.049456</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0.000000</td>
<td align="right">2.049456</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">2.049456</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">2.049456</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">2.049456</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">2.049456</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<hr />
</div>
<div id="marginal-covariance-matrix-mathbfv-of-mathbfy" class="section level3 hasAnchor" number="6.7.9">
<h3><span class="header-section-number">6.7.9</span> Marginal covariance matrix <span class="math inline">\(\mathbf{V}\)</span> of <span class="math inline">\(\mathbf{y}\)</span><a href="statistical-models.html#marginal-covariance-matrix-mathbfv-of-mathbfy" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The key decomposition is:</p>
<p><span class="math display">\[
\mathbf{V}=\mathbf{Z}\mathbf{G}\mathbf{Z}&#39;+\sigma^2\mathbf{I}.
\]</span></p>
<p>In your implementation:</p>
<ul>
<li><span class="math inline">\(\mathbf{Z}\Lambda_{\text{new}}\mathbf{Z}&#39;\)</span> creates within-subject covariance,</li>
<li><span class="math inline">\(\sigma^2\mathbf{I}\)</span> adds residual variance.</li>
</ul>
<div class="sourceCode" id="cb704"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb704-1"><a href="statistical-models.html#cb704-1" tabindex="-1"></a>VM <span class="ot">&lt;-</span> Z<span class="sc">%*%</span>Lambda_new<span class="sc">%*%</span><span class="fu">t</span>(Z)<span class="sc">+</span>sigma<span class="sc">*</span><span class="fu">diag</span>(<span class="fu">nrow</span>(Data)) </span>
<span id="cb704-2"><a href="statistical-models.html#cb704-2" tabindex="-1"></a><span class="fu">head</span>(VM)</span></code></pre></div>
<pre><code>## 6 x 108 sparse Matrix of class &quot;dgCMatrix&quot;</code></pre>
<pre><code>##   [[ suppressing 108 column names &#39;1&#39;, &#39;2&#39;, &#39;3&#39; ... ]]</code></pre>
<pre><code>##                                                                                
## 1 5.316240 3.266784 3.266784 3.266784 .        .        .        .        . . .
## 2 3.266784 5.316240 3.266784 3.266784 .        .        .        .        . . .
## 3 3.266784 3.266784 5.316240 3.266784 .        .        .        .        . . .
## 4 3.266784 3.266784 3.266784 5.316240 .        .        .        .        . . .
## 5 .        .        .        .        5.316240 3.266784 3.266784 3.266784 . . .
## 6 .        .        .        .        3.266784 5.316240 3.266784 3.266784 . . .
##                                                                                
## 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
## 2 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
## 3 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
## 4 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
## 5 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
## 6 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
##                                                                                
## 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
## 2 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
## 3 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
## 4 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
## 5 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
## 6 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
##                                        
## 1 . . . . . . . . . . . . . . . . . . .
## 2 . . . . . . . . . . . . . . . . . . .
## 3 . . . . . . . . . . . . . . . . . . .
## 4 . . . . . . . . . . . . . . . . . . .
## 5 . . . . . . . . . . . . . . . . . . .
## 6 . . . . . . . . . . . . . . . . . . .</code></pre>
<div class="sourceCode" id="cb708"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb708-1"><a href="statistical-models.html#cb708-1" tabindex="-1"></a><span class="fu">dim</span>(VM)</span></code></pre></div>
<pre><code>## [1] 108 108</code></pre>
<p>This <span class="math inline">\(\mathbf{V}\)</span> is the object that controls:</p>
<ul>
<li>GLS estimation of <span class="math inline">\(\beta\)</span>,</li>
<li>shrinkage and BLUP estimation of <span class="math inline">\(u\)</span>,</li>
<li>standard errors of <span class="math inline">\(\hat{\beta}\)</span>.</li>
</ul>
<hr />
</div>
<div id="fixed-effect-coefficient-covariance-matrix" class="section level3 hasAnchor" number="6.7.10">
<h3><span class="header-section-number">6.7.10</span> Fixed effect coefficient covariance matrix<a href="statistical-models.html#fixed-effect-coefficient-covariance-matrix" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>From theory:</p>
<p><span class="math display">\[
\mathrm{Var}(\hat{\beta})=
(\mathbf{X}&#39;\mathbf{V}^{-1}\mathbf{X})^{-1}.
\]</span></p>
<p><code>vcov(fit.lmer)</code> returns the estimated <span class="math inline">\(\mathrm{Var}(\hat{\beta})\)</span>.</p>
<div class="sourceCode" id="cb710"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb710-1"><a href="statistical-models.html#cb710-1" tabindex="-1"></a>vcov <span class="ot">&lt;-</span> <span class="fu">vcov</span>(fit.lmer) <span class="co">#fixed cov</span></span>
<span id="cb710-2"><a href="statistical-models.html#cb710-2" tabindex="-1"></a>vcov</span></code></pre></div>
<pre><code>## 3 x 3 Matrix of class &quot;dpoMatrix&quot;
##             (Intercept)           age     SexFemale
## (Intercept)  0.69542669 -4.174818e-02 -2.361967e-01
## age         -0.04174818  3.795289e-03 -3.051416e-17
## SexFemale   -0.23619673 -3.051416e-17  5.797556e-01</code></pre>
<div class="sourceCode" id="cb712"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb712-1"><a href="statistical-models.html#cb712-1" tabindex="-1"></a><span class="co"># computer correlation coefficients </span></span>
<span id="cb712-2"><a href="statistical-models.html#cb712-2" tabindex="-1"></a>vcov<span class="sc">@</span>x[<span class="dv">2</span>]<span class="sc">/</span><span class="fu">prod</span>(<span class="fu">sqrt</span>( <span class="fu">diag</span>(<span class="fu">vcov</span>(fit.lmer))[<span class="sc">-</span><span class="dv">3</span>] ))</span></code></pre></div>
<pre><code>## [1] -0.8126236</code></pre>
<p>Interpretation:
- diagonal elements are variances of coefficients,
- square roots are standard errors,
- off-diagonal elements encode correlation among coefficient estimates.</p>
<hr />
</div>
<div id="random-effect-covariance-matrix-standard-deviation-scale" class="section level3 hasAnchor" number="6.7.11">
<h3><span class="header-section-number">6.7.11</span> Random effect covariance matrix (standard deviation scale)<a href="statistical-models.html#random-effect-covariance-matrix-standard-deviation-scale" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>VarCorr()</code> prints SDs (and correlations if applicable).<br />
<code>Matrix::bdiag(vc)</code> produces a block-diagonal covariance structure across random-effect terms.</p>
<div class="sourceCode" id="cb714"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb714-1"><a href="statistical-models.html#cb714-1" tabindex="-1"></a>vc <span class="ot">&lt;-</span> <span class="fu">VarCorr</span>(fit.lmer) </span>
<span id="cb714-2"><a href="statistical-models.html#cb714-2" tabindex="-1"></a>vc <span class="do">### default print method: standard dev and corr</span></span></code></pre></div>
<pre><code>##  Groups   Name        Std.Dev.
##  Subject  (Intercept) 1.8074  
##  Residual             1.4316</code></pre>
<div class="sourceCode" id="cb716"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb716-1"><a href="statistical-models.html#cb716-1" tabindex="-1"></a><span class="fu">as.matrix</span>(Matrix<span class="sc">::</span><span class="fu">bdiag</span>(vc)) <span class="co">#random effect covariance matrix</span></span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">(Intercept)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">3.266784</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb717"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb717-1"><a href="statistical-models.html#cb717-1" tabindex="-1"></a><span class="co"># https://stackoverflow.com/questions/47307340/extracting-the-i-estimated-variance-covariance-matrix-of-random-effects-and-or</span></span>
<span id="cb717-2"><a href="statistical-models.html#cb717-2" tabindex="-1"></a><span class="co"># https://support.sas.com/documentation/cdl/en/statug/63033/HTML/default/viewer.htm#statug_mixed_sect022.htm</span></span></code></pre></div>
<p>And your empirical SD check based on BLUPs:</p>
<div class="sourceCode" id="cb718"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb718-1"><a href="statistical-models.html#cb718-1" tabindex="-1"></a>uintercept <span class="ot">&lt;-</span> (uhat[[<span class="st">&quot;Subject&quot;</span>]])</span>
<span id="cb718-2"><a href="statistical-models.html#cb718-2" tabindex="-1"></a><span class="fu">sd</span>(uintercept[,<span class="dv">1</span>])</span></code></pre></div>
<pre><code>## [1] 1.647809</code></pre>
<p>Important: the SD of the BLUPs is typically smaller than <span class="math inline">\(\hat{\sigma}_u\)</span> due to shrinkage.</p>
<hr />
</div>
<div id="compute-fixed-effect-coefficients-manually-gls" class="section level3 hasAnchor" number="6.7.12">
<h3><span class="header-section-number">6.7.12</span> Compute fixed effect coefficients manually (GLS)<a href="statistical-models.html#compute-fixed-effect-coefficients-manually-gls" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Given <span class="math inline">\(\mathbf{V}\)</span>, the GLS estimator is:</p>
<p><span class="math display">\[
\hat{\beta}=
(\mathbf{X}&#39;\mathbf{V}^{-1}\mathbf{X})^{-1}\mathbf{X}&#39;\mathbf{V}^{-1}\mathbf{y}.
\]</span></p>
<p>You compute it directly and compare with <code>bhat</code>.</p>
<div class="sourceCode" id="cb720"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb720-1"><a href="statistical-models.html#cb720-1" tabindex="-1"></a><span class="fu">library</span>(matlib)</span>
<span id="cb720-2"><a href="statistical-models.html#cb720-2" tabindex="-1"></a><span class="fu">inv</span>(<span class="fu">t</span>(<span class="fu">as.matrix</span>(X))<span class="sc">%*%</span><span class="fu">inv</span>(<span class="fu">as.matrix</span>(VM))<span class="sc">%*%</span><span class="fu">as.matrix</span>(X))<span class="sc">%*%</span><span class="fu">t</span>(<span class="fu">as.matrix</span>(X))<span class="sc">%*%</span><span class="fu">inv</span>(<span class="fu">as.matrix</span>(VM))<span class="sc">%*%</span>y</span></code></pre></div>
<table>
<tbody>
<tr class="odd">
<td align="right">17.7067076</td>
</tr>
<tr class="even">
<td align="right">0.6601871</td>
</tr>
<tr class="odd">
<td align="right">-2.3210230</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb721"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb721-1"><a href="statistical-models.html#cb721-1" tabindex="-1"></a>bhat</span></code></pre></div>
<pre><code>## (Intercept)         age   SexFemale 
##  17.7067130   0.6601852  -2.3210227</code></pre>
<hr />
</div>
<div id="compute-covariance-of-fixed-effect-coefficients-manually" class="section level3 hasAnchor" number="6.7.13">
<h3><span class="header-section-number">6.7.13</span> Compute covariance of fixed effect coefficients manually<a href="statistical-models.html#compute-covariance-of-fixed-effect-coefficients-manually" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Theory:</p>
<p><span class="math display">\[
\mathrm{Var}(\hat{\beta})=(\mathbf{X}&#39;\mathbf{V}^{-1}\mathbf{X})^{-1}.
\]</span></p>
<p>Then standard errors are the square roots of the diagonal.</p>
<div class="sourceCode" id="cb723"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb723-1"><a href="statistical-models.html#cb723-1" tabindex="-1"></a><span class="fu">inv</span>(<span class="fu">t</span>(<span class="fu">as.matrix</span>(X))<span class="sc">%*%</span><span class="fu">inv</span>(<span class="fu">as.matrix</span>(VM))<span class="sc">%*%</span><span class="fu">as.matrix</span>(X))</span></code></pre></div>
<table>
<tbody>
<tr class="odd">
<td align="right">0.6954267</td>
<td align="right">-0.0417482</td>
<td align="right">-0.2361967</td>
</tr>
<tr class="even">
<td align="right">-0.0417482</td>
<td align="right">0.0037953</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="right">-0.2361967</td>
<td align="right">0.0000000</td>
<td align="right">0.5797556</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb724"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb724-1"><a href="statistical-models.html#cb724-1" tabindex="-1"></a><span class="co"># standard error</span></span>
<span id="cb724-2"><a href="statistical-models.html#cb724-2" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">inv</span>(<span class="fu">t</span>(<span class="fu">as.matrix</span>(X))<span class="sc">%*%</span><span class="fu">inv</span>(<span class="fu">as.matrix</span>(VM))<span class="sc">%*%</span><span class="fu">as.matrix</span>(X)))</span></code></pre></div>
<pre><code>## Warning in sqrt(inv(t(as.matrix(X)) %*% inv(as.matrix(VM)) %*% as.matrix(X))):
## NaNs produced</code></pre>
<table>
<tbody>
<tr class="odd">
<td align="right">0.8339225</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="right">NaN</td>
<td align="right">0.0616059</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="right">NaN</td>
<td align="right">0.0000000</td>
<td align="right">0.7614169</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb726"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb726-1"><a href="statistical-models.html#cb726-1" tabindex="-1"></a><span class="co"># the following equals lmm summary</span></span>
<span id="cb726-2"><a href="statistical-models.html#cb726-2" tabindex="-1"></a><span class="fu">vcov</span>(fit.lmer) </span></code></pre></div>
<pre><code>## 3 x 3 Matrix of class &quot;dpoMatrix&quot;
##             (Intercept)           age     SexFemale
## (Intercept)  0.69542669 -4.174818e-02 -2.361967e-01
## age         -0.04174818  3.795289e-03 -3.051416e-17
## SexFemale   -0.23619673 -3.051416e-17  5.797556e-01</code></pre>
<div class="sourceCode" id="cb728"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb728-1"><a href="statistical-models.html#cb728-1" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">vcov</span>(fit.lmer))</span></code></pre></div>
<pre><code>## Warning in g({: NaNs produced</code></pre>
<pre><code>## 3 x 3 Matrix of class &quot;dsyMatrix&quot;
##             (Intercept)        age SexFemale
## (Intercept)   0.8339225        NaN       NaN
## age                 NaN 0.06160592       NaN
## SexFemale           NaN        NaN 0.7614168</code></pre>
<hr />
</div>
<div id="compute-random-effect-coefficients-manually-blups" class="section level3 hasAnchor" number="6.7.14">
<h3><span class="header-section-number">6.7.14</span> Compute random effect coefficients manually (BLUPs)<a href="statistical-models.html#compute-random-effect-coefficients-manually-blups" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The BLUP formula is:</p>
<p><span class="math display">\[
\hat{u}=\mathbf{G}\mathbf{Z}&#39;\mathbf{V}^{-1}(\mathbf{y}-\mathbf{X}\hat{\beta}).
\]</span></p>
<p>Your code implements the same structure and compares to <code>ranef()</code>.</p>
<div class="sourceCode" id="cb731"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb731-1"><a href="statistical-models.html#cb731-1" tabindex="-1"></a>comput_uhat <span class="ot">&lt;-</span> (<span class="fu">as.matrix</span>(Lambda_new))<span class="sc">%*%</span><span class="fu">t</span>(Z)<span class="sc">%*%</span><span class="fu">inv</span>(<span class="fu">as.matrix</span>(VM))<span class="sc">%*%</span>(y<span class="sc">-</span><span class="fu">as.matrix</span>(X)<span class="sc">%*%</span>(bhat))</span>
<span id="cb731-2"><a href="statistical-models.html#cb731-2" tabindex="-1"></a><span class="fu">cbind</span>((comput_uhat<span class="sc">@</span>x),(uhat[[<span class="st">&quot;Subject&quot;</span>]]))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">(<a href="mailto:comput_uhat@x" class="email">comput_uhat@x</a>)</th>
<th align="right">(Intercept)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">M16</td>
<td align="right">-1.7018335</td>
<td align="right">-1.7018336</td>
</tr>
<tr class="even">
<td align="left">M05</td>
<td align="right">-1.7018335</td>
<td align="right">-1.7018336</td>
</tr>
<tr class="odd">
<td align="left">M02</td>
<td align="right">-1.3776748</td>
<td align="right">-1.3776748</td>
</tr>
<tr class="even">
<td align="left">M11</td>
<td align="right">-1.1615689</td>
<td align="right">-1.1615689</td>
</tr>
<tr class="odd">
<td align="left">M07</td>
<td align="right">-1.0535160</td>
<td align="right">-1.0535160</td>
</tr>
<tr class="even">
<td align="left">M08</td>
<td align="right">-0.9454631</td>
<td align="right">-0.9454631</td>
</tr>
<tr class="odd">
<td align="left">M03</td>
<td align="right">-0.6213043</td>
<td align="right">-0.6213043</td>
</tr>
<tr class="even">
<td align="left">M12</td>
<td align="right">-0.6213043</td>
<td align="right">-0.6213043</td>
</tr>
<tr class="odd">
<td align="left">M13</td>
<td align="right">-0.6213043</td>
<td align="right">-0.6213043</td>
</tr>
<tr class="even">
<td align="left">M14</td>
<td align="right">-0.0810397</td>
<td align="right">-0.0810397</td>
</tr>
<tr class="odd">
<td align="left">M09</td>
<td align="right">0.1350662</td>
<td align="right">0.1350662</td>
</tr>
<tr class="even">
<td align="left">M15</td>
<td align="right">0.7833837</td>
<td align="right">0.7833837</td>
</tr>
<tr class="odd">
<td align="left">M06</td>
<td align="right">1.2155954</td>
<td align="right">1.2155954</td>
</tr>
<tr class="even">
<td align="left">M04</td>
<td align="right">1.4317012</td>
<td align="right">1.4317013</td>
</tr>
<tr class="odd">
<td align="left">M01</td>
<td align="right">2.4041775</td>
<td align="right">2.4041776</td>
</tr>
<tr class="even">
<td align="left">M10</td>
<td align="right">3.9169184</td>
<td align="right">3.9169185</td>
</tr>
<tr class="odd">
<td align="left">F10</td>
<td align="right">-3.5853924</td>
<td align="right">-3.5853925</td>
</tr>
<tr class="even">
<td align="left">F09</td>
<td align="right">-1.3162811</td>
<td align="right">-1.3162811</td>
</tr>
<tr class="odd">
<td align="left">F06</td>
<td align="right">-1.3162811</td>
<td align="right">-1.3162811</td>
</tr>
<tr class="even">
<td align="left">F01</td>
<td align="right">-1.1001752</td>
<td align="right">-1.1001752</td>
</tr>
<tr class="odd">
<td align="left">F05</td>
<td align="right">-0.0196460</td>
<td align="right">-0.0196460</td>
</tr>
<tr class="even">
<td align="left">F07</td>
<td align="right">0.3045128</td>
<td align="right">0.3045128</td>
</tr>
<tr class="odd">
<td align="left">F02</td>
<td align="right">0.3045128</td>
<td align="right">0.3045128</td>
</tr>
<tr class="even">
<td align="left">F08</td>
<td align="right">0.6286716</td>
<td align="right">0.6286716</td>
</tr>
<tr class="odd">
<td align="left">F03</td>
<td align="right">0.9528303</td>
<td align="right">0.9528303</td>
</tr>
<tr class="even">
<td align="left">F04</td>
<td align="right">1.9253066</td>
<td align="right">1.9253067</td>
</tr>
<tr class="odd">
<td align="left">F11</td>
<td align="right">3.2219417</td>
<td align="right">3.2219418</td>
</tr>
</tbody>
</table>
<hr />
<div id="covariance-object-used-for-random-effects" class="section level4 hasAnchor" number="6.7.14.1">
<h4><span class="header-section-number">6.7.14.1</span> Covariance object used for random effects<a href="statistical-models.html#covariance-object-used-for-random-effects" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>You print the diagonal matrix you constructed:</p>
<div class="sourceCode" id="cb732"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb732-1"><a href="statistical-models.html#cb732-1" tabindex="-1"></a><span class="fu">head</span>(Lambda_new)</span></code></pre></div>
<table>
<colgroup>
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="right">3.266784</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0.000000</td>
<td align="right">3.266784</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">3.266784</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">3.266784</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">3.266784</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">3.266784</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>In a teaching narrative, this is where you can emphasize:</p>
<ul>
<li>in random intercept models, <span class="math inline">\(\mathbf{G}\)</span> is extremely simple,</li>
<li>all complexity in <span class="math inline">\(\mathbf{V}\)</span> comes from how <span class="math inline">\(\mathbf{Z}\)</span> maps subject membership into the observation-level covariance.</li>
</ul>
<hr />
</div>
</div>
<div id="compute-predicted-values" class="section level3 hasAnchor" number="6.7.15">
<h3><span class="header-section-number">6.7.15</span> Compute predicted values<a href="statistical-models.html#compute-predicted-values" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Conditional fitted values are:</p>
<p><span class="math display">\[
\hat{y}=\mathbf{X}\hat{\beta}+\mathbf{Z}\hat{u}.
\]</span></p>
<p>You compute and compare with <code>fitted()</code>.</p>
<div class="sourceCode" id="cb733"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb733-1"><a href="statistical-models.html#cb733-1" tabindex="-1"></a>yhat <span class="ot">&lt;-</span> X<span class="sc">%*%</span>(bhat)<span class="sc">+</span>Z<span class="sc">%*%</span>(uhat[[<span class="st">&quot;Subject&quot;</span>]][[<span class="st">&quot;(Intercept)&quot;</span>]])</span>
<span id="cb733-2"><a href="statistical-models.html#cb733-2" tabindex="-1"></a><span class="fu">head</span>(yhat)</span></code></pre></div>
<pre><code>## 6 x 1 Matrix of class &quot;dgeMatrix&quot;
##       [,1]
## 1 25.39237
## 2 26.71274
## 3 28.03311
## 4 29.35348
## 5 21.61052
## 6 22.93089</code></pre>
<div class="sourceCode" id="cb735"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb735-1"><a href="statistical-models.html#cb735-1" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">fitted</span>(fit.lmer))</span></code></pre></div>
<pre><code>##        1        2        3        4        5        6 
## 25.39237 26.71274 28.03311 29.35348 21.61052 22.93089</code></pre>
<p>Interpretation:</p>
<ul>
<li><span class="math inline">\(\mathbf{X}\hat{\beta}\)</span> is the population-average prediction,</li>
<li><span class="math inline">\(\mathbf{Z}\hat{u}\)</span> adds subject-specific intercept shifts,</li>
<li><code>fitted(fit.lmer)</code> corresponds to the conditional fitted values under the LMM.</li>
</ul>
<hr />
<div id="key-takeaway" class="section level4 hasAnchor" number="6.7.15.1">
<h4><span class="header-section-number">6.7.15.1</span> Key takeaway<a href="statistical-models.html#key-takeaway" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This random-intercept example is the cleanest case where the entire mixed model machinery reduces to:</p>
<ol style="list-style-type: decimal">
<li>specify <span class="math inline">\(\mathbf{V}=\mathbf{Z}\mathbf{G}\mathbf{Z}&#39;+\sigma^2\mathbf{I}\)</span>,<br />
</li>
<li>compute GLS <span class="math inline">\(\hat{\beta}\)</span>,<br />
</li>
<li>compute BLUP <span class="math inline">\(\hat{u}\)</span>,<br />
</li>
<li>obtain fitted values <span class="math inline">\(\hat{y}=\mathbf{X}\hat{\beta}+\mathbf{Z}\hat{u}\)</span>.</li>
</ol>

</div>
</div>
</div>
<div id="linear-mixed-model-covariance-decomposition-with-random-slopes-lme4" class="section level2 hasAnchor" number="6.8">
<h2><span class="header-section-number">6.8</span> Linear Mixed Model Covariance Decomposition with Random Slopes (lme4)<a href="statistical-models.html#linear-mixed-model-covariance-decomposition-with-random-slopes-lme4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this section, we extend the covariance decomposition of linear mixed models (LMMs) from <strong>random intercept models</strong> to <strong>random slope models</strong>. Allowing random slopes means that, in addition to subject-specific baselines (intercepts), the effect of a covariate (here, age) is also allowed to vary across subjects. This is particularly important in longitudinal and growth-curve settings, where individuals may follow systematically different trajectories over time.</p>
<p>We continue to use the <strong>Orthodont</strong> dataset, a classic longitudinal dataset that records the distance of orthodontic measurements over age, stratified by subject and sex.</p>
<hr />
<div id="load-data-1" class="section level3 hasAnchor" number="6.8.1">
<h3><span class="header-section-number">6.8.1</span> Load data<a href="statistical-models.html#load-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We begin by loading the Orthodont dataset from the <code>nlme</code> package. Each subject has repeated measurements over age, making this dataset well suited for mixed-effects modeling.</p>
<div class="sourceCode" id="cb737"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb737-1"><a href="statistical-models.html#cb737-1" tabindex="-1"></a><span class="fu">data</span>(Orthodont, <span class="at">package=</span><span class="st">&quot;nlme&quot;</span>)</span>
<span id="cb737-2"><a href="statistical-models.html#cb737-2" tabindex="-1"></a>Data <span class="ot">&lt;-</span> Orthodont</span></code></pre></div>
<hr />
</div>
<div id="using-a-linear-mixed-model-with-random-slopes" class="section level3 hasAnchor" number="6.8.2">
<h3><span class="header-section-number">6.8.2</span> Using a linear mixed model with random slopes<a href="statistical-models.html#using-a-linear-mixed-model-with-random-slopes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We now fit a linear mixed model with:
- fixed effects for <strong>age</strong> and <strong>Sex</strong>,
- a <strong>random intercept</strong> for each Subject,
- and a <strong>random slope for age</strong> within each Subject.</p>
<p>Mathematically, this model can be written as</p>
<p><span class="math display">\[
y_{ij} = (\beta_0 + u_{0j}) + (\beta_1 + u_{1j}) \, \text{age}_{ij} + \beta_2 \, \text{Sex}_{ij} + \varepsilon_{ij},
\]</span></p>
<p>where:
- <span class="math inline">\((u_{0j}, u_{1j})\)</span> are subject-specific random effects,
- <span class="math inline">\(\varepsilon_{ij} \sim N(0, \sigma^2)\)</span> are residual errors.</p>
<div class="sourceCode" id="cb738"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb738-1"><a href="statistical-models.html#cb738-1" tabindex="-1"></a><span class="fu">library</span>(lme4) </span>
<span id="cb738-2"><a href="statistical-models.html#cb738-2" tabindex="-1"></a>fit.lmer.slope <span class="ot">&lt;-</span> <span class="fu">lmer</span>(distance <span class="sc">~</span> age <span class="sc">+</span> Sex  <span class="sc">+</span>(<span class="dv">1</span><span class="sc">+</span> age <span class="sc">|</span> Subject), <span class="at">data =</span> Data) </span>
<span id="cb738-3"><a href="statistical-models.html#cb738-3" tabindex="-1"></a><span class="fu">summary</span>(fit.lmer.slope)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: distance ~ age + Sex + (1 + age | Subject)
##    Data: Data
## 
## REML criterion at convergence: 435.2
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.0815 -0.4568  0.0155  0.4471  3.8944 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev. Corr 
##  Subject  (Intercept) 7.82249  2.7969        
##           age         0.05126  0.2264   -0.77
##  Residual             1.71621  1.3100        
## Number of obs: 108, groups:  Subject, 27
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept) 17.63518    0.88623  19.899
## age          0.66019    0.07125   9.265
## SexFemale   -2.14544    0.75746  -2.832
## 
## Correlation of Fixed Effects:
##           (Intr) age   
## age       -0.838       
## SexFemale -0.348  0.000</code></pre>
<p>Although the residual covariance is independent (diagonal), the <strong>random-effects covariance structure</strong> is no longer scalar. Instead, each subject has a <strong>2×2 covariance matrix</strong> corresponding to the random intercept and random slope.</p>
<hr />
</div>
<div id="extracting-the-design-matrices-x-y-and-z" class="section level3 hasAnchor" number="6.8.3">
<h3><span class="header-section-number">6.8.3</span> Extracting the design matrices X, y, and Z<a href="statistical-models.html#extracting-the-design-matrices-x-y-and-z" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To understand the internal structure of the fitted model, we explicitly extract:
- <strong>X</strong>: the fixed-effects design matrix,
- <strong>y</strong>: the response vector,
- <strong>Z</strong>: the random-effects design matrix.</p>
<p>The Z matrix is particularly important here because it now contains <strong>two columns per subject</strong>: one for the random intercept and one for the random slope.</p>
<div class="sourceCode" id="cb740"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb740-1"><a href="statistical-models.html#cb740-1" tabindex="-1"></a>X<span class="ot">=</span>(<span class="fu">getME</span>(fit.lmer.slope, <span class="st">&quot;X&quot;</span>))</span>
<span id="cb740-2"><a href="statistical-models.html#cb740-2" tabindex="-1"></a><span class="fu">head</span>(X)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">(Intercept)</th>
<th align="right">age</th>
<th align="right">SexFemale</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">8</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">10</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">12</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">14</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">8</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">10</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb741"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb741-1"><a href="statistical-models.html#cb741-1" tabindex="-1"></a>y<span class="ot">=</span><span class="fu">getME</span>(fit.lmer.slope, <span class="st">&quot;y&quot;</span>)</span>
<span id="cb741-2"><a href="statistical-models.html#cb741-2" tabindex="-1"></a><span class="fu">head</span>(y)</span></code></pre></div>
<pre><code>## [1] 26.0 25.0 29.0 31.0 21.5 22.5</code></pre>
<div class="sourceCode" id="cb743"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb743-1"><a href="statistical-models.html#cb743-1" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">getME</span>(fit.lmer.slope, <span class="st">&quot;Z&quot;</span>)</span>
<span id="cb743-2"><a href="statistical-models.html#cb743-2" tabindex="-1"></a><span class="fu">head</span>(Z)</span></code></pre></div>
<pre><code>## 6 x 54 sparse Matrix of class &quot;dgCMatrix&quot;</code></pre>
<pre><code>##   [[ suppressing 54 column names &#39;M16&#39;, &#39;M16&#39;, &#39;M05&#39; ... ]]</code></pre>
<pre><code>##                                                                                
## 1 . . . . .  . . . . . . . . . . . . . . . . . . . . . . . 1  8 . . . . . . . .
## 2 . . . . .  . . . . . . . . . . . . . . . . . . . . . . . 1 10 . . . . . . . .
## 3 . . . . .  . . . . . . . . . . . . . . . . . . . . . . . 1 12 . . . . . . . .
## 4 . . . . .  . . . . . . . . . . . . . . . . . . . . . . . 1 14 . . . . . . . .
## 5 . . . . 1  8 . . . . . . . . . . . . . . . . . . . . . . .  . . . . . . . . .
## 6 . . . . 1 10 . . . . . . . . . . . . . . . . . . . . . . .  . . . . . . . . .
##                                  
## 1 . . . . . . . . . . . . . . . .
## 2 . . . . . . . . . . . . . . . .
## 3 . . . . . . . . . . . . . . . .
## 4 . . . . . . . . . . . . . . . .
## 5 . . . . . . . . . . . . . . . .
## 6 . . . . . . . . . . . . . . . .</code></pre>
<div class="sourceCode" id="cb747"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb747-1"><a href="statistical-models.html#cb747-1" tabindex="-1"></a><span class="fu">dim</span>(Z)</span></code></pre></div>
<pre><code>## [1] 108  54</code></pre>
<p>Each block of columns in Z corresponds to one subject, and within each block, the columns represent the intercept and slope contributions.</p>
<hr />
</div>
<div id="fixed-and-random-effect-coefficients" class="section level3 hasAnchor" number="6.8.4">
<h3><span class="header-section-number">6.8.4</span> Fixed and random effect coefficients<a href="statistical-models.html#fixed-and-random-effect-coefficients" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We next extract:
- <span class="math inline">\(\hat{\beta}\)</span>, the estimated fixed-effect coefficients,
- <span class="math inline">\(\hat{u}\)</span>, the estimated random effects (BLUPs).</p>
<p>The random effects are returned as a list indexed by grouping factor.</p>
<div class="sourceCode" id="cb749"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb749-1"><a href="statistical-models.html#cb749-1" tabindex="-1"></a>bhat <span class="ot">&lt;-</span> <span class="fu">getME</span>(fit.lmer.slope, <span class="st">&quot;fixef&quot;</span>) <span class="co"># fixed effects</span></span>
<span id="cb749-2"><a href="statistical-models.html#cb749-2" tabindex="-1"></a>bhat </span></code></pre></div>
<pre><code>## (Intercept)         age   SexFemale 
##  17.6351805   0.6601852  -2.1454431</code></pre>
<div class="sourceCode" id="cb751"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb751-1"><a href="statistical-models.html#cb751-1" tabindex="-1"></a>uhat <span class="ot">&lt;-</span> <span class="fu">ranef</span>(fit.lmer.slope) </span>
<span id="cb751-2"><a href="statistical-models.html#cb751-2" tabindex="-1"></a>uhat</span></code></pre></div>
<pre><code>## $Subject
##     (Intercept)         age
## M16 -0.96698456 -0.06544230
## M05 -2.15621081  0.04447130
## M02 -1.58143839  0.02194874
## M11  0.38737823 -0.13961777
## M07 -1.40307472  0.03606404
## M08  0.37415109 -0.11799495
## M03 -0.83491587  0.02435289
## M12 -1.82593774  0.11594755
## M13 -5.59182087  0.46400729
## M14  0.51944692 -0.04982259
## M09 -1.07941522  0.11835170
## M15 -1.11909663  0.18322017
## M06  1.03469722  0.02495756
## M04  3.20171821 -0.15492789
## M01  0.96194797  0.14388309
## M10  3.04960613  0.09373458
## F10 -2.31273350 -0.13319695
## F09  0.32324282 -0.16262237
## F06 -0.07316594 -0.12598450
## F01  0.11181130 -0.12268061
## F05  1.43310624 -0.14279903
## F07  0.62044804 -0.03708906
## F02 -0.37057384  0.05450561
## F08  2.38444671 -0.16952522
## F03 -0.01384650  0.08273621
## F04  2.30508388 -0.03978828
## F11  2.62212981  0.05331079
## 
## with conditional variances for &quot;Subject&quot;</code></pre>
<p>Each subject now has <strong>two random-effect coefficients</strong>: one intercept deviation and one slope deviation.</p>
<hr />
</div>
<div id="random-effect-covariance-structure-matrix-expansion" class="section level3 hasAnchor" number="6.8.5">
<h3><span class="header-section-number">6.8.5</span> Random-effect covariance structure (matrix expansion)<a href="statistical-models.html#random-effect-covariance-structure-matrix-expansion" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In a random slope model, the random-effects covariance matrix for a single subject is:</p>
<p><span class="math display">\[
\mathbf{G}_{\text{subject}} =
\begin{pmatrix}
\sigma^2_{\text{int}} &amp; \sigma_{\text{int,slope}} \\
\sigma_{\text{int,slope}} &amp; \sigma^2_{\text{slope}}
\end{pmatrix}.
\]</span></p>
<p>The full covariance matrix <span class="math inline">\(\mathbf{G}\)</span> is block-diagonal, with one such matrix per subject. We explicitly construct this block-diagonal matrix using <code>bdiag()</code>.</p>
<div class="sourceCode" id="cb753"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb753-1"><a href="statistical-models.html#cb753-1" tabindex="-1"></a>vc <span class="ot">&lt;-</span> <span class="fu">VarCorr</span>(fit.lmer.slope)</span>
<span id="cb753-2"><a href="statistical-models.html#cb753-2" tabindex="-1"></a>Lambda_new <span class="ot">&lt;-</span> <span class="fu">bdiag</span>(<span class="fu">replicate</span>(<span class="fu">length</span>(<span class="fu">levels</span>(Data<span class="sc">$</span>Subject)), vc[[<span class="st">&quot;Subject&quot;</span>]], <span class="at">simplify =</span> <span class="cn">FALSE</span>))</span>
<span id="cb753-3"><a href="statistical-models.html#cb753-3" tabindex="-1"></a><span class="fu">head</span>(Lambda_new)</span></code></pre></div>
<pre><code>## 6 x 54 sparse Matrix of class &quot;dgCMatrix&quot;
##                                                                               
## [1,]  7.822487 -0.48495997  .         .           .         .          . . . .
## [2,] -0.484960  0.05126495  .         .           .         .          . . . .
## [3,]  .         .           7.822487 -0.48495997  .         .          . . . .
## [4,]  .         .          -0.484960  0.05126495  .         .          . . . .
## [5,]  .         .           .         .           7.822487 -0.48495997 . . . .
## [6,]  .         .           .         .          -0.484960  0.05126495 . . . .
##                                                                               
## [1,] . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
## [2,] . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
## [3,] . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
## [4,] . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
## [5,] . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
## [6,] . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
##                   
## [1,] . . . . . . .
## [2,] . . . . . . .
## [3,] . . . . . . .
## [4,] . . . . . . .
## [5,] . . . . . . .
## [6,] . . . . . . .</code></pre>
<div class="sourceCode" id="cb755"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb755-1"><a href="statistical-models.html#cb755-1" tabindex="-1"></a><span class="fu">dim</span>(Lambda_new)</span></code></pre></div>
<pre><code>## [1] 54 54</code></pre>
<p>Here:
- <code>VarCorr()</code> provides the estimated standard deviations and correlations,
- <code>bdiag()</code> assembles the subject-specific covariance matrices into a global random-effects covariance matrix.</p>
<blockquote>
<p><strong>Note</strong><br />
In <code>lme4</code>, the internal parameters <code>theta</code> correspond to the Cholesky factors of these covariance matrices. Given <code>theta</code>, the full covariance matrix is reconstructed implicitly.</p>
</blockquote>
<hr />
</div>
<div id="residual-variance-and-identity-matrix" class="section level3 hasAnchor" number="6.8.6">
<h3><span class="header-section-number">6.8.6</span> Residual variance and identity matrix<a href="statistical-models.html#residual-variance-and-identity-matrix" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The residual errors are assumed independent with variance <span class="math inline">\(\sigma^2\)</span>. We extract <span class="math inline">\(\sigma^2\)</span> and explicitly form <span class="math inline">\(\sigma^2 I\)</span>.</p>
<div class="sourceCode" id="cb757"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb757-1"><a href="statistical-models.html#cb757-1" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">getME</span>(fit.lmer.slope, <span class="st">&quot;sigma&quot;</span>)<span class="sc">**</span><span class="dv">2</span> </span>
<span id="cb757-2"><a href="statistical-models.html#cb757-2" tabindex="-1"></a>sigma</span></code></pre></div>
<pre><code>## [1] 1.71621</code></pre>
<div class="sourceCode" id="cb759"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb759-1"><a href="statistical-models.html#cb759-1" tabindex="-1"></a><span class="fu">head</span>(sigma<span class="sc">*</span><span class="fu">diag</span>(<span class="fu">nrow</span>(Data)))</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="right">1.71621</td>
<td align="right">0.00000</td>
<td align="right">0.00000</td>
<td align="right">0.00000</td>
<td align="right">0.00000</td>
<td align="right">0.00000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0.00000</td>
<td align="right">1.71621</td>
<td align="right">0.00000</td>
<td align="right">0.00000</td>
<td align="right">0.00000</td>
<td align="right">0.00000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">0.00000</td>
<td align="right">0.00000</td>
<td align="right">1.71621</td>
<td align="right">0.00000</td>
<td align="right">0.00000</td>
<td align="right">0.00000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0.00000</td>
<td align="right">0.00000</td>
<td align="right">0.00000</td>
<td align="right">1.71621</td>
<td align="right">0.00000</td>
<td align="right">0.00000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">0.00000</td>
<td align="right">0.00000</td>
<td align="right">0.00000</td>
<td align="right">0.00000</td>
<td align="right">1.71621</td>
<td align="right">0.00000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0.00000</td>
<td align="right">0.00000</td>
<td align="right">0.00000</td>
<td align="right">0.00000</td>
<td align="right">0.00000</td>
<td align="right">1.71621</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<hr />
</div>
<div id="covariance-matrix-of-the-response-vector-y" class="section level3 hasAnchor" number="6.8.7">
<h3><span class="header-section-number">6.8.7</span> Covariance matrix of the response vector y<a href="statistical-models.html#covariance-matrix-of-the-response-vector-y" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The marginal covariance of <span class="math inline">\(\mathbf{y}\)</span> is:</p>
<p><span class="math display">\[
\mathbf{V} = \mathbf{Z G Z}^\top + \sigma^2 \mathbf{I}.
\]</span></p>
<p>We compute this matrix explicitly.</p>
<div class="sourceCode" id="cb760"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb760-1"><a href="statistical-models.html#cb760-1" tabindex="-1"></a>VM <span class="ot">&lt;-</span> Z<span class="sc">%*%</span>Lambda_new<span class="sc">%*%</span><span class="fu">t</span>(Z)<span class="sc">+</span>sigma<span class="sc">*</span><span class="fu">diag</span>(<span class="fu">nrow</span>(Data)) </span>
<span id="cb760-2"><a href="statistical-models.html#cb760-2" tabindex="-1"></a><span class="fu">head</span>(VM)</span></code></pre></div>
<pre><code>## 6 x 108 sparse Matrix of class &quot;dgCMatrix&quot;</code></pre>
<pre><code>##   [[ suppressing 108 column names &#39;1&#39;, &#39;2&#39;, &#39;3&#39; ... ]]</code></pre>
<pre><code>##                                                                                
## 1 5.060294 3.194403 3.044722 2.895042 .        .        .        .        . . .
## 2 3.194403 4.965992 3.305161 3.360540 .        .        .        .        . . .
## 3 3.044722 3.305161 5.281810 3.826039 .        .        .        .        . . .
## 4 2.895042 3.360540 3.826039 6.007747 .        .        .        .        . . .
## 5 .        .        .        .        5.060294 3.194403 3.044722 2.895042 . . .
## 6 .        .        .        .        3.194403 4.965992 3.305161 3.360540 . . .
##                                                                                
## 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
## 2 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
## 3 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
## 4 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
## 5 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
## 6 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
##                                                                                
## 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
## 2 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
## 3 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
## 4 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
## 5 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
## 6 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
##                                        
## 1 . . . . . . . . . . . . . . . . . . .
## 2 . . . . . . . . . . . . . . . . . . .
## 3 . . . . . . . . . . . . . . . . . . .
## 4 . . . . . . . . . . . . . . . . . . .
## 5 . . . . . . . . . . . . . . . . . . .
## 6 . . . . . . . . . . . . . . . . . . .</code></pre>
<div class="sourceCode" id="cb764"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb764-1"><a href="statistical-models.html#cb764-1" tabindex="-1"></a><span class="fu">dim</span>(VM)</span></code></pre></div>
<pre><code>## [1] 108 108</code></pre>
<p>This matrix fully characterizes the dependence structure induced by the random intercepts and random slopes.</p>
<hr />
</div>
<div id="covariance-matrix-of-fixed-effect-coefficients" class="section level3 hasAnchor" number="6.8.8">
<h3><span class="header-section-number">6.8.8</span> Covariance matrix of fixed-effect coefficients<a href="statistical-models.html#covariance-matrix-of-fixed-effect-coefficients" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The covariance matrix of <span class="math inline">\(\hat{\beta}\)</span> is given by:</p>
<p><span class="math display">\[
\operatorname{Var}(\hat{\beta}) = (\mathbf{X}^\top \mathbf{V}^{-1} \mathbf{X})^{-1}.
\]</span></p>
<p>We confirm that this matches the output from <code>vcov()</code>.</p>
<div class="sourceCode" id="cb766"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb766-1"><a href="statistical-models.html#cb766-1" tabindex="-1"></a>vcov <span class="ot">&lt;-</span> <span class="fu">vcov</span>(fit.lmer.slope) <span class="co"># fixed-effect covariance</span></span>
<span id="cb766-2"><a href="statistical-models.html#cb766-2" tabindex="-1"></a>vcov</span></code></pre></div>
<pre><code>## 3 x 3 Matrix of class &quot;dpoMatrix&quot;
##             (Intercept)           age     SexFemale
## (Intercept)  0.78540227 -5.292131e-02 -2.337501e-01
## age         -0.05292131  5.076869e-03 -5.668086e-16
## SexFemale   -0.23375009 -5.668086e-16  5.737502e-01</code></pre>
<div class="sourceCode" id="cb768"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb768-1"><a href="statistical-models.html#cb768-1" tabindex="-1"></a><span class="co"># compute correlation coefficient</span></span>
<span id="cb768-2"><a href="statistical-models.html#cb768-2" tabindex="-1"></a>vcov<span class="sc">@</span>x[<span class="dv">2</span>]<span class="sc">/</span><span class="fu">prod</span>(<span class="fu">sqrt</span>( <span class="fu">diag</span>(<span class="fu">vcov</span>(fit.lmer.slope))[<span class="sc">-</span><span class="dv">3</span>] ))</span></code></pre></div>
<pre><code>## [1] -0.8380822</code></pre>
<hr />
</div>
<div id="random-effect-covariance-matrix" class="section level3 hasAnchor" number="6.8.9">
<h3><span class="header-section-number">6.8.9</span> Random-effect covariance matrix<a href="statistical-models.html#random-effect-covariance-matrix" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The block-diagonal random-effects covariance matrix can also be extracted directly.</p>
<div class="sourceCode" id="cb770"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb770-1"><a href="statistical-models.html#cb770-1" tabindex="-1"></a>vc <span class="ot">&lt;-</span> <span class="fu">VarCorr</span>(fit.lmer.slope) </span>
<span id="cb770-2"><a href="statistical-models.html#cb770-2" tabindex="-1"></a>vc <span class="do">## standard deviations and correlations</span></span></code></pre></div>
<pre><code>##  Groups   Name        Std.Dev. Corr  
##  Subject  (Intercept) 2.79687        
##           age         0.22642  -0.766
##  Residual             1.31004</code></pre>
<div class="sourceCode" id="cb772"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb772-1"><a href="statistical-models.html#cb772-1" tabindex="-1"></a><span class="fu">as.matrix</span>(Matrix<span class="sc">::</span><span class="fu">bdiag</span>(vc)) <span class="co"># random-effect covariance matrix</span></span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">(Intercept)</th>
<th align="right">age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">7.822487</td>
<td align="right">-0.4849600</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">-0.484960</td>
<td align="right">0.0512649</td>
</tr>
</tbody>
</table>
<hr />
</div>
<div id="computing-fixed-effect-coefficients-manually" class="section level3 hasAnchor" number="6.8.10">
<h3><span class="header-section-number">6.8.10</span> Computing fixed-effect coefficients manually<a href="statistical-models.html#computing-fixed-effect-coefficients-manually" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Using the generalized least squares (GLS) formula,</p>
<p><span class="math display">\[
\hat{\beta} = (\mathbf{X}^\top \mathbf{V}^{-1} \mathbf{X})^{-1}\mathbf{X}^\top \mathbf{V}^{-1}\mathbf{y},
\]</span></p>
<p>we compute <span class="math inline">\(\hat{\beta}\)</span> explicitly and verify it matches the model output.</p>
<div class="sourceCode" id="cb773"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb773-1"><a href="statistical-models.html#cb773-1" tabindex="-1"></a><span class="fu">library</span>(matlib)</span>
<span id="cb773-2"><a href="statistical-models.html#cb773-2" tabindex="-1"></a><span class="fu">inv</span>(<span class="fu">t</span>(<span class="fu">as.matrix</span>(X))<span class="sc">%*%</span><span class="fu">inv</span>(<span class="fu">as.matrix</span>(VM))<span class="sc">%*%</span><span class="fu">as.matrix</span>(X))<span class="sc">%*%</span><span class="fu">t</span>(<span class="fu">as.matrix</span>(X))<span class="sc">%*%</span><span class="fu">inv</span>(<span class="fu">as.matrix</span>(VM))<span class="sc">%*%</span>y</span></code></pre></div>
<table>
<tbody>
<tr class="odd">
<td align="right">17.635190</td>
</tr>
<tr class="even">
<td align="right">0.660189</td>
</tr>
<tr class="odd">
<td align="right">-2.145444</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb774"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb774-1"><a href="statistical-models.html#cb774-1" tabindex="-1"></a>bhat</span></code></pre></div>
<pre><code>## (Intercept)         age   SexFemale 
##  17.6351805   0.6601852  -2.1454431</code></pre>
<hr />
</div>
<div id="covariance-of-fixed-effect-coefficients" class="section level3 hasAnchor" number="6.8.11">
<h3><span class="header-section-number">6.8.11</span> Covariance of fixed-effect coefficients<a href="statistical-models.html#covariance-of-fixed-effect-coefficients" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We also compute the covariance matrix and standard errors manually.</p>
<div class="sourceCode" id="cb776"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb776-1"><a href="statistical-models.html#cb776-1" tabindex="-1"></a><span class="fu">inv</span>(<span class="fu">t</span>(<span class="fu">as.matrix</span>(X))<span class="sc">%*%</span><span class="fu">inv</span>(<span class="fu">as.matrix</span>(VM))<span class="sc">%*%</span><span class="fu">as.matrix</span>(X))</span></code></pre></div>
<table>
<tbody>
<tr class="odd">
<td align="right">0.7854023</td>
<td align="right">-0.0529213</td>
<td align="right">-0.2337501</td>
</tr>
<tr class="even">
<td align="right">-0.0529213</td>
<td align="right">0.0050769</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="right">-0.2337501</td>
<td align="right">0.0000000</td>
<td align="right">0.5737502</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb777"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb777-1"><a href="statistical-models.html#cb777-1" tabindex="-1"></a><span class="co"># standard errors</span></span>
<span id="cb777-2"><a href="statistical-models.html#cb777-2" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">inv</span>(<span class="fu">t</span>(<span class="fu">as.matrix</span>(X))<span class="sc">%*%</span><span class="fu">inv</span>(<span class="fu">as.matrix</span>(VM))<span class="sc">%*%</span><span class="fu">as.matrix</span>(X)))</span></code></pre></div>
<pre><code>## Warning in sqrt(inv(t(as.matrix(X)) %*% inv(as.matrix(VM)) %*% as.matrix(X))):
## NaNs produced</code></pre>
<table>
<tbody>
<tr class="odd">
<td align="right">0.8862292</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="right">NaN</td>
<td align="right">0.0712522</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="right">NaN</td>
<td align="right">0.0000000</td>
<td align="right">0.757463</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb779"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb779-1"><a href="statistical-models.html#cb779-1" tabindex="-1"></a><span class="co"># matches lmer output</span></span>
<span id="cb779-2"><a href="statistical-models.html#cb779-2" tabindex="-1"></a><span class="fu">vcov</span>(fit.lmer.slope) </span></code></pre></div>
<pre><code>## 3 x 3 Matrix of class &quot;dpoMatrix&quot;
##             (Intercept)           age     SexFemale
## (Intercept)  0.78540227 -5.292131e-02 -2.337501e-01
## age         -0.05292131  5.076869e-03 -5.668086e-16
## SexFemale   -0.23375009 -5.668086e-16  5.737502e-01</code></pre>
<div class="sourceCode" id="cb781"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb781-1"><a href="statistical-models.html#cb781-1" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">vcov</span>(fit.lmer.slope))</span></code></pre></div>
<pre><code>## Warning in g({: NaNs produced</code></pre>
<pre><code>## 3 x 3 Matrix of class &quot;dsyMatrix&quot;
##             (Intercept)        age SexFemale
## (Intercept)   0.8862292        NaN       NaN
## age                 NaN 0.07125215       NaN
## SexFemale           NaN        NaN  0.757463</code></pre>
<hr />
</div>
<div id="computing-random-effect-coefficients" class="section level3 hasAnchor" number="6.8.12">
<h3><span class="header-section-number">6.8.12</span> Computing random-effect coefficients<a href="statistical-models.html#computing-random-effect-coefficients" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The BLUPs of the random effects are given by:</p>
<p><span class="math display">\[
\hat{\mathbf{u}} = \mathbf{GZ}^\top \mathbf{V}^{-1} (\mathbf{y} - \mathbf{X}\hat{\beta}).
\]</span></p>
<p>We compute these manually and compare them with <code>ranef()</code>.</p>
<div class="sourceCode" id="cb784"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb784-1"><a href="statistical-models.html#cb784-1" tabindex="-1"></a>comput_uhat <span class="ot">&lt;-</span> (<span class="fu">as.matrix</span>(Lambda_new))<span class="sc">%*%</span><span class="fu">t</span>(Z)<span class="sc">%*%</span><span class="fu">inv</span>(<span class="fu">as.matrix</span>(VM))<span class="sc">%*%</span>(y<span class="sc">-</span><span class="fu">as.matrix</span>(X)<span class="sc">%*%</span>(bhat))</span>
<span id="cb784-2"><a href="statistical-models.html#cb784-2" tabindex="-1"></a><span class="fu">cbind</span>((comput_uhat<span class="sc">@</span>x),(uhat[[<span class="st">&quot;Subject&quot;</span>]]))</span></code></pre></div>
<pre><code>## Warning in data.frame(..., check.names = FALSE): row names were found from a
## short variable and have been discarded</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">(<a href="mailto:comput_uhat@x" class="email">comput_uhat@x</a>)</th>
<th align="right">(Intercept)</th>
<th align="right">age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">-0.9669845</td>
<td align="right">-0.9669846</td>
<td align="right">-0.0654423</td>
</tr>
<tr class="even">
<td align="right">-0.0654423</td>
<td align="right">-2.1562108</td>
<td align="right">0.0444713</td>
</tr>
<tr class="odd">
<td align="right">-2.1562108</td>
<td align="right">-1.5814384</td>
<td align="right">0.0219487</td>
</tr>
<tr class="even">
<td align="right">0.0444713</td>
<td align="right">0.3873782</td>
<td align="right">-0.1396178</td>
</tr>
<tr class="odd">
<td align="right">-1.5814383</td>
<td align="right">-1.4030747</td>
<td align="right">0.0360640</td>
</tr>
<tr class="even">
<td align="right">0.0219487</td>
<td align="right">0.3741511</td>
<td align="right">-0.1179949</td>
</tr>
<tr class="odd">
<td align="right">0.3873782</td>
<td align="right">-0.8349159</td>
<td align="right">0.0243529</td>
</tr>
<tr class="even">
<td align="right">-0.1396178</td>
<td align="right">-1.8259377</td>
<td align="right">0.1159476</td>
</tr>
<tr class="odd">
<td align="right">-1.4030747</td>
<td align="right">-5.5918209</td>
<td align="right">0.4640073</td>
</tr>
<tr class="even">
<td align="right">0.0360640</td>
<td align="right">0.5194469</td>
<td align="right">-0.0498226</td>
</tr>
<tr class="odd">
<td align="right">0.3741511</td>
<td align="right">-1.0794152</td>
<td align="right">0.1183517</td>
</tr>
<tr class="even">
<td align="right">-0.1179950</td>
<td align="right">-1.1190966</td>
<td align="right">0.1832202</td>
</tr>
<tr class="odd">
<td align="right">-0.8349158</td>
<td align="right">1.0346972</td>
<td align="right">0.0249576</td>
</tr>
<tr class="even">
<td align="right">0.0243529</td>
<td align="right">3.2017182</td>
<td align="right">-0.1549279</td>
</tr>
<tr class="odd">
<td align="right">-1.8259377</td>
<td align="right">0.9619480</td>
<td align="right">0.1438831</td>
</tr>
<tr class="even">
<td align="right">0.1159476</td>
<td align="right">3.0496061</td>
<td align="right">0.0937346</td>
</tr>
<tr class="odd">
<td align="right">-5.5918208</td>
<td align="right">-2.3127335</td>
<td align="right">-0.1331970</td>
</tr>
<tr class="even">
<td align="right">0.4640073</td>
<td align="right">0.3232428</td>
<td align="right">-0.1626224</td>
</tr>
<tr class="odd">
<td align="right">0.5194469</td>
<td align="right">-0.0731659</td>
<td align="right">-0.1259845</td>
</tr>
<tr class="even">
<td align="right">-0.0498226</td>
<td align="right">0.1118113</td>
<td align="right">-0.1226806</td>
</tr>
<tr class="odd">
<td align="right">-1.0794152</td>
<td align="right">1.4331062</td>
<td align="right">-0.1427990</td>
</tr>
<tr class="even">
<td align="right">0.1183517</td>
<td align="right">0.6204480</td>
<td align="right">-0.0370891</td>
</tr>
<tr class="odd">
<td align="right">-1.1190966</td>
<td align="right">-0.3705738</td>
<td align="right">0.0545056</td>
</tr>
<tr class="even">
<td align="right">0.1832202</td>
<td align="right">2.3844467</td>
<td align="right">-0.1695252</td>
</tr>
<tr class="odd">
<td align="right">1.0346972</td>
<td align="right">-0.0138465</td>
<td align="right">0.0827362</td>
</tr>
<tr class="even">
<td align="right">0.0249576</td>
<td align="right">2.3050839</td>
<td align="right">-0.0397883</td>
</tr>
<tr class="odd">
<td align="right">3.2017181</td>
<td align="right">2.6221298</td>
<td align="right">0.0533108</td>
</tr>
<tr class="even">
<td align="right">-0.1549279</td>
<td align="right">-0.9669846</td>
<td align="right">-0.0654423</td>
</tr>
<tr class="odd">
<td align="right">0.9619480</td>
<td align="right">-2.1562108</td>
<td align="right">0.0444713</td>
</tr>
<tr class="even">
<td align="right">0.1438831</td>
<td align="right">-1.5814384</td>
<td align="right">0.0219487</td>
</tr>
<tr class="odd">
<td align="right">3.0496061</td>
<td align="right">0.3873782</td>
<td align="right">-0.1396178</td>
</tr>
<tr class="even">
<td align="right">0.0937346</td>
<td align="right">-1.4030747</td>
<td align="right">0.0360640</td>
</tr>
<tr class="odd">
<td align="right">-2.3127334</td>
<td align="right">0.3741511</td>
<td align="right">-0.1179949</td>
</tr>
<tr class="even">
<td align="right">-0.1331970</td>
<td align="right">-0.8349159</td>
<td align="right">0.0243529</td>
</tr>
<tr class="odd">
<td align="right">0.3232428</td>
<td align="right">-1.8259377</td>
<td align="right">0.1159476</td>
</tr>
<tr class="even">
<td align="right">-0.1626224</td>
<td align="right">-5.5918209</td>
<td align="right">0.4640073</td>
</tr>
<tr class="odd">
<td align="right">-0.0731659</td>
<td align="right">0.5194469</td>
<td align="right">-0.0498226</td>
</tr>
<tr class="even">
<td align="right">-0.1259845</td>
<td align="right">-1.0794152</td>
<td align="right">0.1183517</td>
</tr>
<tr class="odd">
<td align="right">0.1118113</td>
<td align="right">-1.1190966</td>
<td align="right">0.1832202</td>
</tr>
<tr class="even">
<td align="right">-0.1226806</td>
<td align="right">1.0346972</td>
<td align="right">0.0249576</td>
</tr>
<tr class="odd">
<td align="right">1.4331062</td>
<td align="right">3.2017182</td>
<td align="right">-0.1549279</td>
</tr>
<tr class="even">
<td align="right">-0.1427990</td>
<td align="right">0.9619480</td>
<td align="right">0.1438831</td>
</tr>
<tr class="odd">
<td align="right">0.6204480</td>
<td align="right">3.0496061</td>
<td align="right">0.0937346</td>
</tr>
<tr class="even">
<td align="right">-0.0370891</td>
<td align="right">-2.3127335</td>
<td align="right">-0.1331970</td>
</tr>
<tr class="odd">
<td align="right">-0.3705738</td>
<td align="right">0.3232428</td>
<td align="right">-0.1626224</td>
</tr>
<tr class="even">
<td align="right">0.0545056</td>
<td align="right">-0.0731659</td>
<td align="right">-0.1259845</td>
</tr>
<tr class="odd">
<td align="right">2.3844467</td>
<td align="right">0.1118113</td>
<td align="right">-0.1226806</td>
</tr>
<tr class="even">
<td align="right">-0.1695252</td>
<td align="right">1.4331062</td>
<td align="right">-0.1427990</td>
</tr>
<tr class="odd">
<td align="right">-0.0138465</td>
<td align="right">0.6204480</td>
<td align="right">-0.0370891</td>
</tr>
<tr class="even">
<td align="right">0.0827362</td>
<td align="right">-0.3705738</td>
<td align="right">0.0545056</td>
</tr>
<tr class="odd">
<td align="right">2.3050838</td>
<td align="right">2.3844467</td>
<td align="right">-0.1695252</td>
</tr>
<tr class="even">
<td align="right">-0.0397883</td>
<td align="right">-0.0138465</td>
<td align="right">0.0827362</td>
</tr>
<tr class="odd">
<td align="right">2.6221297</td>
<td align="right">2.3050839</td>
<td align="right">-0.0397883</td>
</tr>
<tr class="even">
<td align="right">0.0533108</td>
<td align="right">2.6221298</td>
<td align="right">0.0533108</td>
</tr>
</tbody>
</table>
<hr />
</div>
<div id="predicted-values" class="section level3 hasAnchor" number="6.8.13">
<h3><span class="header-section-number">6.8.13</span> Predicted values<a href="statistical-models.html#predicted-values" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Predicted values are obtained by combining fixed and random components:</p>
<p><span class="math display">\[
\hat{\mathbf{y}} = \mathbf{X}\hat{\beta} + \mathbf{Z}\hat{\mathbf{u}}.
\]</span></p>
<div class="sourceCode" id="cb786"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb786-1"><a href="statistical-models.html#cb786-1" tabindex="-1"></a>yhat <span class="ot">&lt;-</span> X<span class="sc">%*%</span>(bhat)<span class="sc">+</span>Z<span class="sc">%*%</span>comput_uhat</span>
<span id="cb786-2"><a href="statistical-models.html#cb786-2" tabindex="-1"></a><span class="fu">head</span>(yhat)</span></code></pre></div>
<pre><code>## 6 x 1 Matrix of class &quot;dgeMatrix&quot;
##       [,1]
## 1 25.02967
## 2 26.63781
## 3 28.24595
## 4 29.85408
## 5 21.51081
## 6 22.87508</code></pre>
<div class="sourceCode" id="cb788"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb788-1"><a href="statistical-models.html#cb788-1" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">fitted</span>(fit.lmer.slope))</span></code></pre></div>
<pre><code>##        1        2        3        4        5        6 
## 25.02967 26.63781 28.24595 29.85408 21.51081 22.87508</code></pre>
<hr />
</div>
<div id="model-with-two-grouping-factors" class="section level3 hasAnchor" number="6.8.14">
<h3><span class="header-section-number">6.8.14</span> Model with two grouping factors<a href="statistical-models.html#model-with-two-grouping-factors" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We now illustrate a model with <strong>two random-effect grouping factors</strong>, adding a random intercept for <code>age</code> as well.</p>
<div class="sourceCode" id="cb790"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb790-1"><a href="statistical-models.html#cb790-1" tabindex="-1"></a><span class="fu">library</span>(lme4) </span>
<span id="cb790-2"><a href="statistical-models.html#cb790-2" tabindex="-1"></a>fit.lmer.slope2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(distance <span class="sc">~</span> age <span class="sc">+</span> Sex  <span class="sc">+</span>(<span class="dv">1</span><span class="sc">+</span> age <span class="sc">|</span> Subject)<span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> age), <span class="at">data =</span> Data) </span></code></pre></div>
<pre><code>## boundary (singular) fit: see help(&#39;isSingular&#39;)</code></pre>
<div class="sourceCode" id="cb792"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb792-1"><a href="statistical-models.html#cb792-1" tabindex="-1"></a><span class="fu">summary</span>(fit.lmer.slope2)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: distance ~ age + Sex + (1 + age | Subject) + (1 | age)
##    Data: Data
## 
## REML criterion at convergence: 435.2
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.0821 -0.4568  0.0154  0.4471  3.8942 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev. Corr 
##  Subject  (Intercept) 7.81589  2.7957        
##           age         0.05122  0.2263   -0.77
##  age      (Intercept) 0.00000  0.0000        
##  Residual             1.71643  1.3101        
## Number of obs: 108, groups:  Subject, 27; age, 4
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept) 17.63511    0.88612  19.902
## age          0.66019    0.07124   9.267
## SexFemale   -2.14527    0.75745  -2.832
## 
## Correlation of Fixed Effects:
##           (Intr) age   
## age       -0.838       
## SexFemale -0.348  0.000
## optimizer (nloptwrap) convergence code: 0 (OK)
## boundary (singular) fit: see help(&#39;isSingular&#39;)</code></pre>
<hr />
</div>
<div id="extracting-z-for-the-two-factor-model" class="section level3 hasAnchor" number="6.8.15">
<h3><span class="header-section-number">6.8.15</span> Extracting Z for the two-factor model<a href="statistical-models.html#extracting-z-for-the-two-factor-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here, the Z matrix expands accordingly. The dimension reflects the combined random effects.</p>
<div class="sourceCode" id="cb794"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb794-1"><a href="statistical-models.html#cb794-1" tabindex="-1"></a>Z2 <span class="ot">&lt;-</span> <span class="fu">getME</span>(fit.lmer.slope2, <span class="st">&quot;Z&quot;</span>)</span>
<span id="cb794-2"><a href="statistical-models.html#cb794-2" tabindex="-1"></a><span class="fu">head</span>(Z2,<span class="dv">10</span>)</span></code></pre></div>
<pre><code>## 10 x 58 sparse Matrix of class &quot;dgCMatrix&quot;</code></pre>
<pre><code>##   [[ suppressing 58 column names &#39;M16&#39;, &#39;M16&#39;, &#39;M05&#39; ... ]]</code></pre>
<pre><code>##                                                                                
## 1  . . . . .  . . . . . . . .  . . . . . . . . . . . . . . . 1  8 . . . . . . .
## 2  . . . . .  . . . . . . . .  . . . . . . . . . . . . . . . 1 10 . . . . . . .
## 3  . . . . .  . . . . . . . .  . . . . . . . . . . . . . . . 1 12 . . . . . . .
## 4  . . . . .  . . . . . . . .  . . . . . . . . . . . . . . . 1 14 . . . . . . .
## 5  . . . . 1  8 . . . . . . .  . . . . . . . . . . . . . . . .  . . . . . . . .
## 6  . . . . 1 10 . . . . . . .  . . . . . . . . . . . . . . . .  . . . . . . . .
## 7  . . . . 1 12 . . . . . . .  . . . . . . . . . . . . . . . .  . . . . . . . .
## 8  . . . . 1 14 . . . . . . .  . . . . . . . . . . . . . . . .  . . . . . . . .
## 9  . . . . .  . . . . . . . 1  8 . . . . . . . . . . . . . . .  . . . . . . . .
## 10 . . . . .  . . . . . . . 1 10 . . . . . . . . . . . . . . .  . . . . . . . .
##                                             
## 1  . . . . . . . . . . . . . . . . . 1 . . .
## 2  . . . . . . . . . . . . . . . . . . 1 . .
## 3  . . . . . . . . . . . . . . . . . . . 1 .
## 4  . . . . . . . . . . . . . . . . . . . . 1
## 5  . . . . . . . . . . . . . . . . . 1 . . .
## 6  . . . . . . . . . . . . . . . . . . 1 . .
## 7  . . . . . . . . . . . . . . . . . . . 1 .
## 8  . . . . . . . . . . . . . . . . . . . . 1
## 9  . . . . . . . . . . . . . . . . . 1 . . .
## 10 . . . . . . . . . . . . . . . . . . 1 . .</code></pre>
<div class="sourceCode" id="cb798"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb798-1"><a href="statistical-models.html#cb798-1" tabindex="-1"></a><span class="fu">dim</span>(Z2)</span></code></pre></div>
<pre><code>## [1] 108  58</code></pre>
<hr />
</div>
<div id="nested-versus-crossed-random-effects" class="section level3 hasAnchor" number="6.8.16">
<h3><span class="header-section-number">6.8.16</span> Nested versus crossed random effects<a href="statistical-models.html#nested-versus-crossed-random-effects" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Finally, we demonstrate a nested random-effects structure, where subjects are nested within sex.</p>
<div class="sourceCode" id="cb800"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb800-1"><a href="statistical-models.html#cb800-1" tabindex="-1"></a><span class="fu">library</span>(lme4) </span>
<span id="cb800-2"><a href="statistical-models.html#cb800-2" tabindex="-1"></a>fit.lmer.slope3 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(distance <span class="sc">~</span> age <span class="sc">+</span> Sex  <span class="sc">+</span>(<span class="dv">1</span> <span class="sc">|</span> Sex<span class="sc">/</span>Subject), <span class="at">data =</span> Data) </span></code></pre></div>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl = control$checkConv, : Model is nearly unidentifiable: large eigenvalue ratio
##  - Rescale variables?</code></pre>
<div class="sourceCode" id="cb802"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb802-1"><a href="statistical-models.html#cb802-1" tabindex="-1"></a><span class="fu">summary</span>(fit.lmer.slope3)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: distance ~ age + Sex + (1 | Sex/Subject)
##    Data: Data
## 
## REML criterion at convergence: 437.5
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.7489 -0.5503 -0.0252  0.4534  3.6575 
## 
## Random effects:
##  Groups      Name        Variance Std.Dev.
##  Subject:Sex (Intercept) 3.2668   1.8074  
##  Sex         (Intercept) 0.9392   0.9691  
##  Residual                2.0495   1.4316  
## Number of obs: 108, groups:  Subject:Sex, 27; Sex, 2
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept) 17.70671    1.27852   13.85
## age          0.66019    0.06161   10.72
## SexFemale   -2.32102    1.56785   -1.48
## 
## Correlation of Fixed Effects:
##           (Intr) age   
## age       -0.530       
## SexFemale -0.586  0.000
## optimizer (nloptwrap) convergence code: 0 (OK)
## Model is nearly unidentifiable: large eigenvalue ratio
##  - Rescale variables?</code></pre>
<p>The corresponding Z matrix reflects this nesting.</p>
<div class="sourceCode" id="cb804"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb804-1"><a href="statistical-models.html#cb804-1" tabindex="-1"></a>Z3 <span class="ot">&lt;-</span> <span class="fu">getME</span>(fit.lmer.slope3, <span class="st">&quot;Z&quot;</span>)</span>
<span id="cb804-2"><a href="statistical-models.html#cb804-2" tabindex="-1"></a><span class="fu">head</span>(Z3,<span class="dv">10</span>)</span></code></pre></div>
<pre><code>## 10 x 29 sparse Matrix of class &quot;dgCMatrix&quot;</code></pre>
<pre><code>##   [[ suppressing 29 column names &#39;M16:Male&#39;, &#39;M05:Male&#39;, &#39;M02:Male&#39; ... ]]</code></pre>
<pre><code>##                                                             
## 1  . . . . . . . . . . . . . . 1 . . . . . . . . . . . . 1 .
## 2  . . . . . . . . . . . . . . 1 . . . . . . . . . . . . 1 .
## 3  . . . . . . . . . . . . . . 1 . . . . . . . . . . . . 1 .
## 4  . . . . . . . . . . . . . . 1 . . . . . . . . . . . . 1 .
## 5  . . 1 . . . . . . . . . . . . . . . . . . . . . . . . 1 .
## 6  . . 1 . . . . . . . . . . . . . . . . . . . . . . . . 1 .
## 7  . . 1 . . . . . . . . . . . . . . . . . . . . . . . . 1 .
## 8  . . 1 . . . . . . . . . . . . . . . . . . . . . . . . 1 .
## 9  . . . . . . 1 . . . . . . . . . . . . . . . . . . . . 1 .
## 10 . . . . . . 1 . . . . . . . . . . . . . . . . . . . . 1 .</code></pre>
<div class="sourceCode" id="cb808"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb808-1"><a href="statistical-models.html#cb808-1" tabindex="-1"></a><span class="fu">dim</span>(Z3)</span></code></pre></div>
<pre><code>## [1] 108  29</code></pre>
<hr />
</div>
<div id="remark-nested-vs.-crossed-random-effects" class="section level3 hasAnchor" number="6.8.17">
<h3><span class="header-section-number">6.8.17</span> Remark: Nested vs. crossed random effects<a href="statistical-models.html#remark-nested-vs.-crossed-random-effects" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><strong>Nested random effects</strong> occur when one grouping factor appears only within levels of another:</li>
</ul>
<p>(1 | group1/group2)</p>
<ul>
<li><strong>Crossed random effects</strong> occur when observations are independently grouped by multiple factors:</li>
</ul>
<p>(1 | group1) + (1 | group2)</p>
<p>Understanding how these structures affect the Z matrix and covariance decomposition is essential for correctly specifying and interpreting linear mixed models in practice.</p>

</div>
</div>
<div id="linear-mixed-model-covariance-decomposition-nlme" class="section level2 hasAnchor" number="6.9">
<h2><span class="header-section-number">6.9</span> Linear Mixed Model Covariance Decomposition (nlme)<a href="statistical-models.html#linear-mixed-model-covariance-decomposition-nlme" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This chapter is a practical, “under-the-hood” guide to linear mixed models (LMMs) using <strong>nlme</strong>, with a strong focus on <strong>covariance decomposition</strong> and how it connects to estimation, inference, and prediction. We will fit models in R, extract the key design matrices, and then reproduce (parts of) the computations by hand to make the machinery transparent.</p>
<p>Throughout, we work with the <strong>Orthodont</strong> dataset, a classic longitudinal dataset with repeated measurements per subject. The key statistical idea is simple:</p>
<ul>
<li>repeated observations within the same subject are <strong>correlated</strong>,</li>
<li>that correlation can be explained by <strong>random effects</strong>, <strong>correlated residual errors</strong>, or both,</li>
<li>and once we specify the covariance structure correctly, estimation becomes a generalized least squares (GLS) problem.</li>
</ul>
<div id="load-data-2" class="section level3 hasAnchor" number="6.9.1">
<h3><span class="header-section-number">6.9.1</span> Load data<a href="statistical-models.html#load-data-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb810"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb810-1"><a href="statistical-models.html#cb810-1" tabindex="-1"></a><span class="fu">data</span>(Orthodont, <span class="at">package=</span><span class="st">&quot;nlme&quot;</span>)</span>
<span id="cb810-2"><a href="statistical-models.html#cb810-2" tabindex="-1"></a>Data <span class="ot">&lt;-</span> Orthodont</span></code></pre></div>
<p>The Orthodont dataset contains repeated measurements of a distance outcome over time (age). Each subject is measured multiple times, so the data are clustered by <code>Subject</code>. This repeated-measures structure is exactly where mixed models become useful.</p>
<p>A quick reminder of notation we will use in this chapter:</p>
<ul>
<li><span class="math inline">\(i\)</span> indexes subjects, <span class="math inline">\(j\)</span> indexes repeated observations within subject <span class="math inline">\(i\)</span>.</li>
<li><span class="math inline">\(y_{ij}\)</span> is the response (distance).</li>
<li><span class="math inline">\(\mathbf{X}\)</span> is the fixed-effect design matrix.</li>
<li><span class="math inline">\(\mathbf{Z}\)</span> is the random-effect design matrix.</li>
<li><span class="math inline">\(\boldsymbol\beta\)</span> are fixed-effect parameters.</li>
<li><span class="math inline">\(\mathbf{u}\)</span> are random effects.</li>
<li><span class="math inline">\(\boldsymbol\varepsilon\)</span> are residual errors.</li>
</ul>
</div>
<div id="exploratory-visualization" class="section level3 hasAnchor" number="6.9.2">
<h3><span class="header-section-number">6.9.2</span> Exploratory visualization<a href="statistical-models.html#exploratory-visualization" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Before fitting a model, we want to visually confirm two things:</p>
<ol style="list-style-type: decimal">
<li>the overall mean trend of distance over age, and<br />
</li>
<li>whether subjects appear to have systematic deviations from that trend.</li>
</ol>
<p>The first plot stratifies by sex and overlays a linear trend line.</p>
<div class="sourceCode" id="cb811"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb811-1"><a href="statistical-models.html#cb811-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb811-2"><a href="statistical-models.html#cb811-2" tabindex="-1"></a><span class="fu">ggplot</span>(Data, <span class="fu">aes</span>(<span class="at">y =</span> distance, <span class="at">x =</span> age,  <span class="at">color =</span> Sex)) <span class="sc">+</span></span>
<span id="cb811-3"><a href="statistical-models.html#cb811-3" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>,<span class="at">se=</span>F) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_classic</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-367-1.png" alt="" width="672" /></p>
<p>Interpretation:
- If the slopes differ between sexes, that suggests an interaction (not modeled here).
- If points form vertical “bands” by subject (hidden here), that suggests subject-to-subject heterogeneity.</p>
<p>The second plot includes <code>Subject</code> in the aesthetics. Even if the visual is busy, it helps us see whether each subject follows a roughly parallel trajectory shifted up or down. That pattern is the classic signal for a <strong>random intercept</strong>.</p>
<div class="sourceCode" id="cb813"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb813-1"><a href="statistical-models.html#cb813-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb813-2"><a href="statistical-models.html#cb813-2" tabindex="-1"></a><span class="fu">ggplot</span>(Data, <span class="fu">aes</span>(<span class="at">y =</span> distance, <span class="at">x =</span> age, <span class="at">fill =</span> Subject, <span class="at">color =</span> Sex)) <span class="sc">+</span></span>
<span id="cb813-3"><a href="statistical-models.html#cb813-3" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>,<span class="at">se=</span>F) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_classic</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-368-1.png" alt="" width="672" /></p>
<p>If subjects show consistent vertical separation across age, a random intercept is a natural first model. If subjects also differ in slope, we would consider random slopes (covered in a separate chapter / section).</p>
</div>
<div id="using-lme-nlme" class="section level3 hasAnchor" number="6.9.3">
<h3><span class="header-section-number">6.9.3</span> Using lme (nlme)<a href="statistical-models.html#using-lme-nlme" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We first fit a random intercept model using <code>nlme::lme</code>. The model is:</p>
<p><span class="math display">\[
y_{ij} = \beta_0 + \beta_1 \, \text{age}_{ij} + \beta_2 \, \text{Sex}_i + b_i + \varepsilon_{ij},
\]</span></p>
<p>with assumptions</p>
<p><span class="math display">\[
b_i \sim N(0,\sigma_b^2), \quad \varepsilon_{ij} \sim N(0,\sigma^2), \quad b_i \perp \varepsilon_{ij}.
\]</span></p>
<p>This implies a within-subject covariance of compound symmetry form (equal correlation between any two observations from the same subject), because the shared random intercept induces correlation.</p>
<p>We fit the model in <strong>nlme</strong> and also fit the “equivalent” random-intercept model in <strong>lme4</strong> (we will use <code>lme4</code> later to extract <span class="math inline">\(\mathbf{X}\)</span>, <span class="math inline">\(\mathbf{Z}\)</span>, and <span class="math inline">\(\mathbf{y}\)</span>).</p>
<div class="sourceCode" id="cb815"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb815-1"><a href="statistical-models.html#cb815-1" tabindex="-1"></a><span class="fu">library</span>(nlme)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;nlme&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:lme4&#39;:
## 
##     lmList</code></pre>
<pre><code>## The following object is masked from &#39;package:matlib&#39;:
## 
##     Dim</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     collapse</code></pre>
<div class="sourceCode" id="cb820"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb820-1"><a href="statistical-models.html#cb820-1" tabindex="-1"></a>fit.lmer2 <span class="ot">&lt;-</span> <span class="fu">lme</span>(distance <span class="sc">~</span> age <span class="sc">+</span> Sex  , <span class="at">random =</span> <span class="sc">~</span><span class="dv">1</span>   <span class="sc">|</span> Subject, <span class="at">data =</span> Data) </span>
<span id="cb820-2"><a href="statistical-models.html#cb820-2" tabindex="-1"></a><span class="fu">summary</span>(fit.lmer2)</span></code></pre></div>
<pre><code>## Linear mixed-effects model fit by REML
##   Data: Data 
##        AIC      BIC    logLik
##   447.5125 460.7823 -218.7563
## 
## Random effects:
##  Formula: ~1 | Subject
##         (Intercept) Residual
## StdDev:    1.807425 1.431592
## 
## Fixed effects:  distance ~ age + Sex 
##                 Value Std.Error DF   t-value p-value
## (Intercept) 17.706713 0.8339225 80 21.233044  0.0000
## age          0.660185 0.0616059 80 10.716263  0.0000
## SexFemale   -2.321023 0.7614168 25 -3.048294  0.0054
##  Correlation: 
##           (Intr) age   
## age       -0.813       
## SexFemale -0.372  0.000
## 
## Standardized Within-Group Residuals:
##         Min          Q1         Med          Q3         Max 
## -3.74889609 -0.55034466 -0.02516628  0.45341781  3.65746539 
## 
## Number of Observations: 108
## Number of Groups: 27</code></pre>
<div class="sourceCode" id="cb822"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb822-1"><a href="statistical-models.html#cb822-1" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb822-2"><a href="statistical-models.html#cb822-2" tabindex="-1"></a><span class="co"># lme4</span></span>
<span id="cb822-3"><a href="statistical-models.html#cb822-3" tabindex="-1"></a>fit.lmer <span class="ot">&lt;-</span> <span class="fu">lmer</span>(distance <span class="sc">~</span> age <span class="sc">+</span> Sex  <span class="sc">+</span>(<span class="dv">1</span> <span class="sc">|</span> Subject), <span class="at">data =</span> Data) </span>
<span id="cb822-4"><a href="statistical-models.html#cb822-4" tabindex="-1"></a><span class="co"># compound symmetry</span></span></code></pre></div>
<p>Practical note:
- In this simplest random-intercept setting, <code>lme</code> and <code>lmer</code> should agree closely on fixed-effect estimates and variance components (allowing for minor numerical differences).
- The big advantage of <code>nlme</code> is the ability to specify <strong>residual correlation structures</strong> (AR(1), exponential, Gaussian, unstructured, etc.), which we explore later.</p>
</div>
<div id="inference-for-fixed-effects" class="section level3 hasAnchor" number="6.9.4">
<h3><span class="header-section-number">6.9.4</span> Inference for fixed effects<a href="statistical-models.html#inference-for-fixed-effects" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>After fitting the model, we usually want to test whether covariates such as <code>age</code> and <code>Sex</code> are associated with the outcome. Mixed models complicate testing because correlation changes both the standard errors and the effective degrees of freedom.</p>
<div id="t-test-wald-type-test" class="section level4 hasAnchor" number="6.9.4.1">
<h4><span class="header-section-number">6.9.4.1</span> t test (Wald-type test)<a href="statistical-models.html#t-test-wald-type-test" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Here we compute a t-statistic “by hand” from the fixed-effect estimates and their estimated covariance matrix:</p>
<p><span class="math display">\[
t_k = \frac{\hat\beta_k}{\sqrt{\widehat{\mathrm{Var}}(\hat\beta_k)}}.
\]</span></p>
<p>We then compute two-sided p-values using the degrees of freedom stored by <code>nlme</code>.</p>
<div class="sourceCode" id="cb823"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb823-1"><a href="statistical-models.html#cb823-1" tabindex="-1"></a>tstat <span class="ot">&lt;-</span> <span class="fu">fixef</span>(fit.lmer2)<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">diag</span>(<span class="fu">vcov</span>(fit.lmer2)))</span>
<span id="cb823-2"><a href="statistical-models.html#cb823-2" tabindex="-1"></a>pval <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">pt</span>(<span class="sc">-</span><span class="fu">abs</span>(tstat), <span class="at">df =</span> fit.lmer2<span class="sc">$</span>fixDF<span class="sc">$</span>X)</span>
<span id="cb823-3"><a href="statistical-models.html#cb823-3" tabindex="-1"></a>Tresult <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">t =</span> tstat, <span class="at">p =</span> <span class="fu">round</span>(pval, <span class="dv">4</span>))</span>
<span id="cb823-4"><a href="statistical-models.html#cb823-4" tabindex="-1"></a><span class="fu">print</span>(Tresult)</span></code></pre></div>
<pre><code>##                     t      p
## (Intercept) 21.233044 0.0000
## age         10.716263 0.0000
## SexFemale   -3.048294 0.0054</code></pre>
<p>Why this matters:
- <code>vcov(fit.lmer2)</code> is not the OLS covariance; it is the GLS-based covariance that accounts for <span class="math inline">\(\mathbf{V}\)</span>, the marginal covariance of <span class="math inline">\(\mathbf{y}\)</span>.
- The degrees of freedom in <code>nlme</code> reflect an approximate finite-sample adjustment for mixed models, not a simple <span class="math inline">\(n-p\)</span>.</p>
</div>
<div id="f-test-anova-table" class="section level4 hasAnchor" number="6.9.4.2">
<h4><span class="header-section-number">6.9.4.2</span> F test (ANOVA table)<a href="statistical-models.html#f-test-anova-table" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The <code>anova()</code> method provides an ANOVA-style summary of fixed effects.</p>
<div class="sourceCode" id="cb825"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb825-1"><a href="statistical-models.html#cb825-1" tabindex="-1"></a><span class="fu">anova</span>(fit.lmer2 ) </span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">numDF</th>
<th align="right">denDF</th>
<th align="right">F-value</th>
<th align="right">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">1</td>
<td align="right">80</td>
<td align="right">4123.155691</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">1</td>
<td align="right">80</td>
<td align="right">114.838287</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">Sex</td>
<td align="right">1</td>
<td align="right">25</td>
<td align="right">9.292099</td>
<td align="right">0.0053751</td>
</tr>
</tbody>
</table>
<p>Interpretation:
- This is typically a Wald-type test presented as an F statistic.
- It answers whether each term contributes after accounting for the covariance structure.</p>
</div>
<div id="restricted-model-test-linear-contrast" class="section level4 hasAnchor" number="6.9.4.3">
<h4><span class="header-section-number">6.9.4.3</span> Restricted model test (linear contrast)<a href="statistical-models.html#restricted-model-test-linear-contrast" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Sometimes we want to test a specific linear hypothesis about fixed effects:</p>
<p><span class="math display">\[
H_0: \mathbf{L}\boldsymbol\beta = 0.
\]</span></p>
<p>The <code>L</code> vector specifies a linear combination of coefficients. In this example, <code>L = c(0,1,0)</code> targets the second fixed-effect coefficient (often the age effect, depending on parameter ordering).</p>
<div class="sourceCode" id="cb826"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb826-1"><a href="statistical-models.html#cb826-1" tabindex="-1"></a><span class="fu">anova</span>(fit.lmer2, <span class="at">L =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)) </span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">numDF</th>
<th align="right">denDF</th>
<th align="right">F-value</th>
<th align="right">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">80</td>
<td align="right">114.8383</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>This approach generalizes cleanly to:
- testing multiple coefficients jointly,
- testing contrasts among factor levels,
- testing spline basis groups, etc.</p>
</div>
<div id="likelihood-ratio-test-nested-models" class="section level4 hasAnchor" number="6.9.4.4">
<h4><span class="header-section-number">6.9.4.4</span> Likelihood ratio test (nested models)<a href="statistical-models.html#likelihood-ratio-test-nested-models" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We compare:</p>
<ul>
<li>full model: <code>distance ~ age + Sex</code><br />
</li>
<li>reduced model: <code>distance ~ Sex</code></li>
</ul>
<p>Both have the same random intercept structure, so the models are nested in their fixed effects.</p>
<div class="sourceCode" id="cb827"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb827-1"><a href="statistical-models.html#cb827-1" tabindex="-1"></a>fit.lmer2<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">lme</span>(distance <span class="sc">~</span>   Sex  , <span class="at">random =</span> <span class="sc">~</span><span class="dv">1</span>   <span class="sc">|</span> Subject, <span class="at">data =</span> Data) </span>
<span id="cb827-2"><a href="statistical-models.html#cb827-2" tabindex="-1"></a><span class="fu">anova</span>(fit.lmer2, fit.lmer2<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## Warning in anova.lme(fit.lmer2, fit.lmer2.2): fitted objects with different
## fixed effects. REML comparisons are not meaningful.</code></pre>
<table>
<colgroup>
<col width="7%" />
<col width="54%" />
<col width="3%" />
<col width="1%" />
<col width="5%" />
<col width="5%" />
<col width="6%" />
<col width="4%" />
<col width="5%" />
<col width="5%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">call</th>
<th align="right">Model</th>
<th align="right">df</th>
<th align="right">AIC</th>
<th align="right">BIC</th>
<th align="right">logLik</th>
<th align="left">Test</th>
<th align="right">L.Ratio</th>
<th align="right">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">fit.lmer2</td>
<td align="left">lme.formula(fixed = distance ~ age + Sex, data = Data, random = ~1 | Subject)</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">447.5125</td>
<td align="right">460.7823</td>
<td align="right">-218.7563</td>
<td align="left"></td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">fit.lmer2.2</td>
<td align="left">lme.formula(fixed = distance ~ Sex, data = Data, random = ~1 | Subject)</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="right">513.8718</td>
<td align="right">524.5255</td>
<td align="right">-252.9359</td>
<td align="left">1 vs 2</td>
<td align="right">68.35926</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>A likelihood ratio test uses:</p>
<p><span class="math display">\[
\mathrm{LR} = 2(\ell_1 - \ell_0),
\]</span></p>
<p>and compares LR to a <span class="math inline">\(\chi^2\)</span> distribution with degrees of freedom equal to the difference in number of parameters (here, the difference in fixed effects).</p>
<p><code>And now by hand</code></p>
<div class="sourceCode" id="cb829"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb829-1"><a href="statistical-models.html#cb829-1" tabindex="-1"></a>logLik  <span class="ot">&lt;-</span> <span class="fu">logLik</span>(fit.lmer2)</span>
<span id="cb829-2"><a href="statistical-models.html#cb829-2" tabindex="-1"></a>logLik0 <span class="ot">&lt;-</span> <span class="fu">logLik</span>(fit.lmer2<span class="fl">.2</span>)</span>
<span id="cb829-3"><a href="statistical-models.html#cb829-3" tabindex="-1"></a></span>
<span id="cb829-4"><a href="statistical-models.html#cb829-4" tabindex="-1"></a>LR <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (logLik <span class="sc">-</span> logLik0)</span>
<span id="cb829-5"><a href="statistical-models.html#cb829-5" tabindex="-1"></a>pval <span class="ot">&lt;-</span> <span class="fu">pchisq</span>(LR, <span class="at">df =</span> <span class="dv">2</span>, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb829-6"><a href="statistical-models.html#cb829-6" tabindex="-1"></a>LRresult <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">LR =</span> LR, <span class="at">p =</span> <span class="fu">round</span>(pval, <span class="dv">4</span>), <span class="at">row.names =</span> <span class="st">&quot;age&quot;</span>)</span>
<span id="cb829-7"><a href="statistical-models.html#cb829-7" tabindex="-1"></a><span class="fu">print</span>(LRresult)</span></code></pre></div>
<pre><code>##           LR p
## age 68.35926 0</code></pre>
<p>Practical note:
- For testing <strong>variance components</strong> (e.g., whether a random effect variance is zero), LR tests can be nonstandard due to boundary issues.
- Here we are testing a <strong>fixed effect</strong>, so the usual large-sample chi-square reference is commonly used.</p>
</div>
</div>
<div id="model-diagnosing" class="section level3 hasAnchor" number="6.9.5">
<h3><span class="header-section-number">6.9.5</span> Model diagnosing<a href="statistical-models.html#model-diagnosing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Even if inference looks “significant,” model assumptions can be wrong. Diagnostic plots help assess:</p>
<ul>
<li>residual patterns (nonlinearity, heteroscedasticity),</li>
<li>normality of residuals,</li>
<li>influential clusters,</li>
<li>random-effects distribution.</li>
</ul>
<div class="sourceCode" id="cb831"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb831-1"><a href="statistical-models.html#cb831-1" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb831-2"><a href="statistical-models.html#cb831-2" tabindex="-1"></a><span class="fu">plot.lme</span>(fit.lmer2)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-375-1.png" alt="" width="672" /></p>
<p>In longitudinal data, a frequent warning sign is residual correlation that remains after adding random effects. If residuals within each subject still show time dependence, we may need an explicit residual correlation structure (AR(1), exponential, etc.), which we will fit later in this chapter.</p>
</div>
<div id="get-x-y-z-matrices-using-lme4" class="section level3 hasAnchor" number="6.9.6">
<h3><span class="header-section-number">6.9.6</span> Get X, y, Z matrices (using lme4)<a href="statistical-models.html#get-x-y-z-matrices-using-lme4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To connect the model to matrix formulas, we extract the core objects:</p>
<ul>
<li><span class="math inline">\(\mathbf{X}\)</span>: fixed-effect design matrix<br />
</li>
<li><span class="math inline">\(\mathbf{Z}\)</span>: random-effect design matrix<br />
</li>
<li><span class="math inline">\(\mathbf{y}\)</span>: response vector</li>
</ul>
<p>We use <code>lme4</code> because <code>getME()</code> provides these matrices directly in a standard form.</p>
<div class="sourceCode" id="cb832"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb832-1"><a href="statistical-models.html#cb832-1" tabindex="-1"></a>X<span class="ot">=</span>(<span class="fu">getME</span>(fit.lmer, <span class="st">&quot;X&quot;</span>))</span>
<span id="cb832-2"><a href="statistical-models.html#cb832-2" tabindex="-1"></a>y<span class="ot">=</span><span class="fu">getME</span>(fit.lmer, <span class="st">&quot;y&quot;</span>)</span>
<span id="cb832-3"><a href="statistical-models.html#cb832-3" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">getME</span>(fit.lmer, <span class="st">&quot;Z&quot;</span>)</span>
<span id="cb832-4"><a href="statistical-models.html#cb832-4" tabindex="-1"></a></span>
<span id="cb832-5"><a href="statistical-models.html#cb832-5" tabindex="-1"></a>Z2 <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span>Subject<span class="dv">-1</span>,<span class="at">data=</span>Data)</span></code></pre></div>
<p>Interpretation:
- For a random intercept model, <span class="math inline">\(\mathbf{Z}\)</span> is essentially a subject indicator matrix (one column per subject).
- Each row has a single 1 indicating the subject membership.</p>
<div id="check-z-matrix" class="section level4 hasAnchor" number="6.9.6.1">
<h4><span class="header-section-number">6.9.6.1</span> Check Z matrix<a href="statistical-models.html#check-z-matrix" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We confirm that <code>Z</code> matches a manually created subject dummy matrix.</p>
<div class="sourceCode" id="cb833"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb833-1"><a href="statistical-models.html#cb833-1" tabindex="-1"></a>dummyz<span class="ot">&lt;-</span> <span class="fu">as.matrix</span> (Z)<span class="sc">==</span>Z2</span>
<span id="cb833-2"><a href="statistical-models.html#cb833-2" tabindex="-1"></a><span class="fu">table</span>(dummyz)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">TRUE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2916</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb834"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb834-1"><a href="statistical-models.html#cb834-1" tabindex="-1"></a><span class="fu">dim</span>(Z)</span></code></pre></div>
<pre><code>## [1] 108  27</code></pre>
<p>This is a useful sanity check: it ensures that when we later compute <span class="math inline">\(\mathbf{Z}\mathbf{D}\mathbf{Z}^\top\)</span>, we are using the same <span class="math inline">\(\mathbf{Z}\)</span> that the model implies.</p>
</div>
<div id="check-y-and-x-matrices" class="section level4 hasAnchor" number="6.9.6.2">
<h4><span class="header-section-number">6.9.6.2</span> Check y and X matrices<a href="statistical-models.html#check-y-and-x-matrices" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We also check that columns in <span class="math inline">\(\mathbf{X}\)</span> match the original variables.</p>
<div class="sourceCode" id="cb836"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb836-1"><a href="statistical-models.html#cb836-1" tabindex="-1"></a>dummyx<span class="ot">&lt;-</span> Data[,<span class="fu">c</span>(<span class="dv">2</span>)]<span class="sc">==</span>X[,<span class="dv">2</span>]</span>
<span id="cb836-2"><a href="statistical-models.html#cb836-2" tabindex="-1"></a><span class="fu">table</span>(dummyx)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">TRUE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">108</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="fixed-effect-coefficient" class="section level3 hasAnchor" number="6.9.7">
<h3><span class="header-section-number">6.9.7</span> Fixed effect coefficient<a href="statistical-models.html#fixed-effect-coefficient" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The fixed effects <span class="math inline">\(\hat{\boldsymbol\beta}\)</span> represent the population-average association between distance and the covariates, after accounting for within-subject correlation.</p>
<div class="sourceCode" id="cb837"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb837-1"><a href="statistical-models.html#cb837-1" tabindex="-1"></a>bhat <span class="ot">&lt;-</span> fit.lmer2<span class="sc">$</span>coef<span class="sc">$</span>fixed</span>
<span id="cb837-2"><a href="statistical-models.html#cb837-2" tabindex="-1"></a>bhat</span></code></pre></div>
<pre><code>## (Intercept)         age   SexFemale 
##  17.7067130   0.6601852  -2.3210227</code></pre>
<div class="sourceCode" id="cb839"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb839-1"><a href="statistical-models.html#cb839-1" tabindex="-1"></a><span class="co"># fixef()</span></span></code></pre></div>
<div id="fixed-effect-confidence-intervals" class="section level4 hasAnchor" number="6.9.7.1">
<h4><span class="header-section-number">6.9.7.1</span> Fixed effect confidence intervals<a href="statistical-models.html#fixed-effect-confidence-intervals" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>nlme::intervals()</code> provides approximate confidence intervals for fixed effects.</p>
<div class="sourceCode" id="cb840"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb840-1"><a href="statistical-models.html#cb840-1" tabindex="-1"></a><span class="fu">intervals</span>(fit.lmer2)</span></code></pre></div>
<pre><code>## Approximate 95% confidence intervals
## 
##  Fixed effects:
##                  lower       est.      upper
## (Intercept) 16.0471544 17.7067130 19.3662716
## age          0.5375855  0.6601852  0.7827849
## SexFemale   -3.8891901 -2.3210227 -0.7528554
## 
##  Random Effects:
##   Level: Subject 
##                    lower     est.    upper
## sd((Intercept)) 1.310357 1.807425 2.493049
## 
##  Within-group standard error:
##    lower     est.    upper 
## 1.226095 1.431592 1.671531</code></pre>
<p>These intervals are typically Wald-type:</p>
<p><span class="math display">\[
\hat\beta_k \pm t_{0.975,\;df}\sqrt{\widehat{\mathrm{Var}}(\hat\beta_k)}.
\]</span></p>
</div>
<div id="plot-fixed-effect-coefficients-and-their-ci" class="section level4 hasAnchor" number="6.9.7.2">
<h4><span class="header-section-number">6.9.7.2</span> Plot fixed effect coefficients and their CI<a href="statistical-models.html#plot-fixed-effect-coefficients-and-their-ci" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Visualizing coefficients often communicates results faster than tables, especially in teaching materials.</p>
<div class="sourceCode" id="cb842"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb842-1"><a href="statistical-models.html#cb842-1" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">Est =</span> <span class="fu">intervals</span>(fit.lmer2)[[<span class="st">&quot;fixed&quot;</span>]][,<span class="dv">2</span>], <span class="at">LL =</span> <span class="fu">intervals</span>(fit.lmer2)[[<span class="st">&quot;fixed&quot;</span>]][,<span class="dv">1</span>], <span class="at">UL=</span></span>
<span id="cb842-2"><a href="statistical-models.html#cb842-2" tabindex="-1"></a><span class="fu">intervals</span>(fit.lmer2)[[<span class="st">&quot;fixed&quot;</span>]][,<span class="dv">3</span>])</span>
<span id="cb842-3"><a href="statistical-models.html#cb842-3" tabindex="-1"></a><span class="co">#Extracting the fixed effect estimates and manually calculating the 95% confidence limits</span></span>
<span id="cb842-4"><a href="statistical-models.html#cb842-4" tabindex="-1"></a><span class="co">#qnorm extracts the standard normal critical value for 1-alpha/2= 1-0.05/2=0.975</span></span>
<span id="cb842-5"><a href="statistical-models.html#cb842-5" tabindex="-1"></a>Odds<span class="ot">=</span> (tab)</span>
<span id="cb842-6"><a href="statistical-models.html#cb842-6" tabindex="-1"></a><span class="fu">round</span>(Odds,<span class="dv">4</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Est</th>
<th align="right">LL</th>
<th align="right">UL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">17.7067</td>
<td align="right">16.0472</td>
<td align="right">19.3663</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">0.6602</td>
<td align="right">0.5376</td>
<td align="right">0.7828</td>
</tr>
<tr class="odd">
<td align="left">SexFemale</td>
<td align="right">-2.3210</td>
<td align="right">-3.8892</td>
<td align="right">-0.7529</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb843"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb843-1"><a href="statistical-models.html#cb843-1" tabindex="-1"></a>Odds<span class="ot">=</span><span class="fu">as.data.frame</span>(Odds)</span>
<span id="cb843-2"><a href="statistical-models.html#cb843-2" tabindex="-1"></a>Odds<span class="sc">$</span>Label<span class="ot">=</span><span class="fu">rownames</span>(Odds)</span>
<span id="cb843-3"><a href="statistical-models.html#cb843-3" tabindex="-1"></a> </span>
<span id="cb843-4"><a href="statistical-models.html#cb843-4" tabindex="-1"></a><span class="fu">ggplot</span>(Odds[<span class="sc">-</span><span class="dv">1</span>,],<span class="fu">aes</span>(<span class="at">x=</span>Est,<span class="at">y=</span>Label))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb843-5"><a href="statistical-models.html#cb843-5" tabindex="-1"></a><span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">xmax =</span> UL, <span class="at">xmin =</span> LL))<span class="sc">+</span></span>
<span id="cb843-6"><a href="statistical-models.html#cb843-6" tabindex="-1"></a>  </span>
<span id="cb843-7"><a href="statistical-models.html#cb843-7" tabindex="-1"></a><span class="fu">theme_bw</span>()<span class="sc">+</span><span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="dv">0</span>,<span class="at">col=</span><span class="st">&quot;darkgray&quot;</span>,<span class="at">size=</span><span class="fl">1.2</span>,<span class="at">linetype=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb843-8"><a href="statistical-models.html#cb843-8" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb843-9"><a href="statistical-models.html#cb843-9" tabindex="-1"></a><span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>))<span class="sc">+</span><span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Beta coefficients&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: `geom_errorbarh()` was deprecated in ggplot2 4.0.0.
## ℹ Please use the `orientation` argument of
##   `geom_errorbar()` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see
## where this warning was generated.</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-381-1.png" alt="" width="672" /></p>
<p>Interpretation tips:
- Intervals crossing 0 suggest the effect may be weak relative to uncertainty.
- The vertical line at 0 is a convenient “no effect” reference.</p>
<p><code>And now by hand</code></p>
<p>We replicate the fixed-effect CI using the stored degrees of freedom and the covariance matrix.</p>
<div class="sourceCode" id="cb845"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb845-1"><a href="statistical-models.html#cb845-1" tabindex="-1"></a><span class="fu">print</span>(tquants <span class="ot">&lt;-</span> <span class="fu">qt</span>(<span class="fl">0.975</span>, <span class="at">df =</span> fit.lmer2<span class="sc">$</span>fixDF<span class="sc">$</span>X))</span></code></pre></div>
<pre><code>## (Intercept)         age   SexFemale 
##    1.990063    1.990063    2.059539</code></pre>
<div class="sourceCode" id="cb847"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb847-1"><a href="statistical-models.html#cb847-1" tabindex="-1"></a>Low <span class="ot">&lt;-</span> <span class="fu">fixef</span>(fit.lmer2) <span class="sc">-</span> tquants <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(<span class="fu">vcov</span>(fit.lmer2)))</span>
<span id="cb847-2"><a href="statistical-models.html#cb847-2" tabindex="-1"></a>Upp <span class="ot">&lt;-</span> <span class="fu">fixef</span>(fit.lmer2) <span class="sc">+</span> tquants <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(<span class="fu">vcov</span>(fit.lmer2)))</span>
<span id="cb847-3"><a href="statistical-models.html#cb847-3" tabindex="-1"></a>EstInt <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Lower =</span> Low, <span class="at">Estimate =</span> <span class="fu">fixef</span>(fit.lmer2), <span class="at">Upper =</span> Upp)</span>
<span id="cb847-4"><a href="statistical-models.html#cb847-4" tabindex="-1"></a><span class="fu">print</span>(EstInt)</span></code></pre></div>
<pre><code>##                  Lower   Estimate      Upper
## (Intercept) 16.0471544 17.7067130 19.3662716
## age          0.5375855  0.6601852  0.7827849
## SexFemale   -3.8891901 -2.3210227 -0.7528554</code></pre>
<p>This is an important conceptual checkpoint: it shows that once we know <span class="math inline">\(\widehat{\mathrm{Var}}(\hat{\boldsymbol\beta})\)</span>, confidence intervals reduce to standard linear model logic—the “mixed model” complexity is contained in estimating <span class="math inline">\(\mathbf{V}\)</span> and thus the correct covariance of <span class="math inline">\(\hat{\boldsymbol\beta}\)</span>.</p>
</div>
</div>
<div id="random-effect-coefficient" class="section level3 hasAnchor" number="6.9.8">
<h3><span class="header-section-number">6.9.8</span> Random effect coefficient<a href="statistical-models.html#random-effect-coefficient" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The random effects are subject-specific intercept deviations (BLUPs / empirical Bayes estimates). These quantify how each subject’s average distance differs from the population mean after adjusting for covariates.</p>
<div class="sourceCode" id="cb849"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb849-1"><a href="statistical-models.html#cb849-1" tabindex="-1"></a>fit.lmer2<span class="sc">$</span>coef<span class="sc">$</span>random</span></code></pre></div>
<pre><code>## $Subject
##     (Intercept)
## M16 -1.70183357
## M05 -1.70183357
## M02 -1.37767479
## M11 -1.16156894
## M07 -1.05351602
## M08 -0.94546309
## M03 -0.62130432
## M12 -0.62130432
## M13 -0.62130432
## M14 -0.08103969
## M09  0.13506616
## M15  0.78338371
## M06  1.21559540
## M04  1.43170125
## M01  2.40417758
## M10  3.91691853
## F10 -3.58539251
## F09 -1.31628108
## F06 -1.31628108
## F01 -1.10017523
## F05 -0.01964599
## F07  0.30451279
## F02  0.30451279
## F08  0.62867156
## F03  0.95283034
## F04  1.92530666
## F11  3.22194176</code></pre>
<p>Interpretation:
- Large positive random intercept: subject tends to have larger distance than average.
- Large negative random intercept: subject tends to have smaller distance than average.
- Shrinkage: subjects with fewer observations are pulled more strongly toward 0.</p>
</div>
<div id="fixed-effect-coefficients-covariance" class="section level3 hasAnchor" number="6.9.9">
<h3><span class="header-section-number">6.9.9</span> Fixed effect coefficients covariance<a href="statistical-models.html#fixed-effect-coefficients-covariance" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The covariance matrix of fixed effect estimates is central for inference:</p>
<p><span class="math display">\[
\widehat{\mathrm{Cov}}(\hat{\boldsymbol\beta}) = (\mathbf{X}^\top \hat{\mathbf{V}}^{-1}\mathbf{X})^{-1}.
\]</span></p>
<p>We inspect both the matrix and the standard errors.</p>
<div class="sourceCode" id="cb851"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb851-1"><a href="statistical-models.html#cb851-1" tabindex="-1"></a>fit.lmer2<span class="sc">$</span>varFix</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">(Intercept)</th>
<th align="right">age</th>
<th align="right">SexFemale</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.6954267</td>
<td align="right">-0.0417482</td>
<td align="right">-0.2361967</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">-0.0417482</td>
<td align="right">0.0037953</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">SexFemale</td>
<td align="right">-0.2361967</td>
<td align="right">0.0000000</td>
<td align="right">0.5797556</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb852"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb852-1"><a href="statistical-models.html#cb852-1" tabindex="-1"></a><span class="co"># vcov(fit.lmer2)</span></span>
<span id="cb852-2"><a href="statistical-models.html#cb852-2" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">diag</span>(<span class="fu">vcov</span>(fit.lmer2)))</span></code></pre></div>
<pre><code>## (Intercept)         age   SexFemale 
##  0.83392247  0.06160592  0.76141685</code></pre>
<div id="fixed-effect-coefficients-correlation" class="section level4 hasAnchor" number="6.9.9.1">
<h4><span class="header-section-number">6.9.9.1</span> Fixed effect coefficients correlation<a href="statistical-models.html#fixed-effect-coefficients-correlation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The next line manually computes a correlation between two fixed-effect estimates by dividing an off-diagonal covariance term by the product of standard deviations. (In practice, you would usually compute the full correlation matrix, but this single calculation emphasizes the concept.)</p>
<div class="sourceCode" id="cb854"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb854-1"><a href="statistical-models.html#cb854-1" tabindex="-1"></a><span class="sc">-</span><span class="fl">0.04174818</span><span class="sc">/</span><span class="fu">prod</span>(<span class="fu">sqrt</span>( <span class="fu">diag</span>(fit.lmer2<span class="sc">$</span>varFix)[<span class="sc">-</span><span class="dv">3</span>] ))</span></code></pre></div>
<pre><code>## [1] -0.8126236</code></pre>
<p>Why care about correlation among estimates?
- Strong correlation can make interpretation unstable (e.g., intercept and slope correlation in centered vs uncentered age).
- It affects joint inference and multicollinearity diagnostics.</p>
</div>
</div>
<div id="random-effect-covariance-and-correlation" class="section level3 hasAnchor" number="6.9.10">
<h3><span class="header-section-number">6.9.10</span> Random effect covariance and correlation<a href="statistical-models.html#random-effect-covariance-and-correlation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For a random intercept model, the random-effect covariance <span class="math inline">\(\mathbf{D}\)</span> is a <span class="math inline">\(1\times1\)</span> matrix (a single variance). In more complex models (random slopes), <span class="math inline">\(\mathbf{D}\)</span> becomes a full covariance matrix.</p>
<p>Here we extract the random-effect covariance from the internal structures.</p>
<div class="sourceCode" id="cb856"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb856-1"><a href="statistical-models.html#cb856-1" tabindex="-1"></a><span class="fu">pdMatrix</span>(fit.lmer2<span class="sc">$</span>modelStruct<span class="sc">$</span>reStruct[[<span class="dv">1</span>]])<span class="sc">*</span>fit.lmer2<span class="sc">$</span>sigma<span class="sc">**</span><span class="dv">2</span></span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">(Intercept)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">3.266784</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb857"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb857-1"><a href="statistical-models.html#cb857-1" tabindex="-1"></a><span class="fu">getVarCov</span>(fit.lmer2)  <span class="co">#using default </span></span></code></pre></div>
<pre><code>## Random effects variance covariance matrix
##             (Intercept)
## (Intercept)      3.2668
##   Standard Deviations: 1.8074</code></pre>
<div class="sourceCode" id="cb859"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb859-1"><a href="statistical-models.html#cb859-1" tabindex="-1"></a><span class="fu">getVarCov</span>(fit.lmer2, <span class="at">individual =</span> <span class="st">&quot;F01&quot;</span>, <span class="at">type =</span> <span class="st">&quot;marginal&quot;</span>)</span></code></pre></div>
<pre><code>## Subject F01 
## Marginal variance covariance matrix
##        1      2      3      4
## 1 5.3162 3.2668 3.2668 3.2668
## 2 3.2668 5.3162 3.2668 3.2668
## 3 3.2668 3.2668 5.3162 3.2668
## 4 3.2668 3.2668 3.2668 5.3162
##   Standard Deviations: 2.3057 2.3057 2.3057 2.3057</code></pre>
<div class="sourceCode" id="cb861"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb861-1"><a href="statistical-models.html#cb861-1" tabindex="-1"></a><span class="fu">getVarCov</span>(fit.lmer2, <span class="at">type =</span> <span class="st">&quot;conditional&quot;</span>)</span></code></pre></div>
<pre><code>## Subject M01 
## Conditional variance covariance matrix
##        1      2      3      4
## 1 2.0495 0.0000 0.0000 0.0000
## 2 0.0000 2.0495 0.0000 0.0000
## 3 0.0000 0.0000 2.0495 0.0000
## 4 0.0000 0.0000 0.0000 2.0495
##   Standard Deviations: 1.4316 1.4316 1.4316 1.4316</code></pre>
<p>Interpretation:
- <code>type="marginal"</code> returns the covariance of <span class="math inline">\(\mathbf{y}\)</span> within a subject after integrating over random effects.
- <code>type="conditional"</code> returns the covariance of <span class="math inline">\(\mathbf{y}\)</span> given the random effects (often closer to <span class="math inline">\(\boldsymbol\Sigma\)</span>).</p>
<p>We also look at variance components and compute the proportion of each component.</p>
<div class="sourceCode" id="cb863"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb863-1"><a href="statistical-models.html#cb863-1" tabindex="-1"></a>vc <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.matrix</span>(<span class="fu">VarCorr</span>(fit.lmer2))[,<span class="dv">1</span>])</span>
<span id="cb863-2"><a href="statistical-models.html#cb863-2" tabindex="-1"></a>vc<span class="sc">/</span><span class="fu">sum</span>(vc)</span></code></pre></div>
<pre><code>## [1] 0.6144914 0.3855086</code></pre>
<div class="sourceCode" id="cb865"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb865-1"><a href="statistical-models.html#cb865-1" tabindex="-1"></a><span class="fu">VarCorr</span>(fit.lmer2)</span></code></pre></div>
<pre><code>## Subject = pdLogChol(1) 
##             Variance StdDev  
## (Intercept) 3.266784 1.807425
## Residual    2.049456 1.431592</code></pre>
<p>This proportion is a useful descriptive measure:
- If random intercept variance dominates, subject-to-subject differences explain most variability.
- If residual variance dominates, within-subject noise is large relative to between-subject differences.</p>
</div>
<div id="get-y-covariance-directly" class="section level3 hasAnchor" number="6.9.11">
<h3><span class="header-section-number">6.9.11</span> Get y covariance directly<a href="statistical-models.html#get-y-covariance-directly" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A core identity in LMMs is the marginal covariance decomposition:</p>
<p><span class="math display">\[
\mathbf{V} = \mathbf{Z}\mathbf{D}\mathbf{Z}^\top + \boldsymbol\Sigma.
\]</span></p>
<p>In the simplest random intercept model with independent residuals, <span class="math inline">\(\boldsymbol\Sigma = \sigma^2 \mathbf{I}\)</span>, and <span class="math inline">\(\mathbf{Z}\mathbf{D}\mathbf{Z}^\top\)</span> creates equal covariance between any two observations in the same subject.</p>
<p>We extract <span class="math inline">\(\mathbf{V}\)</span> directly.</p>
<p><code>= Z REcov Zt + sigma**2</code></p>
<div class="sourceCode" id="cb867"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb867-1"><a href="statistical-models.html#cb867-1" tabindex="-1"></a><span class="fu">require</span>(mgcv)</span></code></pre></div>
<pre><code>## Loading required package: mgcv</code></pre>
<pre><code>## This is mgcv 1.9-1. For overview type &#39;help(&quot;mgcv-package&quot;)&#39;.</code></pre>
<div class="sourceCode" id="cb870"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb870-1"><a href="statistical-models.html#cb870-1" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb870-2"><a href="statistical-models.html#cb870-2" tabindex="-1"></a> </span>
<span id="cb870-3"><a href="statistical-models.html#cb870-3" tabindex="-1"></a>cov <span class="ot">&lt;-</span> <span class="fu">extract.lme.cov</span>(fit.lmer2,Data)</span>
<span id="cb870-4"><a href="statistical-models.html#cb870-4" tabindex="-1"></a><span class="fu">head</span>(cov)</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="right">5.316240</td>
<td align="right">3.266784</td>
<td align="right">3.266784</td>
<td align="right">3.266784</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">3.266784</td>
<td align="right">5.316240</td>
<td align="right">3.266784</td>
<td align="right">3.266784</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">3.266784</td>
<td align="right">3.266784</td>
<td align="right">5.316240</td>
<td align="right">3.266784</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">3.266784</td>
<td align="right">3.266784</td>
<td align="right">3.266784</td>
<td align="right">5.316240</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">5.316240</td>
<td align="right">3.266784</td>
<td align="right">3.266784</td>
<td align="right">3.266784</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">3.266784</td>
<td align="right">5.316240</td>
<td align="right">3.266784</td>
<td align="right">3.266784</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb871"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb871-1"><a href="statistical-models.html#cb871-1" tabindex="-1"></a><span class="fu">dim</span>(cov)</span></code></pre></div>
<pre><code>## [1] 108 108</code></pre>
<p>Practical reason to do this:
- Once we have <span class="math inline">\(\mathbf{V}\)</span>, we can compute GLS estimates and prediction variances directly using matrix formulas.
- This also makes it easy to compare alternative covariance models: only <span class="math inline">\(\mathbf{V}\)</span> changes.</p>
</div>
<div id="residual-variance" class="section level3 hasAnchor" number="6.9.12">
<h3><span class="header-section-number">6.9.12</span> Residual variance<a href="statistical-models.html#residual-variance" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For the baseline random intercept model, the residual variance is <span class="math inline">\(\sigma^2\)</span>.</p>
<div class="sourceCode" id="cb873"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb873-1"><a href="statistical-models.html#cb873-1" tabindex="-1"></a>fit.lmer2<span class="sc">$</span>sigma<span class="sc">**</span><span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] 2.049456</code></pre>
</div>
<div id="compute-fixed-effect-coefficients-by-gls" class="section level3 hasAnchor" number="6.9.13">
<h3><span class="header-section-number">6.9.13</span> Compute fixed effect coefficients (by GLS)<a href="statistical-models.html#compute-fixed-effect-coefficients-by-gls" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The GLS estimator is:</p>
<p><span class="math display">\[
\hat{\boldsymbol\beta} = (\mathbf{X}^\top \mathbf{V}^{-1}\mathbf{X})^{-1}\mathbf{X}^\top \mathbf{V}^{-1}\mathbf{y}.
\]</span></p>
<p>We compute it directly using the extracted covariance matrix.</p>
<div class="sourceCode" id="cb875"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb875-1"><a href="statistical-models.html#cb875-1" tabindex="-1"></a><span class="fu">library</span>(matlib)</span>
<span id="cb875-2"><a href="statistical-models.html#cb875-2" tabindex="-1"></a><span class="fu">inv</span>(<span class="fu">t</span>(<span class="fu">as.matrix</span>(X))<span class="sc">%*%</span><span class="fu">inv</span>(<span class="fu">as.matrix</span>(cov))<span class="sc">%*%</span><span class="fu">as.matrix</span>(X))<span class="sc">%*%</span><span class="fu">t</span>(<span class="fu">as.matrix</span>(X))<span class="sc">%*%</span><span class="fu">inv</span>(<span class="fu">as.matrix</span>(cov))<span class="sc">%*%</span>y</span></code></pre></div>
<table>
<tbody>
<tr class="odd">
<td align="right">17.7067076</td>
</tr>
<tr class="even">
<td align="right">0.6601871</td>
</tr>
<tr class="odd">
<td align="right">-2.3210230</td>
</tr>
</tbody>
</table>
<p>This should match <code>fit.lmer2$coef$fixed</code> (up to numerical rounding). This is the central “bridge” between mixed models and GLS: mixed models reduce to GLS once <span class="math inline">\(\mathbf{V}\)</span> is known.</p>
</div>
<div id="compute-covariance-of-fixed-effect-coefficients" class="section level3 hasAnchor" number="6.9.14">
<h3><span class="header-section-number">6.9.14</span> Compute covariance of fixed effect coefficients<a href="statistical-models.html#compute-covariance-of-fixed-effect-coefficients" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As noted earlier:</p>
<p><span class="math display">\[
\widehat{\mathrm{Cov}}(\hat{\boldsymbol\beta}) = (\mathbf{X}^\top \mathbf{V}^{-1}\mathbf{X})^{-1}.
\]</span></p>
<div class="sourceCode" id="cb876"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb876-1"><a href="statistical-models.html#cb876-1" tabindex="-1"></a><span class="fu">inv</span>(<span class="fu">t</span>(<span class="fu">as.matrix</span>(X))<span class="sc">%*%</span><span class="fu">inv</span>(<span class="fu">as.matrix</span>(cov))<span class="sc">%*%</span><span class="fu">as.matrix</span>(X))</span></code></pre></div>
<table>
<tbody>
<tr class="odd">
<td align="right">0.6954267</td>
<td align="right">-0.0417482</td>
<td align="right">-0.2361967</td>
</tr>
<tr class="even">
<td align="right">-0.0417482</td>
<td align="right">0.0037953</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="right">-0.2361967</td>
<td align="right">0.0000000</td>
<td align="right">0.5797556</td>
</tr>
</tbody>
</table>
</div>
<div id="compute-random-effect-coefficients-blup" class="section level3 hasAnchor" number="6.9.15">
<h3><span class="header-section-number">6.9.15</span> Compute random effect coefficients (BLUP)<a href="statistical-models.html#compute-random-effect-coefficients-blup" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The BLUP / empirical Bayes estimate satisfies:</p>
<p><span class="math display">\[
\hat{\mathbf{u}} = \mathbf{D}\mathbf{Z}^\top \mathbf{V}^{-1}(\mathbf{y} - \mathbf{X}\hat{\boldsymbol\beta}).
\]</span></p>
<p>For a random intercept model, <span class="math inline">\(\mathbf{D}\)</span> is just the scalar <span class="math inline">\(\sigma_b^2\)</span>. In code, <code>Lambda_new</code> constructs a diagonal matrix with that variance repeated for each subject (one random intercept per subject).</p>
<div class="sourceCode" id="cb877"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb877-1"><a href="statistical-models.html#cb877-1" tabindex="-1"></a>Lambda_new <span class="ot">&lt;-</span><span class="fu">as.numeric</span>(<span class="fu">VarCorr</span>(fit.lmer2)[<span class="dv">1</span>])<span class="sc">*</span><span class="fu">diag</span>(<span class="fu">length</span>(<span class="fu">levels</span>(Data<span class="sc">$</span>Subject)))</span>
<span id="cb877-2"><a href="statistical-models.html#cb877-2" tabindex="-1"></a><span class="co"># head(Lambda_new)</span></span></code></pre></div>
<p>Now we compute <span class="math inline">\(\hat{\mathbf{u}}\)</span> and compare with the model’s own random-effect estimates.</p>
<div class="sourceCode" id="cb878"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb878-1"><a href="statistical-models.html#cb878-1" tabindex="-1"></a>uhat <span class="ot">&lt;-</span> fit.lmer2<span class="sc">$</span>coef<span class="sc">$</span>random </span>
<span id="cb878-2"><a href="statistical-models.html#cb878-2" tabindex="-1"></a>comput_uhat <span class="ot">&lt;-</span> (<span class="fu">as.matrix</span>(Lambda_new))<span class="sc">%*%</span><span class="fu">t</span>(Z)<span class="sc">%*%</span><span class="fu">inv</span>(<span class="fu">as.matrix</span>(cov))<span class="sc">%*%</span>(y<span class="sc">-</span><span class="fu">as.matrix</span>(X)<span class="sc">%*%</span>(bhat))</span>
<span id="cb878-3"><a href="statistical-models.html#cb878-3" tabindex="-1"></a><span class="fu">cbind</span>((comput_uhat<span class="sc">@</span>x),(uhat[[<span class="st">&quot;Subject&quot;</span>]]))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right"></th>
<th align="right">(Intercept)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">M16</td>
<td align="right">-1.7018337</td>
<td align="right">-1.7018336</td>
</tr>
<tr class="even">
<td align="left">M05</td>
<td align="right">-1.7018337</td>
<td align="right">-1.7018336</td>
</tr>
<tr class="odd">
<td align="left">M02</td>
<td align="right">-1.3776749</td>
<td align="right">-1.3776748</td>
</tr>
<tr class="even">
<td align="left">M11</td>
<td align="right">-1.1615690</td>
<td align="right">-1.1615689</td>
</tr>
<tr class="odd">
<td align="left">M07</td>
<td align="right">-1.0535161</td>
<td align="right">-1.0535160</td>
</tr>
<tr class="even">
<td align="left">M08</td>
<td align="right">-0.9454632</td>
<td align="right">-0.9454631</td>
</tr>
<tr class="odd">
<td align="left">M03</td>
<td align="right">-0.6213044</td>
<td align="right">-0.6213043</td>
</tr>
<tr class="even">
<td align="left">M12</td>
<td align="right">-0.6213044</td>
<td align="right">-0.6213043</td>
</tr>
<tr class="odd">
<td align="left">M13</td>
<td align="right">-0.6213044</td>
<td align="right">-0.6213043</td>
</tr>
<tr class="even">
<td align="left">M14</td>
<td align="right">-0.0810397</td>
<td align="right">-0.0810397</td>
</tr>
<tr class="odd">
<td align="left">M09</td>
<td align="right">0.1350662</td>
<td align="right">0.1350662</td>
</tr>
<tr class="even">
<td align="left">M15</td>
<td align="right">0.7833838</td>
<td align="right">0.7833837</td>
</tr>
<tr class="odd">
<td align="left">M06</td>
<td align="right">1.2155955</td>
<td align="right">1.2155954</td>
</tr>
<tr class="even">
<td align="left">M04</td>
<td align="right">1.4317013</td>
<td align="right">1.4317013</td>
</tr>
<tr class="odd">
<td align="left">M01</td>
<td align="right">2.4041777</td>
<td align="right">2.4041776</td>
</tr>
<tr class="even">
<td align="left">M10</td>
<td align="right">3.9169188</td>
<td align="right">3.9169185</td>
</tr>
<tr class="odd">
<td align="left">F10</td>
<td align="right">-3.5853927</td>
<td align="right">-3.5853925</td>
</tr>
<tr class="even">
<td align="left">F09</td>
<td align="right">-1.3162812</td>
<td align="right">-1.3162811</td>
</tr>
<tr class="odd">
<td align="left">F06</td>
<td align="right">-1.3162812</td>
<td align="right">-1.3162811</td>
</tr>
<tr class="even">
<td align="left">F01</td>
<td align="right">-1.1001753</td>
<td align="right">-1.1001752</td>
</tr>
<tr class="odd">
<td align="left">F05</td>
<td align="right">-0.0196460</td>
<td align="right">-0.0196460</td>
</tr>
<tr class="even">
<td align="left">F07</td>
<td align="right">0.3045128</td>
<td align="right">0.3045128</td>
</tr>
<tr class="odd">
<td align="left">F02</td>
<td align="right">0.3045128</td>
<td align="right">0.3045128</td>
</tr>
<tr class="even">
<td align="left">F08</td>
<td align="right">0.6286716</td>
<td align="right">0.6286716</td>
</tr>
<tr class="odd">
<td align="left">F03</td>
<td align="right">0.9528304</td>
<td align="right">0.9528303</td>
</tr>
<tr class="even">
<td align="left">F04</td>
<td align="right">1.9253068</td>
<td align="right">1.9253067</td>
</tr>
<tr class="odd">
<td align="left">F11</td>
<td align="right">3.2219420</td>
<td align="right">3.2219418</td>
</tr>
</tbody>
</table>
<p>Why this is important:
- It demonstrates that random effects are not “free parameters” estimated independently.
- They are predictions, borrowing strength from the full dataset via <span class="math inline">\(\mathbf{V}^{-1}\)</span>.
- Shrinkage happens naturally through this formula.</p>
</div>
<div id="compute-predicted-values-1" class="section level3 hasAnchor" number="6.9.16">
<h3><span class="header-section-number">6.9.16</span> Compute predicted values<a href="statistical-models.html#compute-predicted-values-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In mixed models, the word “prediction” can mean different things:</p>
<ol style="list-style-type: decimal">
<li><strong>conditional</strong> (subject-specific) prediction: includes random effects<br />
</li>
<li><strong>marginal</strong> (population-average) prediction: excludes random effects</li>
</ol>
<p>Both are valid, but they answer different scientific questions.</p>
<p>In most applied analyses:
- “What is the expected trajectory for this subject?” → conditional
- “What is the average trajectory in the population?” → marginal</p>
<p>We now formalize both views.</p>
<div id="the-conditional-distribution" class="section level4 hasAnchor" number="6.9.16.1">
<h4><span class="header-section-number">6.9.16.1</span> The conditional distribution<a href="statistical-models.html#the-conditional-distribution" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Conditioning on random effects:</p>
<p><span class="math display">\[
\mathbf{y} \mid \mathbf{b} \sim \mathbf{N}\left(\mathbf{X}\boldsymbol{\beta}+\mathbf{Z}\mathbf{b}, \boldsymbol{\Sigma}\right).
\]</span></p>
<p>This implies that the conditional mean depends on both fixed and random components.</p>
<div id="conditional-mean-prediction" class="section level5 hasAnchor" number="6.9.16.1.1">
<h5><span class="header-section-number">6.9.16.1.1</span> Conditional mean prediction<a href="statistical-models.html#conditional-mean-prediction" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>For a new observation with design rows <span class="math inline">\(\mathbf{X}_0\)</span> and <span class="math inline">\(\mathbf{Z}_0\)</span>:</p>
<p><span class="math display">\[
E(\hat{Y}_0) = \mathbf{X}_0\hat{\boldsymbol\beta} + \mathbf{Z}_0\hat{\mathbf{u}}.
\]</span></p>
<p>The uncertainty in the conditional mean prediction comes from uncertainty in estimating <span class="math inline">\(\boldsymbol\beta\)</span> and <span class="math inline">\(\mathbf{u}\)</span> (and possibly from uncertainty in variance components, which we typically ignore in simple plug-in formulas).</p>
<p>Your derivation expands:</p>
<p><span class="math display">\[
\mathrm{Var}(X+Y)=\mathrm{Var}(X)+\mathrm{Var}(Y)+2\mathrm{Cov}(X,Y),
\]</span></p>
<p>so if we treat the fixed and random predictors as independent (a simplifying approximation), the covariance term is ignored and the prediction variance becomes “fixed-part variance + random-part variance.”</p>
<p>That leads to the practical decomposition:</p>
<p><span class="math display">\[
\mathrm{Var}(\hat{Y}_0) \approx \mathbf{X}_0 \,\widehat{\mathrm{Cov}}(\hat{\boldsymbol\beta})\, \mathbf{X}_0^\top
+ \mathbf{Z}_0 \,\widehat{\mathrm{Cov}}(\hat{\mathbf{u}})\, \mathbf{Z}_0^\top.
\]</span></p>
</div>
<div id="conditional-individual-prediction" class="section level5 hasAnchor" number="6.9.16.1.2">
<h5><span class="header-section-number">6.9.16.1.2</span> Conditional individual prediction<a href="statistical-models.html#conditional-individual-prediction" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>If we want a prediction interval for an actual future <span class="math inline">\(Y_0\)</span> (not just its mean), we must add residual variance:</p>
<p><span class="math display">\[
\mathrm{Var}(Y_0 - \hat{Y}_0)\approx \mathrm{Var}(\hat{Y}_0) + \sigma^2.
\]</span></p>
<p>This is exactly the distinction in your code between <code>SE_rand</code> (mean) and <code>SE_rand2</code> (individual).</p>
</div>
</div>
<div id="lower-level-conditional-prediction-in-r" class="section level4 hasAnchor" number="6.9.16.2">
<h4><span class="header-section-number">6.9.16.2</span> Lower level (conditional prediction) in R<a href="statistical-models.html#lower-level-conditional-prediction-in-r" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Here we compute subject-specific fitted values explicitly:</p>
<p><span class="math display">\[
\hat{\mathbf{y}} = \mathbf{X}\hat{\boldsymbol\beta} + \mathbf{Z}\hat{\mathbf{u}}.
\]</span></p>
<div class="sourceCode" id="cb879"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb879-1"><a href="statistical-models.html#cb879-1" tabindex="-1"></a><span class="co"># how to calculate predicted values</span></span>
<span id="cb879-2"><a href="statistical-models.html#cb879-2" tabindex="-1"></a>yhat <span class="ot">&lt;-</span> X<span class="sc">%*%</span>(fit.lmer2<span class="sc">$</span>coef<span class="sc">$</span>fixed)<span class="sc">+</span>Z<span class="sc">%*%</span> <span class="fu">as.numeric</span> ( uhat[[<span class="st">&quot;Subject&quot;</span>]])</span>
<span id="cb879-3"><a href="statistical-models.html#cb879-3" tabindex="-1"></a></span>
<span id="cb879-4"><a href="statistical-models.html#cb879-4" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">cbind</span> (yhat,<span class="fu">predict</span>(fit.lmer2),y))  <span class="co">#create individual trajectory curve   </span></span></code></pre></div>
<pre><code>## 6 x 3 Matrix of class &quot;dgeMatrix&quot;
##                        y
## 1 25.39237 25.39237 26.0
## 2 26.71274 26.71274 25.0
## 3 28.03311 28.03311 29.0
## 4 29.35348 29.35348 31.0
## 5 21.61052 21.61052 21.5
## 6 22.93089 22.93089 22.5</code></pre>
<p>The comparison shows that:
- your manual computation equals <code>predict(fit.lmer2)</code> at the default prediction level (subject-specific).</p>
<p>Next we compute an approximate standard error of conditional predictions by adding two components:
- fixed-effect contribution: <span class="math inline">\(\mathbf{X}\,\widehat{\mathrm{Cov}}(\hat{\boldsymbol\beta})\,\mathbf{X}^\top\)</span>
- random-effect contribution: <span class="math inline">\(\mathbf{Z}\,\widehat{\mathrm{Cov}}(\hat{\mathbf{u}})\,\mathbf{Z}^\top\)</span> (approximated here using the random intercept variance)</p>
<div class="sourceCode" id="cb881"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb881-1"><a href="statistical-models.html#cb881-1" tabindex="-1"></a><span class="co">#compute standard error for marginal predictions</span></span>
<span id="cb881-2"><a href="statistical-models.html#cb881-2" tabindex="-1"></a>predvar_rand <span class="ot">&lt;-</span> <span class="fu">diag</span>(X <span class="sc">%*%</span> fit.lmer2<span class="sc">$</span>varFix <span class="sc">%*%</span> <span class="fu">t</span>(X)) <span class="sc">+</span> <span class="fu">diag</span>(Z <span class="sc">%*%</span>  <span class="fu">diag</span>(<span class="fu">getVarCov</span>(fit.lmer2)[<span class="dv">1</span>]  ,<span class="dv">27</span>) <span class="sc">%*%</span> <span class="fu">t</span>(Z))</span>
<span id="cb881-3"><a href="statistical-models.html#cb881-3" tabindex="-1"></a></span>
<span id="cb881-4"><a href="statistical-models.html#cb881-4" tabindex="-1"></a>SE_rand <span class="ot">&lt;-</span> <span class="fu">sqrt</span> (predvar_rand)  <span class="co">#mean prediction </span></span>
<span id="cb881-5"><a href="statistical-models.html#cb881-5" tabindex="-1"></a>SE_rand2 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(predvar_rand<span class="sc">+</span>fit.lmer2<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span>)  <span class="co">#individual prediction </span></span>
<span id="cb881-6"><a href="statistical-models.html#cb881-6" tabindex="-1"></a><span class="fu">head</span>(SE_rand,<span class="dv">20</span>)</span></code></pre></div>
<pre><code>##        1        2        3        4        5        6        7        8 
## 1.880728 1.872639 1.872639 1.880728 1.880728 1.872639 1.872639 1.880728 
##        9       10       11       12       13       14       15       16 
## 1.880728 1.872639 1.872639 1.880728 1.880728 1.872639 1.872639 1.880728 
##       17       18       19       20 
## 1.880728 1.872639 1.872639 1.880728</code></pre>
<div class="sourceCode" id="cb883"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb883-1"><a href="statistical-models.html#cb883-1" tabindex="-1"></a><span class="fu">head</span>(SE_rand2,<span class="dv">20</span>)</span></code></pre></div>
<pre><code>##        1        2        3        4        5        6        7        8 
## 2.363598 2.357166 2.357166 2.363598 2.363598 2.357166 2.357166 2.363598 
##        9       10       11       12       13       14       15       16 
## 2.363598 2.357166 2.357166 2.363598 2.363598 2.357166 2.357166 2.363598 
##       17       18       19       20 
## 2.363598 2.357166 2.357166 2.363598</code></pre>
<p>A conceptual caution:
- In full generality, <span class="math inline">\(\widehat{\mathrm{Cov}}(\hat{\mathbf{u}})\)</span> is not simply <span class="math inline">\(\sigma_b^2 I\)</span>; it depends on <span class="math inline">\(\mathbf{D}\)</span> and <span class="math inline">\(\mathbf{V}^{-1}\)</span>.
- Your expression is a reasonable pedagogical approximation that highlights the idea of adding fixed and random contributions.</p>
</div>
</div>
<div id="the-marginal-distribution" class="section level3 hasAnchor" number="6.9.17">
<h3><span class="header-section-number">6.9.17</span> The marginal distribution<a href="statistical-models.html#the-marginal-distribution" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Integrating out random effects yields:</p>
<p><span class="math display">\[
\mathbf{y} \sim \mathrm{N}\left(\mathbf{X}\boldsymbol{\beta}, \mathbf{V}\right),
\]</span></p>
<p>where</p>
<p><span class="math display">\[
\mathrm{Cov}(\mathbf{y})=\mathbf{V}=\mathbf{Z}\mathbf{D}\mathbf{Z}^\top+\boldsymbol{\Sigma}.
\]</span></p>
<p>Here <span class="math inline">\(\mathbf{Z}\mathbf{D}\mathbf{Z}^\top\)</span> is the covariance induced by random effects, and <span class="math inline">\(\boldsymbol{\Sigma}\)</span> is the residual covariance (often <span class="math inline">\(\sigma^2 I\)</span> unless we specify a correlation structure).</p>
<div id="marginal-mean-prediction" class="section level4 hasAnchor" number="6.9.17.1">
<h4><span class="header-section-number">6.9.17.1</span> Marginal mean prediction<a href="statistical-models.html#marginal-mean-prediction" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The marginal mean depends only on fixed effects:</p>
<p><span class="math display">\[
E(\hat{Y}_0)=\mathbf{X}_0\hat{\boldsymbol\beta}.
\]</span></p>
<p>The variance of the marginal mean prediction uses only <span class="math inline">\(\widehat{\mathrm{Cov}}(\hat{\boldsymbol\beta})\)</span>:</p>
<p><span class="math display">\[
\mathrm{Var}(\hat{Y}_0)=\mathbf{X}_0 \,\widehat{\mathrm{Cov}}(\hat{\boldsymbol\beta})\, \mathbf{X}_0^\top.
\]</span></p>
</div>
<div id="marginal-individual-prediction" class="section level4 hasAnchor" number="6.9.17.2">
<h4><span class="header-section-number">6.9.17.2</span> Marginal individual prediction<a href="statistical-models.html#marginal-individual-prediction" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For predicting a new observation at the population level, we add residual variance:</p>
<p><span class="math display">\[
\mathrm{Var}(Y_0)\approx \mathrm{Var}(\hat{Y}_0)+\sigma^2.
\]</span></p>
</div>
<div id="higher-level-marginal-in-r" class="section level4 hasAnchor" number="6.9.17.3">
<h4><span class="header-section-number">6.9.17.3</span> Higher level (marginal) in R<a href="statistical-models.html#higher-level-marginal-in-r" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Your code computes the marginal prediction SE using only the fixed-effect variance component:</p>
<div class="sourceCode" id="cb885"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb885-1"><a href="statistical-models.html#cb885-1" tabindex="-1"></a><span class="co">#compute standard error for marginal predictions</span></span>
<span id="cb885-2"><a href="statistical-models.html#cb885-2" tabindex="-1"></a>predvar <span class="ot">&lt;-</span> <span class="fu">diag</span>(X <span class="sc">%*%</span> fit.lmer2<span class="sc">$</span>varFix <span class="sc">%*%</span> <span class="fu">t</span>(X))</span>
<span id="cb885-3"><a href="statistical-models.html#cb885-3" tabindex="-1"></a></span>
<span id="cb885-4"><a href="statistical-models.html#cb885-4" tabindex="-1"></a>SE <span class="ot">&lt;-</span> <span class="fu">sqrt</span> (predvar)  <span class="co">#mean prediction </span></span>
<span id="cb885-5"><a href="statistical-models.html#cb885-5" tabindex="-1"></a>SE2 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(predvar<span class="sc">+</span>fit.lmer2<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span>)  <span class="co">#individual prediction</span></span>
<span id="cb885-6"><a href="statistical-models.html#cb885-6" tabindex="-1"></a><span class="fu">head</span>(SE,<span class="dv">10</span>)</span></code></pre></div>
<pre><code>##         1         2         3         4         5         6         7         8 
## 0.5199561 0.4898898 0.4898898 0.5199561 0.5199561 0.4898898 0.4898898 0.5199561 
##         9        10 
## 0.5199561 0.4898898</code></pre>
<div class="sourceCode" id="cb887"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb887-1"><a href="statistical-models.html#cb887-1" tabindex="-1"></a><span class="fu">head</span>(SE2,<span class="dv">10</span>)</span></code></pre></div>
<pre><code>##        1        2        3        4        5        6        7        8 
## 1.523092 1.513092 1.513092 1.523092 1.523092 1.513092 1.513092 1.523092 
##        9       10 
## 1.523092 1.513092</code></pre>
<p>Then it forms approximate 95% bounds:</p>
<ul>
<li>mean prediction band: <span class="math inline">\(\hat{\mu} \pm 1.96\,SE\)</span></li>
<li>individual prediction band: <span class="math inline">\(\hat{\mu} \pm 1.96\,SE2\)</span></li>
</ul>
<div class="sourceCode" id="cb889"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb889-1"><a href="statistical-models.html#cb889-1" tabindex="-1"></a>up<span class="ot">=</span><span class="fu">predict</span>(fit.lmer2, <span class="at">newdata=</span>Data, <span class="at">level=</span><span class="dv">0</span>) <span class="sc">+</span><span class="fl">1.96</span> <span class="sc">*</span>SE  <span class="co">#mean prediction </span></span>
<span id="cb889-2"><a href="statistical-models.html#cb889-2" tabindex="-1"></a>up2<span class="ot">=</span><span class="fu">predict</span>(fit.lmer2, <span class="at">newdata=</span>Data, <span class="at">level=</span><span class="dv">0</span>) <span class="sc">+</span><span class="fl">1.96</span> <span class="sc">*</span>SE2  <span class="co">#individual prediction </span></span>
<span id="cb889-3"><a href="statistical-models.html#cb889-3" tabindex="-1"></a><span class="fu">head</span>(up)</span></code></pre></div>
<pre><code>##        1        2        3        4        5        6 
## 24.00731 25.26875 26.58912 27.96842 24.00731 25.26875</code></pre>
<div class="sourceCode" id="cb891"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb891-1"><a href="statistical-models.html#cb891-1" tabindex="-1"></a><span class="fu">head</span>(up2)</span></code></pre></div>
<pre><code>##        1        2        3        4        5        6 
## 25.97346 27.27423 28.59460 29.93457 25.97346 27.27423</code></pre>
<p>Note the crucial use of <code>level=0</code>:
- <code>level=0</code> gives marginal predictions (fixed effects only)
- <code>level=1</code> (or default) typically includes random effects for subject-specific predictions</p>
<p>Finally, <code>ggeffects::ggpredict()</code> provides a convenient interface for marginal effects plots (your code uses <code>%&gt;%</code>, but we keep it unchanged as requested).</p>
<div class="sourceCode" id="cb893"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb893-1"><a href="statistical-models.html#cb893-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb893-2"><a href="statistical-models.html#cb893-2" tabindex="-1"></a><span class="fu">library</span>(ggeffects)</span></code></pre></div>
<pre><code>## Warning: package &#39;ggeffects&#39; was built under R version 4.4.3</code></pre>
<div class="sourceCode" id="cb895"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb895-1"><a href="statistical-models.html#cb895-1" tabindex="-1"></a><span class="fu">ggpredict</span>(fit.lmer2,<span class="at">terms=</span><span class="fu">c</span>(<span class="st">&quot;age&quot;</span> ))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
<th align="right">predicted</th>
<th align="right">std.error</th>
<th align="right">conf.low</th>
<th align="right">conf.high</th>
<th align="left">group</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">8</td>
<td align="right">22.98819</td>
<td align="right">0.5199561</td>
<td align="right">21.96910</td>
<td align="right">24.00729</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">24.30856</td>
<td align="right">0.4898898</td>
<td align="right">23.34840</td>
<td align="right">25.26873</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="right">12</td>
<td align="right">25.62894</td>
<td align="right">0.4898898</td>
<td align="right">24.66877</td>
<td align="right">26.58910</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="right">14</td>
<td align="right">26.94931</td>
<td align="right">0.5199561</td>
<td align="right">25.93021</td>
<td align="right">27.96840</td>
<td align="left">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb896"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb896-1"><a href="statistical-models.html#cb896-1" tabindex="-1"></a><span class="co"># ggpredict(fit.lmer2,terms=c(&quot;age&quot; ))  %&gt;% plot(rawdata = T, dot.alpha = 0.2)</span></span>
<span id="cb896-2"><a href="statistical-models.html#cb896-2" tabindex="-1"></a><span class="co"># ggpredict(fit.lmer2,&quot;age&quot;,   type = &quot;re&quot; )  %&gt;% plot(rawdata = T, dot.alpha = 0.2)</span></span>
<span id="cb896-3"><a href="statistical-models.html#cb896-3" tabindex="-1"></a></span>
<span id="cb896-4"><a href="statistical-models.html#cb896-4" tabindex="-1"></a><span class="fu">library</span>(sjPlot)</span>
<span id="cb896-5"><a href="statistical-models.html#cb896-5" tabindex="-1"></a><span class="fu">plot_model</span>(fit.lmer2, <span class="at">type =</span> <span class="st">&quot;pred&quot;</span>, <span class="at">terms =</span> <span class="st">&quot;age&quot;</span>, <span class="at">show.data =</span> <span class="cn">TRUE</span>, <span class="at">dot.alpha =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-398-1.png" alt="" width="672" /></p>
<p>Your “Compute SE by hand” numeric values are a useful checkpoint: they suggest that the analytic SE derived from <span class="math inline">\(\mathbf{X}\widehat{\mathrm{Cov}}(\hat{\boldsymbol\beta})\mathbf{X}^\top\)</span> matches a simpler calculation for specific design points.</p>
</div>
</div>
<div id="extending-the-covariance-structure-correlated-residual-errors" class="section level3 hasAnchor" number="6.9.18">
<h3><span class="header-section-number">6.9.18</span> Extending the covariance structure: correlated residual errors<a href="statistical-models.html#extending-the-covariance-structure-correlated-residual-errors" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>So far, our baseline model assumed independent residuals:</p>
<p><span class="math display">\[
\boldsymbol{\Sigma}=\sigma^2\mathbf{I}.
\]</span></p>
<p>But longitudinal data often have residual correlations over time even after accounting for random effects. <code>nlme</code> allows us to specify parametric correlation structures for residuals within subjects.</p>
<p>A key conceptual point:</p>
<ul>
<li>random effects model <em>between-subject</em> heterogeneity (e.g., different baseline levels),</li>
<li>residual correlation structures model <em>within-subject temporal dependence</em> beyond random effects.</li>
</ul>
</div>
<div id="using-lme-with-gaussian-correlation" class="section level3 hasAnchor" number="6.9.19">
<h3><span class="header-section-number">6.9.19</span> Using lme with Gaussian correlation<a href="statistical-models.html#using-lme-with-gaussian-correlation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A Gaussian correlation structure implies residual correlation decays with distance in time (here, age). With a nugget effect, we allow a discontinuity at distance 0 (measurement error).</p>
<div class="sourceCode" id="cb897"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb897-1"><a href="statistical-models.html#cb897-1" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb897-2"><a href="statistical-models.html#cb897-2" tabindex="-1"></a></span>
<span id="cb897-3"><a href="statistical-models.html#cb897-3" tabindex="-1"></a>fit.lmer.gaus <span class="ot">&lt;-</span> <span class="fu">lme</span>(distance <span class="sc">~</span> age <span class="sc">+</span> Sex  , <span class="at">random =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> Subject, <span class="at">correlation=</span><span class="fu">corGaus</span>(<span class="at">form=</span> <span class="sc">~</span> age<span class="sc">|</span>Subject, <span class="at">nugget=</span><span class="cn">TRUE</span>), <span class="at">data =</span> Data) </span>
<span id="cb897-4"><a href="statistical-models.html#cb897-4" tabindex="-1"></a><span class="fu">summary</span>(fit.lmer.gaus)</span></code></pre></div>
<pre><code>## Linear mixed-effects model fit by REML
##   Data: Data 
##        AIC      BIC    logLik
##   451.4311 470.0089 -218.7156
## 
## Random effects:
##  Formula: ~1 | Subject
##         (Intercept) Residual
## StdDev:    1.795504 1.446192
## 
## Correlation Structure: Gaussian spatial correlation
##  Formula: ~age | Subject 
##  Parameter estimate(s):
##     range    nugget 
## 1.1324270 0.1039536 
## Fixed effects:  distance ~ age + Sex 
##                 Value Std.Error DF   t-value p-value
## (Intercept) 17.717033 0.8448813 80 20.969848  0.0000
## age          0.659620 0.0628344 80 10.497756  0.0000
## SexFemale   -2.325355 0.7612563 25 -3.054629  0.0053
##  Correlation: 
##           (Intr) age   
## age       -0.818       
## SexFemale -0.367  0.000
## 
## Standardized Within-Group Residuals:
##         Min          Q1         Med          Q3         Max 
## -3.70618679 -0.54458678 -0.01435195  0.45606804  3.62915585 
## 
## Number of Observations: 108
## Number of Groups: 27</code></pre>
<p>Variogram plots visualize how empirical semi-variance changes with time separation. In longitudinal settings, they act like a diagnostic for residual correlation: if semi-variance increases with lag, that indicates correlation decays as time separation grows.</p>
<div class="sourceCode" id="cb899"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb899-1"><a href="statistical-models.html#cb899-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">plot</span>(<span class="fu">Variogram</span>(fit.lmer.gaus, <span class="at">form =</span><span class="sc">~</span><span class="fu">as.numeric</span>(age)<span class="sc">|</span>Subject,</span>
<span id="cb899-2"><a href="statistical-models.html#cb899-2" tabindex="-1"></a><span class="at">data =</span> Data)))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-400-1.png" alt="" width="672" /></p>
<p>We can again extract <span class="math inline">\(\mathbf{V}\)</span> (now incorporating the Gaussian residual correlation) and verify that GLS formulas still apply. The only difference is that <span class="math inline">\(\mathbf{V}\)</span> is no longer compound symmetric.</p>
<div class="sourceCode" id="cb900"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb900-1"><a href="statistical-models.html#cb900-1" tabindex="-1"></a><span class="fu">require</span>(mgcv)</span>
<span id="cb900-2"><a href="statistical-models.html#cb900-2" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb900-3"><a href="statistical-models.html#cb900-3" tabindex="-1"></a> </span>
<span id="cb900-4"><a href="statistical-models.html#cb900-4" tabindex="-1"></a>cov.gaus <span class="ot">&lt;-</span> <span class="fu">extract.lme.cov</span>(fit.lmer.gaus,Data)</span>
<span id="cb900-5"><a href="statistical-models.html#cb900-5" tabindex="-1"></a><span class="fu">head</span>(cov.gaus)</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="right">5.315307</td>
<td align="right">3.306657</td>
<td align="right">3.223843</td>
<td align="right">3.223836</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">3.306657</td>
<td align="right">5.315307</td>
<td align="right">3.306657</td>
<td align="right">3.223843</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">3.223843</td>
<td align="right">3.306657</td>
<td align="right">5.315307</td>
<td align="right">3.306657</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">3.223836</td>
<td align="right">3.223843</td>
<td align="right">3.306657</td>
<td align="right">5.315307</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">5.315307</td>
<td align="right">3.306657</td>
<td align="right">3.223843</td>
<td align="right">3.223836</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">3.306657</td>
<td align="right">5.315307</td>
<td align="right">3.306657</td>
<td align="right">3.223843</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb901"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb901-1"><a href="statistical-models.html#cb901-1" tabindex="-1"></a><span class="fu">dim</span>(cov.gaus)</span></code></pre></div>
<pre><code>## [1] 108 108</code></pre>
<p>Compute fixed effects using the Gaussian covariance:</p>
<p><span class="math display">\[
\hat{\boldsymbol\beta}_{GLS} = (\mathbf{X}^\top \mathbf{V}^{-1}\mathbf{X})^{-1}\mathbf{X}^\top \mathbf{V}^{-1}\mathbf{y}.
\]</span></p>
<div class="sourceCode" id="cb903"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb903-1"><a href="statistical-models.html#cb903-1" tabindex="-1"></a><span class="fu">library</span>(matlib)</span>
<span id="cb903-2"><a href="statistical-models.html#cb903-2" tabindex="-1"></a><span class="fu">inv</span>(<span class="fu">t</span>(<span class="fu">as.matrix</span>(X))<span class="sc">%*%</span><span class="fu">inv</span>(<span class="fu">as.matrix</span>(cov.gaus))<span class="sc">%*%</span><span class="fu">as.matrix</span>(X))<span class="sc">%*%</span><span class="fu">t</span>(<span class="fu">as.matrix</span>(X))<span class="sc">%*%</span><span class="fu">inv</span>(<span class="fu">as.matrix</span>(cov.gaus))<span class="sc">%*%</span>y</span></code></pre></div>
<table>
<tbody>
<tr class="odd">
<td align="right">17.7170272</td>
</tr>
<tr class="even">
<td align="right">0.6596201</td>
</tr>
<tr class="odd">
<td align="right">-2.3253552</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb904"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb904-1"><a href="statistical-models.html#cb904-1" tabindex="-1"></a>fit.lmer.gaus<span class="sc">$</span>coef<span class="sc">$</span>fixed</span></code></pre></div>
<pre><code>## (Intercept)         age   SexFemale 
##   17.717033    0.659620   -2.325355</code></pre>
<p>This equivalence is a powerful principle:
&gt; Mixed models are GLS with a structured covariance matrix.</p>
</div>
<div id="using-lme-with-autoregressive-ar1" class="section level3 hasAnchor" number="6.9.20">
<h3><span class="header-section-number">6.9.20</span> Using lme with autoregressive (AR1)<a href="statistical-models.html#using-lme-with-autoregressive-ar1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>An AR(1) residual structure assumes correlation decays geometrically with time lag:</p>
<p><span class="math display">\[
\mathrm{Cor}(\varepsilon_{ij},\varepsilon_{ik})=\rho^{|t_{ij}-t_{ik}|},
\]</span></p>
<p>under equally spaced times; with irregular spacing, <code>nlme</code> uses an appropriate generalization based on the numeric time covariate.</p>
<div class="sourceCode" id="cb906"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb906-1"><a href="statistical-models.html#cb906-1" tabindex="-1"></a>fit.lmer.AR1 <span class="ot">&lt;-</span> <span class="fu">lme</span>(distance <span class="sc">~</span> age <span class="sc">+</span> Sex  , <span class="at">random =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> Subject, <span class="at">correlation=</span><span class="fu">corAR1</span>(<span class="at">form=</span> <span class="sc">~</span> <span class="fu">as.numeric</span>(age)<span class="sc">|</span>Subject ), <span class="at">data =</span> Data) </span>
<span id="cb906-2"><a href="statistical-models.html#cb906-2" tabindex="-1"></a><span class="fu">summary</span>(fit.lmer.AR1)</span></code></pre></div>
<pre><code>## Linear mixed-effects model fit by REML
##   Data: Data 
##        AIC      BIC    logLik
##   449.5125 465.4363 -218.7563
## 
## Random effects:
##  Formula: ~1 | Subject
##         (Intercept) Residual
## StdDev:    1.807425 1.431592
## 
## Correlation Structure: ARMA(1,0)
##  Formula: ~as.numeric(age) | Subject 
##  Parameter estimate(s):
## Phi1 
##    0 
## Fixed effects:  distance ~ age + Sex 
##                 Value Std.Error DF   t-value p-value
## (Intercept) 17.706713 0.8339225 80 21.233044  0.0000
## age          0.660185 0.0616059 80 10.716263  0.0000
## SexFemale   -2.321023 0.7614168 25 -3.048294  0.0054
##  Correlation: 
##           (Intr) age   
## age       -0.813       
## SexFemale -0.372  0.000
## 
## Standardized Within-Group Residuals:
##         Min          Q1         Med          Q3         Max 
## -3.74889609 -0.55034466 -0.02516628  0.45341781  3.65746539 
## 
## Number of Observations: 108
## Number of Groups: 27</code></pre>
<p>Variogram diagnostic:</p>
<div class="sourceCode" id="cb908"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb908-1"><a href="statistical-models.html#cb908-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">plot</span>(<span class="fu">Variogram</span>(fit.lmer.AR1, <span class="at">form =</span><span class="sc">~</span><span class="fu">as.numeric</span>(age)<span class="sc">|</span>Subject,</span>
<span id="cb908-2"><a href="statistical-models.html#cb908-2" tabindex="-1"></a><span class="at">data =</span> Data)))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-404-1.png" alt="" width="672" /></p>
<p>Extract covariance:</p>
<div class="sourceCode" id="cb909"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb909-1"><a href="statistical-models.html#cb909-1" tabindex="-1"></a><span class="fu">require</span>(mgcv)</span>
<span id="cb909-2"><a href="statistical-models.html#cb909-2" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb909-3"><a href="statistical-models.html#cb909-3" tabindex="-1"></a> </span>
<span id="cb909-4"><a href="statistical-models.html#cb909-4" tabindex="-1"></a>cov.AR1 <span class="ot">&lt;-</span> <span class="fu">extract.lme.cov</span>(fit.lmer.AR1,Data)</span>
<span id="cb909-5"><a href="statistical-models.html#cb909-5" tabindex="-1"></a><span class="fu">head</span>(cov.AR1)</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="right">5.316240</td>
<td align="right">3.266784</td>
<td align="right">3.266784</td>
<td align="right">3.266784</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">3.266784</td>
<td align="right">5.316240</td>
<td align="right">3.266784</td>
<td align="right">3.266784</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">3.266784</td>
<td align="right">3.266784</td>
<td align="right">5.316240</td>
<td align="right">3.266784</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">3.266784</td>
<td align="right">3.266784</td>
<td align="right">3.266784</td>
<td align="right">5.316240</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">5.316240</td>
<td align="right">3.266784</td>
<td align="right">3.266784</td>
<td align="right">3.266784</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">3.266784</td>
<td align="right">5.316240</td>
<td align="right">3.266784</td>
<td align="right">3.266784</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb910"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb910-1"><a href="statistical-models.html#cb910-1" tabindex="-1"></a><span class="fu">dim</span>(cov.AR1)</span></code></pre></div>
<pre><code>## [1] 108 108</code></pre>
</div>
<div id="using-lme-with-exponential-correlation" class="section level3 hasAnchor" number="6.9.21">
<h3><span class="header-section-number">6.9.21</span> Using lme with exponential correlation<a href="statistical-models.html#using-lme-with-exponential-correlation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Exponential correlation decays continuously with lag:</p>
<p><span class="math display">\[
\mathrm{Cor}(\varepsilon_{ij},\varepsilon_{ik})=\exp(-\phi |t_{ij}-t_{ik}|).
\]</span></p>
<p>This is often used in spatial and longitudinal settings.</p>
<div class="sourceCode" id="cb912"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb912-1"><a href="statistical-models.html#cb912-1" tabindex="-1"></a>fit.lmer.Exp <span class="ot">&lt;-</span> <span class="fu">lme</span>(distance <span class="sc">~</span> age <span class="sc">+</span> Sex  , <span class="at">random =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> Subject, <span class="at">correlation=</span><span class="fu">corExp</span>(<span class="at">form=</span> <span class="sc">~</span> <span class="fu">as.numeric</span>(age)<span class="sc">|</span>Subject ), <span class="at">data =</span> Data) </span>
<span id="cb912-2"><a href="statistical-models.html#cb912-2" tabindex="-1"></a><span class="fu">summary</span>(fit.lmer.Exp)</span></code></pre></div>
<pre><code>## Linear mixed-effects model fit by REML
##   Data: Data 
##        AIC      BIC    logLik
##   449.3968 465.3206 -218.6984
## 
## Random effects:
##  Formula: ~1 | Subject
##         (Intercept) Residual
## StdDev:    1.788899 1.454494
## 
## Correlation Structure: Exponential spatial correlation
##  Formula: ~as.numeric(age) | Subject 
##  Parameter estimate(s):
##     range 
## 0.7045117 
## Fixed effects:  distance ~ age + Sex 
##                 Value Std.Error DF   t-value p-value
## (Intercept) 17.721416 0.8500193 80 20.848250  0.0000
## age          0.659405 0.0634074 80 10.399499  0.0000
## SexFemale   -2.327485 0.7611852 25 -3.057711  0.0053
##  Correlation: 
##           (Intr) age   
## age       -0.821       
## SexFemale -0.365  0.000
## 
## Standardized Within-Group Residuals:
##          Min           Q1          Med           Q3          Max 
## -3.683026666 -0.540915318 -0.008097445  0.461167542  3.612579065 
## 
## Number of Observations: 108
## Number of Groups: 27</code></pre>
<p>Variogram:</p>
<div class="sourceCode" id="cb914"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb914-1"><a href="statistical-models.html#cb914-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">plot</span>(<span class="fu">Variogram</span>(fit.lmer.Exp, <span class="at">form =</span><span class="sc">~</span><span class="fu">as.numeric</span>(age)<span class="sc">|</span>Subject,</span>
<span id="cb914-2"><a href="statistical-models.html#cb914-2" tabindex="-1"></a><span class="at">data =</span> Data)))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-407-1.png" alt="" width="672" /></p>
<p>Extract covariance:</p>
<div class="sourceCode" id="cb915"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb915-1"><a href="statistical-models.html#cb915-1" tabindex="-1"></a><span class="fu">require</span>(mgcv)</span>
<span id="cb915-2"><a href="statistical-models.html#cb915-2" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb915-3"><a href="statistical-models.html#cb915-3" tabindex="-1"></a> </span>
<span id="cb915-4"><a href="statistical-models.html#cb915-4" tabindex="-1"></a>cov.Exp <span class="ot">&lt;-</span> <span class="fu">extract.lme.cov</span>(fit.lmer.Exp,Data)</span>
<span id="cb915-5"><a href="statistical-models.html#cb915-5" tabindex="-1"></a><span class="fu">head</span>(cov.Exp)</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="right">5.315710</td>
<td align="right">3.323904</td>
<td align="right">3.207397</td>
<td align="right">3.200582</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">3.323904</td>
<td align="right">5.315710</td>
<td align="right">3.323904</td>
<td align="right">3.207397</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">3.207397</td>
<td align="right">3.323904</td>
<td align="right">5.315710</td>
<td align="right">3.323904</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">3.200582</td>
<td align="right">3.207397</td>
<td align="right">3.323904</td>
<td align="right">5.315710</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">5.315710</td>
<td align="right">3.323904</td>
<td align="right">3.207397</td>
<td align="right">3.200582</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">3.323904</td>
<td align="right">5.315710</td>
<td align="right">3.323904</td>
<td align="right">3.207397</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb916"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb916-1"><a href="statistical-models.html#cb916-1" tabindex="-1"></a><span class="fu">dim</span>(cov.Exp)</span></code></pre></div>
<pre><code>## [1] 108 108</code></pre>
</div>
<div id="using-lme-with-unstructured-residual-correlation-corsymm" class="section level3 hasAnchor" number="6.9.22">
<h3><span class="header-section-number">6.9.22</span> Using lme with unstructured residual correlation (corSymm)<a href="statistical-models.html#using-lme-with-unstructured-residual-correlation-corsymm" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>An unstructured residual correlation places minimal constraints on within-subject correlations, allowing each pairwise correlation to be estimated (subject to positive definiteness). Because this can be unstable, <code>nlme</code> often pairs it with heteroscedasticity modeling such as <code>varIdent</code>.</p>
<p>Conceptually, this approach says:
- “I do not want to impose a parametric decay pattern.”
- “Let the data estimate the correlation pattern.”</p>
<div class="sourceCode" id="cb918"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb918-1"><a href="statistical-models.html#cb918-1" tabindex="-1"></a>fit.lmer.corSymm <span class="ot">&lt;-</span> <span class="fu">lme</span>(distance <span class="sc">~</span> age <span class="sc">+</span> Sex  , <span class="at">random =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span>  (Subject), <span class="at">correlation=</span><span class="fu">corSymm</span>(<span class="at">form=</span> <span class="sc">~</span> <span class="dv">1</span><span class="sc">|</span> (Subject) ),</span>
<span id="cb918-2"><a href="statistical-models.html#cb918-2" tabindex="-1"></a>                     <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form=</span><span class="sc">~</span><span class="dv">1</span><span class="sc">|</span>age),</span>
<span id="cb918-3"><a href="statistical-models.html#cb918-3" tabindex="-1"></a>                     <span class="at">data =</span> Data)</span>
<span id="cb918-4"><a href="statistical-models.html#cb918-4" tabindex="-1"></a><span class="fu">summary</span>(fit.lmer.corSymm)</span></code></pre></div>
<pre><code>## Linear mixed-effects model fit by REML
##   Data: Data 
##        AIC    BIC    logLik
##   456.6945 493.85 -214.3473
## 
## Random effects:
##  Formula: ~1 | Subject
##         (Intercept) Residual
## StdDev:    1.783141 1.481552
## 
## Correlation Structure: General
##  Formula: ~1 | (Subject) 
##  Parameter estimate(s):
##  Correlation: 
##   1      2      3     
## 2 -0.260              
## 3  0.238 -0.149       
## 4 -0.251 -0.007  0.426
## Variance function:
##  Structure: Different standard deviations per stratum
##  Formula: ~1 | age 
##  Parameter estimates:
##        8       10       12       14 
## 1.000000 0.686841 1.199078 1.000414 
## Fixed effects:  distance ~ age + Sex 
##                 Value Std.Error DF   t-value p-value
## (Intercept) 17.417591 0.8657147 80 20.119319  0.0000
## age          0.674651 0.0702289 80  9.606462  0.0000
## SexFemale   -2.045167 0.7361373 25 -2.778241  0.0102
##  Correlation: 
##           (Intr) age   
## age       -0.840       
## SexFemale -0.346  0.000
## 
## Standardized Within-Group Residuals:
##         Min          Q1         Med          Q3         Max 
## -3.33886326 -0.56222386  0.01374189  0.52235946  3.99060056 
## 
## Number of Observations: 108
## Number of Groups: 27</code></pre>
<p>Variogram:</p>
<div class="sourceCode" id="cb920"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb920-1"><a href="statistical-models.html#cb920-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">plot</span>(<span class="fu">Variogram</span>(fit.lmer.corSymm, <span class="at">form =</span><span class="sc">~</span><span class="fu">as.numeric</span>(age)<span class="sc">|</span>Subject,</span>
<span id="cb920-2"><a href="statistical-models.html#cb920-2" tabindex="-1"></a><span class="at">data =</span> Data)))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-410-1.png" alt="" width="672" /></p>
<p>Extract covariance:</p>
<div class="sourceCode" id="cb921"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb921-1"><a href="statistical-models.html#cb921-1" tabindex="-1"></a><span class="fu">require</span>(mgcv)</span>
<span id="cb921-2"><a href="statistical-models.html#cb921-2" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb921-3"><a href="statistical-models.html#cb921-3" tabindex="-1"></a> </span>
<span id="cb921-4"><a href="statistical-models.html#cb921-4" tabindex="-1"></a>cov.corSymm <span class="ot">&lt;-</span> <span class="fu">extract.lme.cov</span>(fit.lmer.corSymm,Data)</span>
<span id="cb921-5"><a href="statistical-models.html#cb921-5" tabindex="-1"></a><span class="fu">head</span>(cov.corSymm)</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="right">5.374589</td>
<td align="right">2.786932</td>
<td align="right">3.807032</td>
<td align="right">2.628359</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">2.786932</td>
<td align="right">4.215083</td>
<td align="right">2.909655</td>
<td align="right">3.168382</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">3.807032</td>
<td align="right">2.909655</td>
<td align="right">6.335531</td>
<td align="right">4.301450</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">2.628359</td>
<td align="right">3.168382</td>
<td align="right">4.301450</td>
<td align="right">5.376406</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">5.374589</td>
<td align="right">2.786932</td>
<td align="right">3.807032</td>
<td align="right">2.628359</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">2.786932</td>
<td align="right">4.215083</td>
<td align="right">2.909655</td>
<td align="right">3.168382</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb922"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb922-1"><a href="statistical-models.html#cb922-1" tabindex="-1"></a><span class="fu">dim</span>(cov.corSymm)</span></code></pre></div>
<pre><code>## [1] 108 108</code></pre>
</div>
<div id="using-lme-with-compound-symmetry-residual-correlation-corcompsymm" class="section level3 hasAnchor" number="6.9.23">
<h3><span class="header-section-number">6.9.23</span> Using lme with compound symmetry residual correlation (corCompSymm)<a href="statistical-models.html#using-lme-with-compound-symmetry-residual-correlation-corcompsymm" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Compound symmetry as a residual correlation structure assumes constant correlation within a subject:</p>
<p><span class="math display">\[
\mathrm{Cor}(\varepsilon_{ij},\varepsilon_{ik})=\rho \quad (j\neq k).
\]</span></p>
<p>This resembles what a random intercept induces, but note the difference:</p>
<ul>
<li>Random intercept creates compound symmetry through <span class="math inline">\(\mathbf{Z}\mathbf{D}\mathbf{Z}^\top\)</span></li>
<li>corCompSymm creates compound symmetry through <span class="math inline">\(\boldsymbol\Sigma\)</span></li>
</ul>
<p>In practice, both can produce similar marginal covariance patterns, but they represent different modeling stories.</p>
<div class="sourceCode" id="cb924"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb924-1"><a href="statistical-models.html#cb924-1" tabindex="-1"></a>fit.lmer.Symm <span class="ot">&lt;-</span> <span class="fu">lme</span>(distance <span class="sc">~</span> age <span class="sc">+</span> Sex  , <span class="at">random =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span>  (Subject), <span class="at">correlation=</span><span class="fu">corCompSymm</span>(<span class="at">form=</span> <span class="sc">~</span> <span class="fu">as.numeric</span>(age)<span class="sc">|</span> (Subject) ), <span class="at">data =</span> Data) </span>
<span id="cb924-2"><a href="statistical-models.html#cb924-2" tabindex="-1"></a><span class="fu">summary</span>(fit.lmer.Symm)</span></code></pre></div>
<pre><code>## Linear mixed-effects model fit by REML
##   Data: Data 
##        AIC      BIC    logLik
##   449.5125 465.4363 -218.7563
## 
## Random effects:
##  Formula: ~1 | Subject
##         (Intercept) Residual
## StdDev:    1.807425 1.431592
## 
## Correlation Structure: Compound symmetry
##  Formula: ~as.numeric(age) | (Subject) 
##  Parameter estimate(s):
## Rho 
##   0 
## Fixed effects:  distance ~ age + Sex 
##                 Value Std.Error DF   t-value p-value
## (Intercept) 17.706713 0.8339225 80 21.233044  0.0000
## age          0.660185 0.0616059 80 10.716263  0.0000
## SexFemale   -2.321023 0.7614168 25 -3.048294  0.0054
##  Correlation: 
##           (Intr) age   
## age       -0.813       
## SexFemale -0.372  0.000
## 
## Standardized Within-Group Residuals:
##         Min          Q1         Med          Q3         Max 
## -3.74889609 -0.55034466 -0.02516628  0.45341781  3.65746539 
## 
## Number of Observations: 108
## Number of Groups: 27</code></pre>
<p>Variogram:</p>
<div class="sourceCode" id="cb926"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb926-1"><a href="statistical-models.html#cb926-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">plot</span>(<span class="fu">Variogram</span>(fit.lmer.Symm, <span class="at">form =</span><span class="sc">~</span><span class="fu">as.numeric</span>(age)<span class="sc">|</span>Subject,</span>
<span id="cb926-2"><a href="statistical-models.html#cb926-2" tabindex="-1"></a><span class="at">data =</span> Data)))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-413-1.png" alt="" width="672" /></p>
<p>Extract covariance:</p>
<div class="sourceCode" id="cb927"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb927-1"><a href="statistical-models.html#cb927-1" tabindex="-1"></a><span class="fu">require</span>(mgcv)</span>
<span id="cb927-2"><a href="statistical-models.html#cb927-2" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb927-3"><a href="statistical-models.html#cb927-3" tabindex="-1"></a> </span>
<span id="cb927-4"><a href="statistical-models.html#cb927-4" tabindex="-1"></a>cov.Symm <span class="ot">&lt;-</span> <span class="fu">extract.lme.cov</span>(fit.lmer.Symm,Data)</span>
<span id="cb927-5"><a href="statistical-models.html#cb927-5" tabindex="-1"></a><span class="fu">head</span>(cov.Symm)</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="0%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="right">5.316240</td>
<td align="right">3.266784</td>
<td align="right">3.266784</td>
<td align="right">3.266784</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">3.266784</td>
<td align="right">5.316240</td>
<td align="right">3.266784</td>
<td align="right">3.266784</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">3.266784</td>
<td align="right">3.266784</td>
<td align="right">5.316240</td>
<td align="right">3.266784</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">3.266784</td>
<td align="right">3.266784</td>
<td align="right">3.266784</td>
<td align="right">5.316240</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">5.316240</td>
<td align="right">3.266784</td>
<td align="right">3.266784</td>
<td align="right">3.266784</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="right">3.266784</td>
<td align="right">5.316240</td>
<td align="right">3.266784</td>
<td align="right">3.266784</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb928"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb928-1"><a href="statistical-models.html#cb928-1" tabindex="-1"></a><span class="fu">dim</span>(cov.Symm)</span></code></pre></div>
<pre><code>## [1] 108 108</code></pre>
</div>
<div id="gls-models-correlation-in-residuals-without-random-effects" class="section level3 hasAnchor" number="6.9.24">
<h3><span class="header-section-number">6.9.24</span> GLS models: correlation in residuals without random effects<a href="statistical-models.html#gls-models-correlation-in-residuals-without-random-effects" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>gls()</code> function fits models where all correlation is placed in the residuals. This can be useful when:</p>
<ul>
<li>you do not need subject-level random effects, or</li>
<li>you want a pure covariance-modeling approach.</li>
</ul>
</div>
<div id="gls-with-unstructured-correlation" class="section level3 hasAnchor" number="6.9.25">
<h3><span class="header-section-number">6.9.25</span> GLS with unstructured correlation<a href="statistical-models.html#gls-with-unstructured-correlation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb930"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb930-1"><a href="statistical-models.html#cb930-1" tabindex="-1"></a>gls.corsymm <span class="ot">&lt;-</span> <span class="fu">gls</span>(distance <span class="sc">~</span> Sex <span class="sc">+</span>age, Orthodont,</span>
<span id="cb930-2"><a href="statistical-models.html#cb930-2" tabindex="-1"></a>                   <span class="at">correlation =</span> <span class="fu">corSymm</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> Subject),</span>
<span id="cb930-3"><a href="statistical-models.html#cb930-3" tabindex="-1"></a>                   <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form=</span><span class="sc">~</span><span class="dv">1</span><span class="sc">|</span>age))</span>
<span id="cb930-4"><a href="statistical-models.html#cb930-4" tabindex="-1"></a><span class="fu">summary</span>(gls.corsymm)</span></code></pre></div>
<pre><code>## Generalized least squares fit by REML
##   Model: distance ~ Sex + age 
##   Data: Orthodont 
##        AIC     BIC    logLik
##   454.6945 489.196 -214.3473
## 
## Correlation Structure: General
##  Formula: ~1 | Subject 
##  Parameter estimate(s):
##  Correlation: 
##   1     2     3    
## 2 0.586            
## 3 0.652 0.563      
## 4 0.489 0.666 0.737
## Variance function:
##  Structure: Different standard deviations per stratum
##  Formula: ~1 | age 
##  Parameter estimates:
##         8        10        12        14 
## 1.0000000 0.8855866 1.0857309 1.0001682 
## 
## Coefficients:
##                 Value Std.Error   t-value p-value
## (Intercept) 17.417595 0.8657121 20.119383  0.0000
## SexFemale   -2.045167 0.7361425 -2.778222  0.0065
## age          0.674651 0.0702284  9.606521  0.0000
## 
##  Correlation: 
##           (Intr) SexFml
## SexFemale -0.346       
## age       -0.840  0.000
## 
## Standardized residuals:
##          Min           Q1          Med           Q3          Max 
## -2.508191537 -0.584408334  0.003646016  0.531073432  2.179748120 
## 
## Residual standard error: 2.318325 
## Degrees of freedom: 108 total; 105 residual</code></pre>
</div>
<div id="gls-with-compound-symmetry" class="section level3 hasAnchor" number="6.9.26">
<h3><span class="header-section-number">6.9.26</span> GLS with compound symmetry<a href="statistical-models.html#gls-with-compound-symmetry" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb932"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb932-1"><a href="statistical-models.html#cb932-1" tabindex="-1"></a>gls.comsys <span class="ot">&lt;-</span> <span class="fu">gls</span>(distance <span class="sc">~</span> Sex <span class="sc">+</span>age, Orthodont,</span>
<span id="cb932-2"><a href="statistical-models.html#cb932-2" tabindex="-1"></a>                   <span class="at">correlation =</span> <span class="fu">corCompSymm</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> Subject))</span>
<span id="cb932-3"><a href="statistical-models.html#cb932-3" tabindex="-1"></a><span class="fu">summary</span>(gls.comsys)</span></code></pre></div>
<pre><code>## Generalized least squares fit by REML
##   Model: distance ~ Sex + age 
##   Data: Orthodont 
##        AIC      BIC    logLik
##   447.5125 460.7823 -218.7563
## 
## Correlation Structure: Compound symmetry
##  Formula: ~1 | Subject 
##  Parameter estimate(s):
##       Rho 
## 0.6144914 
## 
## Coefficients:
##                 Value Std.Error   t-value p-value
## (Intercept) 17.706713 0.8339225 21.233044  0.0000
## SexFemale   -2.321023 0.7614169 -3.048294  0.0029
## age          0.660185 0.0616059 10.716263  0.0000
## 
##  Correlation: 
##           (Intr) SexFml
## SexFemale -0.372       
## age       -0.813  0.000
## 
## Standardized residuals:
##         Min          Q1         Med          Q3         Max 
## -2.59712955 -0.64544226 -0.02540005  0.51680604  2.32947531 
## 
## Residual standard error: 2.305697 
## Degrees of freedom: 108 total; 105 residual</code></pre>
<p>Interpretation guidance:
- <code>gls()</code> is often a good baseline when you want to emphasize covariance structure.
- <code>lme()</code> is preferred when subject-specific effects are scientifically meaningful (e.g., patient-specific baselines).</p>
</div>
<div id="practical-limitation-of-lme4" class="section level3 hasAnchor" number="6.9.27">
<h3><span class="header-section-number">6.9.27</span> Practical limitation of lme4<a href="statistical-models.html#practical-limitation-of-lme4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>lme4</strong> is extremely powerful for random effects, but it does not natively support rich residual correlation structures. In <code>lme4</code>, residuals are assumed independent conditional on random effects (i.e., <span class="math inline">\(\boldsymbol\Sigma=\sigma^2\mathbf{I}\)</span>). You can fit complex random-effects covariance structures, but not AR(1)/Gaussian/exponential residual correlations in the same direct way as <code>nlme</code>.</p>
<p>This is why, in longitudinal data analysis, a common workflow is:</p>
<ul>
<li>use <code>lme4</code> for flexible random-effects modeling and efficient fitting,</li>
<li>use <code>nlme</code> when you need explicit residual correlation structures.</li>
</ul>
</div>
</div>
<div id="manual-simulating-data-for-linear-mix-model" class="section level2 hasAnchor" number="6.10">
<h2><span class="header-section-number">6.10</span> Manual simulating data for linear mix model<a href="statistical-models.html#manual-simulating-data-for-linear-mix-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><a href="https://rpubs.com/Daniel_He/1041001">see here</a></p>
</div>
<div id="how-to-calculate-the-prediction-interval-for-lmm" class="section level2 hasAnchor" number="6.11">
<h2><span class="header-section-number">6.11</span> How to calculate the prediction interval for LMM<a href="statistical-models.html#how-to-calculate-the-prediction-interval-for-lmm" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><a href="https://rpubs.com/Daniel_He/1041063">see here</a></p>
</div>
<div id="least-squares-means-with-interaction-effect" class="section level2 hasAnchor" number="6.12">
<h2><span class="header-section-number">6.12</span> Least-squares means with interaction effect<a href="statistical-models.html#least-squares-means-with-interaction-effect" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><a href="https://rpubs.com/Daniel_He/1041369">see here</a></p>
</div>
<div id="spline-regression" class="section level2 hasAnchor" number="6.13">
<h2><span class="header-section-number">6.13</span> Spline regression<a href="statistical-models.html#spline-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><a href="https://rpubs.com/Daniel_He/1041069">see here</a></p>

<!-- # --- -->
<!-- # title: "Probability" -->
<!-- # author: "Daniel He" -->
<!-- # date: "2026-02-20" -->
<!-- # output: -->
<!-- #   html_document: -->
<!-- #     toc: true -->
<!-- #     toc_depth: 3 -->
<!-- #   pdf_document: -->
<!-- #     toc: true -->
<!-- #     toc_depth: 3 -->
<!-- #   word_document: -->
<!-- #     toc: true -->
<!-- #     toc_depth: 3 -->
<!-- # --- -->
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="basic-statistics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="probability.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/USERNAME/REPO/edit/BRANCH/06-00-stamodels.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["_main.pdf", "_main.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
